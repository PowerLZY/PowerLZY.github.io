<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 6.3.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">

<link rel="stylesheet" href="https://fonts.lug.ustc.edu.cn/css?family=Lato:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext">

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" integrity="sha256-HtsXJanqjKTc8vVQjO4YMhiqFoXkfBsjBWcX91T1jr8=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pace/1.2.4/themes/blue/pace-theme-bounce.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pace/1.2.4/pace.min.js" integrity="sha256-gqd7YTjg/BtfqWSwsJOvndl0Bxc8gFImLEkXQT8+qj0=" crossorigin="anonymous"></script>

<script class="next-config" data-name="main" type="application/json">{"hostname":"powerlzy.github.io","root":"/","images":"/images","scheme":"Pisces","darkmode":false,"version":"8.15.1","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":{"enable":true,"style":"mac"},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"},"path":"/search.xml","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false}}</script><script src="/js/config.js"></script>

    <meta name="description" content="Dynamic Malware Analysis with Feature Engineering and Feature Learning  项目：https:&#x2F;&#x2F;github.com&#x2F;joddiy&#x2F;DynamicMalwareAnalysis 文章：https:&#x2F;&#x2F;arxiv.org&#x2F;abs&#x2F;1907.07352  摘要 动态恶意软件分析在隔离的环境中执行程序，并监控其运行时行为（如系统API">
<meta property="og:type" content="article">
<meta property="og:title" content="恶意软件检测（2）Dynamic Malware Analysis with Feature Engineering and Feature Learning">
<meta property="og:url" content="https://powerlzy.github.io/posts/NFRYYZ/index.html">
<meta property="og:site_name" content="PowerLZY&#39;s Blog">
<meta property="og:description" content="Dynamic Malware Analysis with Feature Engineering and Feature Learning  项目：https:&#x2F;&#x2F;github.com&#x2F;joddiy&#x2F;DynamicMalwareAnalysis 文章：https:&#x2F;&#x2F;arxiv.org&#x2F;abs&#x2F;1907.07352  摘要 动态恶意软件分析在隔离的环境中执行程序，并监控其运行时行为（如系统API">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://lzy-picture.oss-cn-beijing.aliyuncs.com/img/202304191547460.png">
<meta property="og:image" content="https://lzy-picture.oss-cn-beijing.aliyuncs.com/img/202304191547725.png">
<meta property="og:image" content="https://lzy-picture.oss-cn-beijing.aliyuncs.com/img/202304191548610.png">
<meta property="og:image" content="https://lzy-picture.oss-cn-beijing.aliyuncs.com/img/202304191548031.png">
<meta property="og:image" content="https://lzy-picture.oss-cn-beijing.aliyuncs.com/img/202304191548958.png">
<meta property="og:image" content="https://lzy-picture.oss-cn-beijing.aliyuncs.com/img/202304191548514.png">
<meta property="og:image" content="https://powerlzy.github.io/posts/NFRYYZ/image-20220526184352710.png">
<meta property="og:image" content="https://lzy-picture.oss-cn-beijing.aliyuncs.com/img/202304191548788.png">
<meta property="article:published_time" content="2022-05-26T08:04:26.856Z">
<meta property="article:modified_time" content="2023-04-19T07:52:32.278Z">
<meta property="article:author" content="lzy">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://lzy-picture.oss-cn-beijing.aliyuncs.com/img/202304191547460.png">


<link rel="canonical" href="https://powerlzy.github.io/posts/NFRYYZ/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"https://powerlzy.github.io/posts/NFRYYZ/","path":"posts/NFRYYZ/","title":"恶意软件检测（2）Dynamic Malware Analysis with Feature Engineering and Feature Learning"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>恶意软件检测（2）Dynamic Malware Analysis with Feature Engineering and Feature Learning | PowerLZY's Blog</title>
  








  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">PowerLZY's Blog</p>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">本博客主要用于记录个人学习笔记（测试阶段）</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="搜索" role="button">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup"><div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off" maxlength="80"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close" role="button">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="search-result-container no-result">
  <div class="search-result-icon">
    <i class="fa fa-spinner fa-pulse fa-5x"></i>
  </div>
</div>

    </div>
  </div>

</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link"><span class="nav-text">Dynamic
Malware Analysis with Feature Engineering and Feature Learning</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link"><span class="nav-text">摘要</span></a></li><li class="nav-item nav-level-3"><a class="nav-link"><span class="nav-text">一、说明</span></a></li><li class="nav-item nav-level-3"><a class="nav-link"><span class="nav-text">二、相关工作</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link"><span class="nav-text">2.1 API调用的功能工程</span></a></li><li class="nav-item nav-level-4"><a class="nav-link"><span class="nav-text">2.2 Deep Learning Based
Approaches</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link"><span class="nav-text">三、系统框架</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link"><span class="nav-text">3.1 PE文件收集</span></a></li><li class="nav-item nav-level-4"><a class="nav-link"><span class="nav-text">3.2 行为信息收集</span></a></li><li class="nav-item nav-level-4"><a class="nav-link"><span class="nav-text">3.3 特征提取和模型训练</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link"><span class="nav-text">4、方法</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link"><span class="nav-text">4.1 特征工程</span></a></li><li class="nav-item nav-level-4"><a class="nav-link"><span class="nav-text">API名称和类别</span></a></li><li class="nav-item nav-level-4"><a class="nav-link"><span class="nav-text">API参数</span></a></li><li class="nav-item nav-level-4"><a class="nav-link"><span class="nav-text">统计信息</span></a></li><li class="nav-item nav-level-4"><a class="nav-link"><span class="nav-text">4.2 模型结构</span></a></li><li class="nav-item nav-level-4"><a class="nav-link"><span class="nav-text">输入模块</span></a></li><li class="nav-item nav-level-4"><a class="nav-link"><span class="nav-text">门控CNNs模块</span></a></li><li class="nav-item nav-level-4"><a class="nav-link"><span class="nav-text">BI-LSTM模块</span></a></li><li class="nav-item nav-level-4"><a class="nav-link"><span class="nav-text">分类模块</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link"><span class="nav-text">
Dynamic Malware Analysis - 代码结构</span></a></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="lzy"
      src="/images/cat_mac.jpg">
  <p class="site-author-name" itemprop="name">lzy</p>
  <div class="site-description" itemprop="description">相比到达的地方，同行的人更重要！</div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">263</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">57</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">70</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author animated">
      <span class="links-of-author-item">
        <a href="https://github.com/PowerLZY" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;PowerLZY" rel="noopener me" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:3289218653@qq.com" title="E-Mail → mailto:3289218653@qq.com" rel="noopener me" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
  </div>
  <div class="cc-license animated" itemprop="license">
    <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/zh-CN" class="cc-opacity" rel="noopener" target="_blank"><img src="https://cdnjs.cloudflare.com/ajax/libs/creativecommons-vocabulary/2020.11.3/assets/license_badges/small/by_nc_sa.svg" alt="Creative Commons"></a>
  </div>

        </div>
      </div>
        <div class="back-to-top animated" role="button" aria-label="返回顶部">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://powerlzy.github.io/posts/NFRYYZ/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/cat_mac.jpg">
      <meta itemprop="name" content="lzy">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="PowerLZY's Blog">
      <meta itemprop="description" content="相比到达的地方，同行的人更重要！">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="恶意软件检测（2）Dynamic Malware Analysis with Feature Engineering and Feature Learning | PowerLZY's Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          恶意软件检测（2）Dynamic Malware Analysis with Feature Engineering and Feature Learning
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2022-05-26 16:04:26" itemprop="dateCreated datePublished" datetime="2022-05-26T16:04:26+08:00">2022-05-26</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2023-04-19 15:52:32" itemprop="dateModified" datetime="2023-04-19T15:52:32+08:00">2023-04-19</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E3%80%90draft%E3%80%91%E5%BA%94%E7%94%A8/" itemprop="url" rel="index"><span itemprop="name">【draft】应用</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E3%80%90draft%E3%80%91%E5%BA%94%E7%94%A8/%E5%AD%A6%E6%9C%AF%E5%89%8D%E6%B2%BF/" itemprop="url" rel="index"><span itemprop="name">学术前沿</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E3%80%90draft%E3%80%91%E5%BA%94%E7%94%A8/%E5%AD%A6%E6%9C%AF%E5%89%8D%E6%B2%BF/%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8/" itemprop="url" rel="index"><span itemprop="name">网络安全</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E3%80%90draft%E3%80%91%E5%BA%94%E7%94%A8/%E5%AD%A6%E6%9C%AF%E5%89%8D%E6%B2%BF/%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8/%E6%81%B6%E6%84%8F%E8%BD%AF%E4%BB%B6%E6%A3%80%E6%B5%8B/" itemprop="url" rel="index"><span itemprop="name">恶意软件检测</span></a>
        </span>
    </span>

  
    <span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">阅读次数：</span>
      <span id="busuanzi_value_page_pv"></span>
    </span>
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>12k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>22 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
        <h2><span id="dynamicmalware-analysis-with-feature-engineering-and-feature-learning">Dynamic
Malware Analysis with Feature Engineering and Feature Learning</span></h2>
<ul>
<li>项目：https://github.com/joddiy/DynamicMalwareAnalysis</li>
<li>文章：https://arxiv.org/abs/1907.07352</li>
</ul>
<h3><span id="摘要">摘要</span></h3>
<p>动态恶意软件分析在隔离的环境中执行程序，并监控其运行时行为（如系统<strong>API调用</strong>），以检测恶意软件。该技术已被证明对各种代码混淆技术和新发布的（“零日”）恶意软件有效。然而，现有的工作通常<strong>只考虑API名称而忽略参数</strong>，<strong>或者需要复杂的特征工程操作和专家知识来处理参数</strong>。在本文中，我们<strong>提出了一种新的、低成本的特征提取方法，以及一种有效的深度神经网络体系结构，用于准确、快速地检测恶意软件</strong>。具体而言，<strong>特征表示方法利用特征哈希技巧对与API名称关联的API调用参数进行编码</strong>。深度神经网络体系结构应用多个选通CNN（卷积神经网络）来转换每个API调用的提取特征。通过双向LSTM（长-短期内存网络）进一步处理输出，以<strong>了解API调用之间的顺序相关性</strong>。实验表明，我们的解决方案在大型真实数据集上的性能明显优于基线。从烧蚀研究中获得了有关特征工程和建筑设计的宝贵见解。</p>
<h3><span id="一-说明">一、说明</span></h3>
<p>网络安全给全世界带来了巨大的经济成本。美国政府的一份报告（CEA
2018）估计，2016年美国经济中恶意网络活动的成本在570亿美元至1090亿美元之间。恶意软件（或恶意软件）是快速发展的主要网络安全威胁之一。据报道，每年发现超过1.2亿个新的恶意软件样本（AV-TEST
2017）。因此，开发恶意软件检测技术是迫切而必要的。</p>
<p>数十年来，研究人员一直致力于恶意软件检测。主流解决方案包括静态分析和动态分析。静态分析方法扫描软件的二进制字节流以创建签名，如可打印字符串、n-gram、指令等（Kruegel等人，2005）。然而，基于签名的静态分析可能容易受到代码混淆的影响（Rhode、Burnap和Jones，2018；Gibert等人，2018），或者不足以检测新的（“zeroday”）恶意软件（Vinod等人，2009）。相反，动态分析算法在隔离的环境（例如沙盒）中执行每个软件，以收集其运行时行为信息。通过使用行为信息，动态分析的检测率更高，比静态分析更稳健（Damodaran
et al.2017）。在本文中，我们主要关注动态分析。</p>
<p>在行为信息中，<strong>系统API调用序列</strong>是最常用的数据源，因为它捕获了软件执行的所有操作（包括<strong>网络访问、文件操作等</strong>）。序列中的每个API调用都包含两个重要部分，即<strong>API名称和参数</strong>。每个API可能有零个或多个参数，每个参数都表示为<strong>名称-值对</strong>。为了处理行为信息，提出了许多特征工程方法。例如，如果我们将API名称视为一个字符串，则可以提取最多N个（例如1000个）频繁的N-gram特征（N=1，2.....)
从序列中。然而，从异构类型的参数（包括字符串、整数、地址等）中提取特征并非易事。最近，研究人员将深度学习模型应用于动态分析。卷积神经网络（CNN）和递归神经网络（RNN）等深度学习模型可以直接从序列数据中学习特征，而无需进行特征工程。尽管如此，计算机视觉和自然语言处理等传统深度学习应用程序的数据是同质的，例如图像（或文本）。<strong>使用深度学习模型处理异构API参数仍然具有挑战性</strong>。因此，大多数现有方法都忽略了这些参数。有几种利用API参数的方法（Tian
et al.2010；Fang et al.2017；Agrawal et
al.2018）。然而，这些方法要么将所有参数视为字符串（Tian et
al.2010；Agrawal et al.2018），要么只考虑参数的统计信息（Ahmed et
al.2009；Tian et al.2010；Islam et
al.2013）。因此，<strong>它们无法充分利用来自不同类型参数的异构信息</strong>。</p>
<p>在本文中，我们提出了一种<strong>新的特征工程方法</strong>和一种<strong>新的恶意软件检测深度学习体系结构</strong>。特别是，对于不同类型的参数，我们的特征工程方法<strong>利用哈希方法分别提取异构特征</strong>。<strong>从API名称、类别和参数中提取的特征将进一步串联并输入到深度学习模型中</strong>。我们使用多个选通CNN模型（Dauphin
et
al.2017）从每个API调用的高维哈希特征中学习抽象的低维特征。来自选通CNN模型的输出由双向LSTM处理，以提取所有API调用的顺序相关性。</p>
<p>我们的解决方案比所有基线都有很大的优势。通过广泛的烧蚀研究，我们发现特征工程和模型架构设计对于实现高泛化性能至关重要。本文的主要贡献包括：</p>
<ul>
<li>我们为系统API参数提出了一种新的特征表示。从我们的数据集中提取的特征将发布供公众访问。</li>
<li>我们设计了一种深度神经网络结构来处理提取的特征，它将多个门控CNN和一个双向LSTM相结合。它以巨大的利润超过了所有现有的解决方案。</li>
<li>我们在一个大型真实数据集1上进行了广泛的实验。通过消融研究，发现了有关特征和模型架构的宝贵见解。</li>
</ul>
<h3><span id="二-相关工作">二、相关工作</span></h3>
<p>在本节中，我们将从特征工程和深度学习的角度回顾动态恶意软件分析。</p>
<h4><span id="21-api调用的功能工程">2.1 API调用的功能工程</span></h4>
<p>（Trinius等人，2009）介绍了一种称为<strong>恶意软件指令集（MIST）</strong>的特征表示。MIST使用多个级别的功能来表示系统调用。第一级表示API调用的类别和名称。以下级别是为每个API调用手动指定的，以表示它们的参数。然而，对于不同的API，同一级别的特性可能表示不同类型的信息。这种不一致性给使用机器学习模型学习模式带来了挑战。</p>
<p>（Qiao等人，2013）扩展了MIST，提出了一种称为<strong>基于字节的行为指令集（BBIS）</strong>的表示。他们声称，只有MIST的第一级（API调用的类别和名称）是有效的。此外，他们还提出了一种算法<strong>CARL来处理连续重复的API调用</strong>。</p>
<p>统计特征是训练机器学习模型的常用方法。提取API调用名称及其参数中的字符串，以计算频率和分布，作为中的特征（Tian
et al.2010；Islam et al.2010；2013）。（Ahmed et
al.2009）还使用统计特征来捕获空间和时间信息。从参数中提取空间信息，如均值、方差和熵。时间信息来自ngram
API调用，包括两个n-gram API调用之间的相关性和转换可能性。</p>
<p>（Salehi、Ghiasi和Sami
2012）提出了一种将API调用与其参数关联起来的特性表示。它将每个参数与其API调用的名称连接起来，形成一个新的序列，然而，这种方法会导致一个非常长的特征向量，并且可能会丢失API调用序列的模式。</p>
<p>（Hansen等人，2016）提出了另外两种特征表示法。这些表示包括前200个API调用及其“参数”。但是，此“参数”仅指示此API调用是否与后一个API调用连接，而忽略原始参数。</p>
<h4><span id="22-deep-learning-basedapproaches">2.2 Deep Learning Based
Approaches</span></h4>
<p>（David and Netanyahu
2015）将<strong>沙盒报告视为一个完整的文本字符串</strong>，然后用任何特殊字符拆分所有字符串。他们计算每个字符串的频率，并使用20000位向量来表示最频繁的20000个字符串。他们的模型是一个<strong>深度信念网络（DBN）</strong>，由八层组成（从20000个大小的向量到30个大小的向量）。利用交叉熵损失对模型进行训练。在一个包含600个测试样本的小数据集上，它们的准确率达到98.6%。</p>
<p>（Pascanu et
al.2015）提出了两个阶段的方法，即特征学习阶段和分类阶段。在第一阶段，他们<strong>使用RNN根据之前的API调用序列预测下一个可能的API调用</strong>。在分类阶段，他们冻结RNN，并将输出输入最大池层，以转换特征进行分类。在75000个样本的数据集上，它们的召回率达到71.71%，假阳性率为0.1%。</p>
<p><strong>（Kolosnjaji et
al.2016）提出了一种将CNN与LSTM相结合的方法。他们的方法堆叠两个CNN层，每个CNN层使用一个3大小的内核来模拟3-gram方法。在CNN之后，附加一个具有100大小隐藏向量的LSTM来处理时间序列。以前的论文通常忽略了论点。</strong></p>
<p><strong>（Huang和Stokes
2016）使用了一种包含三个部分的特征表示，即参数中存在可运行代码、API调用名称与其中一个参数的组合（手动选择）以及3-gram的API调用序列</strong>。通过随机投影（random
projection），此特征表示从50000减少到4000。（Agrawal et
al.2018）提出了一种特征表示方法，<strong>该方法使用来自API调用名称的一个one-hot和参数字符串的前N个频繁N-gram</strong>。该模型使用了几个堆叠的LSTM，其性能优于（Kolosnjaji等人，2016）。他们还声称，多个LSTM不能提高性能。</p>
<h3><span id="三-系统框架">三、系统框架</span></h3>
<p>为了收集运行时API调用，我们实现了图1所示的系统。该系统由体育档案采集、行为信息采集、特征提取和模型训练三部分组成。</p>
<figure>
<img src="https://lzy-picture.oss-cn-beijing.aliyuncs.com/img/202304191547460.png" alt="image-20220526165948643">
<figcaption aria-hidden="true">image-20220526165948643</figcaption>
</figure>
<h4><span id="31-pe文件收集">3.1 PE文件收集</span></h4>
<p>我们系统的工作流程从可移植可执行文件（PE）集合开始。在本文中，我们重点检测Windows系统中可移植可执行文件（PE）格式的恶意软件，这是最流行的恶意软件文件格式（AV-TEST
2017）。此收集部分已由新加坡SecureAge
Technology本地反病毒公司实施。此外，该公司还维护了一个包含12个防病毒引擎的平台，用于对PE文件进行分类。对分类结果进行聚合，以获得每个PE文件的标签，用于模型培训。一旦模型经过培训，它将作为第13个防病毒引擎添加到平台中。收集之后，将维护一个执行队列，以提交PE文件以供执行。它监视存储使用情况并决定是否执行更多PE文件。</p>
<h4><span id="32-行为信息收集">3.2 行为信息收集</span></h4>
<blockquote>
<p>https://cuckoosandbox.org/</p>
<p>json在线解析：http://www.jsons.cn/jsoncheck/</p>
</blockquote>
<p><strong>布谷鸟</strong>是一款开源软件，用于运行PE文件和收集执行日志。它在虚拟机内执行PE文件，并使用API挂钩监视API调用跟踪（即行为信息）。此外，布谷鸟模拟了一些用户行为，例如单击按钮、键入一些文本等。<strong>在我们的系统中，我们在每台服务器上维护了数十台虚拟机。所有虚拟机都安装了64位Windows
7系统和一些日常使用的软件</strong>。我们利用虚拟机的快照功能在执行后回滚它。<strong>所有生成的日志都存储在本地的布谷鸟服务器上</strong>。</p>
<h4><span id="33-特征提取和模型训练">3.3 特征提取和模型训练</span></h4>
<p>沙盒生成的执行日志包含<strong>PE文件的详细运行时信息</strong>，PE文件的大小从几KB到数百GB不等。我们设计了一个可以<strong>并行运行的特征工程解决方案</strong>，<strong>以有效地从原始执行日志中提取特征</strong>。提取特征后，我们在带有GPU的模型服务器上训练我们的深度学习模型，以进行恶意软件分类。</p>
<h3><span id="4-方法">4、方法</span></h3>
<blockquote>
<p>#### cuckoo json:</p>
<ul>
<li><p><strong>behavior</strong></p>
<ul>
<li><p>summary</p>
<ul>
<li>file_recreated</li>
<li>file_failed</li>
<li>dll_loaded</li>
<li>guid</li>
<li>file_opened</li>
<li>file_created</li>
<li>file_written</li>
</ul></li>
<li><p><strong>generic</strong></p>
<ul>
<li>process_path: 进程启动路径</li>
<li><strong>process_name</strong>: 进程执行程序名</li>
<li>pid: 进程id</li>
<li>first_seen: 进程启动时间戳</li>
<li>ppid: 父进程id</li>
</ul></li>
<li><p><strong>apistats</strong>：<strong>API名称的调用次数信息</strong></p></li>
<li><p><strong>processes</strong></p>
<ul>
<li><p>command_line</p></li>
<li><p><strong>calls</strong></p>
<blockquote>
<p>{ "<strong>api</strong>": "NtCreateFile",
"<strong>category</strong>": "file", "return_value": 0, "stacktrace": [
], "flags": { "desired_access":
"FILE_READ_ATTRIBUTES|READ_CONTROL|SYNCHRONIZE", "share_access":
"FILE_SHARE_READ", "file_attributes": "", "create_disposition":
"FILE_OPEN", "create_options":
"FILE_NON_DIRECTORY_FILE|FILE_SYNCHRONOUS_IO_NONALERT", "status_info":
"FILE_OPENED" }, "<strong>arguments</strong>": { "desired_access":
"0x00120080", "share_access": 1, "<strong>filepath_r</strong>":
"\??\C:\Users\xn\AppData\Local\Temp\0e823db8b1beaca62207e2a82a9cd691c7af44cd14b876cb9f823f29750dd008",
"<strong>filepath</strong>":
"C:\Users\xn\AppData\Local\Temp\0e823db8b1beaca62207e2a82a9cd691c7af44cd14b876cb9f823f29750dd008",
"file_attributes": 0, "create_disposition": 1, "file_handle":
"0x000004ac", "status_info": 1, "create_options": 96 }, "tid": 3564,
"status": 1, "time": 1622640835.384851 },</p>
</blockquote></li>
<li><p><strong>modules</strong>: <strong>样本运行时调用的系统文件信息,
包括被调用文件名/路径/基地址及其大小</strong></p></li>
<li><p>time: 运行时间</p></li>
</ul></li>
<li><p><strong>processtree</strong></p>
<ul>
<li>children: 子进程列表</li>
</ul></li>
</ul></li>
</ul>
</blockquote>
<h4><span id="41-特征工程">4.1 特征工程</span></h4>
<blockquote>
<ul>
<li><p><strong>FeatureHasher</strong>:
https://scikit-learn.org/dev/modules/generated/sklearn.feature_extraction.FeatureHasher.html#sklearn.feature_extraction.FeatureHasher</p></li>
<li><p><strong>Feature Hashing for Large Scale Multitask
Learning</strong> （2013）</p></li>
</ul>
</blockquote>
<p>以前的大多数工作（Qiao et al.2013；Pascanu et al.2015；Kolosnjaji et
al.2016）都<strong>忽略了API调用的参数</strong>，只考虑了API名称和类别。因此，一些重要（鉴别）信息丢失（Agrawal
et
al.2018）。例如，如果忽略文件路径参数，则两个写操作（API调用）的功能将完全相同。但是，当目标文件由程序本身创建时，写入操作可能是良性的，但如果目标文件是系统文件，则写入操作可能是恶意的。一些考虑到论点的著作（Trinius
et al.2009；Agrawal et al.2018；Huang and Stokes
2016）未能利用不同类型论点的异质信息。我们建议采用（Weinberger et
al.2009）中的哈希方法，<strong>分别对API的名称、类别和参数进行编码</strong>。</p>
<p>如下表所示，我们的特征表示由不同类型的信息组成。<strong>API名称有8维，API类别有4维。API参数部分有90个维，16个用于整数参数，74个用于字符串参数。对于字符串参数，将处理几种特定类型的字符串（文件路径、DLL等）。此外，从所可打印字符串中提取了10个统计特征</strong>。将所有这些特征串联起来，形成<strong>102维特征向量</strong>。</p>
<p><img src="https://lzy-picture.oss-cn-beijing.aliyuncs.com/img/202304191547725.png" alt="image-20220526170451620" style="zoom:50%;"></p>
<ul>
<li><h4><span id="api名称和类别">API名称和类别</span></h4></li>
</ul>
<blockquote>
<p>单词拆分？fastext？<strong>删除循环调用？</strong></p>
</blockquote>
<p><strong>布谷鸟沙盒总共跟踪312个API调用，它们属于17个类别</strong>。每个API名称由多个单词组成，每个单词的第一个字母大写，例如“<strong>GetFileSize</strong>”。我们<strong>将API名称拆分为单词</strong>，然后应用下面的<strong>特性哈希技巧处理这些单词</strong>。对于API类别，由于该类别通常是单个单词，例如“<strong>network</strong>”，我们将该单词拆分为字符并应用特征哈希技巧。此外，我们<strong>计算API名称、类别和参数的MD5值，以删除任何连续重复的API调用</strong>。</p>
<p>我们使用方程1中的<strong>特征哈希</strong>（Weinberger et
al.2009）<strong>将字符串序列编码为固定长度的向量</strong>。随机变量x表示元素序列，其中每个元素要么是字符串，要么是字符。M表示维度数量，即8表示API名称，4表示API类别。第i个bin的值通过以下公式计算：</p>
<p><img src="https://lzy-picture.oss-cn-beijing.aliyuncs.com/img/202304191548610.png" alt="image-20220526172933876" style="zoom:50%;"></p>
<p>其中，h是将元素（例如xj）映射到自然数m的哈希函数∈
{1，…，M}作为bin索引；ξ是另一个将元素映射到{+-1}
。也就是说，对于x的每个元素xj，其bin索引h（xj）为i，我们将ξ（xj）添加到bin中。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">APIName</span>(<span class="title class_ inherited__">FeatureType</span>):</span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27; api_name hash info &#x27;&#x27;&#x27;</span></span><br><span class="line">    name = <span class="string">&#x27;api_name&#x27;</span></span><br><span class="line">    dim = <span class="number">8</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">super</span>(FeatureType, self).__init__()</span><br><span class="line">        self._name = re.<span class="built_in">compile</span>(<span class="string">&#x27;^[a-z]+|[A-Z][^A-Z]*&#x27;</span>)</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">raw_features</span>(<span class="params">self, input_dict</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        input_dict: string</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        tmp = self._name.findall(input_dict)</span><br><span class="line">        hasher = FeatureHasher(self.dim, input_type=<span class="string">&quot;string&quot;</span>).transform([tmp]).toarray()[<span class="number">0</span>]</span><br><span class="line">        <span class="keyword">return</span> hasher</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">process_raw_features</span>(<span class="params">self, raw_obj</span>):</span><br><span class="line">        <span class="keyword">return</span> raw_obj</span><br><span class="line">      </span><br><span class="line"><span class="keyword">class</span> <span class="title class_">APICategory</span>(<span class="title class_ inherited__">FeatureType</span>):</span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27; api_category hash info &#x27;&#x27;&#x27;</span></span><br><span class="line">    name = <span class="string">&#x27;api_category&#x27;</span></span><br><span class="line">    dim = <span class="number">4</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">super</span>(FeatureType, self).__init__()</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">raw_features</span>(<span class="params">self, input_dict</span>):</span><br><span class="line">        hasher = FeatureHasher(self.dim, input_type=<span class="string">&quot;string&quot;</span>).transform([input_dict]).toarray()[<span class="number">0</span>]</span><br><span class="line">        <span class="keyword">return</span> hasher</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">process_raw_features</span>(<span class="params">self, raw_obj</span>):</span><br><span class="line">        <span class="keyword">return</span> raw_obj</span><br></pre></td></tr></table></figure>
<ul>
<li><h4><span id="api参数">API参数</span></h4></li>
</ul>
<figure>
<img src="https://lzy-picture.oss-cn-beijing.aliyuncs.com/img/202304191548031.png" alt="image-20230319160222991">
<figcaption aria-hidden="true">image-20230319160222991</figcaption>
</figure>
<p>至于API参数，只有两种类型的值，即<strong>整数</strong>和<strong>字符串</strong>。整数的单个值没有意义。需要参数名称才能获取值的含义。<strong>相同的整数值可能表示具有不同参数名称的完全不同语义</strong>。例如，<strong>名为“port”的数字22与名为“size”的数字不同</strong>。我们采用前面的特征哈希方法<strong>对整数的参数名称及其值进行编码</strong>，如等式2所示。我们使用参数名称来定位哈希容器。特别是，我们使用名称哈希值为i的所有参数通过求和更新第i个bin。对于每个这样的参数，我们计算对bin的贡献，如等式2所示，其中ξ(<span class="math inline">\(x_{name_j}\)</span>)是参数名称上的哈希函数，<span class="math inline">\(x_{value_j}\)</span>是整数参数的值。由于整数可能在某个范围内稀疏分布，因此我们使用对数对值进行规格化，以压缩该范围。</p>
<p><img src="https://lzy-picture.oss-cn-beijing.aliyuncs.com/img/202304191548958.png" alt="image-20220526174316254" style="zoom:50%;"></p>
<p>其中，h和ξ是与等式1中相同的哈希函数。<strong>对于API参数字符串，它们的值比整数更复杂。某些以“0x”开头的字符串包含某些对象的地址。还有一些可能包含文件路径、IP地址、URL或纯文本</strong>。此外，一些API参数甚至可能包含整个文件的内容。字符串的多样性使得处理它们具有挑战性。根据之前的工作（Tian
et al.2010；Islam et al.2010；2013；Ahmed et
al.2009），最重要的字符串是关于<strong>文件路径、DLL、注册表项、URL和IP地址的值</strong>。因此，我们使用<strong>方程1中的特征哈希方法【string】</strong>来提取这些字符串的特征。</p>
<p>为了捕获<strong>字符串中包含的层次信息</strong>，我们将整个字符串解析为几个子字符串，并分别对它们进行处理。例如，我们使用“C:\”来标识文件路径。所有这些子串都通过方程1进行处理</p>
<blockquote>
<p><strong>Path</strong>：<strong>对于像“C:\a\b\C”这样的路径，将生成四个子字符串，即“C:”、“C:\a”、“C:\a\b”和“C:\a\b\C”。</strong></p>
<p>dll：以“.dll”结尾的字符串</p>
<p>注册表：项通常以“HKEY”开头</p>
<p>IP：由点分隔的四个数字（范围从0到255）组成的字符串</p>
<p>URL：我们仅从URL的主机名生成子字符串。例如，对于“https://security.ai.cs.org/，将生成以下子字符串“org”、“cs.org”、“ai.cs.org”和“security.ai.cs.org”。</p>
</blockquote>
<p><strong>DLL、注册表项和IP也采用相同的处理方法</strong>。<strong>dll是以“.dll”结尾的字符串。注册表项通常以“HKEY”开头。IP是由点分隔的四个数字（范围从0到255）组成的字符串</strong>。URL略有不同，我们仅从URL的主机名生成子字符串。例如，对于“https://security.ai.cs.org/，将生成以下子字符串“org”、“cs.org”、“ai.cs.org”和“security.ai.cs.org”。这样，域和组织信息将对该功能贡献更多。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">PRUIInfo</span>(<span class="title class_ inherited__">FeatureType</span>):</span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27; Path, Registry, Urls, IPs hash info &#x27;&#x27;&#x27;</span></span><br><span class="line">    name = <span class="string">&#x27;prui&#x27;</span></span><br><span class="line">    dim = <span class="number">16</span> + <span class="number">8</span> + <span class="number">12</span> + <span class="number">16</span> + <span class="number">12</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">super</span>(FeatureType, self).__init__()</span><br><span class="line">        self._paths = re.<span class="built_in">compile</span>(<span class="string">&#x27;^c:\\\\&#x27;</span>, re.IGNORECASE)</span><br><span class="line">        self._dlls = re.<span class="built_in">compile</span>(<span class="string">&#x27;.+\.dll$&#x27;</span>, re.IGNORECASE)</span><br><span class="line">        self._urls = re.<span class="built_in">compile</span>(<span class="string">&#x27;^https?://(.+?)[/|\s|:]&#x27;</span>, re.IGNORECASE)</span><br><span class="line">        self._registry = re.<span class="built_in">compile</span>(<span class="string">&#x27;^HKEY_&#x27;</span>)</span><br><span class="line">        self._ips = re.<span class="built_in">compile</span>(<span class="string">&#x27;^\d&#123;1,3&#125;\.\d&#123;1,3&#125;\.\d&#123;1,3&#125;\.\d&#123;1,3&#125;&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">raw_features</span>(<span class="params">self, input_dict</span>):</span><br><span class="line">        paths = np.zeros((<span class="number">16</span>,), dtype=np.float32)</span><br><span class="line">        dlls = np.zeros((<span class="number">8</span>,), dtype=np.float32)</span><br><span class="line">        registry = np.zeros((<span class="number">12</span>,), dtype=np.float32)</span><br><span class="line">        urls = np.zeros((<span class="number">16</span>,), dtype=np.float32)</span><br><span class="line">        ips = np.zeros((<span class="number">12</span>,), dtype=np.float32)</span><br><span class="line">        <span class="keyword">for</span> str_name, str_value <span class="keyword">in</span> input_dict.items():</span><br><span class="line">            <span class="keyword">if</span> self._dlls.<span class="keyword">match</span>(str_value):</span><br><span class="line">                tmp = re.split(<span class="string">&#x27;//|\\\\|\.&#x27;</span>, str_value)[:-<span class="number">1</span>]</span><br><span class="line">                tmp = [<span class="string">&#x27;\\&#x27;</span>.join(tmp[:i]) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="built_in">len</span>(tmp) + <span class="number">1</span>)]</span><br><span class="line">                dlls += FeatureHasher(<span class="number">8</span>, input_type=<span class="string">&quot;string&quot;</span>).transform([tmp]).toarray()[<span class="number">0</span>]</span><br><span class="line">            <span class="keyword">if</span> self._paths.<span class="keyword">match</span>(str_value):</span><br><span class="line">                tmp = re.split(<span class="string">&#x27;//|\\\\|\.&#x27;</span>, str_value)[:-<span class="number">1</span>]</span><br><span class="line">                tmp = [<span class="string">&#x27;\\&#x27;</span>.join(tmp[:i]) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="built_in">len</span>(tmp) + <span class="number">1</span>)]</span><br><span class="line">                paths += FeatureHasher(<span class="number">16</span>, input_type=<span class="string">&quot;string&quot;</span>).transform([tmp]).toarray()[<span class="number">0</span>]</span><br><span class="line">            <span class="keyword">elif</span> self._registry.<span class="keyword">match</span>(str_value):</span><br><span class="line">                tmp = str_value.split(<span class="string">&#x27;\\&#x27;</span>)[:<span class="number">6</span>]</span><br><span class="line">                tmp = [<span class="string">&#x27;\\&#x27;</span>.join(tmp[:i]) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="built_in">len</span>(tmp) + <span class="number">1</span>)]</span><br><span class="line">                registry += FeatureHasher(<span class="number">12</span>, input_type=<span class="string">&quot;string&quot;</span>).transform([tmp]).toarray()[<span class="number">0</span>]</span><br><span class="line">            <span class="keyword">elif</span> self._urls.<span class="keyword">match</span>(str_value):</span><br><span class="line">                tmp = self._urls.split(str_value + <span class="string">&quot;/&quot;</span>)[<span class="number">1</span>]</span><br><span class="line">                tmp = tmp.split(<span class="string">&#x27;.&#x27;</span>)[::-<span class="number">1</span>]</span><br><span class="line">                tmp = [<span class="string">&#x27;.&#x27;</span>.join(tmp[:i][::-<span class="number">1</span>]) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="built_in">len</span>(tmp) + <span class="number">1</span>)]</span><br><span class="line">                urls += FeatureHasher(<span class="number">16</span>, input_type=<span class="string">&quot;string&quot;</span>).transform([tmp]).toarray()[<span class="number">0</span>]</span><br><span class="line">            <span class="keyword">elif</span> self._ips.<span class="keyword">match</span>(str_value):</span><br><span class="line">                tmp = str_value.split(<span class="string">&#x27;.&#x27;</span>)</span><br><span class="line">                tmp = [<span class="string">&#x27;.&#x27;</span>.join(tmp[:i]) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="built_in">len</span>(tmp) + <span class="number">1</span>)]</span><br><span class="line">                ips += FeatureHasher(<span class="number">12</span>, input_type=<span class="string">&quot;string&quot;</span>).transform([tmp]).toarray()[<span class="number">0</span>]</span><br><span class="line">        <span class="keyword">return</span> np.hstack([paths, dlls, registry, urls, ips]).astype(np.float32)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">process_raw_features</span>(<span class="params">self, raw_obj</span>):</span><br><span class="line">        <span class="keyword">return</span> raw_obj</span><br></pre></td></tr></table></figure>
<h4><span id="统计信息">统计信息</span></h4>
<p>对于许多其他类型的字符串，根据之前的工作（Ahmed et al.2009；Tian et
al.2010；Islam et
al.2010），我们<strong>从所有可打印字符串中提取统计信息</strong>。可打印字符串由0x20到0x7f的字符组成。<strong>因此，包括所有路径、注册表项、URL、IP和其他一些可打印字符串</strong>。</p>
<ul>
<li>以“MZ”开头的一类字符串通常是包含整个PE文件的缓冲区，通常出现在恶意PE文件中，如<strong>线程注入</strong>（Liu
et al.2011）。因此，我们额外计算“MZ”字符串的出现次数。</li>
<li><strong>10维向量用于记录字符串的数量、平均长度、字符数、所有可打印字符串的字符熵，以及路径、DLL、URL、注册表项、IP和“MZ”字符串的数量。</strong>我们没有处理其他参数，如虚拟地址、结构等，与上述类型的参数相比，这些参数相对不太重要。</li>
</ul>
<p>虽然所提出的特征工程方法很容易使用额外的bins应用于它们，但我们期待着进行更有针对性的研究来探索这些论点。</p>
<h4><span id="42-模型结构">4.2 模型结构</span></h4>
<p>我们提出了一种深度神经网络架构，它利用了所提出的特征工程步骤中的特征。图2概述了我们提出的深度学习模型。</p>
<p><img src="https://lzy-picture.oss-cn-beijing.aliyuncs.com/img/202304191548514.png" alt="image-20220526184024769" style="zoom:50%;"></p>
<ul>
<li><h4><span id="输入模块">输入模块</span></h4></li>
</ul>
<p>在特征工程之后，我们得到大小为（N，d）的输入向量，<strong>其中N是API调用序列的长度</strong>，<strong>d（102位）是每个提取的API特征的维数</strong>。我们首先通过<strong>批量规范化层（BN）</strong>对输入进行规范化（Ioffe和Szegedy
2015）。该批次标准化层通过减去批次平均值并除以批次标准偏差来标准化输入值。<strong>它保证了特征向量的某些维数不会太大而影响训练；实验验证了该方法的正则化效果。</strong></p>
<ul>
<li><h4><span id="门控cnns模块">门控CNNs模块</span></h4></li>
</ul>
<p>输入模块后应用了多个<strong>门控-CNN</strong>（Dauphin et
al.2017）。<strong>门控-CNN允许选择重要和相关的信息，使其在语言任务上与循环模型相比，但消耗更少的资源和时间</strong>。对于每个选通的CNN，输入分别馈入两个卷积层。设XA表示第一卷积层的输出，XB表示第二卷积层的输出；它们由<img src="image-20220526184352710.png" alt="image-20220526184352710" style="zoom:50%;">组成，它涉及到元素乘法运算。这里，σ是sigmoid函数。<strong>σ（XB）被视为控制从XA传递到模型中下一层的信息的门</strong>。<strong>按照（Shen
et
al.2014)中的想法，一维卷积滤波器被用作n-gram检测器。如图2所示，我们使用两个选通CNN，其过滤器大小分别为2和3。所有卷积层的滤波器个数为128，步长为1。</strong></p>
<ul>
<li><h4><span id="bi-lstm模块">BI-LSTM模块</span></h4></li>
</ul>
<p><strong>来自门CNN的所有输出连接在一起</strong>。对这些输出应用批处理规范化层，以减少过拟合。我们使用<strong>双向LSTM来学习序列模式</strong>。<strong>每个LSTM的单元数为100</strong>。LSTM是一种递归神经网络架构，其中设计了几个门来控制信息传输状态，以便能够捕获长期上下文信息（Pichotta和Mooney
2016）。双向LSTM是两个LSTM叠加在一起，但方向输入不同。与单向LSTM相比，双向LSTM能够同时整合过去和未来状态的信息。双向LSTM在恶意软件检测方面已被证明是有效的（Agrawal
et al.2018）。</p>
<ul>
<li><h4><span id="分类模块">分类模块</span></h4></li>
</ul>
<p><strong>在Bi
LSTM模块中学习序列模式后，应用全局最大池层从隐藏向量中提取抽象特征</strong>。全局最大池层不是使用Bi
LSTM的最终激活，而是依赖于整个序列中观察到的每个信号，这有助于保留整个序列中学习到的相关信息。在全局最大池层之后，<strong>我们使用单元数为64的密集层将中间向量的维数减少到64</strong>。将<strong>ReLU激活应用于该致密层</strong>。然后，我们使用速率为0.5的<strong>衰减层（dropout）</strong>来减少过度拟合。最后，<strong>单位数为1的致密层将维数减少到1</strong>。在致密层之后附加一个<strong>Sigmoid激活以输出概率</strong>。我们的模型使用与每个输入向量相关的标签进行监督。为了测量用于训练模型的损失。</p>
<p><img src="https://lzy-picture.oss-cn-beijing.aliyuncs.com/img/202304191548788.png" alt="image-20220526185129696" style="zoom:50%;"></p>
<p>此外，我们采用的优化方法是Adam，学习率为0.001。</p>
<h2><span id="dynamic-malware-analysis-代码结构"><strong><font color="red">
Dynamic Malware Analysis - 代码结构</font></strong></span></h2>
<blockquote>
<p><strong>model.py</strong></p>
<ul>
<li>ClassifyGenerator: Generates data for Keras</li>
<li>Model: 模型结构定义、模型训练</li>
<li>Cuckoo2DMDS：</li>
<li>DMDS</li>
</ul>
</blockquote>

    </div>

    
    
    

    <footer class="post-footer">
          

<div class="post-copyright">
<ul>
  <li class="post-copyright-author">
      <strong>本文作者： </strong>lzy
  </li>
  <li class="post-copyright-link">
      <strong>本文链接：</strong>
      <a href="https://powerlzy.github.io/posts/NFRYYZ/" title="恶意软件检测（2）Dynamic Malware Analysis with Feature Engineering and Feature Learning">https://powerlzy.github.io/posts/NFRYYZ/</a>
  </li>
  <li class="post-copyright-license">
      <strong>版权声明： </strong>本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/zh-CN" rel="noopener" target="_blank"><i class="fab fa-fw fa-creative-commons"></i>BY-NC-SA</a> 许可协议。转载请注明出处！
  </li>
</ul>
</div>


        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/posts/BZK9HE/" rel="prev" title="算法长征（12）图">
                  <i class="fa fa-chevron-left"></i> 算法长征（12）图
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/posts/3403A74/" rel="next" title="恶意软件检测（3）Living-Off-The-Land 恶意软件系统分析">
                  恶意软件检测（3）Living-Off-The-Land 恶意软件系统分析 <i class="fa fa-chevron-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 
  <span itemprop="copyrightYear">2023</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">lzy</span>
</div>
<div class="busuanzi-count">
    <span class="post-meta-item" id="busuanzi_container_site_uv">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="总访客量">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-item" id="busuanzi_container_site_pv">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="总访问量">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>

<!--
  <div class="powered-by">由 <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/pisces/" rel="noopener" target="_blank">NexT.Pisces</a> 强力驱动
  </div>-->
<!-- 网站运行时间的设置 -->
<span id="timeDate">载入天数...</span>
<span id="times">载入时分秒...</span>
<script>
    var now = new Date();
    function createtime() {
        var grt= new Date("03/01/2023 10:00:00"); //此处修改你的建站时间或者网站上线时间
        now.setTime(now.getTime()+250);
        days = (now - grt ) / 1000 / 60 / 60 / 24; dnum = Math.floor(days);
        hours = (now - grt ) / 1000 / 60 / 60 - (24 * dnum); hnum = Math.floor(hours);
        if(String(hnum).length ==1 ){hnum = "0" + hnum;} minutes = (now - grt ) / 1000 /60 - (24 * 60 * dnum) - (60 * hnum);
        mnum = Math.floor(minutes); if(String(mnum).length ==1 ){mnum = "0" + mnum;}
        seconds = (now - grt ) / 1000 - (24 * 60 * 60 * dnum) - (60 * 60 * hnum) - (60 * mnum);
        snum = Math.round(seconds); if(String(snum).length ==1 ){snum = "0" + snum;}
        document.getElementById("timeDate").innerHTML = "本站已安全运行 "+dnum+" 天 ";
        document.getElementById("times").innerHTML = hnum + " 小时 " + mnum + " 分 " + snum + " 秒.";
    }
setInterval("createtime()",250);
</script>

    </div>
  </footer>

  

  <a href="https://github.com/PowerLZY" class="github-corner" title="在 GitHub 上关注我" aria-label="在 GitHub 上关注我" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/next-boot.js"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-generator-searchdb/1.4.1/search.js" integrity="sha256-1kfA5uHPf65M5cphT2dvymhkuyHPQp5A53EGZOnOLmc=" crossorigin="anonymous"></script>
<script src="/js/third-party/search/local-search.js"></script>


  <script class="next-config" data-name="mermaid" type="application/json">{"enable":true,"theme":{"light":"default","dark":"dark"},"js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/mermaid/9.4.3/mermaid.min.js","integrity":"sha256-e0o3JYsdjqKajf9eOe22FhioYSz9WofRY4dLKo3F6do="}}</script>
  <script src="/js/third-party/tags/mermaid.js"></script>


  <script src="/js/third-party/pace.js"></script>

  
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>




  

  <script class="next-config" data-name="enableMath" type="application/json">true</script><script class="next-config" data-name="mathjax" type="application/json">{"enable":true,"tags":"all","js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/mathjax/3.2.2/es5/tex-mml-chtml.js","integrity":"sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI="}}</script>
<script src="/js/third-party/math/mathjax.js"></script>




        <script src="//cdn.jsdelivr.net/npm/js-base64/base64.min.js"></script>
        <script>
        const hasAttr = (e,a) => a.some(_=> e.attr(_)!==undefined);
        $('a').each(function() {
          const $this = $(this);
          if(hasAttr($this,["data-fancybox","ignore-external-link"])) return;
          const href = $this.attr('href');
          if (href && href.match('^((http|https|thunder|qqdl|ed2k|Flashget|qbrowser|ftp|rtsp|mms)://)')) {
            const strs = href.split('/');
            if (strs.length >= 3) {
                const host = strs[2];
                if (host !== 'powerlzy.github.io' || window.location.host) {
                    $this.attr('href', '/go.html?u='+Base64.encode(href)+'').attr('rel', 'external nofollow noopener noreferrer');
                    if (true) {
                        $this.attr('target', '_blank');
                    }
                }
            }
          }
        });
        </script></body>
</html>
