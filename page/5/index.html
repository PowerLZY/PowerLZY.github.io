<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 6.3.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">

<link rel="stylesheet" href="https://fonts.lug.ustc.edu.cn/css?family=Lato:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext">

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" integrity="sha256-HtsXJanqjKTc8vVQjO4YMhiqFoXkfBsjBWcX91T1jr8=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pace/1.2.4/themes/blue/pace-theme-bounce.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pace/1.2.4/pace.min.js" integrity="sha256-gqd7YTjg/BtfqWSwsJOvndl0Bxc8gFImLEkXQT8+qj0=" crossorigin="anonymous"></script>

<script class="next-config" data-name="main" type="application/json">{"hostname":"powerlzy.github.io","root":"/","images":"/images","scheme":"Pisces","darkmode":false,"version":"8.15.1","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":{"enable":true,"style":"mac"},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"},"path":"/search.xml","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false}}</script><script src="/js/config.js"></script>

    <meta name="description" content="相比到达的地方，同行的人更重要！">
<meta property="og:type" content="website">
<meta property="og:title" content="PowerLZY&#39;s Blog">
<meta property="og:url" content="https://powerlzy.github.io/page/5/index.html">
<meta property="og:site_name" content="PowerLZY&#39;s Blog">
<meta property="og:description" content="相比到达的地方，同行的人更重要！">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="lzy">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="https://powerlzy.github.io/page/5/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":true,"isPost":false,"lang":"zh-CN","comments":"","permalink":"","path":"page/5/index.html","title":""}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>PowerLZY's Blog</title>
  








  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">PowerLZY's Blog</h1>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">本博客主要用于记录个人学习笔记（测试阶段）</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="搜索" role="button">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup"><div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off" maxlength="80"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close" role="button">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="search-result-container no-result">
  <div class="search-result-icon">
    <i class="fa fa-spinner fa-pulse fa-5x"></i>
  </div>
</div>

    </div>
  </div>

</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="lzy"
      src="/images/cat_mac.jpg">
  <p class="site-author-name" itemprop="name">lzy</p>
  <div class="site-description" itemprop="description">相比到达的地方，同行的人更重要！</div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">263</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">57</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">70</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author animated">
      <span class="links-of-author-item">
        <a href="https://github.com/PowerLZY" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;PowerLZY" rel="noopener me" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:3289218653@qq.com" title="E-Mail → mailto:3289218653@qq.com" rel="noopener me" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
  </div>
  <div class="cc-license animated" itemprop="license">
    <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/zh-CN" class="cc-opacity" rel="noopener" target="_blank"><img src="https://cdnjs.cloudflare.com/ajax/libs/creativecommons-vocabulary/2020.11.3/assets/license_badges/small/by_nc_sa.svg" alt="Creative Commons"></a>
  </div>

        </div>
      </div>
        <div class="back-to-top animated" role="button" aria-label="返回顶部">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner index posts-expand">

    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://powerlzy.github.io/posts/67Q9G2/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/cat_mac.jpg">
      <meta itemprop="name" content="lzy">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="PowerLZY's Blog">
      <meta itemprop="description" content="相比到达的地方，同行的人更重要！">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | PowerLZY's Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/posts/67Q9G2/" class="post-title-link" itemprop="url">风控算法（4）特征工程-时间滑窗统计特征体系</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>
      

      <time title="创建时间：2022-07-08 14:52:55 / 修改时间：15:00:37" itemprop="dateCreated datePublished" datetime="2022-07-08T14:52:55+08:00">2022-07-08</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E3%80%90draft%E3%80%91%E5%BA%94%E7%94%A8/" itemprop="url" rel="index"><span itemprop="name">【draft】应用</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E3%80%90draft%E3%80%91%E5%BA%94%E7%94%A8/%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF/" itemprop="url" rel="index"><span itemprop="name">应用场景</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E3%80%90draft%E3%80%91%E5%BA%94%E7%94%A8/%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF/%E4%B8%9A%E5%8A%A1%E5%AE%89%E5%85%A8/" itemprop="url" rel="index"><span itemprop="name">业务安全</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>855</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>2 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2><span id="风控特征时间滑窗统计特征体系">风控特征—时间滑窗统计特征体系</span></h2>
<h4><span id="风控业务背景"><strong>风控业务背景</strong></span></h4>
<p>俗话说，路遥知马力，日久见人心。在风控中也是如此，我们常<strong>从时间维度提取借款人在不同时间点的特征</strong>，以此来判断借款人的风险。在实践中，这类特征通常会占到80%以上。由于是<strong>通过时间切片和聚合统计函数来构造，因此一般被称为时间滑窗统计特征。</strong></p>
<h3><span id="一-观察期-观察点及表现期">一、<strong>观察期、观察点及表现期</strong></span></h3>
<p>理解这三者的概念是风控建模前期样本准备的基础，在此简单介绍。</p>
<ul>
<li><strong>观察点（</strong>Observation
Point<strong>）</strong>：并非是一个具体的时间点，而是一个时间区间，表示的是客户申请贷款的时间。在该时间段申请的客户<strong>可能</strong>会是我们用来建模的样本
。（提示：为什么用“可能”这个描述，因为还需剔除一些强规则命中的异常样本，这部分样本将不会加入建模）</li>
<li><strong>观察期</strong>（Observation
Window）：用以<strong>构造特征X</strong>的时间窗口。相对于观察点而言，是<strong>历史</strong>时间。观察期的选择依赖于用户数据的厚薄程度。通常数据越厚，可提取的信息也就越全面、可靠。</li>
<li><strong>表现期</strong>（Performance
Window）：定义<strong>好坏标签Y</strong>的时间窗口。相对于观察点而言，是<strong>未来</strong>时间。由于风险需要有一定时间窗才能表现出来，因此信贷风险具有<strong>滞后性</strong>。表现期的长短可以通过Vintage分析和滚动率分析来确定，在此不做展开。
<img src="https://pic3.zhimg.com/80/v2-c47416a557f573a72acccb00ec5a37fe_1440w.jpg" alt="img"></li>
</ul>
<p>表现期越长，信用风险暴露将越彻底，但意味着观察期离当前将越远，用以提取样本特征的历史数据将越陈旧，建模样本和未来样本的差异也越大。反之，表现期越短，风险还未暴露完全，但好处是能用到更近的样本。</p>
<h3><span id="二-rfm模型介绍">二、<strong>RFM模型介绍</strong></span></h3>
<p><strong>RFM模型最早是用来衡量客户价值和客户创利能力</strong>。理解RFM框架的思想是构造统计类特征的基础，其含义为：</p>
<ul>
<li><strong>R（Recency）</strong>：客户最近一次交易消费时间的间隔。R值越大，表示客户交易发生的日期越久，反之则表示客户交易发生的日期越近。</li>
<li><strong>F（Frequency）</strong>：客户在最近一段时间内交易消费的次数。F值越大，表示客户交易越频繁，反之则表示客户交易不够活跃。</li>
<li><strong>M（Monetary）</strong>：客户在最近一段时间内交易消费的金额。M值越大，表示客户价值越高，反之则表示客户价值越低。</li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://powerlzy.github.io/posts/3NAHDTK/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/cat_mac.jpg">
      <meta itemprop="name" content="lzy">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="PowerLZY's Blog">
      <meta itemprop="description" content="相比到达的地方，同行的人更重要！">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | PowerLZY's Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/posts/3NAHDTK/" class="post-title-link" itemprop="url">模型训练（2）梯度消失&爆炸</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2022-07-06 20:40:21" itemprop="dateCreated datePublished" datetime="2022-07-06T20:40:21+08:00">2022-07-06</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2023-05-02 14:49:01" itemprop="dateModified" datetime="2023-05-02T14:49:01+08:00">2023-05-02</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E7%AE%97%E6%B3%95/" itemprop="url" rel="index"><span itemprop="name">算法</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E7%AE%97%E6%B3%95/%E3%80%90draft%E3%80%91%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/" itemprop="url" rel="index"><span itemprop="name">【draft】深度学习</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E7%AE%97%E6%B3%95/%E3%80%90draft%E3%80%91%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/%E8%AE%AD%E7%BB%83%E6%8A%80%E5%B7%A7/" itemprop="url" rel="index"><span itemprop="name">训练技巧</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>14k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>25 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p><strong>本质上</strong>是因为神经网络的更新方法，梯度消失是因为反向传播过程中对梯度的求解会产生sigmoid导数和参数的连乘，sigmoid导数的最大值为0.25，权重一般初始都在0，1之间，乘积小于1，多层的话就会有多个小于1的值连乘，导致靠近输入层的梯度几乎为0，得不到更新。梯度爆炸是也是同样的原因，只是如果初始权重大于1，或者更大一些，多个大于1的值连乘，将会很大或溢出，导致梯度更新过大，模型无法收敛。<strong><font color="red">
梯度爆炸和梯度消失问题都是因为网络太深，网络权值更新不稳定造成的，本质上是因为梯度反向传播中的连乘效应。</font></strong></p>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/posts/3NAHDTK/#more" rel="contents">
                阅读全文 &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://powerlzy.github.io/posts/K4HD8V/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/cat_mac.jpg">
      <meta itemprop="name" content="lzy">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="PowerLZY's Blog">
      <meta itemprop="description" content="相比到达的地方，同行的人更重要！">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | PowerLZY's Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/posts/K4HD8V/" class="post-title-link" itemprop="url">模型训练（1）loss不下降</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2022-07-06 20:13:08" itemprop="dateCreated datePublished" datetime="2022-07-06T20:13:08+08:00">2022-07-06</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2023-05-01 16:32:11" itemprop="dateModified" datetime="2023-05-01T16:32:11+08:00">2023-05-01</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E7%AE%97%E6%B3%95/" itemprop="url" rel="index"><span itemprop="name">算法</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E7%AE%97%E6%B3%95/%E3%80%90draft%E3%80%91%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/" itemprop="url" rel="index"><span itemprop="name">【draft】深度学习</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E7%AE%97%E6%B3%95/%E3%80%90draft%E3%80%91%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/%E8%AE%AD%E7%BB%83%E6%8A%80%E5%B7%A7/" itemprop="url" rel="index"><span itemprop="name">训练技巧</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>1.1k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>2 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h3><span id="一-训练的时候-loss不下降">一、<strong>训练的时候 loss
不下降</strong></span></h3>
<ul>
<li><strong>模型结构问题</strong>。当模型结构不好、规模小时，模型对数据的拟合能力不足。</li>
<li>训练时间问题。不同的模型有不同的计算量，当需要的计算量很大时，耗时也会很大</li>
<li><strong>权重初始化问题</strong>。常用的初始化方案有全零初始化、正态分布初始化和均匀分布初始化等，合适的初始化方案很重要，之前提到过<strong><a href="http://link.zhihu.com/?target=https%3A//mp.weixin.qq.com/s/OcEqqQq59a-djZqBsh_7Zw">神经网络初始化为0可能会带来的影响</a></strong></li>
<li><strong>正则化问题</strong>。L1、L2以及Dropout是为了防止过拟合的，当训练集loss下不来时，就要考虑一下是不是正则化过度，导致模型欠拟合了。正则化相关可参考<strong><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/418228948">正则化之L1 &amp;
L2</a></strong></li>
<li><strong>激活函数问题</strong>。全连接层多用ReLu，神经网络的输出层会使用sigmoid
或者 softmax。激活函数可参考<strong><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/455086947">常用的几个激活函数</a></strong>。在使用Relu激活函数时，当每一个神经元的输入为负时，会使得该神经元输出恒为0，导致失活，由于此时梯度为0，无法恢复。</li>
<li><strong>优化器问题</strong>。优化器一般选取Adam，但是当Adam难以训练时，需要使用如SGD之类的其他优化器。常用优化器可参考<strong><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/446357922">机器学习中常用的优化器有哪些？</a></strong></li>
<li><strong>学习率问题</strong>。学习率决定了网络的训练速度，但学习率不是越大越好，当网络趋近于收敛时应该选择较小的学习率来保证找到更好的最优点。所以，我们需要手动调整学习率，首先选择一个合适的初始学习率，当训练不动之后，稍微降低学习率。</li>
<li><strong><font color="red">
梯度消失和爆炸。</font></strong>这时需要考虑激活函数是否合理，网络深度是否合理，可以通过调节sigmoid
-&gt; relu，假如残差网络等，相关可参考<strong><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/442914336">为什么神经网络会有梯度消失和梯度爆炸问题？如何解决？</a></strong></li>
<li><strong>batch
size过小</strong>，会导致模型损失波动大，难以收敛，过大时，模型前期由于梯度的平均，导致收敛速度过慢。</li>
<li>数据集问题。（1）数据集未打乱，可能会导致网络在学习过程中产生一定的偏见（2）噪声过多、标注有大量错误时，会导致神经网络难以学到有用的信息，从而出现摇摆不定的情况，<strong><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/434532885">噪声、缺失值、异常值</a></strong>（3）数据类别不均衡使得少数类别由于信息量不足，难以学到本质特征，样本不均衡相关可以看<strong><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/411613746">样本不均衡及其解决办法</a></strong>。</li>
<li><strong>特征问题</strong>。特征选择不合理，会使网络学习难度增加。之前有提到过特征选择的文章，<strong><a href="http://link.zhihu.com/?target=https%3A//mp.weixin.qq.com/s/WO_NCTt1O1tgYkZV4vnd7g">如何找到有意义的组合特征</a></strong>,<strong><a href="http://link.zhihu.com/?target=https%3A//mp.weixin.qq.com/s/CN7AIhoU3SKOK_Sej6i5Jw">特征选择方法</a></strong></li>
</ul>
<h3><span id="二-测试的时候-loss不下降">二、<strong>测试的时候 loss
不下降</strong></span></h3>
<blockquote>
<p>训练的时候过拟合导致效果不好</p>
</blockquote>
<ul>
<li><strong><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/437803892">交叉检验</a></strong>，通过交叉检验得到较优的模型参数;</li>
<li><strong><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/434089082">特征选择</a></strong>，减少特征数或使用较少的特征组合，对于按区间离散化的特征，增大划分的区间;</li>
<li><strong><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/418228948">正则化</a></strong>，常用的有
L1、L2 正则。而且 L1正则还可以自动进行特征选择;</li>
<li>如果有正则项则可以考虑增大正则项参数<img src="https://www.zhihu.com/equation?tex=%5Clambda" alt="[公式]">;</li>
<li>增加训练数据可以有限的避免过拟合;</li>
<li>Bagging ,将多个弱学习器Bagging
一下效果会好很多，比如随机森林等.</li>
<li>早停策略。本质上是交叉验证策略，选择合适的训练次数，避免训练的网络过度拟合训练数据。</li>
<li><strong><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/410867062">DropOut策略</a></strong>。</li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://powerlzy.github.io/posts/2E809GM/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/cat_mac.jpg">
      <meta itemprop="name" content="lzy">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="PowerLZY's Blog">
      <meta itemprop="description" content="相比到达的地方，同行的人更重要！">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | PowerLZY's Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/posts/2E809GM/" class="post-title-link" itemprop="url">深度学习-NLP-命名实体识别</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>
      

      <time title="创建时间：2022-07-03 22:24:04 / 修改时间：22:42:05" itemprop="dateCreated datePublished" datetime="2022-07-03T22:24:04+08:00">2022-07-03</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E7%AE%97%E6%B3%95/" itemprop="url" rel="index"><span itemprop="name">算法</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E7%AE%97%E6%B3%95/%E3%80%90draft%E3%80%91%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/" itemprop="url" rel="index"><span itemprop="name">【draft】深度学习</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E7%AE%97%E6%B3%95/%E3%80%90draft%E3%80%91%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/NLP/" itemprop="url" rel="index"><span itemprop="name">NLP</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>91</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>1 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2><span id="命名实体识别-bilstm-crf模型">命名实体识别-BiLSTM-CRF模型</span></h2>
<blockquote>
<p>最通俗易懂的BiLSTM-CRF模型中的CRF层介绍 - 孙孙的文章 - 知乎
https://zhuanlan.zhihu.com/p/44042528</p>
</blockquote>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://powerlzy.github.io/posts/31GH3TV/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/cat_mac.jpg">
      <meta itemprop="name" content="lzy">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="PowerLZY's Blog">
      <meta itemprop="description" content="相比到达的地方，同行的人更重要！">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | PowerLZY's Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/posts/31GH3TV/" class="post-title-link" itemprop="url">高级威胁发现（5）Log2vec: A Heterogeneous Graph Embedding Based Approach for Detecting Cyber Threats within Enterprise</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2022-07-03 17:46:43" itemprop="dateCreated datePublished" datetime="2022-07-03T17:46:43+08:00">2022-07-03</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2023-04-19 15:55:27" itemprop="dateModified" datetime="2023-04-19T15:55:27+08:00">2023-04-19</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E3%80%90draft%E3%80%91%E5%BA%94%E7%94%A8/" itemprop="url" rel="index"><span itemprop="name">【draft】应用</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E3%80%90draft%E3%80%91%E5%BA%94%E7%94%A8/%E5%AD%A6%E6%9C%AF%E5%89%8D%E6%B2%BF/" itemprop="url" rel="index"><span itemprop="name">学术前沿</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E3%80%90draft%E3%80%91%E5%BA%94%E7%94%A8/%E5%AD%A6%E6%9C%AF%E5%89%8D%E6%B2%BF/%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8/" itemprop="url" rel="index"><span itemprop="name">网络安全</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E3%80%90draft%E3%80%91%E5%BA%94%E7%94%A8/%E5%AD%A6%E6%9C%AF%E5%89%8D%E6%B2%BF/%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8/%E9%AB%98%E7%BA%A7%E5%A8%81%E8%83%81%E5%8F%91%E7%8E%B0/" itemprop="url" rel="index"><span itemprop="name">高级威胁发现</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>3.2k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>6 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2><span id="log2veca-heterogeneous-graph-embedding-based-approach-for-detecting-cyberthreats-within-enterprise"><strong>Log2vec:
A Heterogeneous Graph Embedding Based Approach for Detecting Cyber
Threats within Enterprise</strong></span></h2>
<blockquote>
<p>【顶会论文解读】Log2vec 基于异构图Heterogeneous Graph
检测网络空间威胁 - 笑个不停的文章 - 知乎
https://zhuanlan.zhihu.com/p/275952146</p>
<p><strong>AIops博客</strong>：https://blog.csdn.net/markaustralia/category_11284226.html</p>
<p><a target="_blank" rel="noopener" href="https://randy.blog.csdn.net/article/details/111773951?spm=1001.2101.3001.6650.1&amp;utm_medium=distribute.pc_relevant.none-task-blog-2%7Edefault%7ECTRLIST%7Edefault-1-111773951-blog-118577347.pc_relevant_multi_platform_whitelistv1&amp;depth_1-utm_source=distribute.pc_relevant.none-task-blog-2%7Edefault%7ECTRLIST%7Edefault-1-111773951-blog-118577347.pc_relevant_multi_platform_whitelistv1&amp;utm_relevant_index=2">基于深度学习的日志数据异常检测</a></p>
</blockquote>
<p>发表在<strong>CCS2019</strong>会议的一篇应用异质图embedding进行企业内部网络空间威胁检测的文章。</p>
<h3><span id="摘要">摘要</span></h3>
<p>内部人员的攻击以及APT攻击是组织常见的攻击类型，现有的检测算法多基于行为检测，大部分方法考虑log日志的序列关系以及用户的行为序列，忽略了其他的关系导致不使用于丰富多样的攻击场景。<strong>本文提出的Log2vec模型，将日志转化为异质图，将日志学习为低纬度的embedding并使用检测算法进行攻击检测（由于攻击样本较少，因此使用聚类算法进行检测）。</strong></p>
<h3><span id="一-引言">一、引言</span></h3>
<p>现有方法一般会转换用户的各种操作（也包括日志条目）分成序列，这些序列可以保存信息，例如
日志条目之间的顺序关系，然后使用序列处理技术，例如
深度学习从过去的事件中学习并预测下一个事件。<strong>本质上，这些日志条目级别的方法可以模拟用户的正常行为行为并将其偏离标记为异常。</strong></p>
<p>但是，这种方法忽略了其他关系。
例如，<strong>比较用户的日常行为是常规内部威胁检测的一种常用方法</strong>。
此检测基于以下前提：用户的日常行为在一段时间内（几天之间的逻辑关系）相对规则。
上述预测方法忽略了这种关系，并且会降低其性能。
此外，他们需要正常的日志条目，甚至需要大量标记数据来进行模型训练。
但是，在现实世界中，存在罕见的攻击动作，从而限制了其正确预测的能力。</p>
<p><strong>对于检测内部威胁以及APT攻击来说，我们面临三个问题：</strong></p>
<p>（1）<strong>如何同时检测上述两种攻击情形，特别是考虑到检测系统中提到的所有三种关系（日志之间序列关系
sequantial relationship among log entries、几天之内的逻辑关系logical
relationship among days以及交互关系interactive relationship among
hosts）；</strong></p>
<p><strong>解决办法</strong>：构建异构图来表示前面提到的三种关系；</p>
<p>（2）<strong>如何在APT场景中进行细粒度的检测，尤其是深入挖掘和分析主机内日志条目之间的关系；</strong></p>
<p><strong>解决办法</strong>：将日志条目分为五个属性。根据这些属性，我们深入考虑了主机内日志之间的关系，并设计了精细的规则来关联它们。这种设计使正常和异常日志条目可以在这种图中拥有不同的拓扑；</p>
<p>（3）<strong>如何针对训练模型进行无攻击样本的检测。【内部威胁】</strong></p>
<p><strong>解决办法</strong>：log2vec的图嵌入和检测算法将日志条目表示并分组到不同的群集中，而没有攻击样本，适用于数据不平衡的情况（针对问题3）。此外，图形嵌入本身可以自动学习每个操作的表示形式（矢量），而无需手动提取特定于领域的特征，从而独立于专家的知识。我们的改进版本可以进一步差分提取并表示来自上述异构图的操作之间的多个关系。</p>
<h3><span id="二-文章的设计">二、<strong>文章的设计</strong></span></h3>
<p><strong>Log2vec包含以下三个组件：</strong></p>
<ul>
<li><p><strong>图的构造。</strong>
Log2vec构造一个异构图以集成日志之间的多个关系条目;</p></li>
<li><p><strong>图嵌入</strong>（也是图表示学习）。这是一种强大的图形处理方法，可用于了解每个操作的</p>
<p>表示（向量）基于它们在这种图中的关系。通过矢量化用户操作，可以直接比较他们的操作</p>
<p>找出异常的相似之处；</p></li>
<li><p><strong>检测算法，</strong>无监督，要有效将恶意操作分组为单个群集</p></li>
</ul>
<p><img src="https://lzy-picture.oss-cn-beijing.aliyuncs.com/img/202304191555029.png" alt="image-20220703183858975" style="zoom:50%;"></p>
<h3><span id="三-概述">三、概述</span></h3>
<p><img src="https://lzy-picture.oss-cn-beijing.aliyuncs.com/img/202304191555735.png" alt="image-20220703184011385" style="zoom:50%;"></p>
<p>如图2（a）所示，<strong>日志记录了用户的操作，如登录操作，设备之间移动操作以及网络操作</strong>。图2（b）描述日志的属性，<strong>主体（user），操作类型（visit或者send），客体（网址或者是邮件）以及时间和主机（设备ID）</strong>。实际上，日志的属性能够反映用户的行为，比如，第一个登录的时间和日志结束的时间能够反映用户的工作时长。系统管理员会频繁的登录服务器和操作对系统进行维护。</p>
<p>图2（c）将a中显示的<strong>日志组成序列</strong>，然后使用如LSTM的方法学习日志序列信息进行预测。此类模型能够捕捉日志的因果信息和序列关系。但是，这样的方法忽视了其他关系，比如（a）中day3序列，有大量的设备连接和文件复制的操作，远比以前多（这意味着数据泄露）。
可以通过直接比较用户的日常行为来检测出这种差异。进行比较的前提是，在一段时间内（几天之间的逻辑关系），用户的日常行为相对规则且相似。
虽然是深度学习，例如
LSTM可以记住序列的长期依赖关系（多天），它没有明确比较用户的日常行为，也无法获得令人满意的性能。
类似地，它们不能保持图2d中主机之间的另一种关系，交互关系，并且不能在APT检测中正常工作。
另外，其中一些需要大量标记数据进行培训。
但是，在我们的检测方案中，存在罕见的攻击行为。</p>
<p>图2d展示了图2a中的登录（红色字体）的图表，<strong>该图表指示用户在主机之间的行为</strong>。
我们可以分析主机之间的这些交互关系，以发现异常登录。
例如，管理员可以定期登录到一组主机以进行系统维护，而APT实施者只能访问他可以访问的主机。
登录跟踪的功能可以捕获这种差异。例如，良性跟踪中涉及的主机数量（1或3，实线）通常不同于APT（2，虚线）。在分析了这些功能之后，可以识别出受感染的主机。
但是，这些主机包含许多良性操作，并且手动提取的特定于域的特征显然无法应用于图2c中的攻击。</p>
<p>本文构建的模型用于检测以下类型的攻击：
第一种情况是<strong>内部人员滥用职权执行恶意操作，例如访问数据库或应用程序服务器，然后破坏系统或窃取知识产权以谋取个人利益</strong>。
其次，<strong>恶意内部人员通过窥视或密钥记录器获取其他合法用户的凭据，并利用此新身份来寻找机密信息或在公司中造成混乱</strong>。
这两种情况属于内部员工的典型攻击。
第三种攻击是<strong>APT参与者破坏了系统中的主机，并从该主机中持续破坏了多个主机，以提升其特权并窃取机密文件。</strong></p>
<h3><span id="四-详细论述"><strong>四、详细论述</strong></span></h3>
<h4><span id="41-图构建">4.1 图构建</span></h4>
<p><strong><font color="red">
本文构建的图的节点是日志，只有一种节点类型，边是通过规则来建立联系的，本文提出10条规则，代表着图有10种边类型。因此，本文构建的异构图只是边类型不同，节点类型是相同的。</font></strong></p>
<p><strong>定义：&lt;sub,obj,A,T,H&gt; 提取日志的五个主要属性：subject,
object, operation type, time and host，称为元属性</strong></p>
<ul>
<li>sub表示用户集合；</li>
<li>obj表示客体集合（文件、移动存储设备、网站）；</li>
<li>A是操作类型集合（文件操作和网页利用）；</li>
<li>T表示时间</li>
<li>H是主机（计算机或者是服务器）。</li>
</ul>
<p><strong>sub,obj,A,H有自己的子属性</strong>。比如，用户在服务器中写入文件，sub的属性包括用户角色（系统管理员等）和所属单位；obj属性包括文件类型和大小；H属性包括是文件服务器还是邮件服务器；对于登录操作，A的属性包括身份验证。对于用户登录，可以表示为user
(sub) logs in to (A) a destination host (obj) in a source one (H),</p>
<h4><span id="42-构建图的规则">4.2 <strong>构建图的规则</strong></span></h4>
<p><img src="https://lzy-picture.oss-cn-beijing.aliyuncs.com/img/202304191555928.png" alt="image-20220703193951973" style="zoom:50%;"></p>
<p>上图，R1-3描述一天中的因果关系和序列关系；R4-6描述多天之间的逻辑关系；R7
R9描述用户登录和web浏览行为序列。R8 R10按照逻辑关系进行关联。</p>
<p><strong>log2vec考虑三种关系：</strong></p>
<ul>
<li>causal and sequential relationships within a day;
一天内的因果关系和顺序关系；</li>
<li>logical relationships among days；日之间的逻辑关系</li>
<li>logical relationships among objects；对象之间的逻辑关系。</li>
</ul>
<p>在设计有关这三种关系的规则时，我们考虑这些元属性的不同组合，以关联较少的日志条目，并将更精细的日志关系映射到图中。</p>
<p><img src="https://lzy-picture.oss-cn-beijing.aliyuncs.com/img/202304191555332.png" alt="image-20220703194402679" style="zoom:50%;"></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://powerlzy.github.io/posts/160TFHT/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/cat_mac.jpg">
      <meta itemprop="name" content="lzy">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="PowerLZY's Blog">
      <meta itemprop="description" content="相比到达的地方，同行的人更重要！">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | PowerLZY's Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/posts/160TFHT/" class="post-title-link" itemprop="url">集成学习（6）CatBoost</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2022-07-02 15:21:08" itemprop="dateCreated datePublished" datetime="2022-07-02T15:21:08+08:00">2022-07-02</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2023-04-21 21:25:03" itemprop="dateModified" datetime="2023-04-21T21:25:03+08:00">2023-04-21</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E7%AE%97%E6%B3%95/" itemprop="url" rel="index"><span itemprop="name">算法</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E7%AE%97%E6%B3%95/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/" itemprop="url" rel="index"><span itemprop="name">机器学习</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E7%AE%97%E6%B3%95/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/%E9%9B%86%E6%88%90%E5%AD%A6%E4%B9%A0/" itemprop="url" rel="index"><span itemprop="name">集成学习</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>4.8k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>9 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2><span id="深入理解catboost">深入理解CatBoost</span></h2>
<blockquote>
<p>深入理解CatBoost - Microstrong的文章 - 知乎
https://zhuanlan.zhihu.com/p/102540344</p>
</blockquote>
<p><strong>本文主要内容概览：</strong></p>
<p><img src="https://pic1.zhimg.com/v2-f6a9520c6db0ba77ad620800cb36c054_b.jpg" alt="img" style="zoom: 67%;"></p>
<h3><span id="一-catboost简介"><strong>一、CatBoost简介</strong></span></h3>
<p>CatBoost是俄罗斯的搜索巨头Yandex在2017年开源的机器学习库，是Boosting族算法的一种。CatBoost和XGBoost、LightGBM并称为GBDT的三大主流神器，都是在GBDT算法框架下的一种改进实现。XGBoost被广泛的应用于工业界，LightGBM有效的提升了GBDT的计算效率，而Yandex的CatBoost号称是比XGBoost和LightGBM在算法准确率等方面表现更为优秀的算法。</p>
<p>CatBoost是一种基于对称决策树（oblivious
trees）为基学习器实现的参数较少、支持类别型变量和高准确性的GBDT框架，主要解决的痛点是高效合理地处理类别型特征，这一点从它的名字中可以看出来，<strong>CatBoost是由Categorical和Boosting组成。此外，CatBoost还解决了梯度偏差（Gradient
Bias）以及预测偏移（Prediction
shift）的问题，从而减少过拟合的发生，进而提高算法的准确性和泛化能力。</strong></p>
<p><strong>与XGBoost、LightGBM相比，CatBoost的创新点有：</strong></p>
<ul>
<li><strong>嵌入了自动将类别型特征处理为数值型特征的创新算法。首先对categorical
features做一些统计，计算某个类别特征（category）出现的频率，之后加上超参数，生成新的数值型特征（numerical
features）。</strong></li>
<li><strong>Catboost还使用了组合类别特征，可以利用到特征之间的联系，这极大的丰富了特征维度</strong>。</li>
<li>采用排序提升的方法对抗训练集中的噪声点，从而避免梯度估计的偏差，进而解决预测偏移的问题。</li>
<li>采用了<strong>完全对称树作为基模型</strong>。</li>
</ul>
<h3><span id="二-类别型特征">二、<strong>类别型特征</strong></span></h3>
<p><strong>所谓类别型特征，即这类特征不是数值型特征，而是离散的集合</strong>，比如省份名（山东、山西、河北等），城市名（北京、上海、深圳等），学历（本科、硕士、博士等）。在梯度提升算法中，最常用的是将这些类别型特征转为数值型来处理，一般类别型特征会转化为一个或多个数值型特征。</p>
<p><strong>类别型特征基数比较低（low-cardinality
features）</strong>，即该特征的所有值去重后构成的集合元素个数比较少，一般利用One-hot编码方法将特征转为数值型。One-hot编码可以在数据预处理时完成，也可以在模型训练的时候完成，从训练时间的角度，后一种方法的实现更为高效，CatBoost对于基数较低的类别型特征也是采用后一种实现。</p>
<p><strong>高基数类别型特征（high cardinality
features）</strong>当中，比如
<code>user ID</code>，这种编码方式会产生大量新的特征，造成维度灾难。一种折中的办法是可以将类别分组成有限个的群体再进行One-hot编码。<strong>一种常被使用的方法是根据目标变量统计（Target
Statistics，以下简称TS）进行分组</strong>，目标变量统计用于估算每个类别的目标变量期望值。甚至有人直接用TS作为一个新的数值型变量来代替原来的类别型变量。<strong><font color="red">
重要的是，可以通过对TS数值型特征的阈值设置，基于对数损失、基尼系数或者均方差，得到一个对于训练集而言将类别一分为二的所有可能划分当中最优的那个。</font></strong></p>
<p>在LightGBM当中，类别型特征用每一步梯度提升时的梯度统计（Gradient
Statistics，以下简称GS）来表示。虽然为建树提供了重要的信息，但是这种方法有以下两个缺点：</p>
<ul>
<li>增加计算时间，因为需要对每一个类别型特征，在迭代的每一步，都需要对GS进行计算；</li>
<li>增加存储需求，对于一个类别型变量，需要存储每一次分离每个节点的类别；</li>
</ul>
<p><strong>为了克服这些缺点，LightGBM以损失部分信息为代价将所有的长尾类别归为一类</strong>，作者声称这样处理高基数类别型特征时比One-hot编码还是好不少。不过如果采用TS特征，那么对于每个类别只需要计算和存储一个数字。</p>
<p>因此，采用TS作为一个新的数值型特征是最有效、信息损失最小的处理类别型特征的方法。TS也被广泛应用在点击预测任务当中，这个场景当中的类别型特征有用户、地区、广告、广告发布者等。接下来我们着重讨论TS，暂时将One-hot编码和GS放一边。</p>
<h4><span id="21-目标变量统计targetstatistics">2.1 <strong>目标变量统计（Target
Statistics）</strong></span></h4>
<p><strong><font color="red">
CatBoost算法的设计初衷是为了更好的处理GBDT特征中的categorical
features</font></strong>。在处理 GBDT特征中的categorical
features的时候，最简单的方法是用 categorical feature
对应的标签的平均值来替换。在决策树中，标签平均值将作为节点分裂的标准。<strong>这种方法被称为
Greedy Target-based Statistics , 简称 Greedy
TS</strong>，用公式来表达就是： <span class="math display">\[
\hat{x}_k^i=\frac{\sum_{j=1}^n\left[x_{j, k}=x_{i, k}\right] \cdot
Y_i}{\sum_{j=1}^n\left[x_{j, k}=x_{i, k}\right]}
\]</span></p>
<p>这种方法有一个显而易见的缺陷，就是通常特征比标签包含更多的信息，<strong><font color="red">
如果强行用标签的平均值来表示特征的话，当训练数据集和测试数据集数据结构和分布不一样的时候会出条件偏移问题。</font></strong></p>
<p>一个标准的改进 Greedy
TS的方式是添加先验分布项，这样可以减少噪声和低频率类别型数据对于数据分布的影响：</p>
<p><span class="math display">\[
\hat{x}_k^i=\frac{\sum_{j=1}^{p-1}\left[x_{\sigma_{j, k}}=x_{\sigma_{p,
k}}\right] Y_{\sigma_j}+a \cdot p}{\sum_{j=1}^{p-1}\left[x_{\sigma_{j,
k}}=x_{\sigma_{p, k}}\right]+a}
\]</span></p>
<p>其中<span class="math inline">\(p\)</span>是添加的先验项， <span class="math inline">\(a\)</span>通常是大于 0
的权重系数。添加先验项是一个普遍做法，针对类别数较少的特征，它可以减少噪声数据。对于回归问题，一般情况下，先验项可取数据集label的均值。对于二分类，先验项是正例的先验概率。利用多个数据集排列也是有效的，但是，如果直接计算可能导致过拟合。CatBoost利用了一个比较新颖的计算叶子节点值的方法，这种方式(oblivious
trees，对称树)可以避免多个数据集排列中直接计算会出现过拟合的问题。</p>
<p>当然，在论文《CatBoost: unbiased boosting with categorical
features》中，还提到了其它几种改进Greedy TS的方法，分别有：Holdout
TS、Leave-one-out TS、Ordered
TS。我这里就不再翻译论文中的这些方法了，感兴趣的同学可以自己翻看一下原论文。</p>
<h4><span id="22-特征组合">2.2 <strong>特征组合</strong></span></h4>
<p>值得注意的是几个类别型特征的任意组合都可视为新的特征。例如，在音乐推荐应用中，我们有两个类别型特征：用户ID和音乐流派。如果有些用户更喜欢摇滚乐，将用户ID和音乐流派转换为数字特征时，根据上述这些信息就会丢失。结合这两个特征就可以解决这个问题，并且可以得到一个新的强大的特征。然而，组合的数量会随着数据集中类别型特征的数量成指数增长，因此不可能在算法中考虑所有组合。为当前树构造新的<a target="_blank" rel="noopener" href="https://www.zhihu.com/search?q=分割点&amp;search_source=Entity&amp;hybrid_search_source=Entity&amp;hybrid_search_extra=%7B%22sourceType%22%3A%22article%22%2C%22sourceId%22%3A%22102540344%22%7D">分割点</a>时，CatBoost会采用贪婪的策略考虑组合。对于树的第一次分割，不考虑任何组合。对于下一个分割，CatBoost将当前树的所有组合、类别型特征与数据集中的所有类别型特征相结合，并将新的组合类别型特征动态地转换为数值型特征。CatBoost还通过以下方式生成数值型特征和类别型特征的组合：树中选定的所有分割点都被视为具有两个值的类别型特征，并像类别型特征一样被进行组合考虑。</p>
<h4><span id="23catboost处理categorical-features总结">2.3
<strong>CatBoost处理Categorical features总结</strong></span></h4>
<ul>
<li><strong>首先计算一些数据的statistics。计算某个category出现的频率，加上超参数，生成新的numerical
features</strong>。这一策略要求同一标签数据不能排列在一起（即先全是0之后全是1这种方式），训练之前需要打乱数据集。</li>
<li>使用数据的不同排列（实际上是4个）。在每一轮建立树之前，先扔一轮骰子，决定使用哪个排列来生成树。</li>
<li>考虑使用categorical
features的不同组合。例如颜色和种类组合起来，可以构成类似于blue
dog这样的特征。当需要组合的categorical
features变多时，CatBoost只考虑一部分<a target="_blank" rel="noopener" href="https://www.zhihu.com/search?q=combinations&amp;search_source=Entity&amp;hybrid_search_source=Entity&amp;hybrid_search_extra=%7B%22sourceType%22%3A%22article%22%2C%22sourceId%22%3A%22102540344%22%7D">combinations</a>。在选择第一个节点时，只考虑选择一个特征，例如A。在生成第二个节点时，考虑A和任意一个categorical
feature的组合，选择其中最好的。就这样使用贪心算法生成combinations。</li>
<li><strong>除非向gender这种维数很小的情况，不建议自己生成One-hot编码向量，最好交给算法来处理。</strong></li>
</ul>
<h3><span id="三-catboostqampa">三、CatboostQ&amp;A</span></h3>
<h4><span id="31catboost与xgboost-lightgbm的联系与区别">3.1
<strong>CatBoost与XGBoost、LightGBM的联系与区别？</strong></span></h4>
<p>（1）2014年3月XGBoost算法首次被<a target="_blank" rel="noopener" href="https://www.zhihu.com/search?q=陈天奇&amp;search_source=Entity&amp;hybrid_search_source=Entity&amp;hybrid_search_extra=%7B%22sourceType%22%3A%22article%22%2C%22sourceId%22%3A%22102540344%22%7D">陈天奇</a>提出，但是直到2016年才逐渐著名。2017年1月微软发布LightGBM第一个稳定版本。2017年4月Yandex开源CatBoost。自从XGBoost被提出之后，很多文章都在对其进行各种改进，CatBoost和LightGBM就是其中的两种。</p>
<p>（2）<strong>CatBoost处理类别型特征十分灵活，可直接传入类别型特征的列标识，模型会自动将其使用One-hot编码，还可通过设置
one_hot_max_size参数来限制One-hot特征向量的长度</strong>。如果不传入类别型特征的列标识，那么CatBoost会把所有列视为数值特征。对于One-hot编码超过设定的one_hot_max_size值的特征来说，CatBoost将会使用一种高效的encoding方法，与mean
encoding类似，但是会降低过拟合。处理过程如下：</p>
<ul>
<li>将输入样本集随机排序，并生成多组随机排列的情况；</li>
<li>将浮点型或属性值标记转化为整数；</li>
<li>将所有的类别型特征值结果都根据以下公式，转化为数值结果；</li>
</ul>
<p><span class="math display">\[
avg_target =\frac{\text { countInClass }+ \text { prior }}{\text {
totalCount }+1}
\]</span></p>
<p>其中 countInClass
表示在当前类别型特征值中有多少样本的标记值是1；prior
是分子的初始值，根据初始参数确定。totalCount
是在所有样本中（包含当前样本）和当前样本具有相同的类别型特征值的样本数量。</p>
<p>LighGBM 和 CatBoost
类似，也可以通过使用特征名称的输入来处理类别型特征数据，它没有对数据进行独热编码，因此速度比独热编码快得多。LighGBM
使用了一个特殊的算法来确定属性特征的分割值。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">train_data = lgb.Dataset(data, label=label, feature_name=[<span class="string">&#x27;c1&#x27;</span>, <span class="string">&#x27;c2&#x27;</span>, <span class="string">&#x27;c3&#x27;</span>], categorical_feature=[<span class="string">&#x27;c3&#x27;</span>])</span><br><span class="line"><span class="comment"># 注意，在建立适用于 LighGBM 的数据集之前，需要将类别型特征变量转化为整型变量，此算法不允许将字符串数据传给类别型变量参数。</span></span><br></pre></td></tr></table></figure>
<p>（3）XGBoost 和 CatBoost、 LighGBM 算法不同，XGBoost
本身无法处理类别型特征，而是像随机森林一样，只接受数值数据。因此在将类别型特征数据传入
XGBoost
之前，必须通过各种编码方式：例如序号编码、独热编码和二进制编码等对数据进行处理。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://powerlzy.github.io/posts/34HK4X9/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/cat_mac.jpg">
      <meta itemprop="name" content="lzy">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="PowerLZY's Blog">
      <meta itemprop="description" content="相比到达的地方，同行的人更重要！">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | PowerLZY's Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/posts/34HK4X9/" class="post-title-link" itemprop="url">风控算法（5）数据挖掘-手机App数据挖掘实现</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2022-07-01 19:35:48" itemprop="dateCreated datePublished" datetime="2022-07-01T19:35:48+08:00">2022-07-01</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2022-07-09 17:01:04" itemprop="dateModified" datetime="2022-07-09T17:01:04+08:00">2022-07-09</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E3%80%90draft%E3%80%91%E5%BA%94%E7%94%A8/" itemprop="url" rel="index"><span itemprop="name">【draft】应用</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E3%80%90draft%E3%80%91%E5%BA%94%E7%94%A8/%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF/" itemprop="url" rel="index"><span itemprop="name">应用场景</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E3%80%90draft%E3%80%91%E5%BA%94%E7%94%A8/%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF/%E4%B8%9A%E5%8A%A1%E5%AE%89%E5%85%A8/" itemprop="url" rel="index"><span itemprop="name">业务安全</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>1.3k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>2 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2><span id="风控数据手机app数据挖掘实践思路">风控数据—手机App数据挖掘实践思路</span></h2>
<h3><span id="引言"><strong>引言</strong></span></h3>
<p>作为移动互联网时代的主要载体，智能手机逐渐成为人们日常生活中不可或缺的一部分，改变着人们的生活习惯。比如，可以用“饿了么”点外卖，“支付宝”可以用来种树，“抖音”可以用来上厕所......强大的App给我们的生活带来了巨大的便利。</p>
<p><img src="https://pic3.zhimg.com/80/v2-87f00e7e18438ad4bf65c09feb5f38e6_1440w.jpg" alt="img" style="zoom: 33%;"></p>
<p>正因为如此，App与用户之间存在着密不可分的联系，用户在频繁使用这些App过程中也积累了大量的个人历史数据。<strong><font color="red">
这些App数据能帮助我们更好地去理解用户，推测用户的性别、职业、收入、兴趣、偏好等属性</font></strong>，也就是所谓的<strong>KYC（Know
your customer）</strong>。</p>
<p>在风控中，App数据也有其重要价值，常用于反欺诈、风控建模特征工程等。本文将分享App数据的一些挖掘思路，以及实践建议。</p>
<p><strong>首先，让我们思考下几个问题：</strong></p>
<ul>
<li>如何获取数据？</li>
<li>数据长啥样？</li>
<li>数据如何和业务相结合去理解？</li>
<li>可以采用什么算法实现高效提取信息？</li>
<li>如何利用这块数据服务业务？</li>
</ul>
<h3><span id="一-app数据长啥样">一、 App数据长啥样？</span></h3>
<p>根据资料显示，当前手机App数据主要包括：<strong>App安装包名称、App中文名、App安装列表、App安装序列。</strong></p>
<p><strong>为便于区分，常把App中文名记为app_name，App包名称（package）记为pkg_name。其中pkg_name是App的唯一ID</strong>，app_name则因为下载渠道、版本更新、数据采集等因素影响导致不唯一。例如，"企业微信"的pkg_name为“com.tencent.wework”，而app_name可能会有“企业微信”、“微信企业版”、“微信（企业版）”等多个值。</p>
<p>至于如何获取手机App package？可以参考这里：<a href="https://link.zhihu.com/?target=https%3A//blog.csdn.net/gufenchen/article/details/91410667">实现获取appPackage和appActivity的方法</a></p>
<figure>
<img src="https://pic3.zhimg.com/80/v2-e7c62877c3193cec175852170ee3eae2_1440w.jpg" alt="img">
<figcaption aria-hidden="true">img</figcaption>
</figure>
<ol type="1">
<li><strong>App安装集合（App
List</strong>）：指手机上安装的所有App的集合，一般用逗号隔开，如：“com.alibaba.android.rimet,com.tencent.mm,com.citiccard.mobilebank,com.icbc,com.hongxin1.rm”。可以认为是一个集合，因此是<strong>无序</strong>的。</li>
<li><strong>App安装序列（App
Seq）</strong>：指手机上包含安装时间的App序列。如：["
信","1558014854044","<a href="https://link.zhihu.com/?target=http%3A//com.tencent.mm/">com.tencent.mm</a>",,"7.0.4"]，分别代表App中文名、App安装时间戳、App包名称和版本号。由于可根据安装时间戳得到安装顺序，因此是<strong>有序</strong>的。</li>
</ol>
<p>我们拿“微信”的package在腾讯应用宝中检索，那么就可以找到以下<strong>App描述数据</strong>：</p>
<ol type="1">
<li><strong>分类标签</strong>：标签精确表达了App的核心功能。但可能是开发者在发布App时从可选项中主观选择了一个标签，也有可能腾讯会在后期维护标签。标签不一定准确，但可作为一个重要的参考维度。</li>
<li><strong>下载量</strong>：可作为判断App是否小众的一个参考维度。然而，能在应用宝上架的App一般是合规的；对于一些质量较差无法上架的app就无法获取到下载量。</li>
<li><strong>应用描述</strong>：开发者对App的主要功能给出的描述性文本，可提取关键词、主题等内容。但如果只是根据关键词匹配，很容易出错。比如微信中藏有游戏中心入口，文本中出现“游戏”关键词，但这并不是一个游戏类App。</li>
</ol>
<h3><span id="二-app如何有效分类">二、App如何有效分类？</span></h3>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://powerlzy.github.io/posts/29H4DXP/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/cat_mac.jpg">
      <meta itemprop="name" content="lzy">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="PowerLZY's Blog">
      <meta itemprop="description" content="相比到达的地方，同行的人更重要！">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | PowerLZY's Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/posts/29H4DXP/" class="post-title-link" itemprop="url">风控算法（4）特征工程-变量加工实践经验</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2022-07-01 19:33:41" itemprop="dateCreated datePublished" datetime="2022-07-01T19:33:41+08:00">2022-07-01</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2022-07-08 14:34:30" itemprop="dateModified" datetime="2022-07-08T14:34:30+08:00">2022-07-08</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E3%80%90draft%E3%80%91%E5%BA%94%E7%94%A8/" itemprop="url" rel="index"><span itemprop="name">【draft】应用</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E3%80%90draft%E3%80%91%E5%BA%94%E7%94%A8/%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF/" itemprop="url" rel="index"><span itemprop="name">应用场景</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E3%80%90draft%E3%80%91%E5%BA%94%E7%94%A8/%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF/%E4%B8%9A%E5%8A%A1%E5%AE%89%E5%85%A8/" itemprop="url" rel="index"><span itemprop="name">业务安全</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>8.5k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>15 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2><span id="特征工程-风控变量加工实践经验">特征工程-风控变量加工实践经验</span></h2>
<blockquote>
<p>风控变量加工实践经验 - 求是汪在路上的文章 - 知乎
https://zhuanlan.zhihu.com/p/479784293</p>
<p>本文总结了风控变量开发过程中的一些实践经验。包括：</p>
<ol type="1">
<li><strong>检查数据一致性，确保数据质量</strong>。</li>
<li><strong>设计好整体架构，提高计算效率</strong>。</li>
</ol>
</blockquote>
<p>我们总在说，<strong>数据决定特征的上限，特征决定模型的上限。</strong>风控决策过程中依托大量变量，这些变量从开发到上线的研发流程如下:</p>
<ol type="1">
<li>风控模型同学先基于离线数据源使用Hive
SQL挖掘一系列变量，经过建模筛选后将变量需求提给开发同学。</li>
<li>开发同学与模型同学一起核对数据源以及变量实现逻辑，将每个变量用Java代码实现。</li>
<li>在线灰度运行，与离线Hive
T+1产出的变量以及模型分数做一致性比对，满足较高的一致性和稳定性后才最终发布。</li>
</ol>
<h3><span id="一-线上线下底层数据一致">一、线上线下底层数据一致</span></h3>
<p>底层数据一致是最根本的要求，其内涵包括两点：</p>
<ul>
<li>线上数据落快照，确保可回溯、不穿越。</li>
<li>线上数据经清洗到线下数据后确保一致。</li>
</ul>
<p><strong>1. 线上数据落快照，确保可回溯、不穿越。</strong></p>
<p>数据资产非常宝贵，一些内部数据早点落快照积累，后期才能进行回溯。在这个过程中，数据穿越问题是最为常见的，其导致的结果是离线分析效果可能很棒，但真正上线后效果一塌糊涂。因此，在做特征变量时都要限制数据采集时间在回溯时点之前。</p>
<p><strong>2. 线上数据经清洗到线下数据后确保一致。</strong></p>
<p><strong>线上数据一般是json这类的半结构化数据，为了离线分析时使用方便，我们通常将其解析为结构化的数据表</strong>。因此，在此转换过程中，有可能会出现字段取值错列、错误等情况，需要进行一致性检查。</p>
<h3><span id="二-离线变量加工注意事项">二、离线变量加工注意事项</span></h3>
<p>在平时业务实践中，我们习惯利用SQL来衍生特征变量，原因在于：</p>
<ul>
<li>SQL可分布式计算，对于海量数据处理上效率更高。</li>
<li>SQL语法较为固定，容易阅读理解；而Python语法灵活，每个人写的代码风格差异很大，较难维护理解。</li>
<li>SQL有大量内置函数（聚合函数、窗口函数等），可省去很多自定义函数的时间。</li>
</ul>
<p>但是，在开发过程中需要注意以下几点：</p>
<p><strong>1.
检查原始字段的取值类型。</strong>对于字符型变量，直接比较时容易出错，如下所示。例如，字符串类型的1000会比800小。因此，在聚合计算风控变量"最近N个月的最大借款金额"时就会出错。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">spark<span class="operator">-</span><span class="keyword">sql</span><span class="operator">&gt;</span> <span class="keyword">select</span> <span class="string">&#x27;1000&#x27;</span> <span class="operator">&gt;</span> <span class="string">&#x27;800&#x27;</span>;</span><br><span class="line"><span class="literal">false</span></span><br><span class="line"><span class="type">Time</span> taken: <span class="number">3.679</span> seconds, Fetched <span class="number">1</span> <span class="type">row</span>(s)</span><br><span class="line">spark<span class="operator">-</span><span class="keyword">sql</span><span class="operator">&gt;</span> <span class="keyword">select</span> <span class="number">1000</span> <span class="operator">&gt;</span> <span class="number">800</span>;</span><br><span class="line"><span class="literal">true</span></span><br><span class="line"><span class="type">Time</span> taken: <span class="number">0.16</span> seconds, Fetched <span class="number">1</span> <span class="type">row</span>(s)</span><br><span class="line">spark<span class="operator">-</span><span class="keyword">sql</span><span class="operator">&gt;</span> <span class="keyword">select</span> <span class="built_in">cast</span>(<span class="string">&#x27;1000&#x27;</span> <span class="keyword">as</span> <span class="type">int</span>) <span class="operator">&gt;</span> <span class="built_in">cast</span>(<span class="string">&#x27;800&#x27;</span> <span class="keyword">as</span> <span class="type">int</span>);</span><br><span class="line"><span class="literal">true</span></span><br><span class="line"><span class="type">Time</span> taken: <span class="number">0.198</span> seconds, Fetched <span class="number">1</span> <span class="type">row</span>(s)</span><br></pre></td></tr></table></figure>
<p><strong>2.
检查原始字段的取值范围。</strong>避免想当然地认为，该变量什么含义就"<strong>应该</strong>"是什么取值，或者完全按照编码文档来写逻辑，一切以实际数据为准。包括但不限于：</p>
<ul>
<li>确认字段正常不应该缺失的情况，确认是否实时数据落库过程中清洗所引起的。</li>
<li>从业务上检查字段含义对应的取值范围，确认脏数据该如何清洗。例如，对于日期类变量，其取值可能有如下格式：</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">datetime.datetime.strptime(<span class="type">date</span>, &quot;%Y-%m-%d %H:%M:%S&quot;)</span><br><span class="line">datetime.datetime.strptime(<span class="type">date</span>, &quot;%Y-%m-%d&quot;)</span><br><span class="line">datetime.datetime.strptime(<span class="type">date</span>, &quot;%Y/%m/%d&quot;)</span><br><span class="line">datetime.datetime.strptime(<span class="type">date</span>, &quot;%Y%m%d&quot;)</span><br><span class="line"></span><br><span class="line">spark<span class="operator">-</span><span class="keyword">sql</span><span class="operator">&gt;</span> <span class="keyword">select</span> to_date(<span class="string">&#x27;2022.03.20&#x27;</span>,<span class="string">&#x27;yyyy.MM.dd&#x27;</span>);</span><br><span class="line"><span class="number">2022</span><span class="number">-03</span><span class="number">-20</span></span><br><span class="line"><span class="type">Time</span> taken: <span class="number">0.18</span> seconds, Fetched <span class="number">1</span> <span class="type">row</span>(s)</span><br><span class="line">spark<span class="operator">-</span><span class="keyword">sql</span><span class="operator">&gt;</span> <span class="keyword">select</span> to_date(<span class="string">&#x27;2022/03/20&#x27;</span>,<span class="string">&#x27;yyyy/MM/dd&#x27;</span>);</span><br><span class="line"><span class="number">2022</span><span class="number">-03</span><span class="number">-20</span></span><br><span class="line"><span class="type">Time</span> taken: <span class="number">0.119</span> seconds, Fetched <span class="number">1</span> <span class="type">row</span>(s)</span><br><span class="line">spark<span class="operator">-</span><span class="keyword">sql</span><span class="operator">&gt;</span> <span class="keyword">select</span> to_date(<span class="string">&#x27;20220320&#x27;</span>,<span class="string">&#x27;yyyyMMdd&#x27;</span>);</span><br><span class="line"><span class="number">2022</span><span class="number">-03</span><span class="number">-20</span></span><br><span class="line"><span class="type">Time</span> taken: <span class="number">0.365</span> seconds, Fetched <span class="number">1</span> <span class="type">row</span>(s)</span><br></pre></td></tr></table></figure>
<p><strong>3. 适当定义一些中间变量。</strong>其好处在于：</p>
<ul>
<li>统一维护映射关系，便于维护修改变量口径；</li>
<li><strong>提高计算效率，一次计算可复用，不必多次重复运算</strong>；</li>
<li>便于代码review，结构层次上更为清晰易懂。</li>
</ul>
<p>中间变量适合需要利用多个字段来定义的场景，或者一个字段需要进行较为复杂的计算。例如：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">case</span> when recall_date &gt; due_date <span class="keyword">and</span> repay_date = due_date then <span class="string">&quot;已到期,正常还款&quot;</span></span><br><span class="line">     when recall_date &gt; due_date <span class="keyword">and</span> repay_date &lt; due_date then <span class="string">&quot;已到期,提前还款&quot;</span></span><br><span class="line">     when recall_date &gt; due_date <span class="keyword">and</span> (repay_date &gt; due_date <span class="keyword">or</span> repay_date <span class="keyword">is</span> null) then <span class="string">&quot;已到期,逾期还款&quot;</span></span><br><span class="line"><span class="keyword">else</span> <span class="string">&quot;未到期&quot;</span> end <span class="keyword">as</span> repay_state -- 还款状态</span><br></pre></td></tr></table></figure>
<p>对于多人协作的项目，需要大家约定好中间变量口径，避免后续整理文档时出现类似的变量多种口径，引起IT同学混淆。</p>
<p><strong>4. 适当制作一些中间表</strong></p>
<p>其作用在于，采取最小可用数据范围原则，减少计算成本。例如：计算借据层面的字段"最近3个月内的借款次数"，只需要用到借据表的信息，并不需要还款计划表的信息。</p>
<p><strong>5. 确认每张表的主键，保证唯一</strong></p>
<p>SQL中常见的聚合函数包括最大值（max）、最小值（min）、平均值（avg）、计数（count）、标准差（std）、累加（sum）。如果数据记录出现重复，虽然不会影响max、min这些操作，但是会影响其他聚合计算的值。因此，在做中间表的过程中需要明确主键，确保group
by分组的时候是唯一的。</p>
<p><strong>6. 优化SQL代码，提高运行效率。</strong></p>
<p>例如，count(distinct case when 条件 then xxx else xxx
end)操作需要消耗大量资源，可以考虑将when中的条件提前到表的where中，过滤减少数据量，但要注意影响范围，避免误伤到其他变量的计算。</p>
<p><strong>同时，还可以将SQL代码做成工作流（workflow），某些任务可实现并行化运行。</strong></p>
<h3><span id="三-实时变量上线比对验证">三、实时变量上线比对验证</span></h3>
<p>实时变量计算有时效性要求，比如500毫秒内计算出数据。因此，实时变量一般将由IT同学根据文档通过Java开发，在此过程中由于以下原因可能引起变量不一致。</p>
<ul>
<li>离线变量开发口径逻辑，在文档整理过程中的表述歧义。</li>
<li>模型同学和IT同学沟通过程中的理解差异。</li>
<li>Java代码编写过程中存在的Bug。</li>
<li>计算引擎不同所引起的精度差异。</li>
<li>脏数据引起的不一致。</li>
</ul>
<p>为解决SQL离线变量到在线变量之间的翻译工作，目前有相关的实时SQL计算引擎技术，可参考下面这篇：</p>
<p>https://link.zhihu.com/?target=https%3A//mp.weixin.qq.com/s/Rx43XfhgdwerQWLn1eI3Ww</p>
<p>线上线下变量确保一致是非常重要的。其能保证基于离线批量数据所建立的风控模型和策略规则，在上线后能按照预期的效果生效。如果不一致，将会导致风控系统不可控。例如，离线评估得到的模型分数阈值为低于600分则拒绝，但线上模型总是和离线有偏差，600这个阈值将拒绝更多的用户，导致通过率下降。</p>
<p>模型同学需要和IT同学协调来定位变量问题，整个工作流程图如下所示。可以看到这是一个闭环迭代的过程，如何加快迭代速度成为关键。</p>
<figure>
<img src="https://pic2.zhimg.com/80/v2-ed93dffab2b80d4711f7a330bada6e59_1440w.jpg" alt="img">
<figcaption aria-hidden="true">img</figcaption>
</figure>
<p>变量一致性比对的逻辑很直接，其依赖于测试数据来归纳排查，当两者出现不一致则必有问题。当然，变量的逻辑正确性和取值一致性是两回事，<strong>逻辑正确性需要业务知识来确认，取值一致性需要技术工具来解决</strong>。</p>
<p><strong>为了尽可能提高比对效率，笔者有以下几点建议：</strong></p>
<p>1）<strong>准备足量测试原始数据，以及离线变量取值结果</strong>。在开发过程中准备一批（如1000条）原始数据json，这批数据必须保证和解析到数据库中的表数据是完全一致的。这样可以确保IT同学在写Java的时候，就可自己测试来消除一部分bug，减少后续工作量。</p>
<p>2）<strong>提前准备好相关不一致案例，预约时间集中排查。</strong>定位问题是一个非常耗时的工作，因此和IT同学约定好大片段的时间，提前准备好一些案例来沟通。案例准备过程可以将变量划分类别，聚类治之可极大提高效率。</p>
<p>3）<strong>整理比对所需要的代码脚本，缩短数据准备时间</strong>。比对过程是迭代中完善的，必然需要多轮数据拉取、计算、整理的工作，把这个流程打通形成工作流可加快速度。</p>
<p>在取数得到线上线下数据集后，可根据附录代码计算得到以下比对报告，如图2所示。我们将比对结果分为以下4种情况：</p>
<ul>
<li>有值且一致：有值并且满足精度一致要求</li>
<li><strong>有值不一致：有值但不满足精度一致要求</strong></li>
<li><strong>缺失不一致：其中有一个为nul</strong>l</li>
<li>缺失且一致：两者取值都为null</li>
</ul>
<p>对于情况1）和情况3）则需要查相应案例来定位原因。<strong>小细节往往能发现大问题</strong>，所以不要轻视。</p>
<figure>
<img src="https://pic1.zhimg.com/80/v2-1328321434f790cffff65d6988cbc29c_1440w.jpg" alt="img">
<figcaption aria-hidden="true">img</figcaption>
</figure>
<h3><span id="附录a">附录A</span></h3>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">from</span> tqdm <span class="keyword">import</span> tqdm</span><br><span class="line"><span class="keyword">from</span> multiprocessing.dummy <span class="keyword">import</span> Pool <span class="keyword">as</span> ThreadPool</span><br><span class="line"> </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">compare_online_offline</span>(<span class="params">data_offline,  </span></span><br><span class="line"><span class="params">                           data_online,</span></span><br><span class="line"><span class="params">                           remove_list=[<span class="string">&#x27;order_id&#x27;</span>],</span></span><br><span class="line"><span class="params">                           key_var=<span class="string">&#x27;order_id&#x27;</span>,</span></span><br><span class="line"><span class="params">                           spec_value=<span class="number">0</span>,</span></span><br><span class="line"><span class="params">                           filename=<span class="string">&#x27;report.xlsx&#x27;</span>,</span></span><br><span class="line"><span class="params">                           need_detail=<span class="number">1</span></span>):</span><br><span class="line">    <span class="keyword">import</span> time</span><br><span class="line">    t0 = time.time()</span><br><span class="line">    data_online_new  = data_online.copy()</span><br><span class="line">    data_offline_new = data_offline.copy()</span><br><span class="line">    data_offline_new.columns = [i.lower() <span class="keyword">for</span> i <span class="keyword">in</span> data_offline_new.columns]</span><br><span class="line">    data_online_new.columns  = [i.lower() <span class="keyword">for</span> i <span class="keyword">in</span> data_online_new.columns]</span><br><span class="line">    comp_list = <span class="built_in">list</span>(<span class="built_in">set</span>(data_online_new.columns) &amp; <span class="built_in">set</span>(data_offline_new.columns))  <span class="comment"># 取交集</span></span><br><span class="line">    comp_list = <span class="built_in">sorted</span>(<span class="built_in">list</span>(<span class="built_in">set</span>(comp_list).difference(remove_list)))   <span class="comment"># 比较列</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;比较特征数量为: &#x27;</span> + <span class="built_in">str</span>(<span class="built_in">len</span>(comp_list)))</span><br><span class="line">    num_varlist = <span class="built_in">list</span>(<span class="built_in">set</span>(data_online_new[comp_list].select_dtypes(exclude=[<span class="string">&#x27;object&#x27;</span>,<span class="string">&#x27;datetime&#x27;</span>]).columns))</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">compare</span>(<span class="params">x1, x2, vartype</span>):</span><br><span class="line">        <span class="keyword">if</span> pd.notna(x1) <span class="keyword">and</span> pd.notna(x2):</span><br><span class="line">            <span class="keyword">if</span> vartype == <span class="string">&#x27;numeric&#x27;</span>:</span><br><span class="line">                <span class="keyword">return</span> <span class="number">1</span> <span class="keyword">if</span> <span class="built_in">abs</span>(x1 - x2) &lt; <span class="number">0.001</span> <span class="keyword">else</span> <span class="number">2</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="keyword">return</span> <span class="number">1</span> <span class="keyword">if</span> x1 == x2 <span class="keyword">else</span> <span class="number">2</span></span><br><span class="line">        <span class="keyword">else</span>:  </span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> pd.notna(x1) <span class="keyword">and</span> <span class="keyword">not</span> pd.notna(x2):</span><br><span class="line">                <span class="keyword">return</span> <span class="number">3</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="keyword">return</span> np.nan</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">stat</span>(<span class="params">var</span>):</span><br><span class="line">        df = pd.merge(data_offline_new[[key_var,var]], data_online_new[[key_var,var]], on=key_var, how=<span class="string">&#x27;inner&#x27;</span>)</span><br><span class="line">        df.columns = [key_var, var+<span class="string">&#x27;_offline&#x27;</span>, var+<span class="string">&#x27;_online&#x27;</span>] </span><br><span class="line">        total = df.shape[<span class="number">0</span>]</span><br><span class="line">        miss_offline = df[var+<span class="string">&#x27;_offline&#x27;</span>].isnull().<span class="built_in">sum</span>()</span><br><span class="line">        miss_online  = df[var+<span class="string">&#x27;_online&#x27;</span>].isnull().<span class="built_in">sum</span>()</span><br><span class="line">        spec_offline = <span class="built_in">sum</span>(df[var+<span class="string">&#x27;_offline&#x27;</span>] == spec_value)</span><br><span class="line">        spec_online  = <span class="built_in">sum</span>(df[var+<span class="string">&#x27;_online&#x27;</span>] == spec_value)</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span>  var <span class="keyword">in</span> num_varlist:   </span><br><span class="line">            mean_offline = df[var+<span class="string">&#x27;_offline&#x27;</span>].mean()</span><br><span class="line">            mean_online  = df[var+<span class="string">&#x27;_online&#x27;</span>].mean()</span><br><span class="line">            df[var+<span class="string">&#x27;_same&#x27;</span>] = df.apply(<span class="keyword">lambda</span> row: compare(row[var+<span class="string">&#x27;_offline&#x27;</span>], row[var+<span class="string">&#x27;_online&#x27;</span>], <span class="string">&#x27;numeric&#x27;</span>), axis=<span class="number">1</span>) </span><br><span class="line">            value_same = df[df[var+<span class="string">&#x27;_same&#x27;</span>]==<span class="number">1</span>].shape[<span class="number">0</span>] <span class="comment"># 有值并且满足精度一致要求</span></span><br><span class="line">            value_diff = df[df[var+<span class="string">&#x27;_same&#x27;</span>]==<span class="number">2</span>].shape[<span class="number">0</span>] <span class="comment"># 有值但不满足精度一致要求</span></span><br><span class="line">        <span class="keyword">else</span>: </span><br><span class="line">            mean_offline = np.nan</span><br><span class="line">            mean_online = np.nan</span><br><span class="line">            df[var+<span class="string">&#x27;_same&#x27;</span>] = df.apply(<span class="keyword">lambda</span> row: compare(row[var+<span class="string">&#x27;_offline&#x27;</span>], row[var+<span class="string">&#x27;_online&#x27;</span>], <span class="string">&#x27;string&#x27;</span>), axis=<span class="number">1</span>)</span><br><span class="line">            value_same = df[df[var+<span class="string">&#x27;_same&#x27;</span>]==<span class="number">1</span>].shape[<span class="number">0</span>] <span class="comment"># 有值并且相同</span></span><br><span class="line">            value_diff = df[df[var+<span class="string">&#x27;_same&#x27;</span>]==<span class="number">2</span>].shape[<span class="number">0</span>] <span class="comment"># 有值但是不同</span></span><br><span class="line"></span><br><span class="line">        miss_same = df[df[var+<span class="string">&#x27;_same&#x27;</span>]==<span class="number">3</span>].shape[<span class="number">0</span>] <span class="comment"># 两者取值都为null</span></span><br><span class="line">        miss_diff = df[var+<span class="string">&#x27;_same&#x27;</span>].isnull().<span class="built_in">sum</span>()  <span class="comment"># 其中有一个为null</span></span><br><span class="line">        total_same = value_same + miss_same         <span class="comment"># 两者完全相同   </span></span><br><span class="line">        df[var+<span class="string">&#x27;_same&#x27;</span>] = df[var+<span class="string">&#x27;_same&#x27;</span>].apply(<span class="keyword">lambda</span> x: <span class="number">1</span> <span class="keyword">if</span> x <span class="keyword">in</span> [<span class="number">1</span>,<span class="number">3</span>] <span class="keyword">else</span> <span class="number">0</span>)</span><br><span class="line">        <span class="keyword">return</span> [var, total, miss_offline, miss_online, mean_offline, mean_online, </span><br><span class="line">                value_diff, value_same, miss_diff, miss_same, total_same, spec_offline, spec_online, df]</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 启动多线程</span></span><br><span class="line">    pool = ThreadPool(<span class="number">10</span>)</span><br><span class="line">    stat_list = pool.<span class="built_in">map</span>(stat, comp_list)</span><br><span class="line">    pool.close()</span><br><span class="line">    pool.join()</span><br><span class="line"></span><br><span class="line">    final_cols = [<span class="string">&#x27;var&#x27;</span>,<span class="string">&#x27;total&#x27;</span>,<span class="string">&#x27;miss_offline&#x27;</span>,<span class="string">&#x27;miss_online&#x27;</span>,<span class="string">&#x27;mean_offline&#x27;</span>,<span class="string">&#x27;mean_online&#x27;</span>,</span><br><span class="line">                  <span class="string">&#x27;value_diff&#x27;</span>,<span class="string">&#x27;value_same&#x27;</span>,<span class="string">&#x27;miss_diff&#x27;</span>,<span class="string">&#x27;miss_same&#x27;</span>,<span class="string">&#x27;total_same&#x27;</span>,<span class="string">&#x27;spec_offline&#x27;</span>,<span class="string">&#x27;spec_online&#x27;</span>]</span><br><span class="line">    stat_arr = [x[:-<span class="number">1</span>] <span class="keyword">for</span> x <span class="keyword">in</span> stat_list]</span><br><span class="line">    df_stat = pd.DataFrame(stat_arr, columns=final_cols)</span><br><span class="line">    df_stat[<span class="string">&#x27;miss_del&#x27;</span>] = df_stat[<span class="string">&#x27;miss_offline&#x27;</span>] - df_stat[<span class="string">&#x27;miss_online&#x27;</span>]</span><br><span class="line">    df_stat[<span class="string">&#x27;mean_del&#x27;</span>] = df_stat[<span class="string">&#x27;mean_offline&#x27;</span>] - df_stat[<span class="string">&#x27;mean_online&#x27;</span>]</span><br><span class="line">    df_stat[<span class="string">&#x27;same_rate&#x27;</span>] = df_stat[<span class="string">&#x27;total_same&#x27;</span>] / df_stat[<span class="string">&#x27;total&#x27;</span>]</span><br><span class="line">    df_report = df_stat[[<span class="string">&#x27;var&#x27;</span>,<span class="string">&#x27;total&#x27;</span>,<span class="string">&#x27;miss_offline&#x27;</span>,<span class="string">&#x27;miss_online&#x27;</span>,<span class="string">&#x27;miss_del&#x27;</span>,<span class="string">&#x27;mean_offline&#x27;</span>,<span class="string">&#x27;mean_online&#x27;</span>,<span class="string">&#x27;mean_del&#x27;</span>,</span><br><span class="line">                         <span class="string">&#x27;value_diff&#x27;</span>,<span class="string">&#x27;value_same&#x27;</span>,<span class="string">&#x27;miss_diff&#x27;</span>,<span class="string">&#x27;miss_same&#x27;</span>,<span class="string">&#x27;total_same&#x27;</span>,<span class="string">&#x27;same_rate&#x27;</span>,<span class="string">&#x27;spec_offline&#x27;</span>,<span class="string">&#x27;spec_online&#x27;</span>]]</span><br><span class="line">    df_report.columns = [<span class="string">&#x27;变量名&#x27;</span>,<span class="string">&#x27;比较数&#x27;</span>,<span class="string">&#x27;离线缺失&#x27;</span>,<span class="string">&#x27;在线缺失&#x27;</span>,<span class="string">&#x27;离线-在线缺失&#x27;</span>,<span class="string">&#x27;离线均值&#x27;</span>,<span class="string">&#x27;在线均值&#x27;</span>,<span class="string">&#x27;离线-在线均值&#x27;</span>,</span><br><span class="line">                         <span class="string">&#x27;有值不一致&#x27;</span>,<span class="string">&#x27;有值一致量&#x27;</span>,<span class="string">&#x27;缺失不一致&#x27;</span>,<span class="string">&#x27;缺失一致量&#x27;</span>,<span class="string">&#x27;一致量&#x27;</span>,<span class="string">&#x27;一致率&#x27;</span>,<span class="string">&#x27;离线特殊值数&#x27;</span>,<span class="string">&#x27;在线特殊值数&#x27;</span>]</span><br><span class="line">    df_report = df_report.sort_values(by=[<span class="string">&#x27;一致率&#x27;</span>], ascending=<span class="number">1</span>)</span><br><span class="line">    df_report.to_excel(filename, index=<span class="number">0</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;对比报告保存在%s&#x27;</span> % filename)</span><br><span class="line">    t1 = time.time()</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;耗时%s分钟&#x27;</span> % <span class="built_in">int</span>((t1-t0)/<span class="number">60</span>))</span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;拼接明细...&#x27;</span>)</span><br><span class="line">    df_detail = pd.DataFrame(data_offline_new[key_var], columns=[key_var])</span><br><span class="line">    <span class="keyword">if</span> need_detail:</span><br><span class="line">       df_list = [x[-<span class="number">1</span>] <span class="keyword">for</span> x <span class="keyword">in</span> stat_list]</span><br><span class="line">       <span class="keyword">for</span> i <span class="keyword">in</span> tqdm(<span class="built_in">range</span>(<span class="built_in">len</span>(df_list))):</span><br><span class="line">           df_detail = pd.merge(df_detail, df_list[i], on=key_var)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> df_report, df_detail</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://powerlzy.github.io/posts/2ZK2C8F/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/cat_mac.jpg">
      <meta itemprop="name" content="lzy">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="PowerLZY's Blog">
      <meta itemprop="description" content="相比到达的地方，同行的人更重要！">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | PowerLZY's Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/posts/2ZK2C8F/" class="post-title-link" itemprop="url">风控算法（4）特征工程-时序数据与特征工程</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2022-07-01 19:33:41" itemprop="dateCreated datePublished" datetime="2022-07-01T19:33:41+08:00">2022-07-01</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2023-04-19 17:13:22" itemprop="dateModified" datetime="2023-04-19T17:13:22+08:00">2023-04-19</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E3%80%90draft%E3%80%91%E5%BA%94%E7%94%A8/" itemprop="url" rel="index"><span itemprop="name">【draft】应用</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E3%80%90draft%E3%80%91%E5%BA%94%E7%94%A8/%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF/" itemprop="url" rel="index"><span itemprop="name">应用场景</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E3%80%90draft%E3%80%91%E5%BA%94%E7%94%A8/%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF/%E4%B8%9A%E5%8A%A1%E5%AE%89%E5%85%A8/" itemprop="url" rel="index"><span itemprop="name">业务安全</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>2.5k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>5 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2><span id="特征工程-时序数据与特征工程">特征工程-时序数据与特征工程</span></h2>
<blockquote>
<p>信贷时序数据与特征工程介绍 - 求是汪在路上的文章 - 知乎
https://zhuanlan.zhihu.com/p/397614923</p>
</blockquote>
<h3><span id="引言">引言</span></h3>
<p><strong>无论是模型还是策略，其遵循的方法论都是“发现问题-&gt;确定目标-&gt;分析原因-&gt;寻找抓手-&gt;上线应对”这样一个闭环</strong>。对于模型岗而言，<strong><font color="red">
其核心KPI是提供具有良好排序能力的模型。而特征工程是提高模型区分度的最有效途径，决定了模型拟合的上限。</font></strong></p>
<p>信贷业务流程中积累了很多时间序列数据。因此，<strong>本文将介绍如何利用时序数据来构建常见的特征</strong>。同时，为兼顾实践性，本文附上了一些特征的SQL实现逻辑，供参考。</p>
<h3><span id="一-信贷时序行为数据">一、<strong>信贷时序行为数据</strong></span></h3>
<p>信贷业务经营中会积累很多时间序列数据。例如，<strong>客户的APP登录行为埋点数据、借款申请行为记录数据、还款行为数据、调额记录数据等</strong>。根据是否在平台内部沉淀，这些数据又可分为内部和外部数据。</p>
<h4><span id="11-内部数据">1.1 <strong>内部数据</strong></span></h4>
<p>以借款、还款行为数据为例，需要明确几个最细的时间粒度，包括：</p>
<ul>
<li>借款时点（draw_date）：客户借款申请时点。</li>
<li>应还时点（due_date）：约定还款时间，固定不变。</li>
<li>实还时点（settle_date）：客户实际还款时间，若早于应还日，称提前还款；若晚于应还时点，则成为逾期（overdue）；若在应还日当天还款，则为正常还款。</li>
</ul>
<p>独立来看，每个时点的数据都具有不同的信息。对于借据而已，具有以下属性：</p>
<figure>
<img src="https://pic4.zhimg.com/80/v2-bd57625dec1cdc547dc81c05796912d3_1440w.jpg" alt="img">
<figcaption aria-hidden="true">img</figcaption>
</figure>
<p>因此，从借款订单数据入手，其可反映客户的额度使用率、借款金额变化、借款时间集中度等信息。</p>
<p>如图2所示，当把这些时点线索交叉在一起，就会衍生出大量信息。例如：</p>
<ul>
<li><strong>结合应还时点和实还时点，可刻画客户历史上的还款行为，包括逾期、提前还款、正常还款</strong>。——由此可构建“过去一段时间内，<strong>逾期/提前还款/正常还款次数</strong>”这类特征。</li>
<li>结合应还时点和借款时点，如果客户在某个应还时点前多次发起借款申请，那么很可能是在“借新还旧”。——由此可构建“过去一段时间内，应还日前借款次数”这类特征。</li>
<li>结合逾期时点和借款时点，如果客户当前处于逾期状态，则新申请借款则可直接拒绝，或者提前管制客户。</li>
</ul>
<figure>
<img src="https://pic4.zhimg.com/80/v2-45b5c68a863deaf80abafc882e3c3703_1440w.jpg" alt="img">
<figcaption aria-hidden="true">img</figcaption>
</figure>
<h4><span id="12-外部数据">1.2 外部数据</span></h4>
<p>客户不仅会在本平台内借款，当无法满足其借款需求时，其也会在其他平台借款，由此形成了多头借款行为数据。这是一块非常宝贵的数据。</p>
<p>在《<a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/109649516">求是汪在路上：多头借贷风险分析与建模</a>》一文中，我们介绍过多头数据的相关知识。整合目前市场上数据商提供的多头数据，我们可分解为以下结构：</p>
<p><img src="https://pic3.zhimg.com/80/v2-bf2f245a96e5f359e82901341f3cae2e_1440w.jpg" alt="img" style="zoom:50%;"></p>
<p>在本文中，先构造一些假数据用以后续衍生特征。可通过以下SQL语句建表，并插入数据。</p>
<h3><span id="二-行为特征衍生思路">二、<strong>行为特征衍生思路</strong></span></h3>
<p>如果拥有这样的数据，你会如何构建特征？通常做法是取最近一段时间窗口（比如最近12个月），在这段时间内，我们可以从以下维度来统计出可累加的指标：</p>
<ul>
<li><strong>指标维度</strong>：金额、次数、笔数、天数、机构数、人数</li>
<li><strong>时间粒度</strong>：日、周、月</li>
<li><strong>聚合函数</strong>：计数（count），求和（sum）</li>
</ul>
<p>为什么要是可累加的呢？这是因为我们可以再次聚合，并且后续计算<strong>比例类特征</strong>时方便。由此，可得到如图5所示的时序数据：</p>
<p><img src="https://pic3.zhimg.com/80/v2-68035afb016202fe873d761ce4ecd3ee_1440w.jpg" alt="img" style="zoom: 67%;"></p>
<p>在《<a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/85440355">求是汪在路上：风控特征—时间滑窗统计特征体系</a>》中，介绍过RFM特征体系的概念。</p>
<ul>
<li><strong>R（Recency）</strong>：<strong>客户最近一次交易消费时间的间隔</strong>。R值越大，表示客户交易发生的日期越久，反之则表示客户交易发生的日期越近。</li>
<li><strong>F（Frequency）</strong>：<strong>客户在最近一段时间内交易消费的次数</strong>。F值越大，表示客户交易越频繁，反之则表示客户交易不够活跃。</li>
<li><strong>M（Monetary）</strong>：<strong>客户在最近一段时间内交易消费的金额</strong>。M值越大，表示客户价值越高，反之则表示客户价值越低。</li>
</ul>
<p><strong>在RFM特征体系的基础上，我们进一步扩展维度</strong>。至少能从图5中捕捉到以下信息：</p>
<p><strong>1）常规统计特征</strong></p>
<p>把客户行为按最小时间粒度统计完毕后，我们就会得到一个分布。接下来则是利用统计函数<strong>最大值（MAX）、最小值（MIN）、平均值（AVG）、标准差（STD）</strong>来描述以上分布特征。</p>
<p>但是，这些指标在统计时只能对给定的数据集合计算，没有考虑到时间序列变化信息。换言之，什么时间段在持续上升，什么时间段在持续下降，什么时间段断档形成空窗期，这些信息都被掩盖了。</p>
<p><strong>2）时间距离特征</strong></p>
<p>用以刻画客户最远一次、最近一次或者某个特殊事件发生的时点。例如：</p>
<ul>
<li>最近一次申请日距离观察点的日期差（天数）</li>
<li>最近一次取到最大值、最小值的事件时点距离观察点的日期差（天数）</li>
<li>最近一次逾期距离观察点的日期差（天数）</li>
</ul>
<p><strong>3）行为波动特征</strong></p>
<p>用以刻画客户某段连续时间内的行为变化特征。例如：</p>
<ul>
<li>最长持续上升（或下降）的时间跨度（天数）。</li>
<li>最长睡眠期（天数）。即，客户多久没有活跃了？</li>
<li>连续行为窗口出现次数。</li>
</ul>
<p><strong>在信贷风控中，变化趋势是衡量风险非常重要的维度。我们喜欢稳定，但是风险天生具有易变性，当有变化的趋势就意味着风险，也意味着机遇。</strong>例如，当客户近期在行业内借款申请次数在上升时，我们就可以判断客户资金紧张，故而在到处借钱。那么，我们需要思考：</p>
<ol type="1">
<li>业务侧：客户是否因为我们的额度不够，无法满足其资金需求而跑到其他平台借款？出于余额增长的目标，我们能不能给客户提额呢？</li>
<li>风险侧：该客户的还款能力是否出现问题？我们给他放开额度后，我们能否承受风险？那么我们就需要给客户打一下风险分，判断客户风险。</li>
</ol>
<p>为捕捉客户行为变化趋势，我们可以用一种简单的方法：<strong>最近N个月次数
/ 最近M个月次数（N &lt;
M）</strong>。例如，多头变量中，该值越高，说明借款申请记录更为集中在近期。一般来说，近期行为对于识别短期欺诈风险更有用，远期行为对于识别长期信用风险更有用。</p>
<p><strong>4）集中度特征</strong></p>
<p><strong>用以刻画客户行为的偏好程度</strong>。如果说时间维度是纵向视角，那么集中度特征则是横截面视角。通常以比例特征形式出现。例如：</p>
<ul>
<li>一天内集中于哪个时间段活动？</li>
<li>借款机构中集中于哪些机构？</li>
<li>借款金额倾向于什么数目（例如1K以内，1K-5K，5K以上）？</li>
<li>购买的商品内集中于买什么品类？</li>
</ul>
<h3><span id="四-其他算法实现思路">四、<strong>其他算法实现思路</strong></span></h3>
<p>前面都是从业务领域知识先入手，分析潜在有用的变量逻辑，再去实现。这是平时大部分模型师所做的事情。但目前也有一些尝试用LSTM、RNN来处理时序数据的技术方案。这是后续可尝试探索和对比的方向。</p>
<figure>
<img src="https://lzy-picture.oss-cn-beijing.aliyuncs.com/img/202304191712092.jpg" alt="img">
<figcaption aria-hidden="true">img</figcaption>
</figure>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://powerlzy.github.io/posts/29K9TF6/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/cat_mac.jpg">
      <meta itemprop="name" content="lzy">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="PowerLZY's Blog">
      <meta itemprop="description" content="相比到达的地方，同行的人更重要！">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | PowerLZY's Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/posts/29K9TF6/" class="post-title-link" itemprop="url">风控算法（2）风控模型-开发流程标准化*</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2022-07-01 19:28:02" itemprop="dateCreated datePublished" datetime="2022-07-01T19:28:02+08:00">2022-07-01</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2022-07-09 18:14:42" itemprop="dateModified" datetime="2022-07-09T18:14:42+08:00">2022-07-09</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E3%80%90draft%E3%80%91%E5%BA%94%E7%94%A8/" itemprop="url" rel="index"><span itemprop="name">【draft】应用</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E3%80%90draft%E3%80%91%E5%BA%94%E7%94%A8/%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF/" itemprop="url" rel="index"><span itemprop="name">应用场景</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E3%80%90draft%E3%80%91%E5%BA%94%E7%94%A8/%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF/%E4%B8%9A%E5%8A%A1%E5%AE%89%E5%85%A8/" itemprop="url" rel="index"><span itemprop="name">业务安全</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>9k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>16 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1><span id="风控模型">风控模型</span></h1>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/109649516">求是汪在路上：多头借贷风险分析与建模</a></p>
<p><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/252845718">求是汪在路上：抽样对Lift和KS指标的影响</a></p>
<p><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/161009991">求是汪在路上：客户级通用信用评分模型架构设计</a></p>
<p><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/90214329">求是汪在路上：大数据信贷风控模型架构</a></p>
<p><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/90251922">求是汪在路上：<strong><font color="red">
风控模型开发流程标准化</font></strong></a></p>
<p><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/92691256">求是汪在路上：风控模型上线部署流程</a></p>
<p><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/350616539">求是汪在路上：如何量化样本偏差对信贷风控模型的影响</a></p>
<p><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/110982479">求是汪在路上：<strong><font color="red">
样本权重对逻辑回归评分卡的影响探讨</font></strong></a></p>
<p><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/85976154">求是汪在路上：利用样本分群提升风控模型性能</a></p>
</blockquote>
<h2><span id="一-风控模型开发流程标准化">一、风控模型开发流程标准化</span></h2>
<h3><span id="风控业务背景"><strong>风控业务背景</strong></span></h3>
<p>在大型风控建模项目中，模型开发阶段实际上只占其中很小的一部分，我们常把大量精力投入在数据准备、特征工程、模型设计等阶段。同时，开发阶段所用方法重复性相对较高。如果将其模块化封装，可大大提高建模效率。Don‘t
repeat yourself！</p>
<figure>
<img src="https://pic2.zhimg.com/80/v2-ca4ae4880f0369cdfd03bfa3b97cba81_1440w.jpg" alt="img">
<figcaption aria-hidden="true">img</figcaption>
</figure>
<p>本文主要内容在于：</p>
<ol type="1">
<li>理论角度，系统阐述了风控模型开发流程，以及相应的理论依据。</li>
<li>实践角度，整理了目前一些开源工具包，可供大家自行选择使用。</li>
</ol>
<h3><span id="11风控模型开发流程标准化的意义"><strong>1.1
风控模型开发流程标准化的意义</strong></span></h3>
<p>在《<a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/90214329">大数据信贷风控模型架构</a>》一文中，我们系统探讨了大数据风控模型架构的优缺点。从该架构出发，基于历次大型模型开发项目实践，我们往往会发现存在以下问题：</p>
<ol type="1">
<li>各建模同学的工程能力存在差异，无法保证所有人都有代码优化及debug的能力。</li>
<li>整个流程不规范统一，某些同学不清楚基础指标函数的底层逻辑，出现问题难以定位。</li>
<li>浪费大量时间用于协调沟通，尤其是过程文档记录参差不齐，无法复现。</li>
<li><strong>建模脚本可能存在多个版本，模型版本管理困难</strong>。</li>
</ol>
<p>风控模型开发流程标准化的意义在于：</p>
<ol type="1">
<li>提高建模效率：可批量快速生产模型，保证项目按期完成，同时让建模同学更有精力关注模型优化分析等复杂工作。</li>
<li>理解计算逻辑：帮助团队更为深刻理解各类评估指标背后的业务含义，便于调试优化。</li>
<li><strong>统一建模流程</strong>：约定命名方式。保证在分工协作的情况下，模型开发文档更容易整合汇总，便于Review。</li>
<li>流程规范约束：减少建模同学（尤其是新手）出错的概率，降低返工可能，并记录必要的中间过程，便于问题回溯。</li>
</ol>
<p>由于经常需要跨时间窗来分析变量，我们约定以下名词：</p>
<ul>
<li><strong>样本集</strong>：训练集（In the Sample，INS）、验证集（Out
of Sample，OOS）、测试集（Out of Time，OOT）</li>
<li><strong>自然月</strong>：由于风控领域中样本相对较少，一般按月粒度来观察。对于某段时间内的样本，我们也称为cohort或vintage。通俗而言，就是一个批次（batch）。</li>
</ul>
<h3><span id="12-功能模块-探索性数据分析"><strong>1.2 功能模块 -
探索性数据分析</strong></span></h3>
<p><strong>探索性数据分析（Exploratory Data
Analysis，EDA）用于初步检验数据质量，因此需要计算各类数据特征指标。</strong></p>
<blockquote>
<ul>
<li>探索数据分布（Exploratory Data Distribution，EDD）</li>
<li>缺失率（Missing Rate）</li>
<li>重复值（Duplicate Value）</li>
<li>单一值（Unique Value）</li>
<li>其他数据质量检查（Quality Check）</li>
</ul>
</blockquote>
<h4><span id="121探索数据分布exploratory-data-distributionedd">1.2.1
探索数据分布（Exploratory Data Distribution，EDD）</span></h4>
<p><strong>功能</strong>：按自然月/样本集维度，统计变量的数据分布。</p>
<p><strong>指标</strong>：</p>
<ul>
<li>连续型变量，包括：数量(count)、均值(mean)、标准差(std)、最小值(min)、分位数P25、P50、P75、最大值(max)。其中，最大值和最小值可用来观察异常值（outlier）。</li>
<li>离散型变量，包括：取值及出现次数(cnt)、占比(ratio)。</li>
</ul>
<p><strong>示例</strong>：连续变量数据分布（月维度)、离散变量数据分布</p>
<figure>
<img src="https://pic3.zhimg.com/80/v2-8f7ad96d18789094dab9090cf551a81e_1440w.jpg" alt="img">
<figcaption aria-hidden="true">img</figcaption>
</figure>
<figure>
<img src="https://pic4.zhimg.com/80/v2-0b97ea436eb6156939e74bf5126ae3d3_1440w.jpg" alt="img">
<figcaption aria-hidden="true">img</figcaption>
</figure>
<ul>
<li><strong>业务含义</strong>：基于“<strong>历史与未来样本分布相同</strong>”的建模假设，我们才能基于历史数据拟合X和Y之间的关系来预测未来。因此，在变量分布上，首先需要保证这一点。</li>
</ul>
<p>从图1中，我们可以观察分位数的变化差异。例如，变量 <img src="https://www.zhihu.com/equation?tex=x_2" alt="[公式]">
在2018年1月时最大值异常，其余月份均正常。此时，我们就需要检查：数据源是否存在问题？变量回溯过程是否出错？</p>
<h4><span id="122-缺失率missingrate">1.2.2 <strong>缺失率（Missing
Rate）</strong></span></h4>
<p>功能：<strong>按自然月/样本集维度，统计变量的缺失率。</strong></p>
<p>指标：缺失率 = 未覆盖样本数 / 总样本数 × 100%</p>
<figure>
<img src="https://pic2.zhimg.com/80/v2-32d1ec1106b1e58cfcd2ecfe7b0040b5_1440w.jpg" alt="img">
<figcaption aria-hidden="true">img</figcaption>
</figure>
<p>业务：</p>
<ul>
<li>用于分析数据源的缺失率，以及未来的采集率趋势。如果缺失率持续升高，我们就认为这块数据不可用。</li>
<li>造成缺失的原因多种多样，可分为随机缺失和非随机缺失。例如，如果是用户自填信息，用户主观不愿意填写而导致数据缺失，属于非随机缺失。</li>
</ul>
<h4><span id="123-重复值duplicatevalue">1.2.3 <strong>重复值（Duplicate
Value）</strong></span></h4>
<p>功能：检验建模样本中是否有重复数据。</p>
<p>指标：按样本ID分组后，统计行数</p>
<figure>
<img src="https://pic1.zhimg.com/80/v2-2c3cd4f809b68e130f4d6edba31058b8_1440w.jpg" alt="img">
<figcaption aria-hidden="true">img</figcaption>
</figure>
<p>业务：观察相同订单的特征变量取值是否一致。取值相同，只需简单去重；否则，说明生成逻辑有误，需检查SQL逻辑。</p>
<h4><span id="124-单一值uniquevalue">1.2.4 <strong>单一值（Unique
Value）</strong></span></h4>
<p>功能：统计变量中某一固定值的占比。</p>
<p>指标：变量每个取值的出现次数。</p>
<p>示例：变量中0的取值占到70%.</p>
<p><strong>业务：如果变量取值中某一固定值占比很高，那么该变量区别度往往很低。通常，单一值比例超过90%以上，建议删除该变量。</strong></p>
<h4><span id="125其他数据质量检查qc"><strong>1.2.5
其他数据质量检查（QC）</strong></span></h4>
<p>变量取值本身具有某些业务含义，我们需要结合业务来检验，并记录归档。例如：</p>
<ul>
<li>特殊值归档说明：例如-9999999是代表缺失，还是其他含义，需给出描述说明。</li>
<li>0的业务逻辑确认：真实值为0？数据缺失？默认填充值？</li>
</ul>
<h3><span id="13-功能模块-特征选择">1.3 <strong>功能模块 -
特征选择</strong></span></h3>
<p>根据RFM特征体系，我们可以构造成千上万个特征变量（参考《<a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/85440355">风控特征—时间滑窗统计特征体系</a>》）。但是，这些变量并不都满足我们的要求，<strong><font color="red">
我们需要剔除不符合要求的变量，从输入上保证风控系统的鲁棒性。</font></strong></p>
<p>变量筛选（selection）是一个比较复杂的精细活，需要考虑很多因素，比如：<strong>预测能力、相关性、稳定性、合规性、业务可解释性</strong>等等。考虑不同维度，我们会依据一系列指标进行变量筛选。</p>
<p>从广义上，可分为业务指标和技术指标两大类。</p>
<h4><span id="131-业务指标包括">1.3.1 <strong>业务指标</strong>包括：</span></h4>
<ol type="1">
<li><strong>合规性(compliant)</strong>：用以加工变量的数据源是否符合国家法律法规？是否涉及用户隐私数据？例如，如果某块爬虫数据被监管，那么相关变量的区分度再好，我们也只能弃用。而在国外，种族、性别、宗教等变量被禁止用于信贷风控中，这会存在歧视性。</li>
<li><strong>可得性(available)</strong>：数据未来是否能继续采集？这就涉及产品流程设计、用户授权协议、合规需求、模型应用环节等诸多方面。例如，如果产品业务流程改动而导致某个埋点下线，那么相关埋点行为变量只能弃用。又比如，如果需要做额度授信模型，那么只能利用在额度阶段能采集到的实时数据，这就需要提前确认数据采集逻辑。</li>
<li><strong>稳定性(stable)</strong>：一方面，数据源采集稳定是变量稳定性的基本前提。例如，外部数据常会因为政策性、技术性等原因导致接入不稳定，这就需要做好数据缓存，或者模型降级机制。另一方面，变量取值分布变化是导致不稳定的直接原因。我们将会采取一些技术指标展开分析，下文将会介绍。</li>
<li><strong>可解释性(interpretable)</strong>：需要符合业务可解释性。如果变量的业务逻辑不清晰，那么我们宁可弃之。同时，这也是保证模型可解释性（参数
+ 变量）的前提。</li>
<li><strong>逻辑性(logical)</strong>：也就是因果逻辑，特征变量是因，风控决策是果。如果某个变量是风控系统决策给出的，那么我们就不能入模。例如，用户历史申贷订单的利率是基于上一次风控系统决策的结果，如果将“用户历史申贷订单的利率”作为变量，那么在实际使用时就会有问题。</li>
<li><strong>可实时上线</strong>：模型最终目的是为了上线使用。如果实时变量不支持加工，那么对应的离线变量就只能弃之。例如，某个离线变量在统计时限定观察期为180天，但线上只支持观察期为90天，那么就不可用。对于不熟悉线上变量加工逻辑的新手，往往容易踩坑而导致返工。</li>
</ol>
<h4><span id="132-技术指标包括">1.3.2 <strong>技术指标</strong>包括：</span></h4>
<blockquote>
<p>基于缺失率（Missing Rate） 基于变异系数（Coefficient of
Variation，CV） 基于稳定性（Population Stability Index，PSI）
基于信息量（Information Value，IV） 基于RF/XGBoost特征重要性（Feature
Importance） 变量聚类（Variable Cluster，VarClus）
基于线性相关性（Linear Correlation） 基于多重共线性（Multicollinearity）
基于逐步回归（stepwise) 基于P-Vaule显著性检验</p>
</blockquote>
<ul>
<li><strong>基于缺失率（Missing Rate）</strong></li>
</ul>
<p><strong>业务：</strong>变量缺失率越高，可利用价值越低。缺失率变化不稳定的变量，尤其是缺失率趋势在升高，代表未来数据源采集率下降，不建议采用。数据源是特征变量的基础，数据源不稳定，直接导致模型稳定性变差。</p>
<h5><span id="功能">功能：</span></h5>
<blockquote>
<p>step 1.
按自然月/样本集维度，统计变量缺失率，并计算缺失率的均值、标准差。 step
2. 根据实际场景，设置阈值（如50%、70%、90%）进行筛选。</p>
</blockquote>
<figure>
<img src="https://pic4.zhimg.com/80/v2-d432f6c6916a4e94b698d325ce9d32b7_1440w.jpg" alt="img">
<figcaption aria-hidden="true">img</figcaption>
</figure>
<ul>
<li><strong>基于变异系数（Coefficient of Variation，CV）</strong></li>
</ul>
<p><strong>业务</strong>：变异系数越小，代表波动越小，稳定性越好。缺点在于CV没有统一的经验标准。</p>
<p><strong>功能</strong>：</p>
<blockquote>
<p>step 1.
基于数据分布EDD，选择某个指标（如均值mean）计算变异系数CV，用来衡量变量分布的稳定性。
step 2. 设置阈值进行筛选。</p>
</blockquote>
<p><strong>指标</strong>：变异系数 C·V =（ 标准偏差 SD / 平均值Mean ）×
100%</p>
<ul>
<li><strong>基于稳定性（Population Stability Index，PSI）</strong></li>
</ul>
<p><strong>业务</strong>：需分申请层、放款层，分别评估变量稳定性。通常会选择0.1作为阈值，只要任意一个不满足稳定性要求就弃用。PSI无法反映很多细节原因，比如分布是右偏还是左偏。此时需要从EDD上进行分析。</p>
<figure>
<img src="https://pic3.zhimg.com/80/v2-330e33c4f93c5abef39854964f780d5a_1440w.png" alt="img">
<figcaption aria-hidden="true">img</figcaption>
</figure>
<p><strong>功能</strong>：</p>
<blockquote>
<p>step 1. 以训练集（INS）分布为期望分布，计算变量的群体稳定性指标PSI。
step 2. 根据PSI的经验阈值进行筛选。</p>
</blockquote>
<p><strong>指标</strong>： <img src="https://www.zhihu.com/equation?tex=psi+%3D+%5Csum_%7Bi%3D1%7D%5E%7Bn%7D%7B%28A_i+-+E_i%29%7D+%2A+ln%28A_i+%2F+E_i%29" alt="[公式]"></p>
<p>上式含义为：PSI = SUM( (实际占比 - 预期占比）* ln(实际占比 /
预期占比)
);预期占比是指训练集上每个分箱里的样本占比，实际占比是待比较样本集的每个分箱里的样本占比。可参考《<a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/79682292">群体稳定性指标(PSI)深入理解应用</a>》。</p>
<figure>
<img src="https://pic3.zhimg.com/80/v2-c9cb1ae5f72f2f6c5dfcb54486f23182_1440w.jpg" alt="img">
<figcaption aria-hidden="true">img</figcaption>
</figure>
<ul>
<li>==<strong>基于信息量（Information Value，IV）</strong>==</li>
</ul>
<p><strong>业务</strong>：<strong>用以评估变量的预测能力</strong>。通常情况下，IV越高，预测能力越强。但IV过高时，我们就要怀疑是否发生信息泄漏（leakage）问题，也就是在自变量X中引入了Y的信息。</p>
<figure>
<img src="https://pic3.zhimg.com/80/v2-1833a40731ac61e55a38bbd928dc7636_1440w.jpg" alt="img">
<figcaption aria-hidden="true">img</figcaption>
</figure>
<p><strong>功能</strong>：</p>
<blockquote>
<p>step 1. 按自然月/样本集维度，统计变量的IV。 step 2.
根据IV的经验阈值来筛选。</p>
</blockquote>
<p><strong>指标</strong>：IV。可参考<strong>《</strong><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/80134853">WOE与IV指标的深入理解应用</a><strong>》</strong></p>
<figure>
<img src="https://www.zhihu.com/equation?tex=IV+%3D++%5Csum_%7Bi%3D1%7D%5E%7Bn%7D%28%5Cfrac%7BBad_i%7D%7BBad_T%7D++-+%5Cfrac%7BGood_i%7D%7BGood_T%7D%29+%2A+WOE_i+%5C%5C++++%3D%5Csum_%7Bi%3D1%7D%5E%7Bn%7D+%28%5Cfrac%7BBad_i%7D%7BBad_T%7D++-+%5Cfrac%7BGood_i%7D%7BGood_T%7D%29+%2Aln%28%5Cfrac%7BBad_i%7D%7BBad_T%7D++%2F+%5Cfrac%7BGood_i%7D%7BGood_T%7D%29+%5C%5C+" alt="[公式]">
<figcaption aria-hidden="true">[公式]</figcaption>
</figure>
<figure>
<img src="https://pic3.zhimg.com/80/v2-2097685ef366bb9df0f6b8944c416aba_1440w.png" alt="img">
<figcaption aria-hidden="true">img</figcaption>
</figure>
<ul>
<li>==<strong>基于RF/XGBoost特征重要性</strong>==</li>
</ul>
<p><strong>业务</strong>：在特征变量特别多的时候，可用于快速筛选特征。从机器学习可解释性角度而言，特征重要性只具有全局可解释性，无法对单个case给出解释。</p>
<p><strong>功能</strong>：</p>
<blockquote>
<p>step 1. 根据树模型训练后给出的特征重要性，一般选择累积重要性Top
95%的变量。 step 2.
为降低一次训练所导致的随机性影响，可综合多次结果来筛选。</p>
</blockquote>
<p>指标：特征重要性。XGBoost实现中Booster类get_score方法输出特征重要性，其中
importance_type参数支持三种特征重要性的计算方法：</p>
<blockquote>
<ol type="1">
<li><strong>weight（默认值）：使用特征在所有树中作为划分属性的次数。</strong></li>
<li><strong>gain：使用特征在作为划分属性时，OBj的平均降低量。</strong></li>
<li><strong>cover：使用特征在作为划分属性时对样本的覆盖度。</strong></li>
</ol>
</blockquote>
<p><strong>RF中计算特征重要度的主要思想：影响力分析</strong>。如果某个输入变量产生扰动，导致模型系统输出性能（利用袋外数据OOB的准确率来评估）产生明显影响，那么说明输入变量对系统具有较大的影响力，特征重要度比较高。</p>
<p>执行步骤为：</p>
<blockquote>
<p>step 1. 基准性能：对每一颗决策树，选择相应的袋外数据计算误差，记为
<img src="https://www.zhihu.com/equation?tex=err_%7BOOB1%7D" alt="[公式]"> ； step 2.
输入扰动：随机对袋外数据所有样本的特征加入噪声干扰(如白噪声)，再次计算袋外数据误差，记为
<img src="https://www.zhihu.com/equation?tex=err_%7BOOB2%7D" alt="[公式]"> ； step 3. 重要度计算： <img src="https://www.zhihu.com/equation?tex=+%5Cfrac%7B%5Csum_%7Bi%3D1%7D%5E%7BN%7D%28err_%7BOOB2%7D-err_%7BOOB1%7D%29%7D%7BN%7D" alt="[公式]"> ，N为随机森林中决策树的棵数。</p>
</blockquote>
<figure>
<img src="https://pic4.zhimg.com/80/v2-7457883119e561b64bae7ef3d49340ff_1440w.jpg" alt="img">
<figcaption aria-hidden="true">img</figcaption>
</figure>
<ul>
<li><strong>变量聚类（Variable Cluster，VarClus）</strong></li>
</ul>
<p><strong>业务</strong>：在SAS中对应Proc VarClus方法。</p>
<p><strong>功能</strong>：</p>
<blockquote>
<p>step 1. 列聚类，将所有变量进行层次聚类。 step 2.
根据聚类结果，剔除IV相对较低的变量。</p>
</blockquote>
<p><strong>指标</strong>：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> sklearn.cluster <span class="keyword">import</span> FeatureAgglomeration</span><br><span class="line"><span class="keyword">from</span> sklearn <span class="keyword">import</span> preprocessing</span><br><span class="line">    </span><br><span class="line">X_Scale = preprocessing.StandardScaler().fit_transform(input_df[var_list])</span><br><span class="line">ward = FeatureAgglomeration(n_clusters=n_clusters, linkage=<span class="string">&#x27;ward&#x27;</span>)</span><br><span class="line">ward.fit(X_Scale)</span><br><span class="line">clusters = <span class="built_in">list</span>(ward.labels_)</span><br></pre></td></tr></table></figure>
<figure>
<img src="https://pic3.zhimg.com/80/v2-f93b791196087e503a2da4b12a26b84a_1440w.jpg" alt="img">
<figcaption aria-hidden="true">img</figcaption>
</figure>
<ul>
<li><strong>基于线性相关性（Linear Correlation）</strong></li>
</ul>
<p><strong>业务</strong>：逻辑回归作为一种线性模型，其基础假设是：自变量
<img src="https://www.zhihu.com/equation?tex=%28X_1%EF%BC%8CX_2%29" alt="[公式]">
之间应相互独立。当两变量间的相关系数大于阈值时（一般阈值设为0.6)，剔除IV值较低的变量。</p>
<p><strong>功能</strong>：</p>
<blockquote>
<p>step 1. 计算变量的线性相关性。 step 2.
<strong>相关性较高的多个变量里，保留IV较高的变量。</strong></p>
</blockquote>
<p><strong>指标</strong>：<strong>皮尔逊相关系数（Pearson Correlation
Coefficient）</strong>，系数的取值为<img src="https://www.zhihu.com/equation?tex=%5B-1.0%2C1.0%5D" alt="[公式]">，两变量相关系数越接近0，说明线性相关性越弱；越接近1或-1，说明线性相关性越强。</p>
<figure>
<img src="https://www.zhihu.com/equation?tex=%5Crho_%7BX%2CY%7D%3D%5Cfrac%7Bcov%28X%2CY%29%7D%7B%5Csigma_X%5Csigma_Y%7D%5C%5C%3D%5Cfrac%7BE%28%28X-%5Cbar+X%29%28Y-%5Cbar+Y%29%29%7D%7B%5Csqrt%7B%5Csum%5Climits_%7Bi%3D1%7D%5En%28X_i-%5Cbar+X%29%5E2%7D+%5Csqrt%7B+%5Csum%5Climits_%7Bi%3D1%7D%5En%28Y_i-%5Cbar+Y%29%5E2%7D%7D+%5C%5C%3D+%5Cfrac%7BE%28XY%29-E%28X%29%28Y%29%7D%7B%5Csqrt%7BE%28X%5E2%29-E%5E2%28X%29%7D%5Csqrt%7BE%28Y%5E2%29-E%5E2%28Y%29%7D%7D+%5C%5C" alt="[公式]">
<figcaption aria-hidden="true">[公式]</figcaption>
</figure>
<figure>
<img src="https://pic4.zhimg.com/80/v2-17f049f47e262d45614a016289def3eb_1440w.jpg" alt="img">
<figcaption aria-hidden="true">img</figcaption>
</figure>
<ul>
<li><strong>基于多重共线性（Multicollinearity）</strong></li>
</ul>
<p>对于自变量<img src="https://www.zhihu.com/equation?tex=X_1%2C+X_2%2C+%5Ccdots+%2C+X_n" alt="[公式]">，如果存在不全为0的系数<img src="https://www.zhihu.com/equation?tex=c_1%2Cc_2%2C+%5Ccdots%2C+c_n" alt="[公式]">，使得以下线性等式近似成立:</p>
<figure>
<img src="https://www.zhihu.com/equation?tex=c_1X_1+%2B+c_2X_2+%2B+%5Ccdots+%2B+c_nX_n+%5Capprox+0%5C%5C" alt="[公式]">
<figcaption aria-hidden="true">[公式]</figcaption>
</figure>
<p>换言之，对于 <img src="https://www.zhihu.com/equation?tex=N" alt="[公式]"> 个变量，其中 <img src="https://www.zhihu.com/equation?tex=1" alt="[公式]">
个可以由剩下的 <img src="https://www.zhihu.com/equation?tex=N-1" alt="[公式]"> 个变量线性表示。此时，我们就称自变量<img src="https://www.zhihu.com/equation?tex=X_1%2C+X_2%2C+%5Ccdots+%2C+X_n" alt="[公式]">具有较强的多重共线性。</p>
<p><strong><font color="red">
当出现多重共线性时，变量之间的联动关系会导致估计标准差偏大，置信区间变宽。这就会产生一个常见的现象，LR中变量系数出现正负号不一致。</font></strong></p>
<p>业务：VIF取值的业务含义为：</p>
<blockquote>
<p>若VIF &lt; 3，说明基本不存在多重共线性问题 若VIF &gt;
10，说明问题比较严重。</p>
</blockquote>
<p>功能：</p>
<blockquote>
<p>step 1. <strong>计算变量的方差膨胀因子（Variance Inflation
Factor，VIF），适用于线性模型。</strong> step 2.
根据阈值剔除VIF较高的变量。</p>
</blockquote>
<p>指标：通常用VIF衡量一个变量和其他变量的多重共线性。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">from statsmodels.stats.outliers_influence import variance_inflation_factor</span><br></pre></td></tr></table></figure>
<p>示例：</p>
<figure>
<img src="https://pic4.zhimg.com/80/v2-6b5e626a0af1ae9f595f25fb8fb9b10b_1440w.jpg" alt="img">
<figcaption aria-hidden="true">img</figcaption>
</figure>
<ul>
<li><p><strong>基于逐步回归（stepwise)</strong></p>
<ul>
<li><p>前向选择（forward
selection）：逐步加入变量，计算指标进行评估，若不合格则不加入，直到评估完所有变量。</p></li>
<li><p>后向选择（backward
selection）：初始时加入所有变量，根据指标逐渐剔除不合格的变量。</p></li>
<li><p>逐步选择（stepwise）：将向前选择和向后选择的结合，逐步放入最优的变量、移除最差的变量。</p></li>
</ul></li>
<li><p><strong>基于P-Vaule显著性检验</strong></p></li>
</ul>
<p>业务：根据逻辑回归参数估计表，剔除P值大于0.05的变量。</p>
<p>功能：</p>
<blockquote>
<p>step 1. 用于检验自变量X与因变量Y之间的相关性。 step 2.
剔除P值大于0.05的变量。</p>
</blockquote>
<p>指标：P-Vaule。在变量相关分析中，对相关系数进行假设检验时：</p>
<blockquote>
<p>原假设H0：自变量与因变量之间线性无关。
备择假设H1：自变量与因变量之间线性相关。</p>
</blockquote>
<p>或许不太恰当，但通常当P值大于0.05时，接受原假设，否则拒绝原假设。因此，我们需要剔除P值大于0.05的变量。</p>
<figure>
<img src="https://pic2.zhimg.com/80/v2-e08616047f86d2e6011528e45df62eb9_1440w.jpg" alt="img">
<figcaption aria-hidden="true">img</figcaption>
</figure>
<h3><span id="14-功能模块-模型训练">1.4 <strong>功能模块 -
模型训练</strong></span></h3>
<p>该模块主要包括<strong>变量变换（如分箱）</strong>、<strong>样本准备（包括样本赋权、拒绝推断等）</strong>、<strong>模型参数估计</strong>、<strong>模型分数校准</strong>、<strong>模型文件保存</strong>等功能。</p>
<h4><span id="141-woe转换weight-ofevidence">1.4.1 <strong>WOE转换（Weight of
Evidence）</strong></span></h4>
<p><strong>业务：训练集上的WOE曲线需满足单调性，并且经过跨时间窗验证WOE变换逻辑同样满足单调性。如果不满足，那就需要再次调整。</strong></p>
<p><strong>功能：在评分卡模型中用于变量WOE变换，支持等频、等距、自定义间距等分箱操作。</strong></p>
<p>原理：可参考<strong>《</strong><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/80134853">WOE与IV指标的深入理解应用</a><strong>》</strong></p>
<p>示例：</p>
<figure>
<img src="https://pic2.zhimg.com/80/v2-3f95842ee9ac7568cfd1147552471481_1440w.jpg" alt="img">
<figcaption aria-hidden="true">img</figcaption>
</figure>
<h4><span id="142-样本权重sampleweight">1.4.2 <strong>样本权重（Sample
Weight）</strong></span></h4>
<p><strong>功能：给建模样本赋予权重列，以逼近总体样本。</strong></p>
<p><strong>原理：建模本质在于从历史样本中学习未来样本的数理统计规律。</strong></p>
<h4><span id="不同的样本权重主要有几个目的"><strong>不同的样本权重主要有几个目的：</strong></span></h4>
<ul>
<li>为了让模型更稳健，一般都是拿近期样本refit模型，但上线后没几个月很快就衰减了，说明训练样本有偏程度比较高，不够代表总体。</li>
<li>早期的历史样本都是拿钱换来的，如何把这部分样本利用起来，不浪费。</li>
</ul>
<h4><span id="业务角度主观性强操作性高"><strong>==业务角度（主观性强，操作性高）：==</strong></span></h4>
<ul>
<li>按时间因素，近期样本提高权重，较远样本降低权重</li>
<li>按贷款类型，不同额度、利率、期限的样本赋予不同权重</li>
<li>按样本分群，不同群体赋予不同权重</li>
</ul>
<h4><span id="技术角度操作性复杂可解释性弱"><strong>技术角度（操作性复杂，可解释性弱）：</strong></span></h4>
<ul>
<li>借鉴Adaboost思想，对误判样本提高权重</li>
<li>过采样、欠采样、SMOTE等</li>
</ul>
<h4><span id="拒绝演绎rejectinference"><strong>拒绝演绎（Reject
Inference）</strong></span></h4>
<p>功能：样本偏差将会导致模型估计过于乐观。通过推断拒绝样本的贷后表现，加入建模样本，可降低放贷建模样本与申请作用样本之间的偏差。</p>
<p>原理：参考《<a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/88624987">风控建模中的样本偏差与拒绝推断</a>》</p>
<h4><span id="参数估计parameterestimation"><strong>参数估计（Parameter
Estimation）</strong></span></h4>
<p><strong>功能：支持机器学习模型（如随机森林、GBDT、XGBoost、LightGBM等）调参、评分卡模型逐步回归（stepwise）。</strong></p>
<p>原理：LR采用最大似然估计进行参数估计。而机器学习模型的超参数较多，通常需要借助网格搜索（grid
search）、贝叶斯调参等技术，降低对人工经验的依赖。</p>
<h4><span id="分数校准calibration"><strong>分数校准（Calibration）</strong></span></h4>
<p>功能：其一，一致性校准，将模型预测概率校准到真实概率。其二，尺度变换，将风险概率转换为平时所见的整数分数。</p>
<p>原理：参考《<a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/82670834">信用评分卡模型分数校准</a>》</p>
<h4><span id="模型保存save-model"><strong>模型保存（Save Model）</strong></span></h4>
<p>功能：将模型（参数+结构）保存为pkl和pmml文件，用以最终上线部署。注意需要给不同版本的模型赋予易于辨识、含义清晰的命名。一般建议至少包含以下内容：</p>
<blockquote>
<p>命名 = 生成日期+责任人+业务线+应用环节+版本号
例如：20190101_小王_有钱花_额度授信_V1.pmml</p>
</blockquote>
<p>原理：参考《<a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/92691256">风控模型上线部署流程</a>》</p>
<h3><span id="15-功能模块-模型评估">1.5 <strong>功能模块 -
模型评估</strong></span></h3>
<p>在实际业务实践中，我们对风控模型的衡量维度主要包括以下几个方面：</p>
<blockquote>
<ul>
<li>稳定性（Stability）</li>
<li>区分度（Discrimination）</li>
<li>排序性（Ranking）</li>
<li>拟合度（Goodness of Fit）</li>
</ul>
</blockquote>
<h4><span id="151-稳定性stability">1.5.1 <strong>稳定性（Stability）</strong></span></h4>
<p>业务：在风控中，稳定性压倒一切。PSI取值所对应的业务含义如图8所示。我们需在申请层和放贷层上评估稳定性。原因在于：</p>
<ul>
<li>虽然模型是基于放贷订单训练，但最终应用在申请层。</li>
<li>申请层和放贷层客群存在差异。</li>
</ul>
<p>当PSI曲线的趋势一直在上升时，我们就要分析原因，消除不稳定因素。排查方向可参考《<a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/86559671">特征稳定性指标(CSI)深入理解应用</a>》中的Part
4。</p>
<p>指标：PSI。可参考《<a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/79682292">群体稳定性指标(PSI)深入理解应用</a>》</p>
<p>示例：</p>
<p><img src="https://pic2.zhimg.com/80/v2-ed926c29a728c4e8f42b881af25c319d_1440w.png" alt="img">模型分数PSI计算结果表（申请+放贷）</p>
<figure>
<img src="https://pic1.zhimg.com/80/v2-b5e5d64f96906eeaa78e8ac6ebf80098_1440w.jpg" alt="img">
<figcaption aria-hidden="true">img</figcaption>
</figure>
<h4><span id="152区分度discrimination">1.5.2
<strong>区分度（Discrimination）</strong></span></h4>
<p>业务：KS指标是风控建模同学最为追求的指标之一。通常情况下，KS越大，模型性能越好。但更需要分析KS不佳的原因，可结合ROC曲线进行辅助分析。</p>
<p>指标：Gini、AUC、KS。可参考《<a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/79934510">区分度评估指标(KS)深入理解应用</a>》
<img src="https://pic2.zhimg.com/80/v2-952042e2835b7a3b4458d3fd763b6e15_1440w.png" alt="img"></p>
<figure>
<img src="https://pic3.zhimg.com/80/v2-649ad86e09b8f5fc09dc224a6a1fb6ea_1440w.jpg" alt="img">
<figcaption aria-hidden="true">img</figcaption>
</figure>
<h4><span id="153-排序性ranking">1.5.3 <strong>排序性（Ranking）</strong></span></h4>
<p><strong>业务</strong>：大部分模型在最终应用时只是利用到排序性，其主要是为了观察曲线的斜率。如图21所示的模型，排序性非常好，前5个分箱就能抓住大约77%的坏客户。</p>
<p><strong>指标：按自然月/样本集维度，统计包含bad_rate、lift、odds等指标的Gain
Table。</strong></p>
<blockquote>
<p><strong>lift = 召回样本的bad rate / 全部样本的bad rate</strong>
<strong>odds = bads / good</strong></p>
</blockquote>
<p>示例：模型分数Gain-Table</p>
<figure>
<img src="https://pic4.zhimg.com/80/v2-169d5023b834416495810435e8c9b11b_1440w.jpg" alt="img">
<figcaption aria-hidden="true">img</figcaption>
</figure>
<h4><span id="154-拟合度goodness-offit">1.5.4 <strong>拟合度（Goodness of
Fit）</strong></span></h4>
<p><strong>业务</strong>：我们以训练集为基准，将模型分数划分成10个(或20个)分箱后，查看每个分箱里的reject
rate等指标是否一致。理论上，如果按每个Vintage绘制多条曲线，这些曲线会几乎重合，也就是围绕在训练集附近波动。此时，我们就可以相信模型在每一档的坏账估计比较准确。</p>
<p>指标：按自然月/样本集，评估每个分箱里lift、reject rate、bad
rate的点估计</p>
<p>示例：</p>
<figure>
<img src="https://pic2.zhimg.com/80/v2-32f4f004276a03f1adb5046d4ea40d91_1440w.jpg" alt="img">
<figcaption aria-hidden="true">img</figcaption>
</figure>
<h3><span id="16-开源的风控建模工具包简介">1.6 开源的风控建模工具包简介</span></h3>
<p>前文主要介绍一些理论，接下来介绍目前一些开源的风控建模工具包。</p>
<blockquote>
<p>feature-selector scorecardpy toad</p>
</blockquote>
<h4><span id="161-feature-selector">1.6.1 <strong>feature-selector</strong></span></h4>
<ul>
<li>https://github.com/WillKoehrsen/feature-selector</li>
</ul>
<p><strong>主要功能：包括缺失率、单一值、相关性、特征重要性等。</strong></p>
<ol type="1">
<li>Missing Values</li>
<li>Single Unique Values</li>
<li>Collinear Features</li>
<li>Zero Importance Features</li>
<li>Low Importance Features</li>
</ol>
<h4><span id="162-scorecardpy">1.6.2 <strong>scorecardpy</strong></span></h4>
<ul>
<li>https://github.com/shichenxie/scorecardpy</li>
</ul>
<p><strong>主要功能：包括数据集划分、变量筛选、WOE分箱变换、评分卡尺度变换、模型性能评估。</strong></p>
<ol type="1">
<li>data partition (split_df)</li>
<li>variable selection (iv, var_filter)</li>
<li>weight of evidence (woe) binning (woebin, woebin_plot, woebin_adj,
woebin_ply)</li>
<li>scorecard scaling (scorecard, scorecard_ply)</li>
<li>performance evaluation (perf_eva, perf_psi)</li>
</ol>
<h4><span id="163-toad">1.6.3 <strong>toad</strong></span></h4>
<ul>
<li>https://toad.readthedocs.io/en/stable/tutorial_chinese.html</li>
</ul>
<p><strong>主要功能：包括数据分析处理、特征筛选、模型筛选、模型评估、评分卡尺度变换等。</strong></p>
<ol type="1">
<li>data handling</li>
<li>feature selection and WOE binning</li>
<li>model selection</li>
<li>results evaluation and model validation</li>
<li>scorecard transformation.</li>
</ol>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




  <nav class="pagination">
    <a class="extend prev" rel="prev" title="上一页" aria-label="上一页" href="/page/4/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/4/">4</a><span class="page-number current">5</span><a class="page-number" href="/page/6/">6</a><span class="space">&hellip;</span><a class="page-number" href="/page/27/">27</a><a class="extend next" rel="next" title="下一页" aria-label="下一页" href="/page/6/"><i class="fa fa-angle-right"></i></a>
  </nav>

</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 
  <span itemprop="copyrightYear">2023</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">lzy</span>
</div>
<div class="busuanzi-count">
    <span class="post-meta-item" id="busuanzi_container_site_uv">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="总访客量">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-item" id="busuanzi_container_site_pv">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="总访问量">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>

<!--
  <div class="powered-by">由 <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/pisces/" rel="noopener" target="_blank">NexT.Pisces</a> 强力驱动
  </div>-->
<!-- 网站运行时间的设置 -->
<span id="timeDate">载入天数...</span>
<span id="times">载入时分秒...</span>
<script>
    var now = new Date();
    function createtime() {
        var grt= new Date("03/01/2023 10:00:00"); //此处修改你的建站时间或者网站上线时间
        now.setTime(now.getTime()+250);
        days = (now - grt ) / 1000 / 60 / 60 / 24; dnum = Math.floor(days);
        hours = (now - grt ) / 1000 / 60 / 60 - (24 * dnum); hnum = Math.floor(hours);
        if(String(hnum).length ==1 ){hnum = "0" + hnum;} minutes = (now - grt ) / 1000 /60 - (24 * 60 * dnum) - (60 * hnum);
        mnum = Math.floor(minutes); if(String(mnum).length ==1 ){mnum = "0" + mnum;}
        seconds = (now - grt ) / 1000 - (24 * 60 * 60 * dnum) - (60 * 60 * hnum) - (60 * mnum);
        snum = Math.round(seconds); if(String(snum).length ==1 ){snum = "0" + snum;}
        document.getElementById("timeDate").innerHTML = "本站已安全运行 "+dnum+" 天 ";
        document.getElementById("times").innerHTML = hnum + " 小时 " + mnum + " 分 " + snum + " 秒.";
    }
setInterval("createtime()",250);
</script>

    </div>
  </footer>

  

  <a href="https://github.com/PowerLZY" class="github-corner" title="在 GitHub 上关注我" aria-label="在 GitHub 上关注我" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/next-boot.js"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-generator-searchdb/1.4.1/search.js" integrity="sha256-1kfA5uHPf65M5cphT2dvymhkuyHPQp5A53EGZOnOLmc=" crossorigin="anonymous"></script>
<script src="/js/third-party/search/local-search.js"></script>


  <script class="next-config" data-name="mermaid" type="application/json">{"enable":true,"theme":{"light":"default","dark":"dark"},"js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/mermaid/9.4.3/mermaid.min.js","integrity":"sha256-e0o3JYsdjqKajf9eOe22FhioYSz9WofRY4dLKo3F6do="}}</script>
  <script src="/js/third-party/tags/mermaid.js"></script>


  <script src="/js/third-party/pace.js"></script>

  
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>




  

  <script class="next-config" data-name="enableMath" type="application/json">true</script><script class="next-config" data-name="mathjax" type="application/json">{"enable":true,"tags":"all","js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/mathjax/3.2.2/es5/tex-mml-chtml.js","integrity":"sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI="}}</script>
<script src="/js/third-party/math/mathjax.js"></script>




        <script src="//cdn.jsdelivr.net/npm/js-base64/base64.min.js"></script>
        <script>
        const hasAttr = (e,a) => a.some(_=> e.attr(_)!==undefined);
        $('a').each(function() {
          const $this = $(this);
          if(hasAttr($this,["data-fancybox","ignore-external-link"])) return;
          const href = $this.attr('href');
          if (href && href.match('^((http|https|thunder|qqdl|ed2k|Flashget|qbrowser|ftp|rtsp|mms)://)')) {
            const strs = href.split('/');
            if (strs.length >= 3) {
                const host = strs[2];
                if (host !== 'powerlzy.github.io' || window.location.host) {
                    $this.attr('href', '/go.html?u='+Base64.encode(href)+'').attr('rel', 'external nofollow noopener noreferrer');
                    if (true) {
                        $this.attr('target', '_blank');
                    }
                }
            }
          }
        });
        </script></body>
</html>
