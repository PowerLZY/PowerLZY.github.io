<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 6.3.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">

<link rel="stylesheet" href="https://fonts.lug.ustc.edu.cn/css?family=Lato:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext">

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" integrity="sha256-HtsXJanqjKTc8vVQjO4YMhiqFoXkfBsjBWcX91T1jr8=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pace/1.2.4/themes/blue/pace-theme-bounce.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pace/1.2.4/pace.min.js" integrity="sha256-gqd7YTjg/BtfqWSwsJOvndl0Bxc8gFImLEkXQT8+qj0=" crossorigin="anonymous"></script>

<script class="next-config" data-name="main" type="application/json">{"hostname":"powerlzy.github.io","root":"/","images":"/images","scheme":"Pisces","darkmode":false,"version":"8.15.1","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":{"enable":true,"style":"mac"},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"},"path":"/search.xml","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false}}</script><script src="/js/config.js"></script>

    <meta name="description" content="相比到达的地方，同行的人更重要！">
<meta property="og:type" content="website">
<meta property="og:title" content="PowerLZY&#39;s Blog">
<meta property="og:url" content="https://powerlzy.github.io/page/4/index.html">
<meta property="og:site_name" content="PowerLZY&#39;s Blog">
<meta property="og:description" content="相比到达的地方，同行的人更重要！">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="lzy">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="https://powerlzy.github.io/page/4/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":true,"isPost":false,"lang":"zh-CN","comments":"","permalink":"","path":"page/4/index.html","title":""}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>PowerLZY's Blog</title>
  








  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">PowerLZY's Blog</h1>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">本博客主要用于记录个人学习笔记（测试阶段）</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="搜索" role="button">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup"><div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off" maxlength="80"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close" role="button">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="search-result-container no-result">
  <div class="search-result-icon">
    <i class="fa fa-spinner fa-pulse fa-5x"></i>
  </div>
</div>

    </div>
  </div>

</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="lzy"
      src="/images/cat_mac.jpg">
  <p class="site-author-name" itemprop="name">lzy</p>
  <div class="site-description" itemprop="description">相比到达的地方，同行的人更重要！</div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">119</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">24</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">6</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author animated">
      <span class="links-of-author-item">
        <a href="https://github.com/PowerLZY" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;PowerLZY" rel="noopener me" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:3289218653@qq.com" title="E-Mail → mailto:3289218653@qq.com" rel="noopener me" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
  </div>
  <div class="cc-license animated" itemprop="license">
    <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/zh-CN" class="cc-opacity" rel="noopener" target="_blank"><img src="https://cdnjs.cloudflare.com/ajax/libs/creativecommons-vocabulary/2020.11.3/assets/license_badges/small/by_nc_sa.svg" alt="Creative Commons"></a>
  </div>

        </div>
      </div>
        <div class="back-to-top animated" role="button" aria-label="返回顶部">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner index posts-expand">

    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://powerlzy.github.io/posts/16VDGF1/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/cat_mac.jpg">
      <meta itemprop="name" content="lzy">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="PowerLZY's Blog">
      <meta itemprop="description" content="相比到达的地方，同行的人更重要！">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | PowerLZY's Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/posts/16VDGF1/" class="post-title-link" itemprop="url">机器学习（8）【Nan】马尔可夫模型</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2022-06-22 12:54:43" itemprop="dateCreated datePublished" datetime="2022-06-22T12:54:43+08:00">2022-06-22</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2022-07-18 22:17:36" itemprop="dateModified" datetime="2022-07-18T22:17:36+08:00">2022-07-18</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/" itemprop="url" rel="index"><span itemprop="name">机器学习</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/%E6%A6%82%E7%8E%87%E5%9B%BE%E6%A8%A1%E5%9E%8B/" itemprop="url" rel="index"><span itemprop="name">概率图模型</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>1.1k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>2 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2><span id="马尔可夫模型">马尔可夫模型</span></h2><blockquote>
<p>  如何用简单易懂的例子解释条件随机场（CRF）模型？它和HMM有什么区别？ - Scofield的回答 - 知乎 <a target="_blank" rel="noopener" href="https://www.zhihu.com/question/35866596/answer/236886066">https://www.zhihu.com/question/35866596/answer/236886066</a></p>
</blockquote>
<h3><span id="一-概念">一、概念</span></h3><h4><span id="11-随机过程">1.1 随机过程</span></h4><p><strong>随机过程就是一些统计模型，利用这些统计模型可以对自然界的一些事物进行预测和处理</strong>，比如天气预报，比如股票，比如市场分析，比如人工智能。它的应用还真是多了去了。</p>
<h4><span id="12-马尔可夫链-markov-chain">1.2 马尔可夫链 （Markov Chain）</span></h4><blockquote>
<p>  马尔可夫链 （Markov Chain）是什么鬼 - 车卡门的文章 - 知乎 <a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/26453269">https://zhuanlan.zhihu.com/p/26453269</a></p>
</blockquote>
<p>马尔可夫链就是这样一个任性的过程，它将来的状态分布只取决于现在，跟过去无关！实际上就是一个随机变量随时间按照Markov性进行变化的过程。</p>
<h4><span id="13-马尔可夫模型hidden-markov-models">1.3 马尔可夫模型（Hidden Markov Models）</span></h4><p>既是马尔可夫模型，就一定存在<a target="_blank" rel="noopener" href="https://www.zhihu.com/search?q=马尔可夫链&amp;search_source=Entity&amp;hybrid_search_source=Entity&amp;hybrid_search_extra={&quot;sourceType&quot;%3A&quot;answer&quot;%2C&quot;sourceId&quot;%3A&quot;64187492&quot;}">马尔可夫链</a>，该马尔可夫链服从马尔可夫性质：即无记忆性。也就是说，这一时刻的状态，受且只受前一时刻的影响，而不受更往前时刻的状态的影响。在这里我们仍然使用非常简单的天气模型来做说明。</p>
<p><img src="https://picx.zhimg.com/80/648a55725e67d718d97d6a475891d70b_1440w.png" alt="img" style="zoom:50%;"></p>
<p>在这个马尔可夫模型中，存在三个状态，Sunny， Rainy， Cloudy，同时图片上标的是各个状态间的转移概率（如果不明白什么是转移概率，那建议先去学习什么是马尔可夫再来看HMM）。</p>
<p><strong><font color="red"> 现在我们要说明什么是 HMM。既是隐形，说明这些状态是观测不到的，相应的，我们可以通过其他方式来『猜测』或是『推断』这些状态，这也是 HMM 需要解决的问题之一。</font></strong></p>
<blockquote>
<p>  举个例子，我女朋友现在在北京工作，而我还在法国读书。每天下班之后，她会根据天气情况有相应的活动：或是去商场购物，或是去公园散步，或是回家收拾房间。我们有时候会通电话，她会告诉我她这几天做了什么，而闲着没事的我呢，则要通过她的行为猜测这几天对应的天气最有可能是什么样子的。</p>
<p>  以上就是一个简单的 HMM，天气状况属于状态序列，而她的行为则属于观测序列。天气状况的转换是一个马尔可夫序列。而根据天气的不同，有相对应的概率产生不同的行为。在这里，为了简化，把天气情况简单归结为晴天和雨天两种情况。雨天，她选择去散步，购物，收拾的概率分别是0.1，0.4，0.5， 而如果是晴天，她选择去散步，购物，收拾的概率分别是0.6，0.3，0.1。而天气的转换情况如下：这一天下雨，则下一天依然下雨的概率是0.7，而转换成晴天的概率是0.3；这一天是晴天，则下一天依然是晴天的概率是0.6，而转换成雨天的概率是0.4. 同时还存在一个初始概率，也就是第一天下雨的概率是0.6， 晴天的概率是0.4.</p>
<p>  <img src="https://pic4.zhimg.com/80/792e033ff9b0418b3b6c9bbaef30fd83_1440w.png" alt="img" style="zoom:50%;"></p>
</blockquote>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://powerlzy.github.io/posts/3PV2CVF/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/cat_mac.jpg">
      <meta itemprop="name" content="lzy">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="PowerLZY's Blog">
      <meta itemprop="description" content="相比到达的地方，同行的人更重要！">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | PowerLZY's Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/posts/3PV2CVF/" class="post-title-link" itemprop="url">风控算法（4）西湖论剑-告警误报检测</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2022-06-19 14:46:27" itemprop="dateCreated datePublished" datetime="2022-06-19T14:46:27+08:00">2022-06-19</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2022-07-12 15:27:41" itemprop="dateModified" datetime="2022-07-12T15:27:41+08:00">2022-07-12</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E7%AE%97%E6%B3%95%E6%AF%94%E8%B5%9B/" itemprop="url" rel="index"><span itemprop="name">算法比赛</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E7%AE%97%E6%B3%95%E6%AF%94%E8%B5%9B/%E4%B8%9A%E5%8A%A1%E5%AE%89%E5%85%A8/" itemprop="url" rel="index"><span itemprop="name">业务安全</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>82</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>1 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2><span id="西湖论剑-告警误报检测">西湖论剑-告警误报检测</span></h2><blockquote>
<p>  2020西湖论剑Ai大数据安全分析竞赛思路分享 - 杨航锋的文章 - 知乎 <a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/295179638">https://zhuanlan.zhihu.com/p/295179638</a></p>
</blockquote>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://powerlzy.github.io/posts/26TF5T6/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/cat_mac.jpg">
      <meta itemprop="name" content="lzy">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="PowerLZY's Blog">
      <meta itemprop="description" content="相比到达的地方，同行的人更重要！">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | PowerLZY's Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/posts/26TF5T6/" class="post-title-link" itemprop="url">工业落地（6）滴滴安全《安全运营之自动编排SOAR的探索》</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2022-06-18 17:55:13" itemprop="dateCreated datePublished" datetime="2022-06-18T17:55:13+08:00">2022-06-18</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2023-04-18 15:16:52" itemprop="dateModified" datetime="2023-04-18T15:16:52+08:00">2023-04-18</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E5%B7%A5%E4%B8%9A%E8%90%BD%E5%9C%B0/" itemprop="url" rel="index"><span itemprop="name">工业落地</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E5%B7%A5%E4%B8%9A%E8%90%BD%E5%9C%B0/%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8/" itemprop="url" rel="index"><span itemprop="name">网络安全</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>5.2k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>10 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2><span id="滴滴安全运营之自动编排-soar-的探索">滴滴安全运营之自动编排 (SOAR) 的探索</span></h2><blockquote>
<p>  DiDi:<a target="_blank" rel="noopener" href="https://www.secrss.com/articles/25896">https://www.secrss.com/articles/25896</a></p>
</blockquote>
<h4><span id="困难和挑战">困难和挑战</span></h4><ul>
<li><strong>海量异构的日志数据源</strong><ul>
<li><strong>覆盖广</strong>：通过各类sensor采集的数据，覆盖了办公网和客服网的终端，以及测试网生产网的服务器，还有公有云的虚拟机等等。</li>
<li><strong>来源多</strong>：HIDS，网络层的NTA，终端EDR，还有VPN的认证日志，DNS的解析记录，802.1x的认证，AD域控的日志，还有防火墙邮件服务器密罐的日志等等。</li>
<li><strong>量级大</strong>：每天用于安全审计的原始日志达到了10Tb及以上的量级。</li>
<li><strong>异构性</strong>：Hive、ElasticSearch、Kafka等等，而有些日志是设备通过Syslog和Webhook的方式打给我们的，这些日志都是异构的。</li>
</ul>
</li>
<li><strong>有效的告警会淹没在误报当中</strong><ul>
<li>黑名单的规则来定义异常，无法感知未知；白名单规则，通过定义正常来发现异常；</li>
<li><strong>统计规则阈值的选取也和误报息息相关</strong>；</li>
<li><strong>在甲方日常的安全运营中，团队可能会受 KPI的影响</strong></li>
</ul>
</li>
<li><strong>告警研判推理的挑战</strong><ul>
<li><strong><font color="red"> 如果我们缺少有效的关联分析能力，就很难从各个孤立的告警中还原出攻击者的一次战术动作。</font></strong></li>
<li><strong>告警研判过程中存在重复低效的二次取证的工作</strong></li>
<li><strong>不完备的资产实体库</strong></li>
<li><strong>研判过程中还缺乏知识的指引</strong></li>
</ul>
</li>
</ul>
<h4><span id="如何针对事件检测响应去建构知识体系"><strong>如何针对事件检测响应去建构知识体系？</strong></span></h4><ul>
<li><strong>知识模型</strong>：STRIDE的模型、kill Chain杀链模型、ATT&amp;CK模型</li>
<li><strong>知识交换</strong>：指交换威胁情报和lOC识别的知识，目前业内比较通用的有像<strong>==STIX2.0==，还有TAXll协议</strong>。</li>
<li><strong>知识运用</strong>：如何运用知识来指导我们做lOC规则的开发，如何做研判策略的设计，以及如何制定事件处置的SOP流程等等。</li>
<li><strong>知识迭代</strong>：知识模型自身的迭代，比如说近期ATT&amp;CK模型也推出了<strong>Sub-techniques</strong>，就是子技术的概念。另一方面就是日常运营的案件如何反馈到知识模型来做迭代。</li>
</ul>
<h4><span id="如何建立科学的度量和评价体系"><strong>如何建立科学的度量和评价体系？</strong></span></h4><p>我们在事件检测运营中有很多指标，比如<strong>围绕资产实体的，有HIDS部署的覆盖率，比如终端EDR的安装覆盖率，还有跨网络、跨安全域网络边界、南北向流量检测覆盖率</strong>等等。</p>
<p>还有围绕运营流程的，比如像比较核心的MTTD/MTTR指标。还有围绕能力矩阵的，比如ATT&amp;CK矩阵的覆盖率。<strong>指标的选取，它关系到能否把控安全态势的全局以及能否做好牵引能力的建设，因此选取有效的度量和评价体系，也是存在挑战的。</strong></p>
<blockquote>
<p>  <strong>MTTD = 故障与检测之间的总时间/事件数量</strong></p>
<p>  <strong>MTTA = 指从系统产生告警到人员开始注意并处理的平均时间。</strong></p>
</blockquote>
<h3><span id="安全编排自动化与响应soar它能为安全事件检测与响应流程带来哪些改善"><strong>安全编排自动化与响应SOAR，它能为安全事件检测与响应流程带来哪些改善?</strong></span></h3><blockquote>
<p>  <strong>SOAR分为安全编排自动化，安全事件响应平台，以及威胁情报平台三种技术工具的融合。</strong></p>
</blockquote>
<h4><span id="soar如何加速事件检测和响应"><strong>SOAR如何加速事件检测和响应</strong></span></h4><p>首先在IDR运营流程中，我们接收到一个异常的事件Event，我们如何通过SOAR的思想来处理这个事件，从而提升IDR流程的效率？</p>
<ul>
<li><strong>告警分诊</strong>:一个原始的告警里边可能只包含了少量的事件信息，我们需要在这个阶段使<strong>告警丰富化</strong>，也就是 Enrichment概念——<strong>将原始告警中的IP服务器，终端ID这样的字段，在我们内部的资产库当中查询出详细的信息，并且自动补充到告警信息中。</strong></li>
<li><strong>初步决策</strong>，比如有些字段命中了<strong>白名单库</strong>，或者威胁情报显示这是一个非恶意的良性的特征。将告警作为误报直接关闭，减少后面人工审计的运营负担。</li>
<li><strong>调查取证</strong>：通过SOAR的自动调用能力，可以调用后台的数据，收集更多的IOC信息，我们也可以调用沙箱这个能力对可疑文件进行动态的检测，得到检测结果，从而实现证据的自动收集。</li>
<li><strong>溯源关联分析</strong>：实现告警事件的上下文相关联事件的聚合。</li>
</ul>
<blockquote>
<p>  比如说同一个告警事件，它发生在不同的资产实体上，或者说同一个资产实体，它在一定的时间段内，发生了多类的告警事件.</p>
</blockquote>
<p><strong>经过前期的告警分诊、误报关闭、调查取证的几个阶段，原始的事件event就转化为了一个需要人工验证的incident案件</strong>。在这个环节安全工程师会根据前面SOAR自动补充和取证的信息做出研判，进入到对这个事件的响应的流程。<strong>响应阶段也可以利用SOAR自动地执行安全处置的动作，包括邮件IM通知员工，或创建处置或漏洞工单，或是向防火墙/终端EDR下发安全策略（比如封禁）等等</strong>。这样我们就通过SOAR完成了一次告警事件的检测与响应的流程。</p>
<h4><span id="剧本编排的概念"><strong><font color="red"> 剧本编排的概念</font></strong></span></h4><p><strong>以钓鱼邮件检测与响应的剧本为例。</strong></p>
<ul>
<li><strong>检测钓鱼邮件</strong>时，首先是提取<strong>邮件的信息</strong>，包括<strong>发件人</strong>、<strong>收件人</strong>、正文里可点击的<strong>url链接列表</strong>、<strong>附件</strong>等等。<ul>
<li>从AD里查询出<strong>员工的相关信息</strong>，可以自动去邮件服务器的访问日志里面去查看员工近期有没有<strong>异常的登录行为</strong>，比如说异地登录，或者是使用非常设备登录等等。</li>
<li><strong>URL链接</strong>，我们首先去威胁情报里查一下有没有命中情报样本。针对可疑的URL链接，我们可以结合像Whois信息，像域名的信息，对 URL进行评分。</li>
<li><strong>针对邮件的附件</strong>也可以做静态分析，看是否包含 office鱼叉。我们还可以利用Cuckoo这样的动态沙箱对邮件附件里的可执行文件做行为检测。我们还可以利用外部的比如Virus Total这样的样本分析平台，来看是否命中恶意样本。</li>
</ul>
</li>
<li>经过信息的自动化收集和分析的动作，我们进入到最后的<strong>人工审计环节</strong>。这个时候安全工程师会结合前面自动收集的信息去做研判。一旦安全工程师识别出这是一个有效的钓鱼邮件，也会通过<strong>剧本的方式去执行后续的这些自动化的动作，包括向员工发送告警工单，要求他修改域账号的密码</strong>。我们还可以将发件人的邮箱加入邮件安全网关的发件人黑名单列表里，防止他再给其他员工继续发邮件。我们也可以将恶意的或可疑的钓鱼邮件链接的域名加入到我们DNS封禁列表里，<strong>来防止进一步的扩散</strong>。</li>
</ul>
<h4><span id="结合滴滴的实践经验和探索介绍贴合甲方实际场景的soar建设思路"><font color="red"> 结合滴滴的实践经验和探索，介绍贴合甲方实际场景的SOAR建设思路</font></span></h4><p><strong>需要明确SOAR</strong>在事件检测响应体系中的定位，也就是它<strong>与SIEM/SOC/安全事件响应平台SIRP之间的关系</strong>，还有它<strong>与TIP威胁情报平台之间的关系</strong>。SOAR可以理解为是事件响应平台或者是SOC的扩展能力。 当然SOAR也可以作为一个独立的平台，与SOC和TIP实现打通。</p>
<blockquote>
<p>  根据Gartner的定义，SOAR是一系列技术的合集，它能够帮助企业和组织收集安全运营团队监控到的各种信息，也包括各种安全系统产生的告警，并对这些信息进行告警分诊和事件分析。</p>
</blockquote>
<p><strong>SOAR在甲方如何落地，主要考虑三方面：</strong></p>
<ul>
<li><strong>实现路径</strong>:<ul>
<li>可以采用商业化的产品，近期我们也看到很多国内外知名安全厂商陆续推出了SOAR这款产品。</li>
<li>我们也可以基于开源工具做二次开发，比如说剧本编排引擎，它特别类似于一个<strong>Workflow的工作流引擎</strong>，我们可以基于开源的像Activity或者是Airflow这样的工作流引擎去做二次的开发。</li>
<li>使用自研的方式。</li>
</ul>
</li>
<li><strong>技术选型</strong>：主要是考虑可视化剧本的编排引擎，还有剧本的执行引擎。</li>
<li><strong>系统设计</strong>：SOAR虽然是一个扩展的能力，但是从系统设计的角度来说，一旦我们引入SOAR，就会将它串联到我们整个的 IDR流程当中。所以SOAR自身的稳定性，还有一些其他的技术指标，比如像EPS每秒处理的事件数，SLA，包括一些其他的benchmark等等，这些也是我们关注的重点。刚才也提到SOAR会串联到IDR流程里，所以它有可能会引入或导致一个单点问题，所以我们也会考虑分布式的部署。还有降级，一旦SOAR不可用的时候，我们的SOC或者事件响应平台能否降级到没有SOAR的状态。</li>
</ul>
<h4><span id="如何评估soar的效果和收益"><strong><font color="red"> 如何评估SOAR的效果和收益？</font></strong></span></h4><ul>
<li><strong>对IDR核心运营指标MTTD和MTTR的提升</strong>，它能让我们技术运营投入更少的人力去做更多的事，提升人效。</li>
<li><strong><font color="red"> 他能否通过SOAR来识别攻击者完整的战术动作，也就是TTP。</font></strong></li>
<li>通过将剧本的引入，将流程案件知识固化下来，牵引我们能力侧的建设。</li>
</ul>
<h4><span id="结合滴滴的经验和探索介绍一下soar的系统设计思想"><strong>结合滴滴的经验和探索，介绍一下SOAR的系统设计思想？</strong></span></h4><p><strong>首先我们从各个sensor采集到的数据经过ETL存储在大数据的组件当中</strong>。我们的策略规则是作用在这些大数据的计算引擎上，像 Spark，Hadoop，还有Flink这样实时的引擎，也包括我们自研的异常检测的引擎，最终产生的异常告警事件会打到我们的event gateway通用事件网关上。这一阶段被我们称为异常检测阶段。</p>
<p>事件网关主要做两个事：一，做<strong>标准化</strong>，将这些异构的数据源产生的各种类型的告警里的字段格式和数据类型做标准化，以便后面我们在做SOAR编排的时候降低成本。二，<strong><font color="red"> 在这个环节我们会做 index，把原始的告警事件索引到数据库里，以便我们后面做关联分析，或者我们可以回溯的时候去实时地查询历史的告警事件数据。</font></strong></p>
<p>【<strong>告警分诊</strong>】经过事件网关以后，我们紧接着做两个事情，<strong>一个是做Enrichment丰富化</strong>，第二个是做<strong>威胁情报</strong>。我们在丰富化这个阶段会补齐像服务器地址、员工信息、终端信息和调研我们内部的核心的资产库，将告警信息做丰富化。 第二就是我们会初步匹配告警字段里边比如像域名，像文件哈希，去我们本地的威胁情报库里面做匹配。</p>
<p>【<strong>调查取证</strong>】接下来就进入到我们的核心检测阶段SOAR编排环节，在这个环节我们将各种检测能力抽象成为各种检测引擎，比如像攻击检测引擎、误报检测引擎、调查取证引擎和关联分析引擎等等。</p>
<ul>
<li><p>【<strong>黑名单</strong>】<strong>攻击检测</strong>引擎是做什么？主要是根据告警事件里的一些字段去我们本地的黑名单库列表里做匹配，一旦确认命中我们的黑名单，就可以不需要做后面一些列复杂的调查取证和关联分析工作，可以直接交给人工来做研判，甚至对它可以绕过人工来做自动化响应。</p>
</li>
<li><p>【<strong>白名单</strong>】<strong>误报检测</strong>是根据字段里边的一些特征，以及我们之前配置的白名单规则，命中了白名单，这个事件我们可以把它自动关闭掉，以减少后面调查取证的负担。</p>
</li>
<li><strong>调查取证</strong>我们是将一些通用的外部接口和能力封装成一些函数或者脚本，来做自动化的调用。而这些封装的能力之间，我们也是以一个子剧本的方式来进行编排，它可以根据剧本流程的配置来做自动化的执行和调用。</li>
<li><strong><font color="red"> 关联分析引擎也是基于我们配置好的一些关联分析的规则，来针对这一个告警事件的上下文，或者一段时间内它同资产的一些其他告警事件来做关联和聚合，上报给人工去做研判。</font></strong></li>
</ul>
<p><strong>这些不同的检测引擎之间，我们也是通过剧本的方式把它进行一个整体的编排</strong>。有些我们可以先经过攻击检测引擎，误报检测引擎，再做调查取证和关联分析；而有一些告警类型，我们通过剧本的编排，它就不需要去做攻击检测了，比如他通过误报检测就可以直接到调查取证检测。这些其实都是通过剧本来实现一个动态编排。</p>
<p>【<strong>人工验证</strong>】经过这个阶段的检测，原始事件就形成了一个具体的需要人工验证的案件，也就是<strong>incident</strong>。从原始的事件到案件，这个阶段我们称它为是检测阶段的SOAR编排。【<strong>自动处置</strong>】这阶段经过人工的验证，如果是一个有效的案件需要经过处置的话，它就会进入到后续的自动处置的流程里面。而这一阶段我们也是通过剧本的方式，将各种处置能力封装来自动编排上。这里边包括像通过邮件和IM消息的方式来通知用户，也包括我们调用工单系统，还有就是我们调用 EDR/IPS/防火墙的一些封禁策略等等，把它封装成自动的脚本，通过剧本的方式做编排，做自动的调用。</p>
<h4><span id="在做soar系统设计的时候是如何把知识体系来融合到系统设计里的呢"><strong>在做SOAR系统设计的时候，是如何把知识体系来融合到系统设计里的呢？</strong></span></h4><p>在上文提到的情报交互里有一个<strong>STIX2.0协议</strong>，STIX2.0有很多个构件，其中有几个构件其实是可以指导我们去做异常检测规则的开发，以及SOAR编排里的关联分析和处置动作的。</p>
<ul>
<li><p><strong>indicator</strong>，就可以指导我们去做异常检测阶段的IOC规则开发；</p>
</li>
<li><p><strong>Attack Pattern</strong>，描述的其实就是TTP，可以指导我们在SOAR检测阶段去做关联分析规则；</p>
</li>
<li><strong>course of action</strong>构件，它是指导我们在做响应处置阶段的SOP的流程。</li>
</ul>
<p>我们前面也提到了ATT&amp;CK模型，其实<strong>ATT&amp;CK模型和STIX2.0之间是有映射关系的</strong>，我们可以将我们的异常检测规则映射到ATT&amp;CK模型上，主要是做两个事，第一个就是我们根据现有的检测点，可以总体来看我们<strong>对ATT&amp;CK的覆盖率</strong>，这样它能牵引我们去做能力侧的建设，也就是<strong>检测策略建设</strong>。<strong>当我们发现缺少哪一部分的检测能力，我们就可以去部署新的sensor，开发新的IOC规则。</strong></p>
<p><strong>我们也可以结合ATT&amp;CK模型去和我们的真实的日常运营中的案件做结合，去查看我们ATT&amp;CK热力图，去从整体安全态势上看我们哪些场景是经常会被攻击的</strong>。我们也可以结合资产的重要性、等级和实际发生的案件，通过一个公式来计算出我们整体的风险值。</p>
<p>【<strong>异常检测评估指标</strong>】整个SOAR流程和指标体系也是紧密结合的，包括我们在异常检测阶段有能力矩阵的覆盖率这样的指标。还有我们在检测阶段的SOAR编排决定了我们的MTTD（平均检测时间）的指标，以及在响应阶段SOAR关联了我们的MTTR（平均响应时间）指标。</p>
<p>这样我们就围绕着SOAR的系统设计，将IDR事件检测与响应流程、SOAR的自动编排、知识体系和指标体系，都融合在了我们整个的SOAR的系统设计思想里。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://powerlzy.github.io/posts/3G00B93/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/cat_mac.jpg">
      <meta itemprop="name" content="lzy">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="PowerLZY's Blog">
      <meta itemprop="description" content="相比到达的地方，同行的人更重要！">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | PowerLZY's Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/posts/3G00B93/" class="post-title-link" itemprop="url">恶意加密流量（1）DataCon2020恶意加密流量检测</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2022-06-18 17:42:20" itemprop="dateCreated datePublished" datetime="2022-06-18T17:42:20+08:00">2022-06-18</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2023-04-18 20:37:48" itemprop="dateModified" datetime="2023-04-18T20:37:48+08:00">2023-04-18</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E7%AE%97%E6%B3%95%E6%AF%94%E8%B5%9B/" itemprop="url" rel="index"><span itemprop="name">算法比赛</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E7%AE%97%E6%B3%95%E6%AF%94%E8%B5%9B/%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8/" itemprop="url" rel="index"><span itemprop="name">网络安全</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>9k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>16 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2><span id="datacon2020-恶意加密流量检测">DataCon2020-恶意加密流量检测</span></h2><blockquote>
<ul>
<li>思科AISec’16：《Identifying Encrypted Malware Traffic with Contextual Flow Data》：<a target="_blank" rel="noopener" href="https://www.cnblogs.com/bonelee/p/9604530.html">https://www.cnblogs.com/bonelee/p/9604530.html</a></li>
</ul>
</blockquote>
<h2><span id="一-流量处理的工具">一、流量处理的工具</span></h2><h3><span id="zeek"><strong>zeek</strong></span></h3><p><a target="_blank" rel="noopener" href="https://darkdefender.medium.com/https-medium-com-melanijan93-analysing-pcaps-with-bro-zeek-33340e710012">使用 Bro/Zeek 分析 PCAP</a></p>
<p><a target="_blank" rel="noopener" href="https://www.freebuf.com/sectool/235587.html">流量分析的瑞士军刀：Zeek</a></p>
<h3><span id="joy">joy</span></h3><p><a target="_blank" rel="noopener" href="https://github.com/ahlashkari/CICFlowMeter">CICFlowMeter</a>：</p>
<h2><span id="二-a-novel-malware-encrypted-traffic-detectionframework-based-on-ensemble-learning">二、A Novel Malware Encrypted Traffic DetectionFramework Based On Ensemble Learning</span></h2><blockquote>
<p>  zeek:<a target="_blank" rel="noopener" href="https://docs.zeek.org/en/master/logs/index.html">https://docs.zeek.org/en/master/logs/index.html</a><br>  zeek-flowmeter:<a target="_blank" rel="noopener" href="https://github.com/zeek-flowmeter/zeek-flowmeter">https://github.com/zeek-flowmeter/zeek-flowmeter</a><br>  zeek-tls-log-alternative:<a target="_blank" rel="noopener" href="https://github.com/0xxon/zeek-tls-log-alternative">https://github.com/0xxon/zeek-tls-log-alternative</a></p>
</blockquote>
<h4><span id="概述">概述：</span></h4><p>在我们的工作中，有一些定义。首先，<strong>将5元组定义为源IP、源端口、目标IP、目标端口和协议</strong>。<strong>其次，前向流是从客户端到服务器具有相同5元组的数据包集</strong>。反向词流与正向流相似，但与五元组相反。最后，流动是向前流动和向后流动的结合。由于我们从流量中提取的特征是异构的，我们不能简单地将它们合并并以常见的方式将它们装配到单个分类器中。我们将不同的特征匹配到相应的分类器中，并进行多数投票以获得最终结果。同时，我们考虑了flowlevel和host级别的行为。对不同级别的特性进行聚合和分析，以提高框架的TPR和较低的FPR。图1：。概述了我们的框架。我们将介绍每个特性以及相应的分类器、实现和性能。</p>
<h3><span id="21-数据包级">2.1 数据包级</span></h3><h4><span id="1长度分布">（1）长度分布</span></h4><p>根据Cisco的研究【17】，<strong>恶意软件和普通软件在正向流和反向流中的数据包长度分布不同</strong>。<strong><font color="red"> 例如，当我们使用谷歌搜索时，客户端向服务器发送少量数据包，然后服务器返回大量数据包。然而，恶意软件的作用恰恰相反：恶意软件通常让客户端将数据传输到服务器，然后服务器定期返回调度命令。</font></strong>无论是否加密，数据包长度始终可见，因此它适合作为一种功能。我们将数据包长度和方向编码为一维独立特征。我们推测，感染恶意软件的客户端和服务器之间的一些控制消息的长度总是相似且频繁的，这具有很好的区分程度。<strong>我们考虑每个可能的数据包长度和方向元组。由于Internet上的最大传输单元（MTU）是1500字节，并且数据包的方向有两个发送或接收方向，因此我们的长度分布特征是3000维。</strong>为了提取这些特征，我们计算具有不同长度的所有数据包的数量，并进行规范化以确保概率分布。我们使用随机森林（RF）算法来处理这些特征。因为它能更好地处理高维特征，并且具有可解释性。</p>
<h4><span id="2长度序列">（2）长度序列</span></h4><p>第二部分，在不使用序列信息的情况下，我们只使用了数据包长度的统计特征，这可能会在时间上丢失一些信息，因此我们提取了数据包长度序列。<strong>我们在每个客户端的双向上取前1000个数据包长度</strong>，并将其放入TextCNN算法中以提取局部序列关系。因为该算法运行速度快，精度高。文本数据的卷积神经网络TextCNN【22】是一种用于句子分类任务的有用的深度学习算法。<strong>在这种情况下，我们将每个数据包的长度视为一个单词，长度序列相当于一个句子</strong>。</p>
<h4><span id="3服务器ip">（3）服务器IP</span></h4><p>在我们的数据集中，服务器IP地址是一个重要的标识符。<strong>我们假设，在同一地区，如果客户端感染了相同的恶意软件，则可能会导致其访问相同的服务器IP地址</strong>。因此，我们还考虑了对服务器IP地址的访问。<strong>值1或0表示是否访问了特定的服务器IP地址（一个热编码）</strong>。我们使用朴素贝叶斯（NB）算法来处理这些特征。由于朴素贝叶斯算法是一种非参数算法，其本质是寻找特征和标签之间的关系。因此，它可以被视为一个黑名单。</p>
<h4><span id="4词频分类器">（4）词频分类器</span></h4><p><strong>X509证书在Internet上广泛使用</strong>。它们用于验证实体之间的信任。证书颁发机构通常将X509证书链接在一起。如图2所示。[23]，<strong>X509证书提供URL、组织、签名等信息</strong>。我们从培训集中每个客户端的TLS流中提取X509证书链，并获取证书中<strong>主题</strong>和<strong>颁发者</strong>中包含的单词。我们将所有单词组合在一起，并将客户的流量视为由这些单词组成的句子。与B部分类似，我们计算每个单词的数量并将其用作特征。0我们使用朴素贝叶斯（NB）算法来处理这些特征。如果测试集样本证书中的所有单词从未出现在训练集中，我们将直接推断它是恶意的。因为训练集包含最流行的域名。</p>
<p><img src="https://lzy-picture.oss-cn-beijing.aliyuncs.com/img/202304182036362.png" alt="image-20220621131035005" style="zoom: 67%;"></p>
<h4><span id="5tcp状态马尔可夫">==（5）TCP状态马尔可夫==</span></h4><p>我们发现<strong>恶意流量和正常流量之间TCP连接状态的分布是不同的</strong>。表一说明了可能的TCP连接状态[24]:</p>
<blockquote>
<p>  [24]:</p>
</blockquote>
<p>我们按照流出现的时间对其进行排序，然后使用马尔可夫随机场转移矩阵（MRFTM）对该特征进行编码。MRFTM在建模连接状态序列时很有用。MRFTM[i，j]中的每个条目统计第i个和第j个状态之间的转换次数。最后，我们对MRFTM的行进行规范化，以确保适当的马尔可夫链。然后我们将其重塑为一维向量，也就是说，我们使用MRFTM的条目作为特征。我们使用随机森林（RF）算法来处理这些特征。</p>
<h3><span id="22-会话流级">2.2 会话流级</span></h3><h4><span id="6会话流量统计">（6）会话流量统计</span></h4><p>在加密流量中，上述5种分类器在主机级使用不同的特征提取方法和分类方法。此外，为了进一步提高准确率，防止恶意软件由于缺乏领域知识而欺骗分类器，我们还提取了TLS握手中的明文信息。在这个分类器中，我们首先考虑流级特征。我们仅选择TLS流，并分析每个流。一旦推断流是恶意的，就会推断相应的客户端被感染。我们对TCP和TLS协议进行了深入分析，<strong>提取了1000多个维度的流级特征</strong>，包括以下部分：</p>
<ul>
<li><strong>TCP连接状态特性</strong>：如F部分所述，我们对每个流的TCP连接状态进行一次热编码。</li>
<li><strong>统计特征</strong>：我们还提取常规统计特征，表II显示了相关特征名称和描述。</li>
</ul>
<p><img src="https://lzy-picture.oss-cn-beijing.aliyuncs.com/img/202304182037399.png" alt="image-20220621141516374" style="zoom: 50%;"></p>
<ul>
<li><strong>长度马尔可夫特征</strong>：数据包长度序列的操作类似于F部分中的TCP连接状态序列。长度值被离散为大小相等的容器。长度数据马尔可夫链有10个箱子，每个箱子150字节。假设一个1500字节的MTU，任何观察到的大小大于1350字节的数据包都被放入同一个bin中。</li>
<li><strong>TLS握手功能</strong>：我们发现客户端和服务器的TLS协议版本在恶意和良性TLS流之间有不同的分布，因此我们对客户端和服务器的TLS版本进行了一次热编码。此外，由于恶意软件可能使用旧的密码套件，我们在客户端和服务器上都对密码套件和扩展进行n-hot编码，即将所有密码套件和扩展扩展扩展为一维0向量，如果当前流使用某个密码套件或扩展，则相应的位置集值为1。</li>
<li><p><strong>TLS证书特性</strong>：我们发现，在恶意流中，很大一部分叶证书是自签名的，或者自签名证书出现在证书链中。恶意软件喜欢利用的自签名证书的成本很低。因此，我们分析从服务器发送的证书：<strong>证书链是否包含自签名证书、叶证书是否过期、证书版本、证书有效期、公钥长度、是否发生警报</strong>。同时，考虑到之前的词频分类器，我们发现一些词无法区分恶意和良性，因此我们还将流词频添加到流特征中。</p>
</li>
<li><p>合并和适配：我们将上述功能合并到5元组（源IP、目标IP、源端口、目标端口和协议）中，并将其适配到随机林（RF）算法中。一旦流被推断为恶意，相应的客户端就会被推断为受到恶意影响。</p>
</li>
</ul>
<p>在本节中，我们使用来自真实恶意软件的加密流量来评估我们的框架。首先，我们描述了数据集的格式。其次，我们分析了每个分类器的有效性以及集成后的有效性。然后，我们展示了我们的集成学习方法的优势。</p>
<h4><span id="数据表示">数据表示：</span></h4><p>如表三所示，列车数据包括3000台正常主机产生的正常流量和3000台恶意软件感染主机产生的恶意流量。我们的任务是检测测试数据中的客户端IP地址是否感染了恶意软件。</p>
<p><img src="https://lzy-picture.oss-cn-beijing.aliyuncs.com/img/202304182037660.png" alt="image-20220621132459446" style="zoom:50%;"></p>
<p><strong>表V显示了每个分类器的得分</strong>。我们将每个分类器与投票结果进行比较，发现集成后的最终效果优于任何单个分类器的得分。我们的方法得分为86.6，TPR为95.0%，FPR为8.4%。流量统计分类器得分最高，其次是长度序列分类器和长度分布分类器。我们在每个分类器中使用默认参数。由于流级特征包含最丰富的信息，因此<strong>流统计分类器的性能最好</strong>，正如我们所期望的那样。我们可以推断，<strong>数据包长度</strong>是一个重要特征。事实上，在流量分类（非恶意流量检测）领域，有很多优秀的作品使用数据包长度进行分类，并取得了很好的效果[11][25]。目前，已有的一些基于机器学习的工作[8][9]与我们的流统计分类器或流合并分类器相似，也就是说，它们只使用流级特征或主机级特征。经过实验，我们的最终效果已经超过了每一个分类器。这表明我们的框架是有效和健壮的。此外，框架可以很容易地调整每个分类器的概率阈值，以提高TPR或降低FPR，以适应不同的场景。</p>
<p><img src="https://lzy-picture.oss-cn-beijing.aliyuncs.com/img/202304182037087.png" alt="image-20220621132751726" style="zoom:50%;"></p>
<h2><span id="三-知乎-s1mple">三、知乎-s1mple</span></h2><blockquote>
<p>  <a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/262533938"><em>DataCon</em>2020<em>加密</em>恶意<em>流量</em>检测初赛Writeup及总结反思</a></p>
</blockquote>
<ul>
<li><p><strong>特征选择（Feature Selection）</strong>，选取对于区分正常/恶意流量有明显作用的 Features。</p>
<ul>
<li><strong>TLS客户端指纹信息</strong><ul>
<li><strong>客户端支持的加密套件数组</strong>（Cipher suites），<strong>服务器端选择的加密套件</strong>。</li>
<li><strong>支持的扩展</strong>（TLS extensions），若分别用向量表示客户端提供的密码套件列表和 TLS 扩展列表，可以从服务器发送的确认包中的信息确定两组向量的值。</li>
<li><strong>客户端公钥长度</strong>（Client public key length），从密钥交换的数据包中，得到密钥的长度。</li>
<li><strong>Client version</strong>，the preferred TLS version for the client</li>
<li><strong>是否非CA自签名</strong>，统计数据表示，恶意流量约70%出现非CA认证服务器且自签名的情况，非恶意流量约占0.1%。此项判断的依据是：未出现 <code>CA: True</code> 字段（默认非 CA 机构）且 <code>signedCertificate</code> 中的 <code>issuer</code> 字段等于 <code>subject</code> 字段。</li>
</ul>
</li>
</ul>
<blockquote>
<p>  在进行TLS握手时，会进行如下几个步骤：</p>
<ol>
<li><strong>Client Hello</strong>，客户端提供支持的加密套件数组（cipher suites）；</li>
<li><strong>Server Hello</strong>，由服务器端选择一个加密套件，传回服务器端公钥，并进行认证和签名授权（<strong>Certificate</strong> + Signature）；</li>
<li>客户端传回客户端公钥（<strong>Client Key Exchange</strong>），客户端确立连接；</li>
<li><p>服务器端确立连接，开始 HTTP 通信。</p>
<p><img src="https://lzy-picture.oss-cn-beijing.aliyuncs.com/img/202304182037145.jpg" alt="img" style="zoom:50%;"></p>
</li>
</ol>
</blockquote>
<ul>
<li><strong>数据包元数据</strong><ul>
<li><strong>数据包的大小</strong>，数据包的长度受 UDP、TCP 或者 ICMP 协议中数据包的有效载荷大小影响，如果数据包不属于以上协议，则被设置为 IP 数据包的大小。</li>
<li><strong>到达时间序列</strong></li>
<li><strong>字节分布</strong></li>
</ul>
</li>
<li><strong><font color="red"> HTTP头部信息</font></strong><ul>
<li><strong>Content-Type</strong>，正常流量 HTTP 头部信息汇总值多为 <code>image/*</code>，而恶意流量为 <code>text/*、text/html、charset=UTF-8</code> 或者 <code>text/html;charset=UTF-8</code>。</li>
<li><strong>User-Agent</strong></li>
<li><strong>Accept-Language</strong></li>
<li><strong>Server</strong></li>
<li><strong>HTTP响应码</strong></li>
</ul>
</li>
<li><strong><font color="red"> DNS响应信息</font></strong><ul>
<li><strong>==域名的长度==</strong>：正常流量的域名长度分布为均值为6或7的高斯分布（正态分布）；而恶意流量的域名（FQDN全称域名）长度多为6（10）。</li>
<li><strong>==数字字符及非字母数字(non-alphanumeric character)的字符占比==</strong>：正常流量的DNS响应中全称域名的数字字符的占比和非字母数字字符的占比要大。</li>
<li><strong>DNS解析出的IP数量</strong>：大多数恶意流量和正常流量只返回一个IP地址；其它情况，大部分正常流量返回2-8个IP地址，恶意流量返回4或者11个IP地址。</li>
<li><strong>TTL值</strong>：正常流量的TTL值一般为60、300、20、30；而恶意流量多为300，大约22%的DNS响应汇总TTL为100，而这在正常流量中很罕见。</li>
<li><strong>域名是否收录在Alexa网站</strong>：恶意流量域名信息很少收录在Alexa top-1,000,000中，而正常流量域名多收录在其中。</li>
</ul>
</li>
</ul>
</li>
<li><p><strong>特征提取（Feature Extraction）</strong>，从 pcap 文件中提取上述 Features，并转换为模型训练所需要的格式。我们选择的特征提取工具为 <strong>Zeek</strong>。特征提取我们采用的工具是 <strong>Zeek</strong>，它的前身是 Bro，一款网络安全监视（Network Security Monitoring）工具，它定义了自己的 DSL 语言，<strong>支持直接处理 pcap 文件生成各类日志文件</strong>，包括 dns、http、smtp 等：Zeek 网上有一些现成的脚本，我们采用的是 <strong>Zeek FlowMeter</strong>，它基于 OSI 七层协议的网络层和传输层，可以分析并生成一些 Packets 到达时间序列、Packet 字节大小和元数据等新特征。<strong>在使用时，我们需要在 <code>local.zeek</code> 配置文件中加入 <code>@load flowmeter</code>，这样 Zeek 在执行时会加载 <code>flowmeter.zeek</code> 并生成对应的 <code>flowmeter.log</code>，下面列出了 FlowMeter 提取出的一些特征，包括上下行包总数、包负载均值方差等。</strong>其他详细的特征请见 <a href="https://link.zhihu.com/?target=https%3A//github.com/zeek-flowmeter/zeek-flowmeter">zeek-flowmeter GitHub官方文档</a>。除 <code>flowmeter.log</code> 之外我们还需要关注 <code>conn.log</code>、<code>ssl.log</code> 和 <code>X509.log</code>。这几个日志共同字段 <code>uid</code> 是 Zeek 根据一次连接的源/目的 IP、源/目的端口四元组生成的唯一 ID。为了方便后续的处理，我们将这几个日志文件统一读入，使用 <code>uid</code> 字段连接后转成 csv 格式输出到文件。<strong>最终我们提取的特征如下：</strong></p>
<p><img src="https://lzy-picture.oss-cn-beijing.aliyuncs.com/img/202304182037409.png" alt="image-20220621141516374" style="zoom: 50%;"></p>
</li>
<li><p><strong>模型训练（Model Training）</strong>，选择合适的机器学习模型对三类 pcap 文件进行训练和预测。我们选择的 Python 机器学习库为 <strong>scikit-learn</strong>。</p>
<ul>
<li><strong>Anomaly Detector</strong>：在 black 数据集中同时存在恶意流量和正常流量，没有明确的标注，无法直接用于训练分类器。而 white 数据集中都是正常流量，可以先用 white 数据集来训练一个 Anomaly Detector 分类器。然后用这个分类器在 black 数据集中推理得到哪些是恶意流量。我们的模型选取的隔离森林 <code>IsolationForest</code>。</li>
<li><strong>Misuse Detector</strong>：<strong>假设这些由异常检测器识别的可疑流量是恶意流量，我们就有了恶意流量的标注</strong>。接下来我们用这些恶意流量 labels，结合 white 数据集中的正常流量 labels，来训练一个 Misuse Detector。我们选取了 XGBoost 基于树的模型，目标选取为多分类问题（分类数为2）。</li>
</ul>
</li>
</ul>
<h2><span id="四-加密恶意流量检测方向清华大学hawkeye战队"><strong><font color="red">四 、加密恶意流量检测方向（清华大学HawkEye战队）</font></strong></span></h2><blockquote>
<p>  <strong>清华大学HawkEye战队</strong>：<a target="_blank" rel="noopener" href="https://datacon.qianxin.com/blog/archives/122">https://datacon.qianxin.com/blog/archives/122</a></p>
</blockquote>
<h3><span id="41-概述">4.1 概述</span></h3><p>我们所采用的检测方法的总体结构是让多个分别利用不同的<strong>异构特征训练</strong>而成的分类器进行多数投票 (Majority Voting) 的方式来获取最终的判定结果。</p>
<p><strong>由于我们所采用的多种特征是异构数据， 且具有不同的组织特点，我们并没有直接采用将这些特征统一编码并输入到集成学习分类器中的常规方式，而是针对各个特征的特点分别构建对应的分类器</strong>，并利用他们的分类结果进行投票，最终取得多数票的分类结果被定为最终的分类结果。</p>
<p>参与投票的多个模型中部分使用了多维特征综合分析，<strong>另一部分使用经过分析后黑白样本区分较大的、置信度较高的单维特征对多维特征中的潜在的过拟合和判断错误进行消解</strong>。同时，我们考虑到了<strong>数据包级、流级、主机级多维度的行为建模</strong>，将不同层次的数据进行聚合分析，提升对于黑白样本建模的准确度。图<a href="applewebdata://7EAAA994-C40A-4F1C-A798-46DA93A65C37#_bookmark0">1</a>展 示了我们方案的整体流程。下面我们将分别介绍我们所采用的特征及对应的分类器、投票机制、 实现和性能以及展望和总结。</p>
<h3><span id="42-特征选取与子分类器">4.2 <strong>特征选取与子分类器</strong></span></h3><p>下面我们将详细介绍六个参与投票的子模型中的每一个模型所采用的特征及对应的分类器， 以及设计的动机和意义。</p>
<p><img src="https://lzy-picture.oss-cn-beijing.aliyuncs.com/img/202304182037655.png" alt="image-20220621153938899" style="zoom: 50%;"></p>
<h4><span id="1包长分布特征3000维">（1）<strong>包长分布特征</strong>（3000维）</span></h4><p>不同的软件在通信数据的体量上具有不同的特点，我们认为功能或实现相似的软件会具有 相同的数据包体量分布特点，正如视频软件的下行流量通常远大于上行流量，而恶意键盘记录 器的上行流量总是远大于下行流量一样。</p>
<p>将每一个可能的报文长度和方向的二元组视为包长分布特征中的一个独立的维度。由 于以太网最小帧长为64 字节，而<strong>互联网的最大传输单元通常是 1500 字节，报文的方向只有收发两个方向</strong>，我们的包长分布特征是一个维数约 3000 的概率分布。</p>
<p><img src="https://lzy-picture.oss-cn-beijing.aliyuncs.com/img/202304182037030.png" alt="image-20220623173625843" style="zoom:50%;"></p>
<p><strong>编码方式与分类器</strong>：</p>
<p><strong>对该特征的提取，我们采用 以频率估计概率的方式，统计每个流量样本中的各个长度和方向的报文的数量，并除以报文总 数得到其概率分布</strong>。</p>
<p>由于包长分布的特征本质上是一个离散概率分布，最直接的分类器应该是基于度量的分类 算法，通过度量分布之间的相似性大小来判断其类别所属。<strong>我们采用了 Hellinger 距离的度量方式与kNN分类算法，Hellinger 距离是在概率分布空间对欧氏距离的模拟</strong>。由于kNN算法并不需要训练过程，而在分类过程中需要计算待分类的样例与已有样本集中的每个样例的相似性度量结果，因此其运行效率十分低下，于是我们也考虑了采用随机森林的分类器来利用这一特征的方式。</p>
<h4><span id="2证书主体与签发者黑白名单特征">（2）<strong>证书主体与签发者黑白名单特征</strong></span></h4><p>我们认为决定一个软件是否是<strong>恶意软件不仅仅取决于其通信内容，也取决于其通信的对象</strong>， 而通信内容由于加密无法作为可辨识的特征，因此我们着重考虑了客户端流量样本中的通信对象。</p>
<p><strong><font color="red"> 在 TLS 建立连接的过程中，服务端发来的证书中的叶子证书的 Subject 字段表明了客户端的直接通信对象，而 Issuer 字段则表明了该证书的直属签发机构。</font></strong></p>
<p><strong>Subject 字段里的 common name 通常是一个域名</strong>，我们认为这将是一个很重要的标识信息，因为恶意软件与恶意域名关联的可 能性较大。图3中展示了恶意和正常证书中主体和签发者的情况，可以看出黑白样本有明显区别 并都存在着访问频次较高的项。</p>
<p><img src="https://lzy-picture.oss-cn-beijing.aliyuncs.com/img/202304182037876.png" alt="image-20220623191438824" style="zoom:50%;"></p>
<p><strong>编码方式与分类器</strong>：</p>
<p><strong>我们对训练集中的每个流量样本统计了其中的叶子证书所涉及到的不同 Subject 和 Issuer 的 数量，并记录每个流量样本与他们通信的频数。</strong></p>
<p><strong>X509证书在Internet上广泛使用</strong>。它们用于验证实体之间的信任。证书颁发机构通常将X509证书链接在一起。如图2所示。[23]，<strong>X509证书提供URL、组织、签名等信息</strong>。我们从培训集中每个客户端的TLS流中提取X509证书链，并获取证书中<strong>主题</strong>和<strong>颁发者</strong>中包含的单词。我们将所有单词组合在一起，并将客户的流量视为由这些单词组成的句子。与B部分类似，我们计算每个单词的数量并将其用作特征。0我们使用朴素贝叶斯（NB）算法来处理这些特征。如果测试集样本证书中的所有单词从未出现在训练集中，我们将直接推断它是恶意的。因为训练集包含最流行的域名。</p>
<p><img src="https://lzy-picture.oss-cn-beijing.aliyuncs.com/img/202304182037096.png" alt="image-20220621131035005" style="zoom: 67%;"></p>
<h4><span id="3通信-ip-地址黑白名单特征">（3）<strong>通信</strong> <strong>IP</strong> <strong>地址黑白名单特征</strong></span></h4><p>除了证书中的 Subject 和 Issuer 信息外，服务端 IP 地址是另一个表示软件通信对象的标识 符。有少数流量样本中出现了缺少证书的情况，且我们认为同一地区遭受同类恶意软件感染很 可能会造成他们对相同的 IP 地址的访问，因此我们将流量样本中的远程 IP 地址的访问情况也 作为一个判断是否包含恶意流量的依据。</p>
<h4><span id="4流级荷载无关特征提取"><strong><font color="red"> （4）流级荷载无关特征提取</font></strong></span></h4><blockquote>
<p>  对于黑样本的流标记问题存在一定问题，由于被感染的主机也可能会进行正常通信，而且 恶意软件也可能出现正常行为</p>
</blockquote>
<p>我们首先考虑流级特征，由于 TCP 连接可以由流的四元组确定，所以恶意通信一般是指流 级别的，分析每条流的黑或白是十分合理的。我们综合考虑了已有相关工作 [<a href="applewebdata://CE580100-416D-47E9-B704-9182656D72ED#_bookmark4">1</a>–<a href="applewebdata://CE580100-416D-47E9-B704-9182656D72ED#_bookmark5">3</a>]，以及对 TCP、 TLS/SSL 协议进行深入分析，共提取了超过 1000 维与荷载无关的流级特征，包含如下几部分:</p>
<ul>
<li><strong>元数据（Metadata）</strong>：即单条流的基本统计数据，包含持续时间（duration）、总的流入（inbound）/流出（outbound）的字节数、数据包个数；</li>
<li><strong>窗口序列统计特征</strong>：我们对出/入流量分别维护了包<strong>时间间隔</strong>和<strong>包长度的窗口</strong>，每个窗口提取统计特征，包含<strong>平均值、标准差、最大值、最小值</strong>；除此而外，我们发现仅仅关注一整个窗口的特征粒度不够细化，为了更加精细化的对流量行为进行捕获和建模，我们关注窗口中的每个数据包，并使用马尔科夫转移矩阵的方式捕获相邻包之间的关系。以构建包长窗口的马尔科夫矩阵为例，我们首先将包长均匀分成 15 个桶（bin），然后建立 15×15 的矩阵，每个元素表示从行转移到列所代表的的桶，最后对矩阵进行行的归一化处理，将其转化为概率形式；</li>
<li><strong>TLS/SSL</strong> <strong>握手包特征</strong>：首先我们发现本赛题中客户端和服务器端都出现了多种不同的协议类型，而黑和白训练集中客户端和服务器不同版本的分布是不同的，因此协议版本可以 作为一个特征，我们将客户端和服务器端使用的 TLS 版本进行独热（one-hot）编码；同时 我们关注到 Hello 包中 GMT Unix Time 字段在黑/白训练集中的分布也有所不同，因此我 们将客户端和服务器端的 GMT Unix Time 的是否存在、是否使用随机时间编码为 0/1 的特征；此外，<strong>由于恶意软件和恶意服务器使用的加密套件和列表</strong>很有可能与正常的加密流量 有所区别，<strong><font color="red"> 我们将客户端与服务器端的加密套件（列表）和扩展列表进行独热编码，即将 所有可能的加密套件和扩展列出展成一维 0 向量，当前流使用的套件和扩展对应的位置赋 值为 1；</font></strong></li>
<li><strong>TLS/SSL证书特征</strong>：服务器端证书对于区分正常和恶意流量有着重要的作用，如恶意通信的证书多采用自签名的方式。因此我们对服务器端证书进行了特征挖掘，主要选用如下的 0/1 特征：<strong><font color="red"> 是否自签名、是否过期、版本号、证书有效期、公钥长度；</font></strong>同时，我们考虑到之 前模型发现有些<strong>证书主体域名</strong>单一使用无法区分黑/白的情况，因此也嵌入到多维特征中， 使用独热编码对训练集常用证书主体域名进行独热编码。</li>
</ul>
<h4><span id="5主机级荷载无关特征聚合-流级统计信息">（5）<strong>主机级荷载无关特征聚合</strong> (流级统计信息)</span></h4><p><strong>单独的看每条流可能漏掉了流之间的关联行为即主机级别的行为</strong>，比如恶意软件在发出正常的访问谷歌流量后可能就要开始进行恶意传输。再比如，有少量正常流也会出现自 签名，如果我们单独看流，可能就会误判，但是如果我们基于主机提取特征发现同一 IP 下有多条流都是自签名，则我们就会有很大的信心认为这是恶意的。因此，我们将上一小节中流级别 的特征进行聚合，并以流为基本单位提取主机级别特征。</p>
<p><strong>主机级特征聚合部分主要考虑了如下的特征:</strong></p>
<ul>
<li><strong>总包个数</strong>，<strong>每条流的平均包个数</strong>，<strong>时间间隔、包长的均值</strong>，以及上一个小节中证书部分的相关特 征，即<strong>自签名流数量，过期流数量，有效期过长（比如 100年）的流数量及其均值。</strong></li>
<li>TLS 半连接 和无连接</li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://powerlzy.github.io/posts/28SSFDQ/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/cat_mac.jpg">
      <meta itemprop="name" content="lzy">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="PowerLZY's Blog">
      <meta itemprop="description" content="相比到达的地方，同行的人更重要！">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | PowerLZY's Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/posts/28SSFDQ/" class="post-title-link" itemprop="url">恶意加密流量（2）Datacon2021恶意加密流量检测</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2022-06-18 15:41:06" itemprop="dateCreated datePublished" datetime="2022-06-18T15:41:06+08:00">2022-06-18</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2023-04-18 20:38:26" itemprop="dateModified" datetime="2023-04-18T20:38:26+08:00">2023-04-18</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E7%AE%97%E6%B3%95%E6%AF%94%E8%B5%9B/" itemprop="url" rel="index"><span itemprop="name">算法比赛</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E7%AE%97%E6%B3%95%E6%AF%94%E8%B5%9B/%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8/" itemprop="url" rel="index"><span itemprop="name">网络安全</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>5.5k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>10 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2><span id="datacon2021-网络流量分析-writeup">Datacon2021 网络流量分析 Writeup</span></h2><h4><span id="一-恶意流量分析">一、恶意流量分析</span></h4><h4><span id="11-比赛题目">1.1 比赛题目</span></h4><p>本题文件中提供了一段时间的失陷主机的通讯流量，参赛选手需审计该流量包，进行追踪溯源，找到真正的恶意服务器，最终获取key，此外本题还设有可以获得额外分数的彩蛋题目。</p>
<p>以主机端的网络流量为基础，通过流量审计和主动探测的方式，对攻击者进行追踪溯源和行为分析。</p>
<h4><span id="二-恶意攻击指令识别">二、恶意攻击指令识别</span></h4><h4><span id="12-比赛题目">1.2 比赛题目</span></h4><p>本题中提供了一段时间的失陷主机的通讯流量和单个指令的流量样本的提供给参算选手，参赛选手需通过恶意软件通讯特征筛选出恶意流量，并通过提供的单一的下发指令流量作为样本，分析出通讯流量（http、dns、https）中下发的指令序列。</p>
<blockquote>
<p>  域前置技术：</p>
</blockquote>
<p>各命令对应的数据流也有不同的特征。比如，screen 命令会有来自服务端和客户端双向的大流量，hash命令有来自服务端的大流量和客户端的小流量，sleep 命令仅有get数据包，没有post数据包等，如图所示。</p>
<p><img src="https://lzy-picture.oss-cn-beijing.aliyuncs.com/img/202304182037518.png" alt="image-20220618161916376"></p>
<h3><span id="三-加密代理流量分析">三、加密代理流量分析</span></h3><h4><span id="31-比赛题目-阶段一-流量审计">3.1 比赛题目-阶段一 【流量审计】</span></h4><p>本题中，<strong>管理员获取了内网中由数个不明用户构建的加密代理节点</strong>，这些软件使用的通信协议不完全一致，管理员只分别提取了一定数量的样本。参赛选手需要通过不同的加密代理特征，按照样本对目标流量进行分类。</p>
<p>概述：本题共有11个加密代理。对应11个类别，其中11个类别共包含带标签样本51个。无标签样本1000个，需要们通过分析51个带有标签样本，找到11个类别所对应的具体的特征，从而对1000个测试样本进行分类。</p>
<p>由于此题类别数目较少，只有圱圱个类别，且每个类别对应的带标签样本数目也很少，因此我们采取规则匹配的方法来实现分类。我们的实验框架如图所示。</p>
<p>首先通过分析不同的类别特征制定每个类别对应的规则，从1000个测试样本的pcap包里根据规则从提取相应的数据，继而基于这些数据进行匹配分类。最终对于极少数没有匹配结果的样本，采用人工审查的方式进行分类。值得注意的是，由于同一个样本可能满足多个类别的特点，所以不同类别的规则匹配顺序会对分类结果有一定影响。</p>
<h4><span id="311-加密代理特点分析">3.1.1 加密代理特点分析</span></h4><p><strong>加密流量的特征</strong>一般包含<strong>协议特征</strong>、<strong>数据元统计特征</strong>。尤其应该注意<strong>TLS协议的流量特点</strong>。</p>
<p>对于恶意加密流量和良性加密流量的区别，cisco的研究表明【6】显示，对于TLS协议特征，在ClientHello数据包中，恶意软件提供于普通客户端完全<strong>不同的一组密码套件</strong>，此外，这些密码套件通常很脆弱或已经过时。相比之下，几乎所有良性应用程序都提供相同的密码套件。除此之外，<strong>恶意软件通常提供很少的扩展</strong>，而正常用户最多有9个拓展。此外<strong>客户端的公钥长度也存在很大的差异</strong>。在ServerHello和Certificate中，<strong>恶意软件查询的服务器会选择不常见的密码套件</strong>，因为优先提供的<strong>密码套件的大小受到限制</strong>。此外，证书的有效期和SAN条目数量也存在区别，而且<strong>恶意服务器发送自签名证书的比例也比普通服务器高一个数量级</strong>。</p>
<p><strong><font color="red"> 对于数据元统计特征，恶意流量于良性流量的特征差异主要表现在数据信息、数据包的大小、到达时间序列和字节分布等。</font></strong></p>
<h4><span id="312-特征分析与规则制定">3.1.2 特征分析与规则制定</span></h4><p>基于上述加密代理的特点, 我们分析 51 个带标签的样本, 并着重关注了 TLS 特征。我们对协议信息、TLS 应用数据、TLS 握手信息、数据信息、数据 包大小等特征进行了分析, 找到了有效区分的方法。</p>
<p>其中有三个类别有明显的区别, 只关注协议信息即可区分开来</p>
<ul>
<li>类别 0 对应的 pcap 包所有的通信流量只包含 UDP 协议, 而在 11 个类别中, 只有类别 0 具有此特点。</li>
<li>类别 6 中, 发现只有类别 6 的流量中同时出现了 TCP 和 UDP 协议, 此外, 只有类别 6 中出现了 OCSP 协议。</li>
<li>类别 8 中, 我们发现了 WireGuard 协议, WireGuard 是一种 VPN 协议, 它的大量出现使得类别 8 的特 征变得明显。通过以上方法, 我们可以通过协议信息将类别 0、类别 6、类别 8 区分出来。</li>
</ul>
<p>剩下的 8 类需要我们做进一步区分, 我们发现类别 4、类别 5、类别 7、类别9 的通信流量中只包含 TCP 协议, 类别 1、类别 2、类别 3、类别 10 的通信流量 由 TCP+TLS 协议组成。</p>
<p>到了此时, 我们的进度开始变得缓慢, 因为剩下的 8 类 没有很明显的区分特征。但是在我们的不觖努力下, 我们逐渐有了突破, 我们 发现：</p>
<ul>
<li>在类别 1 中, 存在 tls.app_data 字段的前 12 位为 00:00:00:00:00:00 的流量, 如图3.2所示; </li>
<li>在类别 7 中, 存在 data.data 字段的前 6 位为 00:00:00 的 流量; </li>
<li>在类别 5 中, 存在 data.data 字段的第 5 位到第 12 位为 $48: 00: 02: 8 \mathrm{a}$ 的 流量, 如图3.3所示; </li>
<li>在类别 3 中, 存在 tls.handshake.extensions_length 字段值 为 156 的流量; 在类别 10 中, 存在 tls.handshake.ciphersuite 值为 $0 \times 1301$ 并且 tls.handshake.type 值为 2 的流量; </li>
<li>在类别 2 中, 存在 tls.handshake.ciphersuite 值为 0x1303 并且 tls.handshake.type 值为 2 的流量; </li>
<li>在类别 4 中, 存在 frame.len 值为 1514 和 71 的流量, 值得注意的是, 当出现 frame.len 为 1514 时, 通常下一 条流量的 frame.len 为 71 ; </li>
<li>在类别 9 中, 存在 data.len 的值为 1424 的流量。<br>综上所述, 我们可以通过以上方法将 11 个类别区分出来, 文字描述略显繁 杂, 表3.1展示了我们制定的匹配规则。</li>
</ul>
<p><img src="https://lzy-picture.oss-cn-beijing.aliyuncs.com/img/202304182037861.png" alt="image-20220618165211660" style="zoom:50%;"></p>
<h3><span id="32-比赛题目-阶段二"><strong><font color="red"> 3.2 比赛题目-阶段二</font></strong></span></h3><blockquote>
<p>  同一代理协议、少量样本标签</p>
</blockquote>
<p><strong>身份不明的用户或恶意软件可能使用未授权的加密代理进行通信</strong>，访问恶意网站或正常网站。确认这些行为的详细信息有利于对可疑用户行为和恶意软件进行分析，但截获的加密流量无法进行破解。</p>
<p>本题中，<strong>管理员使用机器自动产生了恶意软件与多个恶意网站（或正常网站）通信产生的，经过加密代理的流量</strong>。根据已知的信息，管理员提取了一部分可以确定类别的样本信息。参赛选手需要利用管理员生成的样本，标记每个流量包可能访问站点的标签。</p>
<h4><span id="321-概述">3.2.1 概述</span></h4><p><strong>题目主要考察加密流量识别能力，需要选手根据提供的已知类别样本，识别测试数据可能可能访问何种恶意站点。</strong>经过对题目和数据的初步分析，我们发现所<strong><font color="red"> 提供加密流量数据均由同一加密代理软件产生</font></strong>，且数据包中并未观测到特殊应用层协议可供分析。因此，我们确定了从<strong>统计特征</strong>和<strong>行为特征</strong>两个角度角度对加密流量样本进行审计分析，深入挖掘标识访问不同恶意通信流量的有效特征，从而实现对恶意流量的自动化分类的基本思路。</p>
<p>图3.6展示了我们方案的整体流程。具体来讲，我们分别提取训练样本的<strong>多维统计特征</strong>及<strong>标识行为特征的包长序列特征</strong>，分别构建分类器，基于投票机制结合多维分类结果来获得最终判定结果，从而避免异构数据混淆和权重问题带来的误分类情况。接下来我们将分别介绍我们所采用的特征及对应的分类器、实现和性能以及展望和总结。</p>
<p><img src="https://lzy-picture.oss-cn-beijing.aliyuncs.com/img/202304182037437.png" alt="image-20220618170112661" style="zoom:50%;"></p>
<h4><span id="322-结题思路">3.2.2 结题思路</span></h4><p><strong>数据分析</strong>：拿到数据后我们首先对提供的训练样本和测试样本进行初步分整理分析;<code>train_data</code>文件夹中， 共包含1401个流量样本，除第85类只有2个样本，29、52、94只有6个样本，平均每个家族都有13-15个样本。下面我们将详细介绍<strong>六个参与投票的子模型</strong>中的每一个模型所采用的特征及对应的分类器，以及设计的动机和意义。</p>
<h5><span id="1数据包特征">（1）数据包特征</span></h5><p><strong>由于网络中不同的服务商提供的服务不同，导致数据流中的==数据分组大小==存在一定的差异</strong>，如流媒体的数据分组较小以提高播放流畅度而文件下载通常是以最大的负载进行传输[7]。由于数据分组大小与网络服务有关且不受加密技术的影响，因此可以根据数据分组的分布对加密流量进行识别。</p>
<p><img src="https://lzy-picture.oss-cn-beijing.aliyuncs.com/img/202304182038655.png" alt="image-20220618170711029" style="zoom:50%;"></p>
<p>我们根据方向的不同，首先针对每个pacp文件分别提取<strong>前向包有效负载长度序列</strong>和<strong>后向有效负载长度序列</strong>。然后每个序列分别提取方差、均值、四分位值、众数、平均数、最大值等特征从而描述分布特点。</p>
<blockquote>
<p>  由于包长分布的特征本质上是一个离散概率分布，特征值之间的差值可以很好的描述不同分布之间的差异，因此我们选择<strong>基于欧拉距离度量的KNN分类算法</strong>。KNN通过测量不同特征值之间的距离来讲待检测样本分类到训练样本之中，因此并不适用于特征维度过高的数据，我们所提取的圱圲维特征可以较好地应用于此。</p>
</blockquote>
<h5><span id="2-流级特征">(2) 流级特征</span></h5><p><strong>根据五元组（源IP、目的IP、源端口，目的端口，协议）划分得到的会话数据能够最大程度的保留客户端和服务端之间的通信特征信息，因此成为了流量分析领域常用的分析对象[8].</strong>通信双方的<strong><font color="red"> 会话级别的统计特征</font></strong>能够很好的反映不同类型应用的属性。</p>
<ul>
<li><strong>恶意通信往往具有持续时间短、传输速率快、出入站比例大等特点</strong>；</li>
<li><strong>正常流量则往往具有持续时间长、包长分布均匀、数据包到达间隔稳定、出入站比例较小等特点。</strong></li>
</ul>
<p>本题中提供的加密流量只是对数据包的载荷进行加密，对流的特征属性的影响较小，因此可以根据流量的属性如间隔时间，报文大小，流持续时间等提取相应的流量特征，根据流量特征准确的识别出访问不同网站的加密流量的类别。如图所示，为题目提供训练样本中不同类别的加密流量在流级统计特征上的分布差异。</p>
<p><img src="https://lzy-picture.oss-cn-beijing.aliyuncs.com/img/202304182038992.png" alt="image-20220618171300097" style="zoom:67%;"></p>
<h5><span id="提取方式"><strong><font color="red"> 提取方式：</font></strong></span></h5><p><strong>我们利用SplitCap工具按照（源IP、目的IP、源端口, 目的端口, 协议）五元组将提供的训练和测试数据分别拆分成单独的会话,</strong> 并过滤掉末完成三次握手的会话。我们认为末完成三次握手的会话可能是由于抓包或是题目设定原因出现了截断, 而这种不完整的会话若何混合在其他完整的会话中一同提取统计特征, 将会使特征变得混淆而不可用。因此我们从全部切分得到的46,667个会 话文件中过滤后得到可用于特征提取和模型训练的 <strong>22,211 条完整会话。</strong></p>
<blockquote>
<p>  <a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/482187008"><em>SplitCap</em>划分pcap文件</a>:将pcap拆分为较小pcap的文件。</p>
</blockquote>
<p>在确定并获得训练数据后, 我们直接实现了从原始报文数据中的流量特征提取, 没有依赖tshark等第三方工具。具体来讲, <strong><font color="red"> 我们基于 python和dpkt库，直接将pcap文件作为二进制流读取并依据协议解析每个字段, 从而计算80+维的会 话统计特征。</font></strong>具体使用特征如表3.4所示:</p>
<p><img src="https://lzy-picture.oss-cn-beijing.aliyuncs.com/img/202304182038246.png" alt="image-20220618171529682" style="zoom:50%;"></p>
<blockquote>
<p>  dpkt:</p>
<p>  scapy:</p>
<p>  joy：</p>
</blockquote>
<p>特征提取后, 我们选择XGBoost作为流级特征的分类算法。XGBoost (eXtreme Gradient Boosting）是基于Boosting框架的一个算法工具包 (包括工程实现), 在 并行计算效率、缺失值处理、预测性能上都非常强大。同时基于树的方法可以 直接对特征重要性进行评分, 这对于后续挑选重要特征、降低特征维度、删除冗余特征十分方便，同时还可以对max_depth参数进行限制防止特征过于细化和线性相关带来的过拟合风险。</p>
<h5><span id="3-网站行为特征">(3) 网站行为特征</span></h5><p>由于本题数据说明提到所有样本均由同一加密代理生成，<strong>差异在于访问了不同的目标网站</strong>。而恶意网站由于其目的和功能的不同，<strong>在通信过程中往往存在特定的通信模式和规律，通过分析比较有效负载长度序列的异同，可有效定位不同类别的访问流量</strong>【9】</p>
<p>与流级特征中提取的包长统计特征不同，该部分重点关注的是<strong>序列特征</strong>，通过数据包长度的时序性交错变化来反映不同网站的应用和业务特征。在加密代理不变且网站业务功能稳定的情况下，利用基于包长序列的网站应用行为特征进行加密网站流量分类具备相当的稳定性和精确度。</p>
<p><img src="https://lzy-picture.oss-cn-beijing.aliyuncs.com/img/202304182038582.png" alt="image-20220618171923243" style="zoom: 67%;"></p>
<p><img src="https://lzy-picture.oss-cn-beijing.aliyuncs.com/img/202304182038497.png" alt="image-20220618172009931" style="zoom:50%;"></p>
<p>为证明该特征的有效性, <strong>我们先将序列长度窗口设定为 11</strong> , 在 1401 个训练样本中获得了1396个样本所包含的独特包长序列, 并基于匹配的强规则确定4734个样本的标签。此次提交获得了55.18分, 即提交内容获得了94%左右的 正确率，从根本上证明该特征的有效性。</p>
<p>在获得以上的验证结果后，我们开始思考如何将以上的匹配规则“软化” 成机器学习可以处理的形式。我们希望能够兼顾包长序列在莫以类别的出现频 率和 “特异程度”, 结合以往课程和信息检索相关知识, </p>
<p><strong><font color="red"> 我们想到了 TF-IDF(term frequency-inverse document frequency) 技术。即将包长序列视为 $i$ tem, 拼接后形成 对应该类别的 “文档”, 随后基于tf-idf思想, 计算每个item的出现频率tf和特异性程度idf, 两者结合后用来代表该类别的特征向量。</font></strong>在本题提供的数据中, <strong>我们共得到了1306维的特征</strong>, 也就是说1396的训练样本和8109的测试样本, 共出 现不同的包长序列1306个。</p>
<p>在获得特征向量后, 我们依然选择了在前面就已经取得良好表现的梯度提升树算法一XGBoost作为该部分的子分类器。主要是考虑到该部分特征向量维 度较高, 且容易出现过拟合的问题。因此, 我们在设定树模型的超参数时, 集中 调整了如max_depth、colsample_bytree、subsample以及eta、lambda、alpha等 控制数据采样和正则化程度的超参数。</p>
<h4><span id="323-结果验证与评估">3.2.3 结果验证与评估</span></h4><p><strong>我们基于 python的sklearn和dpkt库实现了相应的机器学习模型和特征提取</strong>。 由于所提供数据包规模不大, dpkt并为遇到内存爆炸无法打开的情况, sklearn中 所包含的KNN模型和XGBoost模型则均采用之前多次试验得到的较好的超参数设置。而且<strong>在流级特征分类</strong>时, 我们基于XGBoost树模型特有的特征重要度评分功能, 进行了一定程度的特征选择, 最终得到了纬度较低且精确度较高的模型作为最终使用的判定模型。</p>
<p>给予我们的多级别特征提取和分类器投票结果, 提交多次后发现并末达到理想的分数。因此后期我们又基于KNN算法和tf-idf特征进行进一步分类, 将多 个模型判定结果均相同的 2270 个测试样本提取出来补充相对较少的训练样本集 重新训练各部分子分类器, 最终达到了87分的结果。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://powerlzy.github.io/posts/3X70Q09/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/cat_mac.jpg">
      <meta itemprop="name" content="lzy">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="PowerLZY's Blog">
      <meta itemprop="description" content="相比到达的地方，同行的人更重要！">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | PowerLZY's Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/posts/3X70Q09/" class="post-title-link" itemprop="url">工业落地（8）STIX协议 《网络威胁情报协议》</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2022-06-18 13:23:23" itemprop="dateCreated datePublished" datetime="2022-06-18T13:23:23+08:00">2022-06-18</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2022-07-05 23:09:10" itemprop="dateModified" datetime="2022-07-05T23:09:10+08:00">2022-07-05</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E5%B7%A5%E4%B8%9A%E8%90%BD%E5%9C%B0/" itemprop="url" rel="index"><span itemprop="name">工业落地</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E5%B7%A5%E4%B8%9A%E8%90%BD%E5%9C%B0/%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8/" itemprop="url" rel="index"><span itemprop="name">网络安全</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>6.4k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>12 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2><span id="网络威胁情报之-stix-21">网络威胁情报之 STIX 2.1</span></h2><blockquote>
<p>  <a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/365563090">https://zhuanlan.zhihu.com/p/365563090</a></p>
</blockquote>
<h3><span id="一-说明">一、说明</span></h3><p>STIX（Structured Threat Information Expression）是一种用于交换网络威胁情报（cyber threat intelligence，CTI）的语言和序列化格式。STIX的应用场景包括：<strong>协同威胁分析、自动化威胁情报交换、自动化威胁检测和响应</strong>等。</p>
<h5><span id="stix对网络威胁情报的描述方法如下">STIX对网络威胁情报的描述方法如下：</span></h5><p><img src="https://pic4.zhimg.com/80/v2-c9e59ff49083188d1bf41879c9e1756b_1440w.jpg" alt="img"></p>
<p><strong>STIX Domain Objects</strong>（SDO）：威胁情报主要的分类对象，包含了一些威胁的behaviors和construct，共有18种类型：<strong>Attack Pattern</strong>, Campaign, <strong>Course of Action</strong>, Grouping, Identity, Indicator, Infrastructure, Intrusion Set, Location, Malware, Malware Analysis, Note, Observed Data, Opinion, Report, Threat Actor, Tool, and Vulnerability.</p>
<p><img src="https://pic3.zhimg.com/80/v2-e5fbd4d7693f6dae450a18d6e5981c6a_1440w.jpg" alt="img"></p>
<p><img src="https://pic2.zhimg.com/80/v2-acb4fcb44a2a7d8dd065c75aa848cdc1_1440w.jpg" alt="img"></p>
<p><strong>STIX Cyber-observable Objects</strong>（SCO）：威胁情报中具体的可观察对象，用于刻画<strong>基于主机或基于网络的信息</strong>。</p>
<ul>
<li>SCO会被多种SDO所使用，以提供上下文支持，如<em>Observed Data</em> SDO，表示在特定时间观察到的raw data；在STIX2.0中，SCO在SDO中出现时只会以Observed Data的形式出现，在STIX2.1则不限于此。</li>
<li>SCO本身不包括who，when和why的信息，但是将SCO和SDO关联起来，可能会得到这些信息以及对威胁更高层面的理解。</li>
<li>SCO可以捕获的对象包括文件、进程、IP之间的流量等。</li>
</ul>
<p><strong>STIX Relationship Objects</strong>（SRO）：用于SDO之间、SCO之间、SDO和SCO之间的关系。SRO的大类包括以下两种：</p>
<p><img src="https://pic1.zhimg.com/80/v2-2e19804c43197207ae032bc991594ca0_1440w.jpg" alt="img"></p>
<p><strong>generic SRO（Relationship）</strong>：大多数关系所采用的类型，其relation_type字段包括：内置关系：如Indicator到Malware之间的关系，可以用<em>indicates</em> 表示，它描述了该Indicator可用于检测对应的恶意软件；自定义关系；</p>
<p><strong>Sighting SRO</strong>：用于捕获实体在SDO中出现的案例，如sighting an indicator。没有明确指明连接哪两个object。之所以将其作为独立的SRO，是因为其具有一些独有的属性，如<em>count</em>。</p>
<p>除了SRO，STIX还用ID references来表示嵌入关系（embedded relationship）。当使用嵌入关系时，表示该属性时该对象的内置属性，从而不需要使用SRO表示，如<em>create_by_ref。</em>因此，SRO可以视为两个节点直接的边，而embedded relationship则可以视为属性（只不过其表示了二元关系）</p>
<ul>
<li><strong>STIX Meta Objects</strong>：用于丰富或扩展STIX Core Objects</li>
<li><strong>STIX Bundle Object</strong>：用于打包STIX内容</li>
</ul>
<p><strong>STIX是一种基于图的模型，其中SDO和SCO定义了图的节点，而STIX relationships定义了边</strong>。</p>
<p><strong>STIX Patterning language</strong>：STIX模式语言可以实现网络或终端的威胁检测。该语言目前使用STIX Indicator对象，来匹配时序的observable data。</p>
<h3><span id="二-通用数据类型">二、<strong>通用数据类型</strong></span></h3><p><img src="https://pic3.zhimg.com/80/v2-2d7ff334fee36adda542c0d3281c5d62_1440w.jpg" alt="img" style="zoom:67%;"></p>
<h3><span id="三-stix-通用概念">三、 <strong>STIX 通用概念</strong></span></h3><ul>
<li>STIX common properties</li>
</ul>
<p><img src="https://pic3.zhimg.com/80/v2-4502a49dc00fc1bfae5913c20a191a3e_1440w.jpg" alt="img" style="zoom:67%;"></p>
<h3><span id="四-stix-domain-objects"><strong>四、 STIX Domain Objects</strong></span></h3><p>每个SDO对应 交换网络威胁情报CTI中的唯一概念。<strong>使用SDO，SCO和SRO作为基本模块</strong>，用户可以方便的创建和共享CTI。</p>
<p><strong>SDO</strong>：</p>
<ul>
<li>Property：通用属性、SDO转专用属性</li>
<li>Relationship：embedded relationships、common relationships</li>
</ul>
<p>一些相似的SDO可以被归为一个大类，如：</p>
<ul>
<li><strong>Attack Pattern, Malware, and Tool可以被归为TTP，因为它们描述了攻击行为和资源</strong></li>
<li>Campaign, Intrusion Set, and Threat Actor 可以被描述为“攻击者发动攻击的原因，以及如何组织（why and how）”</li>
</ul>
<h4><span id="41-attack-pattern">4.1 <strong>Attack Pattern</strong></span></h4><p>TTP类型之一，它描述了攻击者试图破坏目标的<strong>方式，</strong>对应于TTP中的<strong>战术</strong>。可用于帮助对<strong>攻击进行分类</strong>，将特定的<strong>攻击概括为其遵循的模式</strong>，并提供有关<strong>如何进行攻击的详细信息</strong>。</p>
<blockquote>
<p>  如spear fishing就是一种攻击模式，而更具体的描述，如被特定攻击者实施的spear fishing也是一种攻击模式。</p>
</blockquote>
<h4><span id="42-campaign"><strong>4.2 Campaign</strong></span></h4><p>表示某次具体的攻击活动。A Campaign is a grouping of adversarial behaviors that describes a set of malicious activities or attacks (sometimes called waves) that occur over a period of time against a specific set of targets. Campaigns usually have well defined objectives and may be part of an Intrusion Set.</p>
<blockquote>
<p>  战役是一组敌对行为，描述了针对特定目标集在一段时间内发生的一组恶意活动或攻击（有时称为WAVE）。活动通常有明确的目标，可能是入侵集的一部分。</p>
</blockquote>
<h4><span id="43-course-of-action-响应的行为">4.3 <strong>Course of Action (响应的行为)</strong></span></h4><p>用于预防攻击或对攻击做出响应的行为，它回包含技术，自动化响应（补丁、重新配置防火墙），或高级别的动作（如员工培训或者策略制定）。</p>
<h4><span id="44-grouping"><strong>4.4 Grouping</strong></span></h4><p>Grouping表示分析和调查<strong>过程中</strong>产生的数据（待确认的线索数据）；还可以用来声明<strong>其引用的STIX对象与正在进行的分析过程有关</strong>，如当一个安全分析人员正在跟其它人合作，分析一系列Campaigns和Indicators的时，<strong>Gouping会引用一系列其它SDO、SCO和SRO（Grouping就表示协作分析吧）。</strong></p>
<p>除了embedded relationship和common relationship之外，没有明确定义Grouping对象和其它STIX对象之间的关系。</p>
<h4><span id="45-identity"><strong>4.5 Identity</strong></span></h4><p><strong>Identity可以代表特定的个人、组织或团伙</strong>；也可以代表一类个人、组织、系统或团伙。Identity SDO可以捕获基本标识信息，联系信息以及Identity所属的部门。 Identity在STIX中用于表示攻击目标，信息源，对象创建者和威胁参与者身份。</p>
<h4><span id="46-incident"><strong>4.6 Incident</strong></span></h4><p>stub对象，待完善，没有专门定义的property和relationship。</p>
<h4><span id="47-indicator"><strong>4.7 Indicator</strong></span></h4><p>Indicator表示可用于检测可疑行为的模式。如用STIX Patterning Language来描述恶意域名集合（第九章）。</p>
<h4><span id="48-infrastructure"><strong>4.8 Infrastructure</strong></span></h4><p><strong>TTP的类型之一，用于描述系统、软件服务等其它的物理或虚拟资源</strong>；如攻击者使用的C2服务器，防御者使用的设备和服务器，以及作为被攻击目标的数据库服务器等；</p>
<p>基于此我们可以将受保护网络中的设备纳入知识图谱，采用类似于这样的关系：</p>
<p><img src="https://pic2.zhimg.com/80/v2-1d2970679ce3243e8ccefe0eda890351_1440w.jpg" alt="img" style="zoom:50%;"></p>
<h4><span id="49-intrusion-set"><strong>4.9 Intrusion Set</strong></span></h4><p>Intrusion set是由<strong>某个组织</strong>所使用的恶意行为和资源的集合。一个Intrusion Set可能会捕获多个Campaigns，他们共同指向一个Threat Actor。新捕获的活动可以被归因于某个Intrusion Set，而Actors可以在Intrusion之间跳转，甚至从属于多个Intrusion Set。</p>
<p>如在 apt1.json 中，整个报告被打包在bundle中，而Intrusion Set用来指示APT组织：</p>
<p><img src="https://pic3.zhimg.com/80/v2-e40a11cbdf0b033063367a3d045d77ba_1440w.jpg" alt="img" style="zoom:67%;"></p>
<p><strong>Intrusion Set和Campaigns对比：</strong></p>
<p><strong><font color="red"> 如果 Campaigns 是在一段时间内针对一组特定目标进行的一组攻击，以实现某些目标，那么入侵集就是整个攻击包，可以在多个活动中长期使用，以实现潜在的多个目的.</font></strong>由Intrusion Set找出Threat Actors，nation state或者nation state中的某个APT组织，是一个<strong>溯源</strong>的过程。</p>
<h4><span id="410-location"><strong>4.10 Location</strong></span></h4><p>表示具体地点，可以与Identity或Intrusion Set相关联，表示其位置；与Malware或Attack Pattern相关联，表示其目标。</p>
<h4><span id="411-malware"><strong>4.11 Malware</strong></span></h4><p>TTP类型之一，表示<strong>恶意软件或代码。</strong></p>
<h4><span id="412-malware-analysis"><strong>4.12 Malware Analysis</strong></span></h4><p>捕获了在恶意软件实例或恶意软件家族分析过程中，动态分析或静态分析的结果。</p>
<h4><span id="413-note"><strong>4.13 Note</strong></span></h4><p>其他对象中不存在的额外信息；例如，分析人员可以在一个Campaign对象中添加注释，以表明他在黑客论坛上看到了与该Campaign相关的帖子。同样，Note对象也没有定义与其他STIX Object之间的关系。</p>
<h4><span id="414-observed-data"><strong>4.14 Observed Data</strong></span></h4><p><strong>网络安全相关的可观察对象（raw information）集合，其引用对象为SCO，包含从analyst reports, sandboxes, and network and host-based detection tools等收集的信息。</strong></p>
<p><strong>必须包含objects或者object_refs属性，表示对SCO的引用</strong>：</p>
<p>Observed Data只有反向关系。此外，还会被Sighting SRO所指向：Sightings represent a relationship between some intelligence entity<strong> that was seen</strong> (e.g., an Indicator or Malware instance), <strong>where it was seen</strong>, and <strong>what evidence was actually seen.</strong> The <strong>evidence (or raw data) in that relationship is captured as Observed Data（Sighting中的证据就是Observed Data）。</strong></p>
<h4><span id="415-opinion"><strong>4.15 Opinion</strong></span></h4><p>Opinion是对STIX对象中信息正确性的评估。</p>
<h4><span id="416-report"><strong>4.16 Report</strong></span></h4><p>威胁情报报告。</p>
<h4><span id="417-threat-actor"><strong>4.17 Threat Actor</strong></span></h4><p>攻击的个人、团体或组织；其与Intrusion Set不同，Threat Actor会同时支持或附属于不同的Intrusion Set、团体或组织。</p>
<h4><span id="418-tool"><strong>4.18 Tool</strong></span></h4><p><strong>Tool是威胁参与者可以用来执行攻击的合法软件。与Malware不同，Tool一般是合法软件，如Namp、VNC。</strong></p>
<h4><span id="419-vulnerability"><strong>4.19 Vulnerability</strong></span></h4><p>漏洞。用于连接相关漏洞的外部描述（external_references），或还没有相关描述的0-day漏洞。</p>
<p><strong>Q&amp;A：</strong></p>
<ul>
<li><strong>Q1：embedded relationship和节点property有啥区别？</strong>property是节点属性，embedded relationship是带有二元关系的节点属性</li>
<li><strong>Q2：Observed Data和SCO有啥区别？</strong>Observed Data观察行为与观察对象的信息，而<strong>SCO是具体可观察实体的信息，二者是引用与被引用的关系</strong></li>
<li><strong>Q3：Intrusion Set、Identity和Threat Actor的区别？</strong>Intrusion Set是最高层的实体，其包括Identity和Threat Actor，如APT1（高层APT组织）为Intrusion Set，其包含一些个人（Ugly Gorilla）或团体（SuperHard）的Threat Actor，而Identity是用真实名称描述的个人或组织（如Ugly Gorilla指向Wang Dong）。由此看来，Threat Actor也可以用真是名称描述（Communist Party of China），但是明显指示了其表示威胁主体，而Identity本身不显示其角色信息。</li>
</ul>
<h3><span id="五-stix-relationship-objects"><strong>五、 STIX Relationship Objects</strong></span></h3><h4><span id="51-relationship"><strong>5.1 Relationship</strong></span></h4><p><strong>Type Name: relationship</strong></p>
<p>用于连接STIX中的SDO或SCO; STIX中的Relationship在每个SDO或SCO的定义中进行了描述, 用户还可以自定义关系。STIX中所有内置的Relationship详见文档Appendix B。注意, Relationship本身也是一个对象, 因此其也有自身的 Property 和 Relationships。</p>
<h4><span id="52-sighting"><strong>5.2 Sighting</strong></span></h4><p><strong>Type Name: sighting</strong></p>
<p><strong>原文定义</strong>:目击(sighting)表示认为在CTI中看到了某些东西（例如指示器、恶意软件、工具、威胁因素等）。目击用于跟踪目标是谁和什么，如何实施攻击，以及跟踪攻击行为的趋势。</p>
<blockquote>
<p>  A Sighting denotes the belief that something in CTI (e.g., an indicator, malware, tool, threat actor, etc.) was seen. Sightings are used to track who and what are being targeted, how attacks are carried out, and to track trends in attack behavior.</p>
</blockquote>
<p>Sighting 没有连接两个对象, 但却被定义为关系, 原因是:目击包括三部分的内容:• 发现的内容，如指示器、恶意软件、活动或其他SDO（sighting\u of\u ref）•发现者和/或发现地点，表示为身份（where\u sighted\u refs）•系统和网络上实际看到的内容，表示为观察数据（SECURED\u Data\u refs）</p>
<blockquote>
<p>  Sighting is captured as a relationship because you cannot have a sighting unless you have something that has been sighted. Sighting does not make sense without the relationship to what was sighted</p>
</blockquote>
<p>Sighting包括三部分的内容:</p>
<ul>
<li><strong>What</strong> was sighted, such as the <strong>Indicator, Malware, Campaign, or other SDO</strong> (<em>sighting_of_ref</em>)</li>
<li><strong>Who</strong> sighted it and/or where it was sighted, represented as an <strong>Identity</strong> (<em>where_sighted_refs</em>)</li>
<li><strong>What</strong> was actually seen on systems and networks, represented as <strong>Observed Data</strong> (<em>observed_data_refs</em>)</li>
</ul>
<p>Sighting和Observed Data的区别:</p>
<p><strong>目击与观察到的数据不同，因为目击是一种情报断言（“我看到了这个威胁参与者”）</strong>，而观察到的数据只是信息（“我看到了这个文件”）。当您通过包含来自目击的链接观测数据（Observed\u Data\u refs）来组合它们时，您可以说“我看到了这个文件，这让我觉得我看到了这个威胁参与者”。</p>
<blockquote>
<p>  Sighting is distinct from Observed Data in that Sighting is an <strong>intelligence assertion</strong> (“I saw this threat actor”) while Observed Data is simply information (“I saw this file”). When you combine them by including the linked Observed Data (observed_data_refs) from a Sighting, you can say “I saw this file, and that makes me think I saw this threat actor”.</p>
</blockquote>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://powerlzy.github.io/posts/22KBA6T/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/cat_mac.jpg">
      <meta itemprop="name" content="lzy">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="PowerLZY's Blog">
      <meta itemprop="description" content="相比到达的地方，同行的人更重要！">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | PowerLZY's Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/posts/22KBA6T/" class="post-title-link" itemprop="url">高级威胁发现（4）【Nan】RAID-Cyber Threat Intelligence Modeling Based on GCN</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2022-06-14 23:05:18" itemprop="dateCreated datePublished" datetime="2022-06-14T23:05:18+08:00">2022-06-14</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2023-04-19 15:55:09" itemprop="dateModified" datetime="2023-04-19T15:55:09+08:00">2023-04-19</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E5%AD%A6%E6%9C%AF%E5%89%8D%E6%B2%BF/" itemprop="url" rel="index"><span itemprop="name">学术前沿</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E5%AD%A6%E6%9C%AF%E5%89%8D%E6%B2%BF/%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8/" itemprop="url" rel="index"><span itemprop="name">网络安全</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>1.3k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>2 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2><span id="raid-cyber-threat-intelligence-modeling-based-on-gcn">RAID-Cyber Threat Intelligence Modeling Based on GCN</span></h2><blockquote>
<p>  <a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s?__biz=Mzg5MTM5ODU2Mg==&amp;mid=2247490941&amp;idx=1&amp;sn=30cf491cf7455bbd075f8285d292a9d8&amp;chksm=cfccadb0f8bb24a6c4e87c5c95aecda92578ee634f2b8642bece665efde54417655ed79936c7&amp;scene=178&amp;cur_album_id=1776483007625822210#rd">[AI安全论文] 05.RAID-Cyber Threat Intelligence Modeling Based on GCN</a></p>
<p>  这篇文章将详细介绍北航老师发表在RAID 2020上的论文《Cyber Threat Intelligence Modeling Based on Heterogeneous Graph Convolutional Network》</p>
<p>  原文作者：Jun Zhao, Qiben Yan, Xudong Liu, Bo Li, Guangsheng Zuo<br>  原文链接：<a target="_blank" rel="noopener" href="https://www.usenix.org/system/files/raid20-zhao.pdf">https://www.usenix.org/system/files/raid20-zhao.pdf</a><br>  论文来源：RAID 2020/CCF B</p>
</blockquote>
<h3><span id="摘要">摘要</span></h3><p>网络威胁情报（CTI，Cyber Threat Intelligence）已在业界被广泛用于抵御流行的网络攻击，CTI通常被看作将威胁参与者形式化的妥协指标（IOC）。然而当前的网络威胁情报（CTI）存在三个主要局限性：</p>
<ul>
<li>IOC提取的准确性低</li>
<li><strong>孤立的IOC几乎无法描述威胁事件的全面情况</strong></li>
<li><strong>异构IOC之间的相互依存关系尚未得到开发，无法利用它们来挖掘深层次安全知识</strong></li>
</ul>
<p>本文提出了基于异构信息网络（HIN， Heterogeneous Information Network）的网络威胁情报框架——HINTI，旨在建模异构IOCs之间的相互依赖关系，以量化其相关性，对CTI进行建模和分析。</p>
<p>本文的主要贡献如下：</p>
<ul>
<li><strong>提出了基于多粒度注意力机制（ multi-granular attention）的IOC识别方法，可以从非结构化威胁描述中自动提取网络威胁对象，并提高准确性。</strong></li>
<li>构建一个异构信息网络（HIN）来建模IOCs之间的依赖关系</li>
<li>提出一个基于图卷积网络（Graph Convolutional Networks）的威胁情报计算框架来发现知识</li>
<li>实现了网络威胁情报（CTI）原型系统</li>
</ul>
<p>实验结果表明，本文提出的IOC提取方法优于现有方法，HINTI可以建模和量化异构IOCs之间的潜在关系，为不断变化的威胁环境提供了新的线索。</p>
<blockquote>
<p>  IOC（Indicator of Compromise）是MANDIANT在长期的数字取证实践中定义的可以反映主机或网络行为的技术指示器。</p>
</blockquote>
<h3><span id="一-hinti工作步骤">一、HINTI工作步骤</span></h3><ul>
<li>通过B-I-O序列标注方法对安全相关帖子进行标注，用于构建IOC提取模型。</li>
<li>将标记的训练样本输入神经网络，训练<strong>IOC提取模型</strong>。</li>
<li><strong>HINTI利用句法依赖性解析器</strong>（e.g.，主-谓-宾，定语从句等）提取IOC之间的关联关系，每个IOC均表示为三元组（IOCi，relation，IOCj）</li>
<li>最后，HINTI集成了基于异构图卷积网络的CTI计算框架以有效地量化IOC之间的关系进行知识发现。</li>
</ul>
<h4><span id="11-hinti总体架构">1.1 HINTI总体架构</span></h4><p>HINTI由四个主要部分组成：（a）收集与安全相关的数据并提取即IOC；（b）将IOC之间的相互依存关系建模为异构信息网络；（c）使用基于权重学习的相似性度量将节点嵌入到低维向量空间中；（d）基于图卷积网络和知识挖掘来计算威胁情报。</p>
<p><img src="https://lzy-picture.oss-cn-beijing.aliyuncs.com/img/202304191555337.jpeg" alt="图片"></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://powerlzy.github.io/posts/RGS2PC/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/cat_mac.jpg">
      <meta itemprop="name" content="lzy">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="PowerLZY's Blog">
      <meta itemprop="description" content="相比到达的地方，同行的人更重要！">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | PowerLZY's Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/posts/RGS2PC/" class="post-title-link" itemprop="url">恶意加密流量（3）西湖论剑AI大数据安全分析赛</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2022-06-12 20:23:33" itemprop="dateCreated datePublished" datetime="2022-06-12T20:23:33+08:00">2022-06-12</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2023-04-18 20:38:38" itemprop="dateModified" datetime="2023-04-18T20:38:38+08:00">2023-04-18</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E7%AE%97%E6%B3%95%E6%AF%94%E8%B5%9B/" itemprop="url" rel="index"><span itemprop="name">算法比赛</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E7%AE%97%E6%B3%95%E6%AF%94%E8%B5%9B/%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8/" itemprop="url" rel="index"><span itemprop="name">网络安全</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>99</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>1 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2><span id="西湖论剑ai大数据安全分析赛加密恶意流量检测">西湖论剑AI大数据安全分析赛加密恶意流量检测</span></h2><blockquote>
<p>  数据集：csv</p>
<p>  加密恶意流量检测初赛第一名，决赛第二名方案：<a target="_blank" rel="noopener" href="https://github.com/undefinedXD/WestLakeSwordComp">https://github.com/undefinedXD/WestLakeSwordComp</a></p>
</blockquote>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://powerlzy.github.io/posts/DTTFVX/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/cat_mac.jpg">
      <meta itemprop="name" content="lzy">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="PowerLZY's Blog">
      <meta itemprop="description" content="相比到达的地方，同行的人更重要！">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | PowerLZY's Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/posts/DTTFVX/" class="post-title-link" itemprop="url">大数据处理（1）高维向量相似度匹配</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2022-06-11 19:01:05" itemprop="dateCreated datePublished" datetime="2022-06-11T19:01:05+08:00">2022-06-11</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2023-03-19 13:52:45" itemprop="dateModified" datetime="2023-03-19T13:52:45+08:00">2023-03-19</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%A4%84%E7%90%86/" itemprop="url" rel="index"><span itemprop="name">大数据处理</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>845</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>2 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2><span id="文本相似度匹配">文本相似度匹配</span></h2><blockquote>
<p>  from 《Scaling Up All Pairs Similarity Search》</p>
<p>  海量文本的成对相似度的高性能计算（待续） - 马东什么的文章 - 知乎 <a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/457947482">https://zhuanlan.zhihu.com/p/457947482</a></p>
</blockquote>
<h4><span id="摘要">摘要：</span></h4><p>对于高维空间中的大量稀疏向量数据，我们研究了寻找相似性分数(由余弦距离等函数确定)高于给定阈值的所有向量对的问题。我们提出了一个简单的算法<strong>，基于新的索引和优化策略，解决了这个问题，而不依赖于近似方法或广泛的参数调整</strong>。我们展示了该方法在广泛的相似阈值设置中有效地处理各种数据集，与以前的最先进的方法相比有很大的加速。</p>
<p>(海量成对文本相似度问题对于反欺诈而言非常重要，因为无论是电商中重要的地址信息，还是设备或用户的离散features之间的相似度计算和构图，都依赖于高性能的文本相似度计算方法，在实践中，我们不可能直接写双循环去做计算，即使是离线也往往需要耗费大量的时间)</p>
<h3><span id="一-介绍">一、介绍</span></h3><p>许多现实世界的应用程序需要解决一个相似度搜索问题，在这个问题中，人们对所有相似度高于指定阈值的对象对都感兴趣。</p>
<ul>
<li>web搜索的查询细化:搜索引擎通常会建议其他查询公式（例如你在百度中输入百，会给你推荐百度）。生成此类查询建议的一种方法是根据查询[19]的搜索结果的相似性来查找所有的相似查询对。由于目标是只提供高质量的建议，所以我们只需要找到相似度高于阈值的查询对（topk问题）。</li>
<li>协同过滤:协同过滤算法通过确定哪些用户有相似的品味来进行推荐。因此，算法需要计算相似度高于某个阈值的相似用户对。</li>
<li>接近重复的文档检测和消除:特别是在文档索引领域，检测和清除等价的文档是重要的。在许多情况下，由于简单的相等性检验不再满足要求，微小修改的存在使这种检测变得困难。通过具有很高的相似度阈值的相似度搜索，可以实现近重复检测（这方面的工作之前看过simhash，google做海量网页去重的方法）。</li>
<li>团伙检测:最近的工作已经应用算法在一个应用程序中寻找所有相似的用户，以识别点击欺诈者[13]团伙。</li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://powerlzy.github.io/posts/3DTA3RC/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/cat_mac.jpg">
      <meta itemprop="name" content="lzy">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="PowerLZY's Blog">
      <meta itemprop="description" content="相比到达的地方，同行的人更重要！">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | PowerLZY's Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/posts/3DTA3RC/" class="post-title-link" itemprop="url">工业落地（5）蚂蚁安全-柳星《我对安全与NLP的实践和思考》</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2022-06-11 15:08:50" itemprop="dateCreated datePublished" datetime="2022-06-11T15:08:50+08:00">2022-06-11</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2023-04-18 15:14:41" itemprop="dateModified" datetime="2023-04-18T15:14:41+08:00">2023-04-18</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E5%B7%A5%E4%B8%9A%E8%90%BD%E5%9C%B0/" itemprop="url" rel="index"><span itemprop="name">工业落地</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E5%B7%A5%E4%B8%9A%E8%90%BD%E5%9C%B0/%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8/" itemprop="url" rel="index"><span itemprop="name">网络安全</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>4.1k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>7 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1><span id="柳星-我对安全与nlp的实践和思考">柳星-我对安全与NLP的实践和思考</span></h1><blockquote>
<p>  <a target="_blank" rel="noopener" href="https://github.com/404notf0und">404notf0und</a>/<strong><a target="_blank" rel="noopener" href="https://github.com/404notf0und/FXY">FXY</a></strong></p>
</blockquote>
<h3><span id="一-个人思考">一、个人思考</span></h3><p><strong><font color="red"> 通过对安全与NLP的实践和思考，有以下三点产出：</font></strong></p>
<ul>
<li><strong>首先，产出一种通用解决方案和轮子，一把梭实现对各种安全场景的安全检测。</strong>通用解决方案给出一类安全问题的解决思路，打造轮子来具体解决这一类问题，而不是使用单个技术点去解决单个问题。<strong>具体来说，将安全与NLP结合，在各种安全场景中，将其安全数据统一视作文本数据，从NLP视角，统一进行文本预处理、特征化、预训练和模型训练。</strong>例如，在Webshell检测中，Webshell文件内容，在恶意软件检测中，API序列，都可以视作长文本数据，使用NLP技术进行分词、向量化、预训练等操作，同理，在Web安全中，SQl、XSS等URL类安全数据，在DNS安全中，DGA域名、DNS隧道等域名安全数据，同样可以视作短文本数据。因此，只要安全场景中安全数据可以看作文本数据，<a target="_blank" rel="noopener" href="https://github.com/404notf0und/FXY">FXY：<em>Security-Scenes-Feature-Engineering-Toolkit</em></a> 中，内置多种通用特征化方法和多种通用深度学习模型，以支持多种安全场景的特征化和模型训练，达到流水线式作业。</li>
<li><strong>其次，是对应用能力和底层能力的思考</strong>。之前写过一篇文章《<a target="_blank" rel="noopener" href="https://4o4notfound.org/index.php/archives/188/">应用型安全算法工程师的自我修养</a>》，在我当时预期想法中，我理解的应用型，重点在于解决实际安全问题，不必苛求于对使用技术本身的理解深度，可以不具备研究型、轮子型的底层能力。映射到我自身，我做安全和算法，最初想法很好，安全和算法两者我都要做好，这里做好，仅仅指用好。之后，面试时暴露了问题，主管给出的建议是两者都要做好。这里做好，不单单指用好，还要知其所以然。举个例子，就是不仅要调包调参玩的6，还要掌握算法的底层原理，这就是底层能力。当时，懂，也不懂，似懂非懂，因为，说，永远是别人的，悟，才是自己的。在实现通用解决方案和轮子的过程中，遇到关于word2vec底层的非预期问题，才深刻体会到，底层能力对应用能力的重要性。过程中遇到的预期和非预期问题，下文会详述。<strong>现在我理解的应用型，重点还是在解决安全问题，以及对安全问题本身的理解，但应用型还需具备研究型、轮子型等上下游岗位的底层能力。</strong>安全算法是这样，其他细分安全领域也是一样，都需要底层能力，以发展技术深度。</li>
<li>最后，带来思考和认识的提升。<strong>从基于机器学习的XX检测，基于深度学习的XX检测，等各种单点检测，到基于NLP的通用安全检测，是一个由点到面的认知提升</strong>。从安全和算法都要做好，到安全和算法都要做好，其中蕴含着认知的提升。从之前写过一篇安全与NLP的文章《<a target="_blank" rel="noopener" href="https://www.4o4notfound.org/index.php/archives/190/">当安全遇上NLP</a>》，到现在这篇文章。对一件事物的认识，在不同阶段应该是不一样的，甚至可能完全推翻自己之前的认识。我们能做的，是保持思考，重新认识过去的经历，提升对事物的认知和认知能力。这个提升认知的过程，类似boosting的残差逼近和强化学习的奖惩，是一个基于不知道不知道-&gt;知道不知道&gt;知道知道-&gt;不知道知道的螺旋式迭代上升过程。</li>
</ul>
<h3><span id="二-预期问题">二、预期问题</span></h3><h4><span id="21-分词粒度">2.1 分词粒度</span></h4><p><strong>首先是分词粒度，粒度这里主要考虑字符粒度和词粒度。在不同的安全场景中，安全数据不同，采用的分词粒度也可能不同：</strong></p>
<ul>
<li><strong><font color="red">恶意样本检测的动态API行为序列数据，需要进行单词粒度的划分。</font></strong></li>
<li><strong>域名安全检测中的域名数据，最好采用字符粒度划分。</strong></li>
<li><strong>URL安全检测中的URL数据，使用字符和单词粒度划分都可以。</strong></li>
<li><strong>XSS检测文中，是根据具体的XSS攻击模式，写成正则分词函数，对XSS数据进行划分，这是一种基于攻击模式的词粒度分词模式，但这种分词模式很难扩展到其他安全场景中。</strong></li>
</ul>
<p><strong>FXY特征化类wordindex和word2vec中参数char_level实现了该功能</strong>。在其他安全场景中，可以根据此思路，写自定义的<strong>基于攻击模式的分词</strong>，但适用范围有限。我这里提供了两种通用词粒度分词模式，第一种是忽略特殊符号的简洁版分词模式，第二种是考虑全量特殊符号的完整版分词模式，这两种分词模式可以适用于各种安全场景中。FXY特征化类word2vec中参数punctuation的值‘concise’，‘all’和‘define’实现了两种通用分词和自定义安全分词功能。下文的实验部分，会测试不同安全场景中，使用字符粒度和词粒度，使用不同词粒度分词模式训练模型的性能对比。</p>
<h4><span id="22-语料库">2.2 语料库</span></h4><p><strong>关于预训练前字典的建立（语料库）</strong>。特征化类word2vec的预训练需求直接引发了字典建立的相关问题。在word2vec预训练前，需要考虑预训练数据的产生。基于深度学习的XSS检测文中，是通过<strong>建立一个基于黑样本数据的指定大小的字典，不在字典内的数据全部泛化为一个特定词，将泛化后的数据作为预训练的数据</strong>。这里我们将此思路扩充，增加使用全量数据建立任意大小的字典。具体到word2vec类中，参数one_class的True or False决定了预训练的数据来源是单类黑样本还是全量黑白样本，参数vocabulary_size的值决定了字典大小，如果为None，就不截断，为全量字典数据。下文的实验部分会测试是<strong>单类黑样本预训练</strong>word2vec好，还是<strong>全量数据预训练</strong>更占优势，是<strong>字典截断</strong>好，还是用全量字典来预训练好。</p>
<h4><span id="23-序列">2.3 序列</span></h4><p><font color="red"> <strong>关于序列的问题，具体地说，是长文本数据特征化需求</strong>。</font><strong>webshell检测等安全场景，引发了序列截断和填充的问题。</strong>短文本数据的特征化，可以保留所有原始信息。而在某些安全场景中的长文本数据，特征化比较棘手，保留全部原始信息不太现实，需要对其进行截断，截断的方式主要有<strong>字典截断、序列软截断、序列硬截断</strong>。</p>
<ul>
<li><strong>序列软截断</strong>是指对不在某个范围内（参数num_words控制范围大小）的数据，直接去除或填充为某值，长文本选择直接去除，缩短整体序列的长度，尽可能保留后续更多的原始信息。如果长本文数据非常非常长，那么就算有字典截断和序列软截断，截断后的序列也可能非常长，超出了模型和算力的承受范围;</li>
<li><strong>序列硬截断</strong>（参数max_length控制）可以发挥实际作用，直接整整齐齐截断和填充序列，保留指定长度的序列数据。这里需要注意的是，为了兼容后文将说到的“预训练+微调”训练模式中的<strong>预训练矩阵</strong>，序列填充值默认为0。</li>
</ul>
<h4><span id="24-词向量">2.4 词向量</span></h4><p>词向量的问题，具体说，是词嵌入向量问题。词嵌入向量的产生有三种方式：</p>
<ul>
<li>词序列索引+有嵌入层的深度学习模型</li>
<li>word2vec预训练产生词嵌入向量+无嵌入层的深度学习模型</li>
<li><strong>word2vec预训练产生预训练矩阵+初始化参数为预训练矩阵的嵌入层的深度学习模型。</strong></li>
</ul>
<p>这里我把这三种方式简单叫做微调、预训练、预训练+微调，从特征工程角度，这三种方式是产生词嵌入向量的方法，从模型角度，也可以看作是模型训练的三种方法。第一种微调的方式实现起来比较简单，直接使用keras的文本处理类Tokenizer就可以分词，转换为词序列，得到词序列索引，输入到深度学习模型中即可。第二种预训练的方式，调个gensim库中word2vec类预训练，对于不在预训练字典中的数据，其词嵌入向量直接填充为0，第三种预训练+微调的方式，稍微复杂一点，简单来说就是前两种方式的组合，用第二种方式得到预训练矩阵，作为嵌入层的初始化权重矩阵参数，用第一种方式得到词序列索引，作为嵌入层的原始输入。下文的实验部分会测试并对比按这三种方式训练模型的性能，<strong>先说结论：预训练+微调&gt;预训练&gt;微调</strong>。</p>
<h3><span id="三-非预期问题">三、非预期问题</span></h3><h4><span id="31-已知的库和函数不能满足我们的需求">3.1 已知的库和函数不能满足我们的需求</span></h4><p>使用keras的文本处理类Tokenizer预处理文本数据，得到词序列索引，完全没有问题。<strong>但类Tokenizer毕竟是文本数据处理类，没有考虑到安全领域的需求。</strong></p>
<ul>
<li><strong><font color="red"> 类Tokenizer的单词分词默认会过滤所有的特殊符号，仅保留单词，而特殊符号在安全数据中是至关重要的，很多payload的构成都有着大量特殊符号，忽略特殊符号会流失部分原始信息。</font></strong></li>
<li><strong>首先阅读了keras的文本处理源码和序列处理源码</strong>，不仅搞懂了其结构和各函数的底层实现方式，还学到了一些trick和优质代码的特性。搞懂了其结构和各函数的底层实现方式，还学到了一些trick和优质代码的特性。下图为Tokenizer类的结构。借鉴并改写Tokenizer类，加入了多种分词模式，我们实现了wordindex类。</li>
</ul>
<p><img src="https://lzy-picture.oss-cn-beijing.aliyuncs.com/img/202304181514240.png" alt="img"></p>
<h4><span id="32-对word2vec的理解不到位">3.2 对word2vec的理解不到位</span></h4><p>第二个非预期问题是，对word2vec的理解不到位，尤其是其底层原理和代码实现，导致会有一些疑惑，无法得到验证，这是潜在的问题。虽然可以直接调用gensim库中的word2vec类暂时解决问题，但我还是决定把word2vec深究深究，一方面可以答疑解惑，另一方面，就算不能调用别人的库，自己也可以造轮子自给自足。限于篇幅问题，不多讲word2vec的详细原理，原理是我们私下里花时间可以搞清楚的，不算是干货，对原理有兴趣的话，这里给大家推荐几篇优质文章，在github仓库<a target="_blank" rel="noopener" href="https://github.com/404notf0und/Always-Learning">Always-Learning</a>中。</p>
<p><strong>word2vec本质上是一个神经网络模型，具体来说此神经网络模型是一个输入层-嵌入层-输出层的三层结构，我们用到的词嵌入向量只是神经网络模型的副产物，是模型嵌入层的权重矩阵。</strong>以word2vec实现方式之一的skip-gram方法为例，此方法本质是通过中心词预测周围词。如果有一段话，要对这段话训练一个word2vec模型，那么很明显需要输入数据，还要是打标的数据。以这段话中的某个单词为中心词为例，在一定滑动窗口内的其他单词都默认和此单词相关，此单词和周围其他单词，一对多产生多个组合，默认是相关的，因此label为1，即是输入数据的y为1，而这些单词组合的one-hot编码是输入数据的x。<strong>那么很明显label全为1，全为positive sample，需要负采样来中和。这里的负采样不是简单地从滑动窗口外采样，而是按照词频的概率，取概率最小的一批样本来做负样本（这个概念下面马上要用到），因为和中心词毫不相关，自然label为0。</strong></p>
<p><strong><font color="red"> tensorflow中的nce_loss函数实现了负采样。</font></strong></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




  <nav class="pagination">
    <a class="extend prev" rel="prev" title="上一页" aria-label="上一页" href="/page/3/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/3/">3</a><span class="page-number current">4</span><a class="page-number" href="/page/5/">5</a><span class="space">&hellip;</span><a class="page-number" href="/page/12/">12</a><a class="extend next" rel="next" title="下一页" aria-label="下一页" href="/page/5/"><i class="fa fa-angle-right"></i></a>
  </nav>

</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 
  <span itemprop="copyrightYear">2023</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">lzy</span>
</div>
<div class="busuanzi-count">
    <span class="post-meta-item" id="busuanzi_container_site_uv">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="总访客量">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-item" id="busuanzi_container_site_pv">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="总访问量">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>

<!--
  <div class="powered-by">由 <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/pisces/" rel="noopener" target="_blank">NexT.Pisces</a> 强力驱动
  </div>-->
<!-- 网站运行时间的设置 -->
<span id="timeDate">载入天数...</span>
<span id="times">载入时分秒...</span>
<script>
    var now = new Date();
    function createtime() {
        var grt= new Date("03/01/2023 10:00:00"); //此处修改你的建站时间或者网站上线时间
        now.setTime(now.getTime()+250);
        days = (now - grt ) / 1000 / 60 / 60 / 24; dnum = Math.floor(days);
        hours = (now - grt ) / 1000 / 60 / 60 - (24 * dnum); hnum = Math.floor(hours);
        if(String(hnum).length ==1 ){hnum = "0" + hnum;} minutes = (now - grt ) / 1000 /60 - (24 * 60 * dnum) - (60 * hnum);
        mnum = Math.floor(minutes); if(String(mnum).length ==1 ){mnum = "0" + mnum;}
        seconds = (now - grt ) / 1000 - (24 * 60 * 60 * dnum) - (60 * 60 * hnum) - (60 * mnum);
        snum = Math.round(seconds); if(String(snum).length ==1 ){snum = "0" + snum;}
        document.getElementById("timeDate").innerHTML = "本站已安全运行 "+dnum+" 天 ";
        document.getElementById("times").innerHTML = hnum + " 小时 " + mnum + " 分 " + snum + " 秒.";
    }
setInterval("createtime()",250);
</script>

    </div>
  </footer>

  

  <a href="https://github.com/PowerLZY" class="github-corner" title="在 GitHub 上关注我" aria-label="在 GitHub 上关注我" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/next-boot.js"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-generator-searchdb/1.4.1/search.js" integrity="sha256-1kfA5uHPf65M5cphT2dvymhkuyHPQp5A53EGZOnOLmc=" crossorigin="anonymous"></script>
<script src="/js/third-party/search/local-search.js"></script>


  <script class="next-config" data-name="mermaid" type="application/json">{"enable":true,"theme":{"light":"default","dark":"dark"},"js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/mermaid/9.4.3/mermaid.min.js","integrity":"sha256-e0o3JYsdjqKajf9eOe22FhioYSz9WofRY4dLKo3F6do="}}</script>
  <script src="/js/third-party/tags/mermaid.js"></script>


  <script src="/js/third-party/pace.js"></script>

  
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>




  

  <script class="next-config" data-name="enableMath" type="application/json">true</script><script class="next-config" data-name="mathjax" type="application/json">{"enable":true,"tags":"all","js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/mathjax/3.2.2/es5/tex-mml-chtml.js","integrity":"sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI="}}</script>
<script src="/js/third-party/math/mathjax.js"></script>




        <script src="//cdn.jsdelivr.net/npm/js-base64/base64.min.js"></script>
        <script>
        const hasAttr = (e,a) => a.some(_=> e.attr(_)!==undefined);
        $('a').each(function() {
          const $this = $(this);
          if(hasAttr($this,["data-fancybox","ignore-external-link"])) return;
          const href = $this.attr('href');
          if (href && href.match('^((http|https|thunder|qqdl|ed2k|Flashget|qbrowser|ftp|rtsp|mms)://)')) {
            const strs = href.split('/');
            if (strs.length >= 3) {
                const host = strs[2];
                if (host !== 'powerlzy.github.io' || window.location.host) {
                    $this.attr('href', '/go.html?u='+Base64.encode(href)+'').attr('rel', 'external nofollow noopener noreferrer');
                    if (true) {
                        $this.attr('target', '_blank');
                    }
                }
            }
          }
        });
        </script></body>
</html>
