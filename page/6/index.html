<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 6.3.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">

<link rel="stylesheet" href="https://fonts.lug.ustc.edu.cn/css?family=Lato:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext">

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" integrity="sha256-HtsXJanqjKTc8vVQjO4YMhiqFoXkfBsjBWcX91T1jr8=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pace/1.2.4/themes/blue/pace-theme-bounce.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pace/1.2.4/pace.min.js" integrity="sha256-gqd7YTjg/BtfqWSwsJOvndl0Bxc8gFImLEkXQT8+qj0=" crossorigin="anonymous"></script>

<script class="next-config" data-name="main" type="application/json">{"hostname":"powerlzy.github.io","root":"/","images":"/images","scheme":"Pisces","darkmode":false,"version":"8.15.1","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":{"enable":true,"style":"flat"},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"},"path":"/search.xml","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false}}</script><script src="/js/config.js"></script>

    <meta name="description" content="相比到达的地方，同行的人更重要！">
<meta property="og:type" content="website">
<meta property="og:title" content="PowerLZY&#39;s Blog">
<meta property="og:url" content="https://powerlzy.github.io/page/6/index.html">
<meta property="og:site_name" content="PowerLZY&#39;s Blog">
<meta property="og:description" content="相比到达的地方，同行的人更重要！">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="lzy">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="https://powerlzy.github.io/page/6/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":true,"isPost":false,"lang":"zh-CN","comments":"","permalink":"","path":"page/6/index.html","title":""}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>PowerLZY's Blog</title>
  








  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">PowerLZY's Blog</h1>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">本博客主要用于记录个人学习笔记（测试阶段）</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="搜索" role="button">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup"><div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off" maxlength="80"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close" role="button">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="search-result-container no-result">
  <div class="search-result-icon">
    <i class="fa fa-spinner fa-pulse fa-5x"></i>
  </div>
</div>

    </div>
  </div>

</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="lzy"
      src="/images/cat_mac.jpg">
  <p class="site-author-name" itemprop="name">lzy</p>
  <div class="site-description" itemprop="description">相比到达的地方，同行的人更重要！</div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">267</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">61</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">77</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author animated">
      <span class="links-of-author-item">
        <a href="https://github.com/PowerLZY" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;PowerLZY" rel="noopener me" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:3289218653@qq.com" title="E-Mail → mailto:3289218653@qq.com" rel="noopener me" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
  </div>
  <div class="cc-license animated" itemprop="license">
    <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/zh-CN" class="cc-opacity" rel="noopener" target="_blank"><img src="https://cdnjs.cloudflare.com/ajax/libs/creativecommons-vocabulary/2020.11.3/assets/license_badges/small/by_nc_sa.svg" alt="Creative Commons"></a>
  </div>

        </div>
      </div>
        <div class="back-to-top animated" role="button" aria-label="返回顶部">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner index posts-expand">

    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://powerlzy.github.io/posts/34HK4X9/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/cat_mac.jpg">
      <meta itemprop="name" content="lzy">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="PowerLZY's Blog">
      <meta itemprop="description" content="相比到达的地方，同行的人更重要！">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | PowerLZY's Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/posts/34HK4X9/" class="post-title-link" itemprop="url">风控算法（5）数据挖掘-手机App数据挖掘实现</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2022-07-01 19:35:48" itemprop="dateCreated datePublished" datetime="2022-07-01T19:35:48+08:00">2022-07-01</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2022-07-09 17:01:04" itemprop="dateModified" datetime="2022-07-09T17:01:04+08:00">2022-07-09</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E3%80%90draft%E3%80%91%E5%BA%94%E7%94%A8/" itemprop="url" rel="index"><span itemprop="name">【draft】应用</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E3%80%90draft%E3%80%91%E5%BA%94%E7%94%A8/%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF/" itemprop="url" rel="index"><span itemprop="name">应用场景</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E3%80%90draft%E3%80%91%E5%BA%94%E7%94%A8/%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF/%E4%B8%9A%E5%8A%A1%E5%AE%89%E5%85%A8/" itemprop="url" rel="index"><span itemprop="name">业务安全</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>1.3k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>2 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2><span id="风控数据手机app数据挖掘实践思路">风控数据—手机App数据挖掘实践思路</span></h2>
<h3><span id="引言"><strong>引言</strong></span></h3>
<p>作为移动互联网时代的主要载体，智能手机逐渐成为人们日常生活中不可或缺的一部分，改变着人们的生活习惯。比如，可以用“饿了么”点外卖，“支付宝”可以用来种树，“抖音”可以用来上厕所…强大的App给我们的生活带来了巨大的便利。</p>
<img src="https://pic3.zhimg.com/80/v2-87f00e7e18438ad4bf65c09feb5f38e6_1440w.jpg" alt="img" style="zoom: 33%;">
<p>正因为如此，App与用户之间存在着密不可分的联系，用户在频繁使用这些App过程中也积累了大量的个人历史数据。<strong><font color="red"> 这些App数据能帮助我们更好地去理解用户，推测用户的性别、职业、收入、兴趣、偏好等属性</font></strong>，也就是所谓的<strong>KYC（Know your customer）</strong>。</p>
<p>在风控中，App数据也有其重要价值，常用于反欺诈、风控建模特征工程等。本文将分享App数据的一些挖掘思路，以及实践建议。</p>
<p><strong>首先，让我们思考下几个问题：</strong></p>
<ul>
<li>如何获取数据？</li>
<li>数据长啥样？</li>
<li>数据如何和业务相结合去理解？</li>
<li>可以采用什么算法实现高效提取信息？</li>
<li>如何利用这块数据服务业务？</li>
</ul>
<h3><span id="一-app数据长啥样">一、 App数据长啥样？</span></h3>
<p>根据资料显示，当前手机App数据主要包括：<strong>App安装包名称、App中文名、App安装列表、App安装序列。</strong></p>
<p><strong>为便于区分，常把App中文名记为app_name，App包名称（package）记为pkg_name。其中pkg_name是App的唯一ID</strong>，app_name则因为下载渠道、版本更新、数据采集等因素影响导致不唯一。例如，&quot;企业微信&quot;的pkg_name为“com.tencent.wework”，而app_name可能会有“企业微信”、“微信企业版”、“微信（企业版）”等多个值。</p>
<p>至于如何获取手机App package？可以参考这里：<a href="https://link.zhihu.com/?target=https%3A//blog.csdn.net/gufenchen/article/details/91410667">实现获取appPackage和appActivity的方法</a></p>
<p><img src="https://pic3.zhimg.com/80/v2-e7c62877c3193cec175852170ee3eae2_1440w.jpg" alt="img"></p>
<ol>
<li><strong>App安装集合（App List</strong>）：指手机上安装的所有App的集合，一般用逗号隔开，如：“com.alibaba.android.rimet,<a target="_blank" rel="noopener" href="http://com.tencent.mm">com.tencent.mm</a>,com.citiccard.mobilebank,com.icbc,com.hongxin1.rm”。可以认为是一个集合，因此是<strong>无序</strong>的。</li>
<li><strong>App安装序列（App Seq）</strong>：指手机上包含安装时间的App序列。如：[&quot; 信&quot;,“1558014854044”,“<a href="https://link.zhihu.com/?target=http%3A//com.tencent.mm/">com.tencent.mm</a>”,“7.0.4”]，分别代表App中文名、App安装时间戳、App包名称和版本号。由于可根据安装时间戳得到安装顺序，因此是<strong>有序</strong>的。</li>
</ol>
<p>我们拿“微信”的package在腾讯应用宝中检索，那么就可以找到以下<strong>App描述数据</strong>：</p>
<ol>
<li><strong>分类标签</strong>：标签精确表达了App的核心功能。但可能是开发者在发布App时从可选项中主观选择了一个标签，也有可能腾讯会在后期维护标签。标签不一定准确，但可作为一个重要的参考维度。</li>
<li><strong>下载量</strong>：可作为判断App是否小众的一个参考维度。然而，能在应用宝上架的App一般是合规的；对于一些质量较差无法上架的app就无法获取到下载量。</li>
<li><strong>应用描述</strong>：开发者对App的主要功能给出的描述性文本，可提取关键词、主题等内容。但如果只是根据关键词匹配，很容易出错。比如微信中藏有游戏中心入口，文本中出现“游戏”关键词，但这并不是一个游戏类App。</li>
</ol>
<h3><span id="二-app如何有效分类">二、App如何有效分类？</span></h3>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://powerlzy.github.io/posts/29H4DXP/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/cat_mac.jpg">
      <meta itemprop="name" content="lzy">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="PowerLZY's Blog">
      <meta itemprop="description" content="相比到达的地方，同行的人更重要！">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | PowerLZY's Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/posts/29H4DXP/" class="post-title-link" itemprop="url">风控算法（4）特征工程-变量加工实践经验</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2022-07-01 19:33:41" itemprop="dateCreated datePublished" datetime="2022-07-01T19:33:41+08:00">2022-07-01</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2022-07-08 14:34:30" itemprop="dateModified" datetime="2022-07-08T14:34:30+08:00">2022-07-08</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E3%80%90draft%E3%80%91%E5%BA%94%E7%94%A8/" itemprop="url" rel="index"><span itemprop="name">【draft】应用</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E3%80%90draft%E3%80%91%E5%BA%94%E7%94%A8/%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF/" itemprop="url" rel="index"><span itemprop="name">应用场景</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E3%80%90draft%E3%80%91%E5%BA%94%E7%94%A8/%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF/%E4%B8%9A%E5%8A%A1%E5%AE%89%E5%85%A8/" itemprop="url" rel="index"><span itemprop="name">业务安全</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>8.6k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>16 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2><span id="特征工程-风控变量加工实践经验">特征工程-风控变量加工实践经验</span></h2>
<blockquote>
<p>风控变量加工实践经验 - 求是汪在路上的文章 - 知乎 <a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/479784293">https://zhuanlan.zhihu.com/p/479784293</a></p>
<p>本文总结了风控变量开发过程中的一些实践经验。包括：</p>
<ol>
<li><strong>检查数据一致性，确保数据质量</strong>。</li>
<li><strong>设计好整体架构，提高计算效率</strong>。</li>
</ol>
</blockquote>
<p>我们总在说，**数据决定特征的上限，特征决定模型的上限。**风控决策过程中依托大量变量，这些变量从开发到上线的研发流程如下:</p>
<ol>
<li>风控模型同学先基于离线数据源使用Hive SQL挖掘一系列变量，经过建模筛选后将变量需求提给开发同学。</li>
<li>开发同学与模型同学一起核对数据源以及变量实现逻辑，将每个变量用Java代码实现。</li>
<li>在线灰度运行，与离线Hive T+1产出的变量以及模型分数做一致性比对，满足较高的一致性和稳定性后才最终发布。</li>
</ol>
<h3><span id="一-线上线下底层数据一致">一、线上线下底层数据一致</span></h3>
<p>底层数据一致是最根本的要求，其内涵包括两点：</p>
<ul>
<li>线上数据落快照，确保可回溯、不穿越。</li>
<li>线上数据经清洗到线下数据后确保一致。</li>
</ul>
<p><strong>1. 线上数据落快照，确保可回溯、不穿越。</strong></p>
<p>数据资产非常宝贵，一些内部数据早点落快照积累，后期才能进行回溯。在这个过程中，数据穿越问题是最为常见的，其导致的结果是离线分析效果可能很棒，但真正上线后效果一塌糊涂。因此，在做特征变量时都要限制数据采集时间在回溯时点之前。</p>
<p><strong>2. 线上数据经清洗到线下数据后确保一致。</strong></p>
<p><strong>线上数据一般是json这类的半结构化数据，为了离线分析时使用方便，我们通常将其解析为结构化的数据表</strong>。因此，在此转换过程中，有可能会出现字段取值错列、错误等情况，需要进行一致性检查。</p>
<h3><span id="二-离线变量加工注意事项">二、离线变量加工注意事项</span></h3>
<p>在平时业务实践中，我们习惯利用SQL来衍生特征变量，原因在于：</p>
<ul>
<li>SQL可分布式计算，对于海量数据处理上效率更高。</li>
<li>SQL语法较为固定，容易阅读理解；而Python语法灵活，每个人写的代码风格差异很大，较难维护理解。</li>
<li>SQL有大量内置函数（聚合函数、窗口函数等），可省去很多自定义函数的时间。</li>
</ul>
<p>但是，在开发过程中需要注意以下几点：</p>
<p>**1. 检查原始字段的取值类型。**对于字符型变量，直接比较时容易出错，如下所示。例如，字符串类型的1000会比800小。因此，在聚合计算风控变量&quot;最近N个月的最大借款金额&quot;时就会出错。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">spark<span class="operator">-</span><span class="keyword">sql</span><span class="operator">&gt;</span> <span class="keyword">select</span> <span class="string">&#x27;1000&#x27;</span> <span class="operator">&gt;</span> <span class="string">&#x27;800&#x27;</span>;</span><br><span class="line"><span class="literal">false</span></span><br><span class="line"><span class="type">Time</span> taken: <span class="number">3.679</span> seconds, Fetched <span class="number">1</span> <span class="type">row</span>(s)</span><br><span class="line">spark<span class="operator">-</span><span class="keyword">sql</span><span class="operator">&gt;</span> <span class="keyword">select</span> <span class="number">1000</span> <span class="operator">&gt;</span> <span class="number">800</span>;</span><br><span class="line"><span class="literal">true</span></span><br><span class="line"><span class="type">Time</span> taken: <span class="number">0.16</span> seconds, Fetched <span class="number">1</span> <span class="type">row</span>(s)</span><br><span class="line">spark<span class="operator">-</span><span class="keyword">sql</span><span class="operator">&gt;</span> <span class="keyword">select</span> <span class="built_in">cast</span>(<span class="string">&#x27;1000&#x27;</span> <span class="keyword">as</span> <span class="type">int</span>) <span class="operator">&gt;</span> <span class="built_in">cast</span>(<span class="string">&#x27;800&#x27;</span> <span class="keyword">as</span> <span class="type">int</span>);</span><br><span class="line"><span class="literal">true</span></span><br><span class="line"><span class="type">Time</span> taken: <span class="number">0.198</span> seconds, Fetched <span class="number">1</span> <span class="type">row</span>(s)</span><br></pre></td></tr></table></figure>
<p>**2. 检查原始字段的取值范围。**避免想当然地认为，该变量什么含义就&quot;<strong>应该</strong>&quot;是什么取值，或者完全按照编码文档来写逻辑，一切以实际数据为准。包括但不限于：</p>
<ul>
<li>确认字段正常不应该缺失的情况，确认是否实时数据落库过程中清洗所引起的。</li>
<li>从业务上检查字段含义对应的取值范围，确认脏数据该如何清洗。例如，对于日期类变量，其取值可能有如下格式：</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">datetime.datetime.strptime(<span class="type">date</span>, &quot;%Y-%m-%d %H:%M:%S&quot;)</span><br><span class="line">datetime.datetime.strptime(<span class="type">date</span>, &quot;%Y-%m-%d&quot;)</span><br><span class="line">datetime.datetime.strptime(<span class="type">date</span>, &quot;%Y/%m/%d&quot;)</span><br><span class="line">datetime.datetime.strptime(<span class="type">date</span>, &quot;%Y%m%d&quot;)</span><br><span class="line"></span><br><span class="line">spark<span class="operator">-</span><span class="keyword">sql</span><span class="operator">&gt;</span> <span class="keyword">select</span> to_date(<span class="string">&#x27;2022.03.20&#x27;</span>,<span class="string">&#x27;yyyy.MM.dd&#x27;</span>);</span><br><span class="line"><span class="number">2022</span><span class="number">-03</span><span class="number">-20</span></span><br><span class="line"><span class="type">Time</span> taken: <span class="number">0.18</span> seconds, Fetched <span class="number">1</span> <span class="type">row</span>(s)</span><br><span class="line">spark<span class="operator">-</span><span class="keyword">sql</span><span class="operator">&gt;</span> <span class="keyword">select</span> to_date(<span class="string">&#x27;2022/03/20&#x27;</span>,<span class="string">&#x27;yyyy/MM/dd&#x27;</span>);</span><br><span class="line"><span class="number">2022</span><span class="number">-03</span><span class="number">-20</span></span><br><span class="line"><span class="type">Time</span> taken: <span class="number">0.119</span> seconds, Fetched <span class="number">1</span> <span class="type">row</span>(s)</span><br><span class="line">spark<span class="operator">-</span><span class="keyword">sql</span><span class="operator">&gt;</span> <span class="keyword">select</span> to_date(<span class="string">&#x27;20220320&#x27;</span>,<span class="string">&#x27;yyyyMMdd&#x27;</span>);</span><br><span class="line"><span class="number">2022</span><span class="number">-03</span><span class="number">-20</span></span><br><span class="line"><span class="type">Time</span> taken: <span class="number">0.365</span> seconds, Fetched <span class="number">1</span> <span class="type">row</span>(s)</span><br></pre></td></tr></table></figure>
<p>**3. 适当定义一些中间变量。**其好处在于：</p>
<ul>
<li>统一维护映射关系，便于维护修改变量口径；</li>
<li><strong>提高计算效率，一次计算可复用，不必多次重复运算</strong>；</li>
<li>便于代码review，结构层次上更为清晰易懂。</li>
</ul>
<p>中间变量适合需要利用多个字段来定义的场景，或者一个字段需要进行较为复杂的计算。例如：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">case</span> when recall_date &gt; due_date <span class="keyword">and</span> repay_date = due_date then <span class="string">&quot;已到期,正常还款&quot;</span></span><br><span class="line">     when recall_date &gt; due_date <span class="keyword">and</span> repay_date &lt; due_date then <span class="string">&quot;已到期,提前还款&quot;</span></span><br><span class="line">     when recall_date &gt; due_date <span class="keyword">and</span> (repay_date &gt; due_date <span class="keyword">or</span> repay_date <span class="keyword">is</span> null) then <span class="string">&quot;已到期,逾期还款&quot;</span></span><br><span class="line"><span class="keyword">else</span> <span class="string">&quot;未到期&quot;</span> end <span class="keyword">as</span> repay_state -- 还款状态</span><br></pre></td></tr></table></figure>
<p>对于多人协作的项目，需要大家约定好中间变量口径，避免后续整理文档时出现类似的变量多种口径，引起IT同学混淆。</p>
<p><strong>4. 适当制作一些中间表</strong></p>
<p>其作用在于，采取最小可用数据范围原则，减少计算成本。例如：计算借据层面的字段&quot;最近3个月内的借款次数&quot;，只需要用到借据表的信息，并不需要还款计划表的信息。</p>
<p><strong>5. 确认每张表的主键，保证唯一</strong></p>
<p>SQL中常见的聚合函数包括最大值（max）、最小值（min）、平均值（avg）、计数（count）、标准差（std）、累加（sum）。如果数据记录出现重复，虽然不会影响max、min这些操作，但是会影响其他聚合计算的值。因此，在做中间表的过程中需要明确主键，确保group by分组的时候是唯一的。</p>
<p><strong>6. 优化SQL代码，提高运行效率。</strong></p>
<p>例如，count(distinct case when 条件 then xxx else xxx end)操作需要消耗大量资源，可以考虑将when中的条件提前到表的where中，过滤减少数据量，但要注意影响范围，避免误伤到其他变量的计算。</p>
<p><strong>同时，还可以将SQL代码做成工作流（workflow），某些任务可实现并行化运行。</strong></p>
<h3><span id="三-实时变量上线比对验证">三、实时变量上线比对验证</span></h3>
<p>实时变量计算有时效性要求，比如500毫秒内计算出数据。因此，实时变量一般将由IT同学根据文档通过Java开发，在此过程中由于以下原因可能引起变量不一致。</p>
<ul>
<li>离线变量开发口径逻辑，在文档整理过程中的表述歧义。</li>
<li>模型同学和IT同学沟通过程中的理解差异。</li>
<li>Java代码编写过程中存在的Bug。</li>
<li>计算引擎不同所引起的精度差异。</li>
<li>脏数据引起的不一致。</li>
</ul>
<p>为解决SQL离线变量到在线变量之间的翻译工作，目前有相关的实时SQL计算引擎技术，可参考下面这篇：</p>
<p><a href="https://link.zhihu.com/?target=https%3A//mp.weixin.qq.com/s/Rx43XfhgdwerQWLn1eI3Ww">https://link.zhihu.com/?target=https%3A//mp.weixin.qq.com/s/Rx43XfhgdwerQWLn1eI3Ww</a></p>
<p>线上线下变量确保一致是非常重要的。其能保证基于离线批量数据所建立的风控模型和策略规则，在上线后能按照预期的效果生效。如果不一致，将会导致风控系统不可控。例如，离线评估得到的模型分数阈值为低于600分则拒绝，但线上模型总是和离线有偏差，600这个阈值将拒绝更多的用户，导致通过率下降。</p>
<p>模型同学需要和IT同学协调来定位变量问题，整个工作流程图如下所示。可以看到这是一个闭环迭代的过程，如何加快迭代速度成为关键。</p>
<p><img src="https://pic2.zhimg.com/80/v2-ed93dffab2b80d4711f7a330bada6e59_1440w.jpg" alt="img"></p>
<p>变量一致性比对的逻辑很直接，其依赖于测试数据来归纳排查，当两者出现不一致则必有问题。当然，变量的逻辑正确性和取值一致性是两回事，<strong>逻辑正确性需要业务知识来确认，取值一致性需要技术工具来解决</strong>。</p>
<p><strong>为了尽可能提高比对效率，笔者有以下几点建议：</strong></p>
<p>1）<strong>准备足量测试原始数据，以及离线变量取值结果</strong>。在开发过程中准备一批（如1000条）原始数据json，这批数据必须保证和解析到数据库中的表数据是完全一致的。这样可以确保IT同学在写Java的时候，就可自己测试来消除一部分bug，减少后续工作量。</p>
<p>2）**提前准备好相关不一致案例，预约时间集中排查。**定位问题是一个非常耗时的工作，因此和IT同学约定好大片段的时间，提前准备好一些案例来沟通。案例准备过程可以将变量划分类别，聚类治之可极大提高效率。</p>
<p>3）<strong>整理比对所需要的代码脚本，缩短数据准备时间</strong>。比对过程是迭代中完善的，必然需要多轮数据拉取、计算、整理的工作，把这个流程打通形成工作流可加快速度。</p>
<p>在取数得到线上线下数据集后，可根据附录代码计算得到以下比对报告，如图2所示。我们将比对结果分为以下4种情况：</p>
<ul>
<li>有值且一致：有值并且满足精度一致要求</li>
<li><strong>有值不一致：有值但不满足精度一致要求</strong></li>
<li><strong>缺失不一致：其中有一个为nul</strong>l</li>
<li>缺失且一致：两者取值都为null</li>
</ul>
<p>对于情况1）和情况3）则需要查相应案例来定位原因。<strong>小细节往往能发现大问题</strong>，所以不要轻视。</p>
<p><img src="https://pic1.zhimg.com/80/v2-1328321434f790cffff65d6988cbc29c_1440w.jpg" alt="img"></p>
<h3><span id="附录a">附录A</span></h3>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">from</span> tqdm <span class="keyword">import</span> tqdm</span><br><span class="line"><span class="keyword">from</span> multiprocessing.dummy <span class="keyword">import</span> Pool <span class="keyword">as</span> ThreadPool</span><br><span class="line"> </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">compare_online_offline</span>(<span class="params">data_offline,  </span></span><br><span class="line"><span class="params">                           data_online,</span></span><br><span class="line"><span class="params">                           remove_list=[<span class="string">&#x27;order_id&#x27;</span>],</span></span><br><span class="line"><span class="params">                           key_var=<span class="string">&#x27;order_id&#x27;</span>,</span></span><br><span class="line"><span class="params">                           spec_value=<span class="number">0</span>,</span></span><br><span class="line"><span class="params">                           filename=<span class="string">&#x27;report.xlsx&#x27;</span>,</span></span><br><span class="line"><span class="params">                           need_detail=<span class="number">1</span></span>):</span><br><span class="line">    <span class="keyword">import</span> time</span><br><span class="line">    t0 = time.time()</span><br><span class="line">    data_online_new  = data_online.copy()</span><br><span class="line">    data_offline_new = data_offline.copy()</span><br><span class="line">    data_offline_new.columns = [i.lower() <span class="keyword">for</span> i <span class="keyword">in</span> data_offline_new.columns]</span><br><span class="line">    data_online_new.columns  = [i.lower() <span class="keyword">for</span> i <span class="keyword">in</span> data_online_new.columns]</span><br><span class="line">    comp_list = <span class="built_in">list</span>(<span class="built_in">set</span>(data_online_new.columns) &amp; <span class="built_in">set</span>(data_offline_new.columns))  <span class="comment"># 取交集</span></span><br><span class="line">    comp_list = <span class="built_in">sorted</span>(<span class="built_in">list</span>(<span class="built_in">set</span>(comp_list).difference(remove_list)))   <span class="comment"># 比较列</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;比较特征数量为: &#x27;</span> + <span class="built_in">str</span>(<span class="built_in">len</span>(comp_list)))</span><br><span class="line">    num_varlist = <span class="built_in">list</span>(<span class="built_in">set</span>(data_online_new[comp_list].select_dtypes(exclude=[<span class="string">&#x27;object&#x27;</span>,<span class="string">&#x27;datetime&#x27;</span>]).columns))</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">compare</span>(<span class="params">x1, x2, vartype</span>):</span><br><span class="line">        <span class="keyword">if</span> pd.notna(x1) <span class="keyword">and</span> pd.notna(x2):</span><br><span class="line">            <span class="keyword">if</span> vartype == <span class="string">&#x27;numeric&#x27;</span>:</span><br><span class="line">                <span class="keyword">return</span> <span class="number">1</span> <span class="keyword">if</span> <span class="built_in">abs</span>(x1 - x2) &lt; <span class="number">0.001</span> <span class="keyword">else</span> <span class="number">2</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="keyword">return</span> <span class="number">1</span> <span class="keyword">if</span> x1 == x2 <span class="keyword">else</span> <span class="number">2</span></span><br><span class="line">        <span class="keyword">else</span>:  </span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> pd.notna(x1) <span class="keyword">and</span> <span class="keyword">not</span> pd.notna(x2):</span><br><span class="line">                <span class="keyword">return</span> <span class="number">3</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="keyword">return</span> np.nan</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">stat</span>(<span class="params">var</span>):</span><br><span class="line">        df = pd.merge(data_offline_new[[key_var,var]], data_online_new[[key_var,var]], on=key_var, how=<span class="string">&#x27;inner&#x27;</span>)</span><br><span class="line">        df.columns = [key_var, var+<span class="string">&#x27;_offline&#x27;</span>, var+<span class="string">&#x27;_online&#x27;</span>] </span><br><span class="line">        total = df.shape[<span class="number">0</span>]</span><br><span class="line">        miss_offline = df[var+<span class="string">&#x27;_offline&#x27;</span>].isnull().<span class="built_in">sum</span>()</span><br><span class="line">        miss_online  = df[var+<span class="string">&#x27;_online&#x27;</span>].isnull().<span class="built_in">sum</span>()</span><br><span class="line">        spec_offline = <span class="built_in">sum</span>(df[var+<span class="string">&#x27;_offline&#x27;</span>] == spec_value)</span><br><span class="line">        spec_online  = <span class="built_in">sum</span>(df[var+<span class="string">&#x27;_online&#x27;</span>] == spec_value)</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span>  var <span class="keyword">in</span> num_varlist:   </span><br><span class="line">            mean_offline = df[var+<span class="string">&#x27;_offline&#x27;</span>].mean()</span><br><span class="line">            mean_online  = df[var+<span class="string">&#x27;_online&#x27;</span>].mean()</span><br><span class="line">            df[var+<span class="string">&#x27;_same&#x27;</span>] = df.apply(<span class="keyword">lambda</span> row: compare(row[var+<span class="string">&#x27;_offline&#x27;</span>], row[var+<span class="string">&#x27;_online&#x27;</span>], <span class="string">&#x27;numeric&#x27;</span>), axis=<span class="number">1</span>) </span><br><span class="line">            value_same = df[df[var+<span class="string">&#x27;_same&#x27;</span>]==<span class="number">1</span>].shape[<span class="number">0</span>] <span class="comment"># 有值并且满足精度一致要求</span></span><br><span class="line">            value_diff = df[df[var+<span class="string">&#x27;_same&#x27;</span>]==<span class="number">2</span>].shape[<span class="number">0</span>] <span class="comment"># 有值但不满足精度一致要求</span></span><br><span class="line">        <span class="keyword">else</span>: </span><br><span class="line">            mean_offline = np.nan</span><br><span class="line">            mean_online = np.nan</span><br><span class="line">            df[var+<span class="string">&#x27;_same&#x27;</span>] = df.apply(<span class="keyword">lambda</span> row: compare(row[var+<span class="string">&#x27;_offline&#x27;</span>], row[var+<span class="string">&#x27;_online&#x27;</span>], <span class="string">&#x27;string&#x27;</span>), axis=<span class="number">1</span>)</span><br><span class="line">            value_same = df[df[var+<span class="string">&#x27;_same&#x27;</span>]==<span class="number">1</span>].shape[<span class="number">0</span>] <span class="comment"># 有值并且相同</span></span><br><span class="line">            value_diff = df[df[var+<span class="string">&#x27;_same&#x27;</span>]==<span class="number">2</span>].shape[<span class="number">0</span>] <span class="comment"># 有值但是不同</span></span><br><span class="line"></span><br><span class="line">        miss_same = df[df[var+<span class="string">&#x27;_same&#x27;</span>]==<span class="number">3</span>].shape[<span class="number">0</span>] <span class="comment"># 两者取值都为null</span></span><br><span class="line">        miss_diff = df[var+<span class="string">&#x27;_same&#x27;</span>].isnull().<span class="built_in">sum</span>()  <span class="comment"># 其中有一个为null</span></span><br><span class="line">        total_same = value_same + miss_same         <span class="comment"># 两者完全相同   </span></span><br><span class="line">        df[var+<span class="string">&#x27;_same&#x27;</span>] = df[var+<span class="string">&#x27;_same&#x27;</span>].apply(<span class="keyword">lambda</span> x: <span class="number">1</span> <span class="keyword">if</span> x <span class="keyword">in</span> [<span class="number">1</span>,<span class="number">3</span>] <span class="keyword">else</span> <span class="number">0</span>)</span><br><span class="line">        <span class="keyword">return</span> [var, total, miss_offline, miss_online, mean_offline, mean_online, </span><br><span class="line">                value_diff, value_same, miss_diff, miss_same, total_same, spec_offline, spec_online, df]</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 启动多线程</span></span><br><span class="line">    pool = ThreadPool(<span class="number">10</span>)</span><br><span class="line">    stat_list = pool.<span class="built_in">map</span>(stat, comp_list)</span><br><span class="line">    pool.close()</span><br><span class="line">    pool.join()</span><br><span class="line"></span><br><span class="line">    final_cols = [<span class="string">&#x27;var&#x27;</span>,<span class="string">&#x27;total&#x27;</span>,<span class="string">&#x27;miss_offline&#x27;</span>,<span class="string">&#x27;miss_online&#x27;</span>,<span class="string">&#x27;mean_offline&#x27;</span>,<span class="string">&#x27;mean_online&#x27;</span>,</span><br><span class="line">                  <span class="string">&#x27;value_diff&#x27;</span>,<span class="string">&#x27;value_same&#x27;</span>,<span class="string">&#x27;miss_diff&#x27;</span>,<span class="string">&#x27;miss_same&#x27;</span>,<span class="string">&#x27;total_same&#x27;</span>,<span class="string">&#x27;spec_offline&#x27;</span>,<span class="string">&#x27;spec_online&#x27;</span>]</span><br><span class="line">    stat_arr = [x[:-<span class="number">1</span>] <span class="keyword">for</span> x <span class="keyword">in</span> stat_list]</span><br><span class="line">    df_stat = pd.DataFrame(stat_arr, columns=final_cols)</span><br><span class="line">    df_stat[<span class="string">&#x27;miss_del&#x27;</span>] = df_stat[<span class="string">&#x27;miss_offline&#x27;</span>] - df_stat[<span class="string">&#x27;miss_online&#x27;</span>]</span><br><span class="line">    df_stat[<span class="string">&#x27;mean_del&#x27;</span>] = df_stat[<span class="string">&#x27;mean_offline&#x27;</span>] - df_stat[<span class="string">&#x27;mean_online&#x27;</span>]</span><br><span class="line">    df_stat[<span class="string">&#x27;same_rate&#x27;</span>] = df_stat[<span class="string">&#x27;total_same&#x27;</span>] / df_stat[<span class="string">&#x27;total&#x27;</span>]</span><br><span class="line">    df_report = df_stat[[<span class="string">&#x27;var&#x27;</span>,<span class="string">&#x27;total&#x27;</span>,<span class="string">&#x27;miss_offline&#x27;</span>,<span class="string">&#x27;miss_online&#x27;</span>,<span class="string">&#x27;miss_del&#x27;</span>,<span class="string">&#x27;mean_offline&#x27;</span>,<span class="string">&#x27;mean_online&#x27;</span>,<span class="string">&#x27;mean_del&#x27;</span>,</span><br><span class="line">                         <span class="string">&#x27;value_diff&#x27;</span>,<span class="string">&#x27;value_same&#x27;</span>,<span class="string">&#x27;miss_diff&#x27;</span>,<span class="string">&#x27;miss_same&#x27;</span>,<span class="string">&#x27;total_same&#x27;</span>,<span class="string">&#x27;same_rate&#x27;</span>,<span class="string">&#x27;spec_offline&#x27;</span>,<span class="string">&#x27;spec_online&#x27;</span>]]</span><br><span class="line">    df_report.columns = [<span class="string">&#x27;变量名&#x27;</span>,<span class="string">&#x27;比较数&#x27;</span>,<span class="string">&#x27;离线缺失&#x27;</span>,<span class="string">&#x27;在线缺失&#x27;</span>,<span class="string">&#x27;离线-在线缺失&#x27;</span>,<span class="string">&#x27;离线均值&#x27;</span>,<span class="string">&#x27;在线均值&#x27;</span>,<span class="string">&#x27;离线-在线均值&#x27;</span>,</span><br><span class="line">                         <span class="string">&#x27;有值不一致&#x27;</span>,<span class="string">&#x27;有值一致量&#x27;</span>,<span class="string">&#x27;缺失不一致&#x27;</span>,<span class="string">&#x27;缺失一致量&#x27;</span>,<span class="string">&#x27;一致量&#x27;</span>,<span class="string">&#x27;一致率&#x27;</span>,<span class="string">&#x27;离线特殊值数&#x27;</span>,<span class="string">&#x27;在线特殊值数&#x27;</span>]</span><br><span class="line">    df_report = df_report.sort_values(by=[<span class="string">&#x27;一致率&#x27;</span>], ascending=<span class="number">1</span>)</span><br><span class="line">    df_report.to_excel(filename, index=<span class="number">0</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;对比报告保存在%s&#x27;</span> % filename)</span><br><span class="line">    t1 = time.time()</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;耗时%s分钟&#x27;</span> % <span class="built_in">int</span>((t1-t0)/<span class="number">60</span>))</span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;拼接明细...&#x27;</span>)</span><br><span class="line">    df_detail = pd.DataFrame(data_offline_new[key_var], columns=[key_var])</span><br><span class="line">    <span class="keyword">if</span> need_detail:</span><br><span class="line">       df_list = [x[-<span class="number">1</span>] <span class="keyword">for</span> x <span class="keyword">in</span> stat_list]</span><br><span class="line">       <span class="keyword">for</span> i <span class="keyword">in</span> tqdm(<span class="built_in">range</span>(<span class="built_in">len</span>(df_list))):</span><br><span class="line">           df_detail = pd.merge(df_detail, df_list[i], on=key_var)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> df_report, df_detail</span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://powerlzy.github.io/posts/2ZK2C8F/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/cat_mac.jpg">
      <meta itemprop="name" content="lzy">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="PowerLZY's Blog">
      <meta itemprop="description" content="相比到达的地方，同行的人更重要！">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | PowerLZY's Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/posts/2ZK2C8F/" class="post-title-link" itemprop="url">风控算法（4）特征工程-时序数据与特征工程</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2022-07-01 19:33:41" itemprop="dateCreated datePublished" datetime="2022-07-01T19:33:41+08:00">2022-07-01</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2023-04-19 17:13:22" itemprop="dateModified" datetime="2023-04-19T17:13:22+08:00">2023-04-19</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E3%80%90draft%E3%80%91%E5%BA%94%E7%94%A8/" itemprop="url" rel="index"><span itemprop="name">【draft】应用</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E3%80%90draft%E3%80%91%E5%BA%94%E7%94%A8/%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF/" itemprop="url" rel="index"><span itemprop="name">应用场景</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E3%80%90draft%E3%80%91%E5%BA%94%E7%94%A8/%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF/%E4%B8%9A%E5%8A%A1%E5%AE%89%E5%85%A8/" itemprop="url" rel="index"><span itemprop="name">业务安全</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>2.5k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>5 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2><span id="特征工程-时序数据与特征工程">特征工程-时序数据与特征工程</span></h2>
<blockquote>
<p>信贷时序数据与特征工程介绍 - 求是汪在路上的文章 - 知乎 <a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/397614923">https://zhuanlan.zhihu.com/p/397614923</a></p>
</blockquote>
<h3><span id="引言">引言</span></h3>
<p><strong>无论是模型还是策略，其遵循的方法论都是“发现问题-&gt;确定目标-&gt;分析原因-&gt;寻找抓手-&gt;上线应对”这样一个闭环</strong>。对于模型岗而言，<strong><font color="red"> 其核心KPI是提供具有良好排序能力的模型。而特征工程是提高模型区分度的最有效途径，决定了模型拟合的上限。</font></strong></p>
<p>信贷业务流程中积累了很多时间序列数据。因此，<strong>本文将介绍如何利用时序数据来构建常见的特征</strong>。同时，为兼顾实践性，本文附上了一些特征的SQL实现逻辑，供参考。</p>
<h3><span id="一-信贷时序行为数据">一、<strong>信贷时序行为数据</strong></span></h3>
<p>信贷业务经营中会积累很多时间序列数据。例如，<strong>客户的APP登录行为埋点数据、借款申请行为记录数据、还款行为数据、调额记录数据等</strong>。根据是否在平台内部沉淀，这些数据又可分为内部和外部数据。</p>
<h4><span id="11-内部数据">1.1 <strong>内部数据</strong></span></h4>
<p>以借款、还款行为数据为例，需要明确几个最细的时间粒度，包括：</p>
<ul>
<li>借款时点（draw_date）：客户借款申请时点。</li>
<li>应还时点（due_date）：约定还款时间，固定不变。</li>
<li>实还时点（settle_date）：客户实际还款时间，若早于应还日，称提前还款；若晚于应还时点，则成为逾期（overdue）；若在应还日当天还款，则为正常还款。</li>
</ul>
<p>独立来看，每个时点的数据都具有不同的信息。对于借据而已，具有以下属性：</p>
<p><img src="https://pic4.zhimg.com/80/v2-bd57625dec1cdc547dc81c05796912d3_1440w.jpg" alt="img"></p>
<p>因此，从借款订单数据入手，其可反映客户的额度使用率、借款金额变化、借款时间集中度等信息。</p>
<p>如图2所示，当把这些时点线索交叉在一起，就会衍生出大量信息。例如：</p>
<ul>
<li><strong>结合应还时点和实还时点，可刻画客户历史上的还款行为，包括逾期、提前还款、正常还款</strong>。——由此可构建“过去一段时间内，<strong>逾期/提前还款/正常还款次数</strong>”这类特征。</li>
<li>结合应还时点和借款时点，如果客户在某个应还时点前多次发起借款申请，那么很可能是在“借新还旧”。——由此可构建“过去一段时间内，应还日前借款次数”这类特征。</li>
<li>结合逾期时点和借款时点，如果客户当前处于逾期状态，则新申请借款则可直接拒绝，或者提前管制客户。</li>
</ul>
<p><img src="https://pic4.zhimg.com/80/v2-45b5c68a863deaf80abafc882e3c3703_1440w.jpg" alt="img"></p>
<h4><span id="12-外部数据">1.2 外部数据</span></h4>
<p>客户不仅会在本平台内借款，当无法满足其借款需求时，其也会在其他平台借款，由此形成了多头借款行为数据。这是一块非常宝贵的数据。</p>
<p>在《<a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/109649516">求是汪在路上：多头借贷风险分析与建模</a>》一文中，我们介绍过多头数据的相关知识。整合目前市场上数据商提供的多头数据，我们可分解为以下结构：</p>
<img src="https://pic3.zhimg.com/80/v2-bf2f245a96e5f359e82901341f3cae2e_1440w.jpg" alt="img" style="zoom:50%;">
<p>在本文中，先构造一些假数据用以后续衍生特征。可通过以下SQL语句建表，并插入数据。</p>
<h3><span id="二-行为特征衍生思路">二、<strong>行为特征衍生思路</strong></span></h3>
<p>如果拥有这样的数据，你会如何构建特征？通常做法是取最近一段时间窗口（比如最近12个月），在这段时间内，我们可以从以下维度来统计出可累加的指标：</p>
<ul>
<li><strong>指标维度</strong>：金额、次数、笔数、天数、机构数、人数</li>
<li><strong>时间粒度</strong>：日、周、月</li>
<li><strong>聚合函数</strong>：计数（count），求和（sum）</li>
</ul>
<p>为什么要是可累加的呢？这是因为我们可以再次聚合，并且后续计算<strong>比例类特征</strong>时方便。由此，可得到如图5所示的时序数据：</p>
<img src="https://pic3.zhimg.com/80/v2-68035afb016202fe873d761ce4ecd3ee_1440w.jpg" alt="img" style="zoom: 67%;">
<p>在《<a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/85440355">求是汪在路上：风控特征—时间滑窗统计特征体系</a>》中，介绍过RFM特征体系的概念。</p>
<ul>
<li><strong>R（Recency）</strong>：<strong>客户最近一次交易消费时间的间隔</strong>。R值越大，表示客户交易发生的日期越久，反之则表示客户交易发生的日期越近。</li>
<li><strong>F（Frequency）</strong>：<strong>客户在最近一段时间内交易消费的次数</strong>。F值越大，表示客户交易越频繁，反之则表示客户交易不够活跃。</li>
<li><strong>M（Monetary）</strong>：<strong>客户在最近一段时间内交易消费的金额</strong>。M值越大，表示客户价值越高，反之则表示客户价值越低。</li>
</ul>
<p><strong>在RFM特征体系的基础上，我们进一步扩展维度</strong>。至少能从图5中捕捉到以下信息：</p>
<p><strong>1）常规统计特征</strong></p>
<p>把客户行为按最小时间粒度统计完毕后，我们就会得到一个分布。接下来则是利用统计函数**最大值（MAX）、最小值（MIN）、平均值（AVG）、标准差（STD）**来描述以上分布特征。</p>
<p>但是，这些指标在统计时只能对给定的数据集合计算，没有考虑到时间序列变化信息。换言之，什么时间段在持续上升，什么时间段在持续下降，什么时间段断档形成空窗期，这些信息都被掩盖了。</p>
<p><strong>2）时间距离特征</strong></p>
<p>用以刻画客户最远一次、最近一次或者某个特殊事件发生的时点。例如：</p>
<ul>
<li>最近一次申请日距离观察点的日期差（天数）</li>
<li>最近一次取到最大值、最小值的事件时点距离观察点的日期差（天数）</li>
<li>最近一次逾期距离观察点的日期差（天数）</li>
</ul>
<p><strong>3）行为波动特征</strong></p>
<p>用以刻画客户某段连续时间内的行为变化特征。例如：</p>
<ul>
<li>最长持续上升（或下降）的时间跨度（天数）。</li>
<li>最长睡眠期（天数）。即，客户多久没有活跃了？</li>
<li>连续行为窗口出现次数。</li>
</ul>
<p>**在信贷风控中，变化趋势是衡量风险非常重要的维度。我们喜欢稳定，但是风险天生具有易变性，当有变化的趋势就意味着风险，也意味着机遇。**例如，当客户近期在行业内借款申请次数在上升时，我们就可以判断客户资金紧张，故而在到处借钱。那么，我们需要思考：</p>
<ol>
<li>业务侧：客户是否因为我们的额度不够，无法满足其资金需求而跑到其他平台借款？出于余额增长的目标，我们能不能给客户提额呢？</li>
<li>风险侧：该客户的还款能力是否出现问题？我们给他放开额度后，我们能否承受风险？那么我们就需要给客户打一下风险分，判断客户风险。</li>
</ol>
<p>为捕捉客户行为变化趋势，我们可以用一种简单的方法：<strong>最近N个月次数 / 最近M个月次数（N &lt; M）</strong>。例如，多头变量中，该值越高，说明借款申请记录更为集中在近期。一般来说，近期行为对于识别短期欺诈风险更有用，远期行为对于识别长期信用风险更有用。</p>
<p><strong>4）集中度特征</strong></p>
<p><strong>用以刻画客户行为的偏好程度</strong>。如果说时间维度是纵向视角，那么集中度特征则是横截面视角。通常以比例特征形式出现。例如：</p>
<ul>
<li>一天内集中于哪个时间段活动？</li>
<li>借款机构中集中于哪些机构？</li>
<li>借款金额倾向于什么数目（例如1K以内，1K-5K，5K以上）？</li>
<li>购买的商品内集中于买什么品类？</li>
</ul>
<h3><span id="四-其他算法实现思路">四、<strong>其他算法实现思路</strong></span></h3>
<p>前面都是从业务领域知识先入手，分析潜在有用的变量逻辑，再去实现。这是平时大部分模型师所做的事情。但目前也有一些尝试用LSTM、RNN来处理时序数据的技术方案。这是后续可尝试探索和对比的方向。</p>
<p><img src="https://lzy-picture.oss-cn-beijing.aliyuncs.com/img/202304191712092.jpg" alt="img"></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://powerlzy.github.io/posts/29K9TF6/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/cat_mac.jpg">
      <meta itemprop="name" content="lzy">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="PowerLZY's Blog">
      <meta itemprop="description" content="相比到达的地方，同行的人更重要！">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | PowerLZY's Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/posts/29K9TF6/" class="post-title-link" itemprop="url">风控算法（2）风控模型-开发流程标准化*</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2022-07-01 19:28:02" itemprop="dateCreated datePublished" datetime="2022-07-01T19:28:02+08:00">2022-07-01</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2022-07-09 18:14:42" itemprop="dateModified" datetime="2022-07-09T18:14:42+08:00">2022-07-09</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E3%80%90draft%E3%80%91%E5%BA%94%E7%94%A8/" itemprop="url" rel="index"><span itemprop="name">【draft】应用</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E3%80%90draft%E3%80%91%E5%BA%94%E7%94%A8/%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF/" itemprop="url" rel="index"><span itemprop="name">应用场景</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E3%80%90draft%E3%80%91%E5%BA%94%E7%94%A8/%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF/%E4%B8%9A%E5%8A%A1%E5%AE%89%E5%85%A8/" itemprop="url" rel="index"><span itemprop="name">业务安全</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>8.9k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>16 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1><span id="风控模型">风控模型</span></h1>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/109649516">求是汪在路上：多头借贷风险分析与建模</a></p>
<p><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/252845718">求是汪在路上：抽样对Lift和KS指标的影响</a></p>
<p><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/161009991">求是汪在路上：客户级通用信用评分模型架构设计</a></p>
<p><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/90214329">求是汪在路上：大数据信贷风控模型架构</a></p>
<p><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/90251922">求是汪在路上：<strong><font color="red"> 风控模型开发流程标准化</font></strong></a></p>
<p><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/92691256">求是汪在路上：风控模型上线部署流程</a></p>
<p><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/350616539">求是汪在路上：如何量化样本偏差对信贷风控模型的影响</a></p>
<p><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/110982479">求是汪在路上：<strong><font color="red"> 样本权重对逻辑回归评分卡的影响探讨</font></strong></a></p>
<p><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/85976154">求是汪在路上：利用样本分群提升风控模型性能</a></p>
</blockquote>
<h2><span id="一-风控模型开发流程标准化">一、风控模型开发流程标准化</span></h2>
<h3><span id="风控业务背景"><strong>风控业务背景</strong></span></h3>
<p>在大型风控建模项目中，模型开发阶段实际上只占其中很小的一部分，我们常把大量精力投入在数据准备、特征工程、模型设计等阶段。同时，开发阶段所用方法重复性相对较高。如果将其模块化封装，可大大提高建模效率。Don‘t repeat yourself！</p>
<p><img src="https://pic2.zhimg.com/80/v2-ca4ae4880f0369cdfd03bfa3b97cba81_1440w.jpg" alt="img"></p>
<p>本文主要内容在于：</p>
<ol>
<li>理论角度，系统阐述了风控模型开发流程，以及相应的理论依据。</li>
<li>实践角度，整理了目前一些开源工具包，可供大家自行选择使用。</li>
</ol>
<h3><span id="11-风控模型开发流程标准化的意义"><strong>1.1 风控模型开发流程标准化的意义</strong></span></h3>
<p>在《<a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/90214329">大数据信贷风控模型架构</a>》一文中，我们系统探讨了大数据风控模型架构的优缺点。从该架构出发，基于历次大型模型开发项目实践，我们往往会发现存在以下问题：</p>
<ol>
<li>各建模同学的工程能力存在差异，无法保证所有人都有代码优化及debug的能力。</li>
<li>整个流程不规范统一，某些同学不清楚基础指标函数的底层逻辑，出现问题难以定位。</li>
<li>浪费大量时间用于协调沟通，尤其是过程文档记录参差不齐，无法复现。</li>
<li><strong>建模脚本可能存在多个版本，模型版本管理困难</strong>。</li>
</ol>
<p>风控模型开发流程标准化的意义在于：</p>
<ol>
<li>提高建模效率：可批量快速生产模型，保证项目按期完成，同时让建模同学更有精力关注模型优化分析等复杂工作。</li>
<li>理解计算逻辑：帮助团队更为深刻理解各类评估指标背后的业务含义，便于调试优化。</li>
<li><strong>统一建模流程</strong>：约定命名方式。保证在分工协作的情况下，模型开发文档更容易整合汇总，便于Review。</li>
<li>流程规范约束：减少建模同学（尤其是新手）出错的概率，降低返工可能，并记录必要的中间过程，便于问题回溯。</li>
</ol>
<p>由于经常需要跨时间窗来分析变量，我们约定以下名词：</p>
<ul>
<li><strong>样本集</strong>：训练集（In the Sample，INS）、验证集（Out of Sample，OOS）、测试集（Out of Time，OOT）</li>
<li><strong>自然月</strong>：由于风控领域中样本相对较少，一般按月粒度来观察。对于某段时间内的样本，我们也称为cohort或vintage。通俗而言，就是一个批次（batch）。</li>
</ul>
<h3><span id="12-功能模块-探索性数据分析"><strong>1.2 功能模块 - 探索性数据分析</strong></span></h3>
<p><strong>探索性数据分析（Exploratory Data Analysis，EDA）用于初步检验数据质量，因此需要计算各类数据特征指标。</strong></p>
<blockquote>
<ul>
<li>探索数据分布（Exploratory Data Distribution，EDD）</li>
<li>缺失率（Missing Rate）</li>
<li>重复值（Duplicate Value）</li>
<li>单一值（Unique Value）</li>
<li>其他数据质量检查（Quality Check）</li>
</ul>
</blockquote>
<h4><span id="121-探索数据分布exploratory-data-distributionedd">1.2.1 探索数据分布（Exploratory Data Distribution，EDD）</span></h4>
<p><strong>功能</strong>：按自然月/样本集维度，统计变量的数据分布。</p>
<p><strong>指标</strong>：</p>
<ul>
<li>连续型变量，包括：数量(count)、均值(mean)、标准差(std)、最小值(min)、分位数P25、P50、P75、最大值(max)。其中，最大值和最小值可用来观察异常值（outlier）。</li>
<li>离散型变量，包括：取值及出现次数(cnt)、占比(ratio)。</li>
</ul>
<p><strong>示例</strong>：连续变量数据分布（月维度)、离散变量数据分布</p>
<p><img src="https://pic3.zhimg.com/80/v2-8f7ad96d18789094dab9090cf551a81e_1440w.jpg" alt="img"></p>
<p><img src="https://pic4.zhimg.com/80/v2-0b97ea436eb6156939e74bf5126ae3d3_1440w.jpg" alt="img"></p>
<ul>
<li><strong>业务含义</strong>：基于“<strong>历史与未来样本分布相同</strong>”的建模假设，我们才能基于历史数据拟合X和Y之间的关系来预测未来。因此，在变量分布上，首先需要保证这一点。</li>
</ul>
<p>从图1中，我们可以观察分位数的变化差异。例如，变量 <img src="https://www.zhihu.com/equation?tex=x_2" alt="[公式]"> 在2018年1月时最大值异常，其余月份均正常。此时，我们就需要检查：数据源是否存在问题？变量回溯过程是否出错？</p>
<h4><span id="122-缺失率missing-rate">1.2.2 <strong>缺失率（Missing Rate）</strong></span></h4>
<p>功能：<strong>按自然月/样本集维度，统计变量的缺失率。</strong></p>
<p>指标：缺失率 = 未覆盖样本数 / 总样本数 × 100%</p>
<p><img src="https://pic2.zhimg.com/80/v2-32d1ec1106b1e58cfcd2ecfe7b0040b5_1440w.jpg" alt="img"></p>
<p>业务：</p>
<ul>
<li>用于分析数据源的缺失率，以及未来的采集率趋势。如果缺失率持续升高，我们就认为这块数据不可用。</li>
<li>造成缺失的原因多种多样，可分为随机缺失和非随机缺失。例如，如果是用户自填信息，用户主观不愿意填写而导致数据缺失，属于非随机缺失。</li>
</ul>
<h4><span id="123-重复值duplicate-value">1.2.3 <strong>重复值（Duplicate Value）</strong></span></h4>
<p>功能：检验建模样本中是否有重复数据。</p>
<p>指标：按样本ID分组后，统计行数</p>
<p><img src="https://pic1.zhimg.com/80/v2-2c3cd4f809b68e130f4d6edba31058b8_1440w.jpg" alt="img"></p>
<p>业务：观察相同订单的特征变量取值是否一致。取值相同，只需简单去重；否则，说明生成逻辑有误，需检查SQL逻辑。</p>
<h4><span id="124-单一值unique-value">1.2.4  <strong>单一值（Unique Value）</strong></span></h4>
<p>功能：统计变量中某一固定值的占比。</p>
<p>指标：变量每个取值的出现次数。</p>
<p>示例：变量中0的取值占到70%.</p>
<p><strong>业务：如果变量取值中某一固定值占比很高，那么该变量区别度往往很低。通常，单一值比例超过90%以上，建议删除该变量。</strong></p>
<h4><span id="125-其他数据质量检查qc"><strong>1.2.5 其他数据质量检查（QC）</strong></span></h4>
<p>变量取值本身具有某些业务含义，我们需要结合业务来检验，并记录归档。例如：</p>
<ul>
<li>特殊值归档说明：例如-9999999是代表缺失，还是其他含义，需给出描述说明。</li>
<li>0的业务逻辑确认：真实值为0？数据缺失？默认填充值？</li>
</ul>
<h3><span id="13-功能模块-特征选择">1.3 <strong>功能模块 - 特征选择</strong></span></h3>
<p>根据RFM特征体系，我们可以构造成千上万个特征变量（参考《<a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/85440355">风控特征—时间滑窗统计特征体系</a>》）。但是，这些变量并不都满足我们的要求，<strong><font color="red"> 我们需要剔除不符合要求的变量，从输入上保证风控系统的鲁棒性。</font></strong></p>
<p>变量筛选（selection）是一个比较复杂的精细活，需要考虑很多因素，比如：<strong>预测能力、相关性、稳定性、合规性、业务可解释性</strong>等等。考虑不同维度，我们会依据一系列指标进行变量筛选。</p>
<p>从广义上，可分为业务指标和技术指标两大类。</p>
<h4><span id="131-业务指标包括">1.3.1 <strong>业务指标</strong>包括：</span></h4>
<ol>
<li><strong>合规性(compliant)</strong>：用以加工变量的数据源是否符合国家法律法规？是否涉及用户隐私数据？例如，如果某块爬虫数据被监管，那么相关变量的区分度再好，我们也只能弃用。而在国外，种族、性别、宗教等变量被禁止用于信贷风控中，这会存在歧视性。</li>
<li><strong>可得性(available)</strong>：数据未来是否能继续采集？这就涉及产品流程设计、用户授权协议、合规需求、模型应用环节等诸多方面。例如，如果产品业务流程改动而导致某个埋点下线，那么相关埋点行为变量只能弃用。又比如，如果需要做额度授信模型，那么只能利用在额度阶段能采集到的实时数据，这就需要提前确认数据采集逻辑。</li>
<li><strong>稳定性(stable)</strong>：一方面，数据源采集稳定是变量稳定性的基本前提。例如，外部数据常会因为政策性、技术性等原因导致接入不稳定，这就需要做好数据缓存，或者模型降级机制。另一方面，变量取值分布变化是导致不稳定的直接原因。我们将会采取一些技术指标展开分析，下文将会介绍。</li>
<li><strong>可解释性(interpretable)</strong>：需要符合业务可解释性。如果变量的业务逻辑不清晰，那么我们宁可弃之。同时，这也是保证模型可解释性（参数 + 变量）的前提。</li>
<li><strong>逻辑性(logical)</strong>：也就是因果逻辑，特征变量是因，风控决策是果。如果某个变量是风控系统决策给出的，那么我们就不能入模。例如，用户历史申贷订单的利率是基于上一次风控系统决策的结果，如果将“用户历史申贷订单的利率”作为变量，那么在实际使用时就会有问题。</li>
<li><strong>可实时上线</strong>：模型最终目的是为了上线使用。如果实时变量不支持加工，那么对应的离线变量就只能弃之。例如，某个离线变量在统计时限定观察期为180天，但线上只支持观察期为90天，那么就不可用。对于不熟悉线上变量加工逻辑的新手，往往容易踩坑而导致返工。</li>
</ol>
<h4><span id="132-技术指标包括">1.3.2 <strong>技术指标</strong>包括：</span></h4>
<blockquote>
<p>基于缺失率（Missing Rate）<br>
基于变异系数（Coefficient of Variation，CV）<br>
基于稳定性（Population Stability Index，PSI）<br>
基于信息量（Information Value，IV）<br>
基于RF/XGBoost特征重要性（Feature Importance）<br>
变量聚类（Variable Cluster，VarClus）<br>
基于线性相关性（Linear Correlation）<br>
基于多重共线性（Multicollinearity）<br>
基于逐步回归（stepwise)<br>
基于P-Vaule显著性检验</p>
</blockquote>
<ul>
<li><strong>基于缺失率（Missing Rate）</strong></li>
</ul>
<p>**业务：**变量缺失率越高，可利用价值越低。缺失率变化不稳定的变量，尤其是缺失率趋势在升高，代表未来数据源采集率下降，不建议采用。数据源是特征变量的基础，数据源不稳定，直接导致模型稳定性变差。</p>
<h5><span id="功能">功能：</span></h5>
<blockquote>
<p>step 1. 按自然月/样本集维度，统计变量缺失率，并计算缺失率的均值、标准差。<br>
step 2. 根据实际场景，设置阈值（如50%、70%、90%）进行筛选。</p>
</blockquote>
<p><img src="https://pic4.zhimg.com/80/v2-d432f6c6916a4e94b698d325ce9d32b7_1440w.jpg" alt="img"></p>
<ul>
<li><strong>基于变异系数（Coefficient of Variation，CV）</strong></li>
</ul>
<p><strong>业务</strong>：变异系数越小，代表波动越小，稳定性越好。缺点在于CV没有统一的经验标准。</p>
<p><strong>功能</strong>：</p>
<blockquote>
<p>step 1. 基于数据分布EDD，选择某个指标（如均值mean）计算变异系数CV，用来衡量变量分布的稳定性。<br>
step 2. 设置阈值进行筛选。</p>
</blockquote>
<p><strong>指标</strong>：变异系数 C·V =（ 标准偏差 SD / 平均值Mean ）× 100%</p>
<ul>
<li><strong>基于稳定性（Population Stability Index，PSI）</strong></li>
</ul>
<p><strong>业务</strong>：需分申请层、放款层，分别评估变量稳定性。通常会选择0.1作为阈值，只要任意一个不满足稳定性要求就弃用。PSI无法反映很多细节原因，比如分布是右偏还是左偏。此时需要从EDD上进行分析。</p>
<p><img src="https://pic3.zhimg.com/80/v2-330e33c4f93c5abef39854964f780d5a_1440w.png" alt="img"></p>
<p><strong>功能</strong>：</p>
<blockquote>
<p>step 1. 以训练集（INS）分布为期望分布，计算变量的群体稳定性指标PSI。<br>
step 2. 根据PSI的经验阈值进行筛选。</p>
</blockquote>
<p><strong>指标</strong>： <img src="https://www.zhihu.com/equation?tex=psi+%3D+%5Csum_%7Bi%3D1%7D%5E%7Bn%7D%7B%28A_i+-+E_i%29%7D+%2A+ln%28A_i+%2F+E_i%29" alt="[公式]"></p>
<p>上式含义为：PSI = SUM( (实际占比 - 预期占比）* ln(实际占比 / 预期占比) );预期占比是指训练集上每个分箱里的样本占比，实际占比是待比较样本集的每个分箱里的样本占比。可参考《<a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/79682292">群体稳定性指标(PSI)深入理解应用</a>》。</p>
<p><img src="https://pic3.zhimg.com/80/v2-c9cb1ae5f72f2f6c5dfcb54486f23182_1440w.jpg" alt="img"></p>
<ul>
<li>==<strong>基于信息量（Information Value，IV）</strong>==</li>
</ul>
<p><strong>业务</strong>：<strong>用以评估变量的预测能力</strong>。通常情况下，IV越高，预测能力越强。但IV过高时，我们就要怀疑是否发生信息泄漏（leakage）问题，也就是在自变量X中引入了Y的信息。</p>
<p><img src="https://pic3.zhimg.com/80/v2-1833a40731ac61e55a38bbd928dc7636_1440w.jpg" alt="img"></p>
<p><strong>功能</strong>：</p>
<blockquote>
<p>step 1. 按自然月/样本集维度，统计变量的IV。<br>
step 2. 根据IV的经验阈值来筛选。</p>
</blockquote>
<p><strong>指标</strong>：IV。可参考**《<strong><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/80134853">WOE与IV指标的深入理解应用</a></strong>》**</p>
<p><img src="https://www.zhihu.com/equation?tex=IV+%3D++%5Csum_%7Bi%3D1%7D%5E%7Bn%7D%28%5Cfrac%7BBad_i%7D%7BBad_T%7D++-+%5Cfrac%7BGood_i%7D%7BGood_T%7D%29+%2A+WOE_i+%5C%5C++++%3D%5Csum_%7Bi%3D1%7D%5E%7Bn%7D+%28%5Cfrac%7BBad_i%7D%7BBad_T%7D++-+%5Cfrac%7BGood_i%7D%7BGood_T%7D%29+%2Aln%28%5Cfrac%7BBad_i%7D%7BBad_T%7D++%2F+%5Cfrac%7BGood_i%7D%7BGood_T%7D%29+%5C%5C+" alt="[公式]"></p>
<p><img src="https://pic3.zhimg.com/80/v2-2097685ef366bb9df0f6b8944c416aba_1440w.png" alt="img"></p>
<ul>
<li>==<strong>基于RF/XGBoost特征重要性</strong>==</li>
</ul>
<p><strong>业务</strong>：在特征变量特别多的时候，可用于快速筛选特征。从机器学习可解释性角度而言，特征重要性只具有全局可解释性，无法对单个case给出解释。</p>
<p><strong>功能</strong>：</p>
<blockquote>
<p>step 1. 根据树模型训练后给出的特征重要性，一般选择累积重要性Top 95%的变量。<br>
step 2. 为降低一次训练所导致的随机性影响，可综合多次结果来筛选。</p>
</blockquote>
<p>指标：特征重要性。XGBoost实现中Booster类get_score方法输出特征重要性，其中 importance_type参数支持三种特征重要性的计算方法：</p>
<blockquote>
<ol>
<li><strong>weight（默认值）：使用特征在所有树中作为划分属性的次数。</strong></li>
<li><strong>gain：使用特征在作为划分属性时，OBj的平均降低量。</strong></li>
<li><strong>cover：使用特征在作为划分属性时对样本的覆盖度。</strong></li>
</ol>
</blockquote>
<p><strong>RF中计算特征重要度的主要思想：影响力分析</strong>。如果某个输入变量产生扰动，导致模型系统输出性能（利用袋外数据OOB的准确率来评估）产生明显影响，那么说明输入变量对系统具有较大的影响力，特征重要度比较高。</p>
<p>执行步骤为：</p>
<blockquote>
<p>step 1. 基准性能：对每一颗决策树，选择相应的袋外数据计算误差，记为 <img src="https://www.zhihu.com/equation?tex=err_%7BOOB1%7D" alt="[公式]"> ；<br>
step 2. 输入扰动：随机对袋外数据所有样本的特征加入噪声干扰(如白噪声)，再次计算袋外数据误差，记为 <img src="https://www.zhihu.com/equation?tex=err_%7BOOB2%7D" alt="[公式]"> ；<br>
step 3. 重要度计算： <img src="https://www.zhihu.com/equation?tex=+%5Cfrac%7B%5Csum_%7Bi%3D1%7D%5E%7BN%7D%28err_%7BOOB2%7D-err_%7BOOB1%7D%29%7D%7BN%7D" alt="[公式]"> ，N为随机森林中决策树的棵数。</p>
</blockquote>
<p><img src="https://pic4.zhimg.com/80/v2-7457883119e561b64bae7ef3d49340ff_1440w.jpg" alt="img"></p>
<ul>
<li><strong>变量聚类（Variable Cluster，VarClus）</strong></li>
</ul>
<p><strong>业务</strong>：在SAS中对应Proc VarClus方法。</p>
<p><strong>功能</strong>：</p>
<blockquote>
<p>step 1. 列聚类，将所有变量进行层次聚类。<br>
step 2. 根据聚类结果，剔除IV相对较低的变量。</p>
</blockquote>
<p><strong>指标</strong>：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> sklearn.cluster <span class="keyword">import</span> FeatureAgglomeration</span><br><span class="line"><span class="keyword">from</span> sklearn <span class="keyword">import</span> preprocessing</span><br><span class="line">    </span><br><span class="line">X_Scale = preprocessing.StandardScaler().fit_transform(input_df[var_list])</span><br><span class="line">ward = FeatureAgglomeration(n_clusters=n_clusters, linkage=<span class="string">&#x27;ward&#x27;</span>)</span><br><span class="line">ward.fit(X_Scale)</span><br><span class="line">clusters = <span class="built_in">list</span>(ward.labels_)</span><br></pre></td></tr></table></figure>
<p><img src="https://pic3.zhimg.com/80/v2-f93b791196087e503a2da4b12a26b84a_1440w.jpg" alt="img"></p>
<ul>
<li><strong>基于线性相关性（Linear Correlation）</strong></li>
</ul>
<p><strong>业务</strong>：逻辑回归作为一种线性模型，其基础假设是：自变量 <img src="https://www.zhihu.com/equation?tex=%28X_1%EF%BC%8CX_2%29" alt="[公式]"> 之间应相互独立。当两变量间的相关系数大于阈值时（一般阈值设为0.6)，剔除IV值较低的变量。</p>
<p><strong>功能</strong>：</p>
<blockquote>
<p>step 1. 计算变量的线性相关性。<br>
step 2. <strong>相关性较高的多个变量里，保留IV较高的变量。</strong></p>
</blockquote>
<p><strong>指标</strong>：<strong>皮尔逊相关系数（Pearson Correlation Coefficient）</strong>，系数的取值为<img src="https://www.zhihu.com/equation?tex=%5B-1.0%2C1.0%5D" alt="[公式]">，两变量相关系数越接近0，说明线性相关性越弱；越接近1或-1，说明线性相关性越强。</p>
<p><img src="https://www.zhihu.com/equation?tex=%5Crho_%7BX%2CY%7D%3D%5Cfrac%7Bcov%28X%2CY%29%7D%7B%5Csigma_X%5Csigma_Y%7D%5C%5C%3D%5Cfrac%7BE%28%28X-%5Cbar+X%29%28Y-%5Cbar+Y%29%29%7D%7B%5Csqrt%7B%5Csum%5Climits_%7Bi%3D1%7D%5En%28X_i-%5Cbar+X%29%5E2%7D+%5Csqrt%7B+%5Csum%5Climits_%7Bi%3D1%7D%5En%28Y_i-%5Cbar+Y%29%5E2%7D%7D+%5C%5C%3D+%5Cfrac%7BE%28XY%29-E%28X%29%28Y%29%7D%7B%5Csqrt%7BE%28X%5E2%29-E%5E2%28X%29%7D%5Csqrt%7BE%28Y%5E2%29-E%5E2%28Y%29%7D%7D+%5C%5C" alt="[公式]"></p>
<p><img src="https://pic4.zhimg.com/80/v2-17f049f47e262d45614a016289def3eb_1440w.jpg" alt="img"></p>
<ul>
<li><strong>基于多重共线性（Multicollinearity）</strong></li>
</ul>
<p>对于自变量<img src="https://www.zhihu.com/equation?tex=X_1%2C+X_2%2C+%5Ccdots+%2C+X_n" alt="[公式]">，如果存在不全为0的系数<img src="https://www.zhihu.com/equation?tex=c_1%2Cc_2%2C+%5Ccdots%2C+c_n" alt="[公式]">，使得以下线性等式近似成立:</p>
<p><img src="https://www.zhihu.com/equation?tex=c_1X_1+%2B+c_2X_2+%2B+%5Ccdots+%2B+c_nX_n+%5Capprox+0%5C%5C" alt="[公式]"></p>
<p>换言之，对于 <img src="https://www.zhihu.com/equation?tex=N" alt="[公式]"> 个变量，其中 <img src="https://www.zhihu.com/equation?tex=1" alt="[公式]"> 个可以由剩下的 <img src="https://www.zhihu.com/equation?tex=N-1" alt="[公式]"> 个变量线性表示。此时，我们就称自变量<img src="https://www.zhihu.com/equation?tex=X_1%2C+X_2%2C+%5Ccdots+%2C+X_n" alt="[公式]">具有较强的多重共线性。</p>
<p><strong><font color="red"> 当出现多重共线性时，变量之间的联动关系会导致估计标准差偏大，置信区间变宽。这就会产生一个常见的现象，LR中变量系数出现正负号不一致。</font></strong></p>
<p>业务：VIF取值的业务含义为：</p>
<blockquote>
<p>若VIF &lt; 3，说明基本不存在多重共线性问题<br>
若VIF &gt; 10，说明问题比较严重。</p>
</blockquote>
<p>功能：</p>
<blockquote>
<p>step 1. <strong>计算变量的方差膨胀因子（Variance Inflation Factor，VIF），适用于线性模型。</strong><br>
step 2. 根据阈值剔除VIF较高的变量。</p>
</blockquote>
<p>指标：通常用VIF衡量一个变量和其他变量的多重共线性。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">from statsmodels.stats.outliers_influence import variance_inflation_factor</span><br></pre></td></tr></table></figure>
<p>示例：</p>
<p><img src="https://pic4.zhimg.com/80/v2-6b5e626a0af1ae9f595f25fb8fb9b10b_1440w.jpg" alt="img"></p>
<ul>
<li>
<p><strong>基于逐步回归（stepwise)</strong></p>
<ul>
<li>
<p>前向选择（forward selection）：逐步加入变量，计算指标进行评估，若不合格则不加入，直到评估完所有变量。</p>
</li>
<li>
<p>后向选择（backward selection）：初始时加入所有变量，根据指标逐渐剔除不合格的变量。</p>
</li>
<li>
<p>逐步选择（stepwise）：将向前选择和向后选择的结合，逐步放入最优的变量、移除最差的变量。</p>
</li>
</ul>
</li>
<li>
<p><strong>基于P-Vaule显著性检验</strong></p>
</li>
</ul>
<p>业务：根据逻辑回归参数估计表，剔除P值大于0.05的变量。</p>
<p>功能：</p>
<blockquote>
<p>step 1. 用于检验自变量X与因变量Y之间的相关性。<br>
step 2. 剔除P值大于0.05的变量。</p>
</blockquote>
<p>指标：P-Vaule。在变量相关分析中，对相关系数进行假设检验时：</p>
<blockquote>
<p>原假设H0：自变量与因变量之间线性无关。<br>
备择假设H1：自变量与因变量之间线性相关。</p>
</blockquote>
<p>或许不太恰当，但通常当P值大于0.05时，接受原假设，否则拒绝原假设。因此，我们需要剔除P值大于0.05的变量。</p>
<p><img src="https://pic2.zhimg.com/80/v2-e08616047f86d2e6011528e45df62eb9_1440w.jpg" alt="img"></p>
<h3><span id="14-功能模块-模型训练">1.4 <strong>功能模块 - 模型训练</strong></span></h3>
<p>该模块主要包括<strong>变量变换（如分箱）</strong>、<strong>样本准备（包括样本赋权、拒绝推断等）</strong>、<strong>模型参数估计</strong>、<strong>模型分数校准</strong>、<strong>模型文件保存</strong>等功能。</p>
<h4><span id="141-woe转换weight-of-evidence">1.4.1 <strong>WOE转换（Weight of Evidence）</strong></span></h4>
<p><strong>业务：训练集上的WOE曲线需满足单调性，并且经过跨时间窗验证WOE变换逻辑同样满足单调性。如果不满足，那就需要再次调整。</strong></p>
<p><strong>功能：在评分卡模型中用于变量WOE变换，支持等频、等距、自定义间距等分箱操作。</strong></p>
<p>原理：可参考**《<strong><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/80134853">WOE与IV指标的深入理解应用</a></strong>》**</p>
<p>示例：</p>
<p><img src="https://pic2.zhimg.com/80/v2-3f95842ee9ac7568cfd1147552471481_1440w.jpg" alt="img"></p>
<h4><span id="142-样本权重sample-weight">1.4.2 <strong>样本权重（Sample Weight）</strong></span></h4>
<p><strong>功能：给建模样本赋予权重列，以逼近总体样本。</strong></p>
<p><strong>原理：建模本质在于从历史样本中学习未来样本的数理统计规律。</strong></p>
<h4><span id="不同的样本权重主要有几个目的"><strong>不同的样本权重主要有几个目的：</strong></span></h4>
<ul>
<li>为了让模型更稳健，一般都是拿近期样本refit模型，但上线后没几个月很快就衰减了，说明训练样本有偏程度比较高，不够代表总体。</li>
<li>早期的历史样本都是拿钱换来的，如何把这部分样本利用起来，不浪费。</li>
</ul>
<h4><span id="业务角度主观性强操作性高"><strong>==业务角度（主观性强，操作性高）：==</strong></span></h4>
<ul>
<li>按时间因素，近期样本提高权重，较远样本降低权重</li>
<li>按贷款类型，不同额度、利率、期限的样本赋予不同权重</li>
<li>按样本分群，不同群体赋予不同权重</li>
</ul>
<h4><span id="技术角度操作性复杂可解释性弱"><strong>技术角度（操作性复杂，可解释性弱）：</strong></span></h4>
<ul>
<li>借鉴Adaboost思想，对误判样本提高权重</li>
<li>过采样、欠采样、SMOTE等</li>
</ul>
<h4><span id="拒绝演绎reject-inference"><strong>拒绝演绎（Reject Inference）</strong></span></h4>
<p>功能：样本偏差将会导致模型估计过于乐观。通过推断拒绝样本的贷后表现，加入建模样本，可降低放贷建模样本与申请作用样本之间的偏差。</p>
<p>原理：参考《<a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/88624987">风控建模中的样本偏差与拒绝推断</a>》</p>
<h4><span id="参数估计parameter-estimation"><strong>参数估计（Parameter Estimation）</strong></span></h4>
<p><strong>功能：支持机器学习模型（如随机森林、GBDT、XGBoost、LightGBM等）调参、评分卡模型逐步回归（stepwise）。</strong></p>
<p>原理：LR采用最大似然估计进行参数估计。而机器学习模型的超参数较多，通常需要借助网格搜索（grid search）、贝叶斯调参等技术，降低对人工经验的依赖。</p>
<h4><span id="分数校准calibration"><strong>分数校准（Calibration）</strong></span></h4>
<p>功能：其一，一致性校准，将模型预测概率校准到真实概率。其二，尺度变换，将风险概率转换为平时所见的整数分数。</p>
<p>原理：参考《<a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/82670834">信用评分卡模型分数校准</a>》</p>
<h4><span id="模型保存save-model"><strong>模型保存（Save Model）</strong></span></h4>
<p>功能：将模型（参数+结构）保存为pkl和pmml文件，用以最终上线部署。注意需要给不同版本的模型赋予易于辨识、含义清晰的命名。一般建议至少包含以下内容：</p>
<blockquote>
<p>命名 = 生成日期+责任人+业务线+应用环节+版本号<br>
例如：20190101_小王_有钱花_额度授信_V1.pmml</p>
</blockquote>
<p>原理：参考《<a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/92691256">风控模型上线部署流程</a>》</p>
<h3><span id="15-功能模块-模型评估">1.5 <strong>功能模块 - 模型评估</strong></span></h3>
<p>在实际业务实践中，我们对风控模型的衡量维度主要包括以下几个方面：</p>
<blockquote>
<ul>
<li>稳定性（Stability）</li>
<li>区分度（Discrimination）</li>
<li>排序性（Ranking）</li>
<li>拟合度（Goodness of Fit）</li>
</ul>
</blockquote>
<h4><span id="151-稳定性stability">1.5.1 <strong>稳定性（Stability）</strong></span></h4>
<p>业务：在风控中，稳定性压倒一切。PSI取值所对应的业务含义如图8所示。我们需在申请层和放贷层上评估稳定性。原因在于：</p>
<ul>
<li>虽然模型是基于放贷订单训练，但最终应用在申请层。</li>
<li>申请层和放贷层客群存在差异。</li>
</ul>
<p>当PSI曲线的趋势一直在上升时，我们就要分析原因，消除不稳定因素。排查方向可参考《<a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/86559671">特征稳定性指标(CSI)深入理解应用</a>》中的Part 4。</p>
<p>指标：PSI。可参考《<a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/79682292">群体稳定性指标(PSI)深入理解应用</a>》</p>
<p>示例：</p>
<p><img src="https://pic2.zhimg.com/80/v2-ed926c29a728c4e8f42b881af25c319d_1440w.png" alt="img">模型分数PSI计算结果表（申请+放贷）</p>
<p><img src="https://pic1.zhimg.com/80/v2-b5e5d64f96906eeaa78e8ac6ebf80098_1440w.jpg" alt="img"></p>
<h4><span id="152-区分度discrimination">1.5.2 <strong>区分度（Discrimination）</strong></span></h4>
<p>业务：KS指标是风控建模同学最为追求的指标之一。通常情况下，KS越大，模型性能越好。但更需要分析KS不佳的原因，可结合ROC曲线进行辅助分析。</p>
<p>指标：Gini、AUC、KS。可参考《<a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/79934510">区分度评估指标(KS)深入理解应用</a>》<br>
<img src="https://pic2.zhimg.com/80/v2-952042e2835b7a3b4458d3fd763b6e15_1440w.png" alt="img"></p>
<p><img src="https://pic3.zhimg.com/80/v2-649ad86e09b8f5fc09dc224a6a1fb6ea_1440w.jpg" alt="img"></p>
<h4><span id="153-排序性ranking">1.5.3 <strong>排序性（Ranking）</strong></span></h4>
<p><strong>业务</strong>：大部分模型在最终应用时只是利用到排序性，其主要是为了观察曲线的斜率。如图21所示的模型，排序性非常好，前5个分箱就能抓住大约77%的坏客户。</p>
<p><strong>指标：按自然月/样本集维度，统计包含bad_rate、lift、odds等指标的Gain Table。</strong></p>
<blockquote>
<p><strong>lift = 召回样本的bad rate / 全部样本的bad rate</strong><br>
<strong>odds = bads / good</strong></p>
</blockquote>
<p>示例：模型分数Gain-Table</p>
<p><img src="https://pic4.zhimg.com/80/v2-169d5023b834416495810435e8c9b11b_1440w.jpg" alt="img"></p>
<h4><span id="154-拟合度goodness-of-fit">1.5.4 <strong>拟合度（Goodness of Fit）</strong></span></h4>
<p><strong>业务</strong>：我们以训练集为基准，将模型分数划分成10个(或20个)分箱后，查看每个分箱里的reject rate等指标是否一致。理论上，如果按每个Vintage绘制多条曲线，这些曲线会几乎重合，也就是围绕在训练集附近波动。此时，我们就可以相信模型在每一档的坏账估计比较准确。</p>
<p>指标：按自然月/样本集，评估每个分箱里lift、reject rate、bad rate的点估计</p>
<p>示例：</p>
<p><img src="https://pic2.zhimg.com/80/v2-32f4f004276a03f1adb5046d4ea40d91_1440w.jpg" alt="img"></p>
<h3><span id="16-开源的风控建模工具包简介">1.6 开源的风控建模工具包简介</span></h3>
<p>前文主要介绍一些理论，接下来介绍目前一些开源的风控建模工具包。</p>
<blockquote>
<p>feature-selector<br>
scorecardpy<br>
toad</p>
</blockquote>
<h4><span id="161-feature-selector">1.6.1 <strong>feature-selector</strong></span></h4>
<ul>
<li><a target="_blank" rel="noopener" href="https://github.com/WillKoehrsen/feature-selector">https://github.com/WillKoehrsen/feature-selector</a></li>
</ul>
<p><strong>主要功能：包括缺失率、单一值、相关性、特征重要性等。</strong></p>
<ol>
<li>Missing Values</li>
<li>Single Unique Values</li>
<li>Collinear Features</li>
<li>Zero Importance Features</li>
<li>Low Importance Features</li>
</ol>
<h4><span id="162-scorecardpy">1.6.2 <strong>scorecardpy</strong></span></h4>
<ul>
<li><a target="_blank" rel="noopener" href="https://github.com/shichenxie/scorecardpy">https://github.com/shichenxie/scorecardpy</a></li>
</ul>
<p><strong>主要功能：包括数据集划分、变量筛选、WOE分箱变换、评分卡尺度变换、模型性能评估。</strong></p>
<ol>
<li>data partition (split_df)</li>
<li>variable selection (iv, var_filter)</li>
<li>weight of evidence (woe) binning (woebin, woebin_plot, woebin_adj, woebin_ply)</li>
<li>scorecard scaling (scorecard, scorecard_ply)</li>
<li>performance evaluation (perf_eva, perf_psi)</li>
</ol>
<h4><span id="163-toad">1.6.3  <strong>toad</strong></span></h4>
<ul>
<li><a target="_blank" rel="noopener" href="https://toad.readthedocs.io/en/stable/tutorial_chinese.html">https://toad.readthedocs.io/en/stable/tutorial_chinese.html</a></li>
</ul>
<p><strong>主要功能：包括数据分析处理、特征筛选、模型筛选、模型评估、评分卡尺度变换等。</strong></p>
<ol>
<li>data handling</li>
<li>feature selection and WOE binning</li>
<li>model selection</li>
<li>results evaluation and model validation</li>
<li>scorecard transformation.</li>
</ol>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://powerlzy.github.io/posts/ADDHH0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/cat_mac.jpg">
      <meta itemprop="name" content="lzy">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="PowerLZY's Blog">
      <meta itemprop="description" content="相比到达的地方，同行的人更重要！">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | PowerLZY's Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/posts/ADDHH0/" class="post-title-link" itemprop="url">风控算法（2）风控模型-抽样对Lift和KS指标的影响</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2022-07-01 19:28:02" itemprop="dateCreated datePublished" datetime="2022-07-01T19:28:02+08:00">2022-07-01</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2023-04-19 15:42:59" itemprop="dateModified" datetime="2023-04-19T15:42:59+08:00">2023-04-19</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E3%80%90draft%E3%80%91%E5%BA%94%E7%94%A8/" itemprop="url" rel="index"><span itemprop="name">【draft】应用</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E3%80%90draft%E3%80%91%E5%BA%94%E7%94%A8/%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF/" itemprop="url" rel="index"><span itemprop="name">应用场景</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E3%80%90draft%E3%80%91%E5%BA%94%E7%94%A8/%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF/%E4%B8%9A%E5%8A%A1%E5%AE%89%E5%85%A8/" itemprop="url" rel="index"><span itemprop="name">业务安全</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>3.6k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>7 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1><span id="风控模型">风控模型</span></h1>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/109649516">多头借贷风险分析与建模</a></p>
<p><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/252845718">抽样对Lift和KS指标的影响</a></p>
<p><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/161009991">客户级通用信用评分模型架构设计</a></p>
<p><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/90214329">大数据信贷风控模型架构</a></p>
<p><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/90251922"><strong><font color="red"> 风控模型开发流程标准化</font></strong></a></p>
<p><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/92691256">风控模型上线部署流程</a></p>
<p><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/350616539">如何量化样本偏差对信贷风控模型的影响</a></p>
<p><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/110982479"><strong><font color="red"> 样本权重对逻辑回归评分卡的影响探讨</font></strong></a></p>
<p><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/85976154"><strong><font color="red"> 利用样本分群提升风控模型性能</font></strong></a></p>
<p><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/252845718">抽样对Lift和KS指标的影响</a></p>
</blockquote>
<h3><span id="风控业务背景"><strong>风控业务背景</strong></span></h3>
<p>在测试外部三方数据时，数据服务商只允许我们抛出有限一定量样本（例如5w、10w、20w）来匹配三方数据。这就要求我们对样本抽样。在对外部数据建模测算后，我们如何将结果还原到原始样本上评估呢？针对这种常见场景，本文将探索抽样对lift指标和KS指标的影响。</p>
<h3><span id="一-样本抽样方法">一、样本抽样方法</span></h3>
<p>在《<a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/104872477">外部数据风控建模评估分析</a>》中，我们介绍过外部数据的一些基本知识，其测算流程大致如图1所示。</p>
<p><img src="https://pic3.zhimg.com/80/v2-df9f69bec553a3a250bfe6e381c5f116_1440w.jpg" alt="img"></p>
<p>在测算外部数据前，第一步非常重要，样本是我们一切分析的载体。<strong>由于三方数据服务商一般只能提供有限的测试量（比如10w）</strong>，那么我们只能从业务样本中进行抽样。那么可以采取哪些抽样方法呢？一般有以下几种：</p>
<h4><span id="11-简单随机抽样保持内部真实好坏比例">1.1 <strong>简单随机抽样，保持内部真实好坏比例。</strong></span></h4>
<ul>
<li>好处：建模时可以直接评估模型效果，而不需要考虑**==bad rate==**失真。</li>
<li>坏处：好坏样本严重不均衡，坏样本总是极少量的，我们可能需要逐月评估单变量和模型KS，以此观察区分度的稳定性。<strong>此时，坏样本较少，导致结果失去统计意义，波动较大</strong></li>
</ul>
<p><img src="https://pic1.zhimg.com/80/v2-0a9b3fd0245488edde868b0e3da6fb6c_1440w.jpg" alt="img"></p>
<h4><span id="12-好坏分层抽样好样本n1抽样坏样本11抽样">1.2 <strong><font color="red"> 好坏分层抽样，好样本N:1抽样，坏样本1:1抽样。</font></strong></span></h4>
<p>比如，<strong>假设内部bad rate是5%</strong>，也就是好坏比例约为20:1，那么从20个好样本中随机抽1个，坏样本则全部保留。<strong>由此，我们在评估真实bad rate捕捉率时，也可以按此权重进行还原。即，1个好样本代表20个原始好样本。</strong></p>
<p><img src="https://pic3.zhimg.com/80/v2-ab77a0e880b5a0c4436af3162be4802e_1440w.jpg" alt="img"></p>
<h4><span id="13-按资质对客群分层再分层随机抽样">1.3 <strong>按资质对客群分层，再分层随机抽样。</strong></span></h4>
<p>具体操作方法为：</p>
<ol>
<li>以某段时间窗的样本训练一个排序模型，例如风险模型（PD），或过退模型（AR）。</li>
<li>对这个时间窗外待抽样的样本进行排序，将人群分为若干个分层。</li>
<li>分层抽样，每组中相同比例。</li>
</ol>
<p>这样就可以用来建立适应不同客群的信用分。</p>
<p><img src="https://pic4.zhimg.com/80/v2-d7b8e0930bde34c4703d2794e6d76c87_1440w.jpg" alt="img"></p>
<p>这三种方案里，我们最常采用方案二。因此，本文以该方案为例进行探讨。</p>
<h3><span id="二-lift和ks指标介绍"><strong>二、Lift和KS指标介绍</strong></span></h3>
<p>Lift, 名称为提升度, 其含义为：经过某种排序后圈出来的坏人浓度, 相对于随机抽样的坏人浓度的提升, 即:<br>
$$<br>
L i f t=\frac{cover-bad-rate}{total-bad-rate}<br>
$$<br>
举例说明, 如图5所示, 现在有 50 个人, 其中 5 个坏人, 那么整体坏人占比为 $10 %$ 。我们将其随机分为 5 组, 每组 10 人，则理想情况下，每组中有 1 个坏人。</p>
<p>现在我们拥有一个排序模型, 对这 50 个人排序后, 我们笑选出分数最低的 10 个人, 也就是第一组, 此时能抓住 2 个 坏人, 坏人浓度为 $20 %$ 。那么 lift $=20 % / 10 %=2$ 。</p>
<p><img src="https://pic4.zhimg.com/80/v2-79b9b1a9ce8a45b1cd3fb70d69da0b63_1440w.jpg" alt="img"></p>
<p><strong>在反欺诈场景中，我们常会用到Lift这个指标来判断规则的有效性</strong>。在测试外部数据时，我们会发现有些变量的区分度虽然很低，或者查得率很低，但是其查得人群的坏人捕捉率却很高。这对我们如何进行规则发现也是一个启发。</p>
<p>KS指标的含义详见：《<a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/79934510">区分度评估指标(KS)深入理解应用</a>》</p>
<h3><span id="三-抽样对lift指标的影响">三、抽样对Lift指标的影响</span></h3>
<p>现在我们有这样一个场景，在抽样样本上我们制定一个阈值cutoff，高于这个阈值则通过(PS)，低于这个阈值则拒绝(RJ)。在抽样样本上，我们测算拒绝部分的坏人lift，那么在原始样本上，相应的lift是多少呢？</p>
<p><img src="https://pic1.zhimg.com/80/v2-8fe85db67a0419fc8e0877a85e254cb4_1440w.jpg" alt="img"></p>
<p>我们按照lift的定义来推导所带来的影响。<br>
$$<br>
\begin{aligned}<br>
&amp; L i f t=\frac{B a d_{r j} / R J}{\left(B a d_{r j}+B a d_{p s}\right) /(R J+P S)} \<br>
&amp; =\frac{B a d_{r j}}{R J} \times \frac{R J+P S}{B a d_{r j}+B a d_{p s}} \<br>
&amp; =\frac{B a d_{r j}}{\operatorname{Bad}<em>{r j}+\operatorname{Bad}</em>{p s}} \times \frac{R J+P S}{R J} \<br>
&amp; =\frac{B a d_{r j}}{B a d_{r j}+B a d_{p s}} \times\left(1+\frac{P S}{R J}\right) \<br>
&amp;<br>
\end{aligned}<br>
$$<br>
其中:</p>
<ul>
<li>$B a d_{r j}$ : 拒绝部分的真实坏样本数</li>
<li>$\operatorname{Good}_{r j}$ : 拒绝部分的真实好样本数</li>
<li>$B_{p s}$ ：通过部分的真实坏样本数</li>
<li>$\operatorname{Good}_{p s}$ : 通过部分的真实好样本数</li>
</ul>
<p>由于全部保留 $B a d$ 样本, 同时采用相同的cutoff, 那么 $B a d_{r j}$ 和 $B a d_{p s}$ 在抽样前后保持不变。同时, 不可能有 完美的模型, 因此无论是 $R J$ 还是 $P S$ 中都有好坏样本，即:<br>
$$<br>
\begin{aligned}<br>
&amp; R J=B_{a d_{r j}}+\operatorname{Good}<em>{r j} \<br>
&amp; P S=\operatorname{Bad}</em>{p s}+\operatorname{Good}<em>{p s}<br>
\end{aligned}<br>
$$<br>
由于简单随机抽样, 假设抽样比例为 rate，那么:<br>
$$<br>
\text { Good }</em>{\text {sample }}=\text { Good }<em>{\text {origin }} \times \text { rate }<br>
$$<br>
同时，在相同的cutoff下，也就是相同的标准下，抽样和原始样本中的好样本比例应该相同，即：<br>
$$<br>
\begin{aligned}<br>
&amp; \text { Good }</em>{r j _} _ \text {sample }=\text { Good }<em>{r j _} _ \text {origin } \times \text { rate } \<br>
&amp; \text { Good }</em>{p s _} \text {sample }=\text { Good }<em>{p s _} _ \text {origin } \times \text { rate } \<br>
&amp;<br>
\end{aligned}在抽样样本上：<br>
$$<br>
在抽样样本上:<br>
$$<br>
\begin{aligned}<br>
&amp; L i f t</em>{s a m p l e}=\frac{B a d_{r j}}{B a d_{r j}+B a d_{p s}} \times\left(1+\frac{P S_s}{R J_s}\right) \<br>
&amp; =\frac{B a d_{r j}}{B a d_{r j}+B a d_{p s}} \times\left(1+\frac{B a d_{p s}+\operatorname{Good}<em>{p s}}{B a d</em>{r j}+\operatorname{Good}<em>{r j}}\right)<br>
\end{aligned}<br>
$$<br>
在原始样本上:<br>
$$<br>
\begin{aligned}<br>
&amp; =\frac{B a d</em>{r j}}{\operatorname{Bad}<em>{r j}+\text { Bad }</em>{p s}} \times\left(1+\frac{\text { Bad }<em>{p s}+\text { Good }</em>{p s} / \text { rate }}{\operatorname{Bad}<em>{r j}+\text { Good }</em>{r j} / \text { rate }}\right) \<br>
&amp; =\frac{B a d_{r j}}{\operatorname{Bad}<em>{r j}+\operatorname{Bad}</em>{p s}} \times\left(1+\frac{\text { rate } \times \operatorname{Bad}<em>{p s}+\operatorname{Good}</em>{p s}}{\text { rate } \times \operatorname{Bad}<em>{r j}+\operatorname{Good}</em>{r j}}\right) \<br>
&amp;<br>
\end{aligned}<br>
$$<br>
**<font color="red"> 对比公式（6）和 （7），我们发现，原始样本上的lift完全可以通过抽样分布上的值进行计算。我们再以实验佐证理论，发现几乎是一样的。</font>**造成些许差异的原因可能是样本量。</p>
<h3><span id="四-抽样对ks指标的影响">四、抽样对KS指标的影响</span></h3>
<p>在《<a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/79934510">区分度评估指标(KS)深入理解应用</a>》中，我们认识了KS的计算原理。那么对于随机抽样而言，好人分布和坏人分布是相互独立的，那么在计算累积好样本分布和累积坏样本分布时，理论上KS不应该发生变化。</p>
<p><strong>数据胜于雄辩。首先对好样本5:1抽样，坏样本则保持1:1不变</strong>，由此组成新样本集。</p>
<p><img src="https://pic3.zhimg.com/80/v2-b6e2797c944acffa0209c745afcbc03e_1440w.jpg" alt="img"></p>
<p>接下来，我们对比抽样前后的KS差异，如图8所示。结果并无明显区别。</p>
<p><img src="https://pic2.zhimg.com/80/v2-6cad55ad53f392de06b951e151f87f6d_1440w.jpg" alt="img"></p>
<p>因此，结论为：<strong>分层抽样不会改变KS</strong>，抽样样本与原始样本上计算的KS相同。在实践中，我们可能因为坏样本过少等原因会影响一些差异，但整体无明显差异。</p>
<h3><span id="五-总结">五、<strong>总结</strong></span></h3>
<p>在匹配外部数据后，我们在抽样样本上会进行一些测算，同时希望能还原在真实原始样本上的结果。针对一些模型指标（Lift、KS）的在抽样前后变化情况，结论为：</p>
<ul>
<li><strong>lift指标数值将会发生变化，但可以换算得到。</strong></li>
<li><strong>ks指标不会发生变化，但需要保证样本量足够。</strong></li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://powerlzy.github.io/posts/2105FD/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/cat_mac.jpg">
      <meta itemprop="name" content="lzy">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="PowerLZY's Blog">
      <meta itemprop="description" content="相比到达的地方，同行的人更重要！">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | PowerLZY's Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/posts/2105FD/" class="post-title-link" itemprop="url">python-dict和set</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>
      

      <time title="创建时间：2022-07-01 16:50:41 / 修改时间：17:34:07" itemprop="dateCreated datePublished" datetime="2022-07-01T16:50:41+08:00">2022-07-01</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E3%80%90draft%E3%80%91%E5%B7%A5%E7%A8%8B/" itemprop="url" rel="index"><span itemprop="name">【draft】工程</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E3%80%90draft%E3%80%91%E5%B7%A5%E7%A8%8B/%E6%B5%81%E7%A8%8B%E7%9A%84Python/" itemprop="url" rel="index"><span itemprop="name">流程的Python</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>1.5k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>3 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2><span id="python-dict和set">Python - dict和set</span></h2>
<p>前言：我们经常会听见很多的概念，<strong>哈希值，哈希表，可哈希对象，不可哈希对象，散列表，字典，映射</strong>，等等，那么这么多的概念后面到底又有什么区别和联系，它们的本质又是怎么样的，本此系列文章将针对这些概念进行说明，鉴于篇幅较多，本次系列文章将分为两篇来说明，此为第一篇，介绍数据结构哈希表与哈希值。</p>
<h3><span id="一-可哈希对象与不可哈希对象">一、可哈希对象与不可哈希对象</span></h3>
<h4><span id="11-哈希表散列表hash-table">1.1 哈希表（散列表）——hash table</span></h4>
<p><strong>哈希表，又称之为散列表，是一种空间换时间的存储结构</strong>，是在算法中提升效率的一种比较常用的方式，但是所需空间太大也会让人头疼，所以通常需要在二者之间权衡。我们会在之后的具体算法章节中得到更多的领悟。</p>
<p><strong>哈希表（散列表），是能够通过给定的关键字的值直接访问到具体对应的值的一个数据结构</strong>。也就是说，把关键字映射到一个表中的位置来直接访问记录，以加快访问速度。</p>
<ul>
<li>关键字，也称之为<strong>键</strong>，或者是Key，这就是我们哈希函数计算的依据</li>
<li><strong>记录</strong>，也称之为<strong>值</strong>，，也称之为<em><strong>哈希值</strong></em>，或者是<em><strong>Value</strong></em>，也就是我们通过key然后经过哈希函数运算之后得到的结果，存储这个记录，即存放哈希函数得到的结果的数组称之为 <em><strong>哈希表</strong></em> 或者是 <em><strong>散列表</strong></em></li>
</ul>
<h4><span id="12-哈希表的问题碰撞clollision">1.2 <strong>哈希表的问题——碰撞Clollision</strong></span></h4>
<p>其中有个特殊情况，就是通过不同的 Key，可能访问到同一个地址，这种现象叫作碰撞（Collision）。</p>
<p>如果“键-值对”在加入哈希表的时候产生了冲突，就必须找另外一个地方来存放它，冲突太多会降低数据插入和搜索的效率，因此希望能找到一个不容易产生冲突的函数，即构造一个地址分布比较均匀的哈希函数。</p>
<p>一个好的<a target="_blank" rel="noopener" href="https://so.csdn.net/so/search?q=%E6%95%A3%E5%88%97%E8%A1%A8&amp;spm=1001.2101.3001.7020">散列表</a>设计，除了需要选择一个性能较好的哈希函数，否则冲突是无法避免的，所以通常还需要有一个好的冲突处理方式，目前，这个哈希函数比较常用的实现方法比较多，通常需要考虑几个因素：关键字的长度、哈希表的大小、关键字的分布情况、记录的查找频率，等等。常见的一些哈希函数有：</p>
<ul>
<li>直接寻址法</li>
<li>数字分析法</li>
<li>平方取中法</li>
<li>取随机数法</li>
<li>除留取余法</li>
</ul>
<p>当出现冲突的时候，处理冲突的一些方法有：</p>
<ul>
<li>开放地址法（也叫开放寻址法）</li>
<li>再哈希法</li>
<li>链地址法</li>
<li>建立一个公共溢出区</li>
</ul>
<h4><span id="13-什么是可哈希hashable">1.3 <strong>什么是可哈希(hashable)？</strong></span></h4>
<p><strong>不可变的数据结构(数字类型（int，float，bool）、字符串str、元组tuple、自定义类的对象)。</strong></p>
<p><strong>不可哈希的数据类型，即可变的数据结构 (字典dict，列表list，集合set)</strong></p>
<blockquote>
<p>An object is hashable if it has a hash value which never changes during its lifetime (it needs a <strong>hash</strong>() method), and can be compared to other objects (it needs an <strong>eq</strong>()or <strong>cmp</strong>() method). Hashable objects which compare equal must have the same hash value.</p>
</blockquote>
<p>如果一个对象是可哈希的,那么在它的<strong>生存期内必须不可变</strong>(而且该对象需要一个哈希函数),而且<strong>可以和其他对象比较</strong>(需要比较方法).比较值相同的对象一定有相同的哈希值，即一个对象必须要包含有以下几个魔术方法：</p>
<ul>
<li>_<em>eq</em>_():用于比较两个对象是否相等</li>
<li>__ cmp__() : 用于比较两个对象的大小关系，它与__eq__只要有一个就可以了</li>
<li>_<em>hash</em>_()：实际上就是哈希函数（散列函数），返回经过运算得到的哈希值</li>
</ul>
<h3><span id="二-dict">二、dict</span></h3>
<p>CPython 的字典实现为可调整大小的哈希表。与 B-树相比，这在大多数情况下为查找（目前最常见的操作）提供了更好的性能，并且实现更简单。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://powerlzy.github.io/posts/387JGHJ/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/cat_mac.jpg">
      <meta itemprop="name" content="lzy">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="PowerLZY's Blog">
      <meta itemprop="description" content="相比到达的地方，同行的人更重要！">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | PowerLZY's Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/posts/387JGHJ/" class="post-title-link" itemprop="url">风控算法（3）技术算法-PU Learning</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2022-07-01 11:58:14" itemprop="dateCreated datePublished" datetime="2022-07-01T11:58:14+08:00">2022-07-01</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2023-04-21 14:40:38" itemprop="dateModified" datetime="2023-04-21T14:40:38+08:00">2023-04-21</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E3%80%90draft%E3%80%91%E5%BA%94%E7%94%A8/" itemprop="url" rel="index"><span itemprop="name">【draft】应用</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E3%80%90draft%E3%80%91%E5%BA%94%E7%94%A8/%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF/" itemprop="url" rel="index"><span itemprop="name">应用场景</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E3%80%90draft%E3%80%91%E5%BA%94%E7%94%A8/%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF/%E4%B8%9A%E5%8A%A1%E5%AE%89%E5%85%A8/" itemprop="url" rel="index"><span itemprop="name">业务安全</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>1.3k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>2 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2><span id="pu-learning在风控中的应用理论篇">PU Learning在风控中的应用（理论篇）</span></h2>
<h4><span id="一-风控业务背景">一、风控业务背景</span></h4>
<p>在实际分类场景中，我们经常会遇到类似这样的问题：<strong>只有已标记的正样本，以及未标记的样本</strong>。比如金融风控场景，只有部分用户被标记为欺诈用户，剩下的大量用户未被标记。虽然这其中大多数信用良好，但仍有少量可能为欺诈用户。</p>
<p>为了方便操作，我们可以将未标记的样本都作为负样本进行训练，但存在几个缺陷：</p>
<ol>
<li>正负样本极度不平衡，负样本数量远远超过正样本，效果很差。</li>
<li>某些关键样本会干扰分类器的最优分隔面的选择，尤其是SVM。</li>
</ol>
<p>如何辨别未标记样本中的正负样本，提升模型准确度，就成为一个值得思考的问题。PU Learning就是解决这种场景的一种学习方法。</p>
<p>本文尝试回答以下几个问题：</p>
<ul>
<li>我们如何将从PU数据中学习的问题形式化？</li>
<li><strong>通常对PU数据进行哪些假设以便于学习算法的设计？</strong></li>
<li><strong>我们可以从PU数据估计类先验吗？为什么这很有用？</strong></li>
<li><strong>我们如何从PU数据中学习模型？</strong></li>
<li><strong>我们如何在PU环境中评估模型？</strong></li>
<li>PU数据何时以及为什么出现在实际应用中？</li>
<li>PU学习与机器学习的其他领域有什么关系？</li>
</ul>
<p><strong>数学符号含义速查</strong>：<br>
$x$ ：某样例的特征向量, $x \in \boldsymbol{x}$</p>
<p>$y$ : 某样例的标签变量, $y \in \boldsymbol{y}={0,1}$</p>
<p>$(\boldsymbol{x}, \boldsymbol{y})$ : 某样本二元组</p>
<p>$s$ : 某样例是否被标注的指示变量, $s \in s={0,1}$</p>
<p>$\alpha$ ：先验类别（Class Prior)， $\alpha=\operatorname{Pr}(y=1)$ ，指正类别先验比例</p>
<p>$c$ : 标签频率（Label Frequency)， $c=\operatorname{Pr}(s=1 \mid y=1)$, 指L集合占总体P集的比例<br>
$e$ : 倾向评分函数 (Propensity Score) , $e(x)=\operatorname{Pr}(s=1 \mid y=1, x)$</p>
<p>$f(x)$ : 总体样本的概率密度分布函数, $\quad f(x)=\operatorname{Pr}(x \mid y \in{0,1})$</p>
<p>$f_{+}(x)$ : 正样本的概率密度分布函数, $\quad f_{+}(x)=\operatorname{Pr}(x \mid y=1)$</p>
<p>$f_{-}(x)$ : 负样本的概率密度分布函数, $\quad f_{-}(x)=\operatorname{Pr}(x \mid y=0)$</p>
<p>$f_l(x)$ : 有标签 (labeled) 样本的概率密度分布函数, $\quad f_l(x)=\operatorname{Pr}(x \mid s=1) \subset f_{+}(x)$</p>
<p>$f_u(x)$ : 无标签 (unlabeled) 样本的概率密度分布函数， $\quad f_u(x)=\operatorname{Pr}(x \mid s=0)$</p>
<p>$\hat{\theta}$ : 对参数 $\theta$ 的估计值</p>
<p>$P:$ 正样本集, Positive, 已标注的正样本</p>
<p>$N$ : 负样本集, Negative, 实际末知</p>
<p>$L$ : 有标签样本集, Labeled, 只有正样本</p>
<p>$U$ : 无标签样本集, Unlabeled, 包括末知的正负样本</p>
<p>$P U:$ 正样本和无标签样本组成的集合</p>
<p>$R N$ : 可靠的负样本</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://powerlzy.github.io/posts/1EHB2HT/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/cat_mac.jpg">
      <meta itemprop="name" content="lzy">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="PowerLZY's Blog">
      <meta itemprop="description" content="相比到达的地方，同行的人更重要！">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | PowerLZY's Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/posts/1EHB2HT/" class="post-title-link" itemprop="url">风控算法（3）技术算法-评分卡基础</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2022-07-01 11:58:14" itemprop="dateCreated datePublished" datetime="2022-07-01T11:58:14+08:00">2022-07-01</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2022-07-08 13:58:34" itemprop="dateModified" datetime="2022-07-08T13:58:34+08:00">2022-07-08</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E3%80%90draft%E3%80%91%E5%BA%94%E7%94%A8/" itemprop="url" rel="index"><span itemprop="name">【draft】应用</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E3%80%90draft%E3%80%91%E5%BA%94%E7%94%A8/%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF/" itemprop="url" rel="index"><span itemprop="name">应用场景</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E3%80%90draft%E3%80%91%E5%BA%94%E7%94%A8/%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF/%E4%B8%9A%E5%8A%A1%E5%AE%89%E5%85%A8/" itemprop="url" rel="index"><span itemprop="name">业务安全</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>2.9k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>5 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2><span id="评分卡基础逻辑回归算法理解">评分卡基础—逻辑回归算法理解</span></h2>
<h4><span id="风控业务背景"><strong>风控业务背景</strong></span></h4>
<p>逻辑回归（Logistic Regression，LR）是建立信贷金融评分卡的重要模型，其具有形式简单、易于解释、鲁棒性强等优点。然而，很多建模同学并不是很清楚其原理。本文尝试对逻辑回归基础加以分析理解。</p>
<blockquote>
<p>目录<br>
Part 1. 从线性回归到逻辑回归<br>
Part 2. 为什么采用sigmoid函数<br>
Part 3. 利用极大似然估计法估计参数<br>
Part 4. 最优化问题求解之梯度下降法<br>
Part 5. 正则项的作用和种类<br>
Part 6. 总结<br>
致谢<br>
版权声明<br>
参考资料</p>
</blockquote>
<h3><span id="一-从线性回归到逻辑回归">一、从线性回归到逻辑回归</span></h3>
<p>线性模型是指对各种属性进行<strong>线性加权</strong>组合的函数：</p>
<p><img src="https://www.zhihu.com/equation?tex=f%28%5Cpmb+%7Bx%7D%29+%3D+w_%7B1%7Dx_%7B1%7D+%2B+w_%7B2%7Dx_%7B2%7D+%2B+...+%2B+w_%7Bn%7D+x_%7Bn%7D+%2B+b+%5C%5C+%3D+%5Cpmb%7Bw%7D%5ET%5Cpmb%7Bx%7D+%2B+b++%5Ctag%7B1%7D" alt="[公式]"></p>
<p>这一过程将信息进行整合；不同的权重(weight)反映了自变量对因变量不同的贡献程度 。线性回归（Liner Regression）具有广泛应用，例如：预测房价、天气等等。</p>
<p><strong><font color="red"> 但在实际应用中，很多人会忽略线性回归的几大假设：</font></strong></p>
<ul>
<li><strong>零均值假设</strong>：随机误差项均值为0。</li>
<li><strong>同方差假设</strong>：随机误差项方差相同。若满足这一特性，称模型具有<strong>同方差性</strong></li>
<li><strong>残差 <img src="https://www.zhihu.com/equation?tex=%5Cvarepsilon" alt="[公式]"> 服从正态分布 <img src="https://www.zhihu.com/equation?tex=N%28%5Cmu%2C+%5Csigma%5E2%29" alt="[公式]"></strong></li>
<li><strong>无自相关假设</strong>：若不满足这一特性，称模型具有<strong>自相关性</strong>（Autocorrelation）。</li>
<li>…</li>
</ul>
<p>显然，线性回归的输出结果 <img src="https://www.zhihu.com/equation?tex=f%28%5Ctextbf%7Bx%7D%29+%5Cin+%28-%5Cinfty%2C+%5Cinfty%29" alt="[公式]"> 。那如果要做分类呢？我们就考虑将线性回归的输出与分类任务的真实标签 <img src="https://www.zhihu.com/equation?tex=y" alt="[公式]">联系起来，即再找一个映射函数。</p>
<p>我们采用一个 <img src="https://www.zhihu.com/equation?tex=sigmoid" alt="[公式]"> 函数（也叫对数几率）：</p>
<p><img src="https://www.zhihu.com/equation?tex=+f%28z%29+%3D+%5Cfrac%7B1%7D%7B1%2Be%5E%7B-z%7D%7D++%5Ctag%7B2%7D" alt="[公式]"></p>
<p>其函数图像如图2所示，直观感受其优美的姿态，对称、平滑，且输出 <img src="https://www.zhihu.com/equation?tex=+f%28z%29+%5Cin+%280%2C1%29" alt="[公式]"> .</p>
<img src="https://pic2.zhimg.com/80/v2-4b114919fe629cb80abcdfd949e73869_1440w.jpg" alt="img" style="zoom:33%;">
<p>我们尝试把 <img src="https://www.zhihu.com/equation?tex=sigmoid" alt="[公式]"> 函数模块拼接到线性回归的输出后面，如图3所示。</p>
<img src="https://pic4.zhimg.com/80/v2-d48c12be1ae99fd3008ea54e242be983_1440w.jpg" alt="img" style="zoom:50%;">
<p>把图3用公式表达，也就是在 <img src="https://www.zhihu.com/equation?tex=sigmoid" alt="[公式]"> 函数内嵌套一个线性回归：</p>
<p><img src="https://www.zhihu.com/equation?tex=f%28%5Cpmb%7Bx%7D%29%3D+%5Cfrac%7B1%7D%7B1+%2B+e%5E-%7B%28%5Cpmb%7Bw%7D%5ET%5Cpmb%7Bx%7D+%2B+b%29%7D%7D+%5Ctag%7B3%7D" alt="[公式]"></p>
<p>我们再将其变换得到逻辑回归的另一种常见形式：</p>
<p><img src="https://www.zhihu.com/equation?tex=+ln+%5Cfrac%7Bp%28y%3D1%7C%5Cpmb%7Bx%7D%29%7D%7B1%E2%88%92p%28y%3D1%7C%5Cpmb%7Bx%7D%29%7D+%3D+%7B%5Cpmb%7Bw%7D%5ET%5Cpmb%7Bx%7D+%2B+b%7D+%5Ctag%7B4%7D" alt="[公式]"></p>
<p>为什么要这样做呢？这是因为右边就是线性回归，而左边则引入了 <img src="https://www.zhihu.com/equation?tex=odds" alt="[公式]"> (几率) 的概念，即<strong>事件发生概率相对于不发生概率的比值。</strong></p>
<p>显然可以得到正负样例的概率表达式：</p>
<p><img src="https://www.zhihu.com/equation?tex=p%28y%3D1%7C%5Cpmb%7Bx%7D%29+%3D++%5Cfrac%7Be%5E%7B%5Cpmb%7Bw%7D%5ET%5Cpmb%7Bx%7D+%2B+b%7D%7D%7B1+%2B+e%5E%7B%5Cpmb%7Bw%7D%5ET%5Cpmb%7Bx%7D+%2B+b%7D%7D+%5C%5C+p%28y%3D0%7C%5Cpmb%7Bx%7D%29+%3D++%5Cfrac%7B1%7D%7B1+%2B+e%5E%7B%5Cpmb%7Bw%7D%5ET%5Cpmb%7Bx%7D+%2B+b%7D%7D+%5Ctag%7B5%7D+" alt="[公式]"></p>
<h3><span id="二-为什么采用sigmoid函数">二、为什么采用sigmoid函数</span></h3>
<blockquote>
<p>根本原因：</p>
<p>函数优点：</p>
</blockquote>
<p>至此，你可能会有疑问：为什么这里就直接选择了<img src="https://www.zhihu.com/equation?tex=sigmoid" alt="[公式]"> 函数？如果只是为了将输出结果从 <img src="https://www.zhihu.com/equation?tex=%28-%5Cinfty%2C+%5Cinfty%29" alt="[公式]"> 映射到 <img src="https://www.zhihu.com/equation?tex=%280%2C+1%29" alt="[公式]"> ，完全可以选择其他函数，比如单位阶跃函数：</p>
<p><img src="https://www.zhihu.com/equation?tex=p%28y%3D1+%7C+x%29%3D%5Cbegin%7Bcases%7D+0%2C%26+z%5Clt+0+%5C%5C+0.5%2C%26+z+%3D+0%5C%5C+1%2C%26+z%5Cgt+0%5C+%5Cend%7Bcases%7D+%2C%5Cquad+z%3Dw%5ET+x%2Bb++%5Ctag%7B6%7D" alt="[公式]"></p>
<p>若预测值 <img src="https://www.zhihu.com/equation?tex=z+%3E0" alt="[公式]"> 则判为正例， <img src="https://www.zhihu.com/equation?tex=z+%3C+0" alt="[公式]"> 则判为负例， <img src="https://www.zhihu.com/equation?tex=z+%3D+0" alt="[公式]"> 则可任意判别。你可能会说，这个阶跃函数不可微，也无法像<img src="https://www.zhihu.com/equation?tex=sigmoid" alt="[公式]"> 函数那样输出概率。这就冒出两个问题：</p>
<ol>
<li><strong>为什么这个映射函数一定要求可微？</strong></li>
<li><strong>为什么 <img src="https://www.zhihu.com/equation?tex=sigmoid" alt="[公式]"> 函数输出值可以代表概率？</strong></li>
</ol>
<p>首先，我们先分析 <img src="https://www.zhihu.com/equation?tex=sigmoid" alt="[公式]"> 函数的基本性质：</p>
<ol>
<li>定义域：<img src="https://www.zhihu.com/equation?tex=%28-%5Cinfty%2C+%5Cinfty%29" alt="[公式]"></li>
<li>值域：<img src="https://www.zhihu.com/equation?tex=%280%2C1%29" alt="[公式]"></li>
<li>函数在定义域内为连续和光滑函数</li>
<li>处处可导，导数为 <img src="https://www.zhihu.com/equation?tex=f%E2%80%B2%28x%29%3Df%28x%29%281%E2%88%92f%28x%29%29" alt="[公式]"> ，以下是推导过程：</li>
</ol>
<p><img src="https://www.zhihu.com/equation?tex=f%27%28x%29%3D%5B%5Cfrac%7B1%7D%7B1%2Be%5E%7B-x%7D%7D%5D%27+%3D%5Cfrac%7B1%27%C2%B7%281%2Be%5E%7B-x%7D%29-1%C2%B7%281%2Be%5E%7B-x%7D%29%27%7D%7B%281%2Be%5E%7B-x%7D%29%5E%7B2%7D%7D+%5C%5C+%3D%5Cfrac%7B1%7D%7B1%2Be%5E%7B-x%7D%7D-%5Cfrac%7B1%7D%7B%281%2Be%5E%7B-x%7D%29%5E%7B2%7D%7D++%3D%5Cfrac%7B1%7D%7B1%2Be%5E%7B-x%7D%7D+%281-%5Cfrac%7B1%7D%7B1%2Be%5E%7B-x%7D%7D%29+%5C%5C+%3Df%28x%29%5B1-f%28x%29%5D+%5Ctag%7B7%7D" alt="[公式]"></p>
<p>可以看到，<img src="https://www.zhihu.com/equation?tex=sigmoid" alt="[公式]"> 函数确实具有很多优点，但这仍不是我们选择它的<strong>根本原因</strong>。这是因为，我们仍可以找到一些与之类似性质的函数。</p>
<h4><span id="根本原因">根本原因：</span></h4>
<p>由于逻辑回归本质上属于线性模型，我们尝试<strong>从广义线性模型（Generalized Linear Model，GLM）角度入手解释</strong>。前文提到，<strong>线性回归存在诸多假设，实际应用中往往无法满足</strong>。这就会有以下问题：</p>
<ul>
<li><img src="https://www.zhihu.com/equation?tex=y" alt="[公式]"> 的取值范围 <img src="https://www.zhihu.com/equation?tex=%28-%5Cinfty%2C+%5Cinfty%29" alt="[公式]"> 与某些场景矛盾。例如，要求 <img src="https://www.zhihu.com/equation?tex=y+%5Cin+%280%2C%5Cinfty%29" alt="[公式]"> 。假设一个线性回归模型预测当温度下降10摄氏度，沙滩上的游客将减少1000人。那么，如果当前20摄氏度时，沙滩上只有50人，按此模型预测，当温度为10摄氏度时，沙滩上便有-950人。这显然不符合常理，因为人数不能为负数。</li>
<li>残差 <img src="https://www.zhihu.com/equation?tex=%5Cvarepsilon" alt="[公式]"> 服从正态分布 <img src="https://www.zhihu.com/equation?tex=N%28%5Cmu%2C+%5Csigma%5E2%29" alt="[公式]"> ，且要求方差 <img src="https://www.zhihu.com/equation?tex=%5Csigma%5E2" alt="[公式]"> 是常数。但有时，均值 <img src="https://www.zhihu.com/equation?tex=%5Cmu" alt="[公式]"> 越大，我们越预测不准确（方差 <img src="https://www.zhihu.com/equation?tex=%5Csigma%5E2" alt="[公式]"> 越大）。</li>
</ul>
<p><strong>为了解决这些局限性，后人发展了GLM，用以提高线性模型的普适性。</strong></p>
<blockquote>
<p>GLM允许因变量 $y$ 的分布<strong>并不一定要服从正态分布</strong>，而可以服从其它分布。</p>
</blockquote>
<p><strong>广义线性模型GLM由三要素组成, 即：</strong></p>
<ul>
<li>
<p><strong>概率分布</strong> (Probability distribution) : 指因变量 $y$ 的分布假设, 来自指数分布族。</p>
</li>
<li>
<p><strong>线性预测</strong> (Linear predictor) : 自变量的线性组合, 即 $\eta=\boldsymbol{X} \boldsymbol{\beta}$</p>
</li>
<li>
<p><strong>链接函数</strong> (Link function) : 通过均值 $\mu$ 来链接前两者, 即 $E(Y)=\mu=g^{-1}(\eta)$<br>
<img src="/Users/apple/Library/Application Support/typora-user-images/image-20220708133222814.png" alt="image-20220708133222814" style="zoom:50%;"></p>
<p><strong>首先分析概率分布。对于只有单个参数 $\theta$ 的指数分布族的通用形式为:</strong><br>
$$<br>
f(x \mid \theta)=h(x) \exp (\eta(\theta) \cdot T(x)-A(\theta))<br>
$$<br>
其中, $h(x)$ 和 $T(x)$ 只是关于自变量 $x$ 的函数； $\eta(\theta)$ 和 $A(\theta)$ 只是关于末知参数 $\theta$ 的函数。 不同的线性模型具有不同的分布假设。比如：</p>
</li>
<li>
<p><strong><font color="red"> 线性回归假设 $y$ 的残差 $\varepsilon$ 服从正态分布 $N\left(\mu, \sigma^{2}\right)$</font></strong></p>
</li>
<li>
<p><strong><font color="red"> 逻辑回归假设 $y$ 服从伯努利分布 (Bernoulli)</font></strong></p>
</li>
</ul>
<p>接下来，我们尝试：</p>
<ol>
<li>将逻辑回归因变量 $y$ 变换到式 <img src="https://www.zhihu.com/equation?tex=%288%29" alt="[公式]"> 的形式，确定以上几个函数，验证其属于指数分布族。</li>
<li>求解出逻辑回归对应的链接函数。注意，此时我们<strong>还没有认可sigmoid函数</strong>。⚠️</li>
</ol>
<p><strong>由于逻辑回归假设 $y$ 服从伯努利分布（<a href="https://link.zhihu.com/?target=https%3A//encyclopedia.thefreedictionary.com/Bernoulli%2Bdistribution">Bernoulli</a>），即：</strong></p>
<p><img src="https://www.zhihu.com/equation?tex=%5Cbegin%7Beqnarray%2A%7D++%26%26+f%28x%7Cp%29+%3D+p%5Ex+%281-p%29%5E%7B1-x%7D+%5C%5C++%26%26+%3D++%5Cexp%28x%2Alnp+%2B+%281-x%29%2Aln%281-p%29%29+%5C%5C+%26%26+%3D%5Cexp%28ln%28%5Cfrac%7Bp%7D%7B1-p%7D%29+%2A+x+%2B+ln%281-p%29%29+%5C%5C++%26%26%3D%5Cexp%28%CE%B7%2Ax+%2B+ln%281%2Be%5E%CE%B7%29%29+%5C%5C+%26%26+Let%3A+%CE%B7%3Dln%28%5Cfrac%7Bp%7D%7B1-p%7D%29++%5Cend%7Beqnarray%2A%7D+%5Ctag%7B9%7D+" alt="[公式]"></p>
<p>对比式 <img src="https://www.zhihu.com/equation?tex=%288%29" alt="[公式]"> 指数函数族的通用形式，我们发现：</p>
<ul>
<li><img src="https://www.zhihu.com/equation?tex=h%28x%29+%3D+1%EF%BC%8CT%28x%29%3Dx" alt="[公式]"></li>
<li><img src="https://www.zhihu.com/equation?tex=%5Ceta%28p%29%3Dln%28%7Bp%7D%2F%281-p%29%29%2C+A%28p%29+%3D+-ln%281%2Be%5E%CE%B7%29" alt="[公式]"></li>
</ul>
<p><strong>这说明伯努利分布也是指数分布族（<a href="https://link.zhihu.com/?target=https%3A//encyclopedia.thefreedictionary.com/Exponential%2Bfamily">exponential family</a>）的成员。按GLM的第二要素定义：</strong></p>
<p><img src="https://www.zhihu.com/equation?tex=%5Ceta+%3D+%5Cpmb%7BX%7D+%5Cpmb%7B%5Cbeta%7D+%5C%5C+%5CRightarrow+ln%28%5Cfrac%7Bp%7D%7B1-p%7D%29+%3D+%5Cpmb%7BX%7D+%5Cpmb%7B%5Cbeta%7D+%5Ctag%7B10%7D" alt="[公式]"></p>
<p>我们再计算 <img src="https://www.zhihu.com/equation?tex=%5Ceta%28p%29%3Dln%28%7Bp%7D%2F%281-p%29%29" alt="[公式]"> 的反函数，就得到了<img src="https://www.zhihu.com/equation?tex=sigmoid" alt="[公式]"> 函数：</p>
<p><img src="https://www.zhihu.com/equation?tex=f%28x%29+%3D+%5Cfrac%7B1%7D%7B1%2B+e%5E%7B-x%7D%7D+%5Ctag%7B11%7D" alt="[公式]"></p>
<p>按类似方法，我们可以推导出各分布函数及其链接函数，如图5所示。</p>
<img src="https://pic1.zhimg.com/80/v2-ffe75b45239773e6245b00b78c65d908_1440w.jpg" alt="img" style="zoom:50%;">
<p><strong>从广义线性模型角度，我们确实推导出 <img src="https://www.zhihu.com/equation?tex=sigmoid" alt="[公式]">函数与逻辑回归之间密不可分的联系。但是，sigmoid函数输出值为什么可以代表概率？</strong></p>
<p><strong><font color="red"> 上文提到，逻辑回归中因变量 $y$ 服从伯努利分布，而伯努利分布的参数 <img src="https://www.zhihu.com/equation?tex=p" alt="[公式]"> 的含义就是样例属于 <img src="https://www.zhihu.com/equation?tex=y+%3D+1" alt="[公式]"> 的概率。</font></strong></p>
<h3><span id="三-利用极大似然估计法估计参数">三、利用极大似然估计法估计参数</span></h3>
<p>在模型参数估计问题上，两大主流学派持有不同观点：</p>
<ul>
<li><strong>频率主义学派（Frequentist）：</strong> <strong>认为参数虽然未知，但却是客观存在的固定值</strong>。因此，可通过优化似然函数等准则估计参数值。</li>
<li>**贝叶斯学派（Bayesian）： ** <strong>认为参数是未观察到的随机变量，其本身也可有分布</strong>。因此，可假定参数服从一个先验分布，再基于观察到的数据来计算参数的后验分布。</li>
</ul>
<p><strong>极大似然估计法（Maximum Likelihood Estimation，MLE）属于频率主义学派方法，其蕴含的朴素思想在于：</strong></p>
<p>我们已经确定了一个模型种类 <img src="https://www.zhihu.com/equation?tex=h_%7B%5Ctheta%7D%28x%7C%5Ctheta%29" alt="[公式]"> ，但还不清楚其真实参数 <img src="https://www.zhihu.com/equation?tex=%5Ctheta" alt="[公式]"> 。既然目前观察样本已经出现，那么就<strong>由果溯因</strong>，估计出一组参数 <img src="https://www.zhihu.com/equation?tex=%5Chat+%7B%5Ctheta%7D" alt="[公式]"> ，使得出现目前结果的可能性<strong>最大</strong>（优化目标)，如图6所示。</p>
<p>由于一组样本中的所有样例是一个整体，因此我们<strong>将各样例的概率相乘</strong>（排列组合中的乘法原理）来得到我们的目标函数。</p>
<p><img src="https://pic1.zhimg.com/80/v2-13bed4bb32c44c57bdde2cc772a34184_1440w.jpg" alt="img"></p>
<p>我们把第 <img src="https://www.zhihu.com/equation?tex=i" alt="[公式]"> 个样例的类别属于 <img src="https://www.zhihu.com/equation?tex=y%3D1" alt="[公式]"> 的概率记为： <img src="https://www.zhihu.com/equation?tex=P%28y%3D1%7C+%5Cpmb%7Bx%7D_i%29+%3D+p%28+%5Cpmb%7Bx%7D_i%7C+%5Cpmb%7Bw%7D+%29" alt="[公式]"> .</p>
<p>现在，我们有观测样本 <img src="https://www.zhihu.com/equation?tex=+D%3D%5C%7B%28+%5Cpmb%7Bx%7D_1%2C+y_%7B1%7D%29%2C+%28+%5Cpmb%7Bx%7D_2%2C+y_%7B2%7D%29%2C...%2C%28+%5Cpmb%7Bx%7D_m%2C+y_%7Bm%7D%29%5C%7D%2C+%5Cpmb+x_%7Bi%7D+%5Cin+R%5En" alt="[公式]"> ，那么似然函数为：</p>
<p><img src="https://www.zhihu.com/equation?tex=L%28%5Cpmb%7Bw%7D%29%3D+%5Cprod_%7Bi%3D1%7D%5E%7Bm%7Dp%28+%5Cpmb%7Bx%7D_i%7C%5Cpmb%7Bw%7D%29++%3D+%5Cprod_%7Bi%3D1%7D%5Em+%5Bp%28+%5Cpmb%7Bx%7D_i%7C%5Cpmb%7Bw%7D%29%5D%5E%7By_%7Bi%7D%7D%5B1-p%28+%5Cpmb%7Bx%7D_i%7C%5Cpmb%7Bw%7D%29%5D%5E%7B1-y_%7Bi%7D%7D++%5Ctag%7B12%7D" alt="[公式]"></p>
<p>其中，样例 <img src="https://www.zhihu.com/equation?tex=+%5Cpmb%7Bx%7D_i" alt="[公式]"> 具有标签 <img src="https://www.zhihu.com/equation?tex=y_%7Bi%7D+%5Cin+%5C%7B0%2C1%5C%7D" alt="[公式]"> 。右边为什么要写成这种形式呢？主要原因在于这是<strong>伯努利分布的常见形式</strong>。按正负样例分析，可以帮助你理解这个形式：</p>
<ul>
<li><img src="https://www.zhihu.com/equation?tex=y_i+%3D+1" alt="[公式]"> 时，<img src="https://www.zhihu.com/equation?tex=%5Bp%28%5Cpmb%7Bx%7D_i%7C%5Cpmb%7Bw%7D%29%5D%5E%7By_%7Bi%7D%7D%5B1-p%28%5Cpmb%7Bx%7D_i%7C%5Cpmb%7Bw%7D%29%5D%5E%7B1-y_%7Bi%7D%7D+%3D+p%28%5Cpmb%7Bx%7D_i%7C%5Cpmb%7Bw%7D%29%5E%7B1%7D%5B1-p%28%5Cpmb%7Bx%7D_i%7C%5Cpmb%7Bw%7D%29%5D%5E%7B0%7D+%3D+p%28%5Cpmb%7Bx%7D_i%7C%5Cpmb%7Bw%7D%29" alt="[公式]"></li>
<li><img src="https://www.zhihu.com/equation?tex=y_i+%3D+0" alt="[公式]"> 时，<img src="https://www.zhihu.com/equation?tex=%5Bp%28%5Cpmb%7Bx%7D_i%7C%5Cpmb%7Bw%7D%29%5D%5E%7By_%7Bi%7D%7D%5B1-p%28%5Cpmb%7Bx%7D_i%7C%5Cpmb%7Bw%7D%29%5D%5E%7B1-y_%7Bi%7D%7D+%3D+p%28%5Cpmb%7Bx%7D_i%7C%5Cpmb%7Bw%7D%29%5E%7B0%7D%5B1-p%28%5Cpmb%7Bx%7D_i%7C%5Cpmb%7Bw%7D%29%5D%5E%7B1%7D+%3D+1-p%28%5Cpmb%7Bx%7D_i%7C%5Cpmb%7Bw%7D%29" alt="[公式]"></li>
</ul>
<p>为便于求解，将连乘 <img src="https://www.zhihu.com/equation?tex=%5Cprod" alt="[公式]"> 转为 <img src="https://www.zhihu.com/equation?tex=%5Csum" alt="[公式]"> ，我们对等式 <img src="https://www.zhihu.com/equation?tex=%2812%29" alt="[公式]"> 两边同取对数 <img src="https://www.zhihu.com/equation?tex=ln" alt="[公式]"> ，写成对数似然函数：</p>
<p><img src="https://www.zhihu.com/equation?tex=+%5Cbegin%7Baligned%7D+L%28%5Cpmb%7Bw%7D%29%26%3D%5Csum_%7Bi%3D1%7D%5Em%5By_%7Bi%7Dlnp%28%5Cpmb%7Bx%7D_i%7C%5Cpmb%7Bw%7D%29%2B%281-y_%7Bi%7D%29ln%281-p%28%5Cpmb%7Bx%7D_i%7C%5Cpmb%7Bw%7D%29%29%5D+%5C%5C+%26%3D%5Csum_%7Bi%3D1%7D%5Em%5By_%7Bi%7Dln%5Cfrac%7Bp%28%5Cpmb%7Bx%7D_i%7C%5Cpmb%7Bw%7D%29%7D%7B1-p%28%5Cpmb%7Bx%7D_i%7C%5Cpmb%7Bw%7D%29%7D%2Bln%281-p%28%5Cpmb%7Bx%7D_i%7C%5Cpmb%7Bw%7D%29%29%5D++%5C%5C++%26%3D%5Csum_%7Bi%3D1%7D%5Em%5By_%7Bi%7D%5Cpmb%7Bw%7D%5ET%5Cpmb%7Bx%7D_i+-+ln%281%2Be%5E%7B%5Cpmb%7Bw%7D%5ET+%5Ccdot+%5Cpmb%7Bx%7D_%7Bi%7D%7D%29%5D+%5C%5C+%26%3D%5Csum_%7Bi%3D1%7D%5Em%5By_%7Bi%7D%5Csum_%7Bj%3D1%7D%5En%28w_i%5Ccdot+x_%7Bi%7D%5E%7B%28j%29%7D%29+-+ln%281%2Be%5E%7B%5Cpmb%7Bw%7D%5ET+%5Ccdot+%5Cpmb%7Bx%7D_%7Bi%7D%7D%29%5D+%5Cend%7Baligned%7D+%5Ctag%7B13%7D" alt="[公式]"></p>
<p>我们的优化目标是：</p>
<p><img src="https://www.zhihu.com/equation?tex=%5Cmax+L%28%5Cpmb%7Bw%7D%29+%5C%5C+%5CLeftrightarrow+%5Cmax+J%28%5Cpmb%7Bw%7D%29+%3D++%5Cfrac%7B1%7D%7Bm%7D%28%5Csum_%7Bi%3D1%7D%5Em%28y_%7Bi%7Dln+p%28x_i%7C%5Cpmb%7Bw%7D%29%2B%281-y_i%29+ln%281-p%28x_i%7C%5Cpmb%7Bw%7D%29%29%29+%5C%5C+%5CLeftrightarrow++%5Cmin+J%28%5Cpmb%7Bw%7D%29+%3D+-+%5Cfrac%7B1%7D%7Bm%7D%28%5Csum_%7Bi%3D1%7D%5Em%28y_%7Bi%7Dln+p%28x_i%7C%5Cpmb%7Bw%7D%29%2B%281-y_i%29+ln%281-p%28x_i%7C%5Cpmb%7Bw%7D%29%29%29+%5Ctag%7B14%7D" alt="[公式]"></p>
<p>认真考虑后，我们发现并没有其他<strong>约束项。</strong>(事实上，这里将蕴含正则项的思想)</p>
<h3><span id="四-最优化问题求解之梯度下降法">四、最优化问题求解之梯度下降法</span></h3>
<p>回到式 <img src="https://www.zhihu.com/equation?tex=%2814%29" alt="[公式]"> 这个问题中：</p>
<p><img src="https://www.zhihu.com/equation?tex=%5Cmin+J%28%5Cpmb%7Bw%7D%29+%3D+-%5Cfrac%7B1%7D%7Bm%7D%5Csum_%7Bi%3D1%7D%5Em%5By_%7Bi%7D%5Csum_%7Bj%3D1%7D%5Enw_i%5Ccdot+x_%7Bi%7D%5E%7B%28j%29%7D+-+ln%281%2B%5Cexp%28%5Csum_%7Bj%3D1%7D%5Enw_i%5Ccdot+x_%7Bi%7D%5E%7B%28j%29%7D%29%5D+%5Ctag%7B17%7D" alt="[公式]"></p>
<p>我们不断重复这一过程：达到某个点 <img src="https://www.zhihu.com/equation?tex=k" alt="[公式]"> 后，继续计算下一个点 <img src="https://www.zhihu.com/equation?tex=%7Bk%2B1%7D" alt="[公式]"> ：</p>
<p><img src="https://www.zhihu.com/equation?tex=+w%5E%7Bk%2B1%7D_i+%3Dw%5Ek_i-%5Clambda++%5Cfrac%7B%5Cpartial+J%28%5Ctextbf%7Bw%7D%29%7D+%7B%5Cpartial+w_i%7D+%5Ctag%7B18%7D" alt="[公式]"></p>
<p>那么，这个迭代过程何时才能停止呢？一般满足以下任意条件即可：</p>
<ul>
<li>达到迭代次数上限： <img src="https://www.zhihu.com/equation?tex=k+%3D+k_%7Bmax%7D" alt="[公式]"></li>
<li>学习曲线变化很小：<img src="https://www.zhihu.com/equation?tex=+%7C%7CJ%28w%5E%7Bk%2B1%7D%29%E2%88%92J%28w%5Ek%29%7C%7C+" alt="[公式]"> 小于阈值。</li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://powerlzy.github.io/posts/DMQR7N/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/cat_mac.jpg">
      <meta itemprop="name" content="lzy">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="PowerLZY's Blog">
      <meta itemprop="description" content="相比到达的地方，同行的人更重要！">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | PowerLZY's Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/posts/DMQR7N/" class="post-title-link" itemprop="url">风控算法（1）业务风控常用算法归纳</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2022-07-01 10:56:13" itemprop="dateCreated datePublished" datetime="2022-07-01T10:56:13+08:00">2022-07-01</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2023-04-19 17:07:07" itemprop="dateModified" datetime="2023-04-19T17:07:07+08:00">2023-04-19</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E3%80%90draft%E3%80%91%E5%BA%94%E7%94%A8/" itemprop="url" rel="index"><span itemprop="name">【draft】应用</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E3%80%90draft%E3%80%91%E5%BA%94%E7%94%A8/%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF/" itemprop="url" rel="index"><span itemprop="name">应用场景</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E3%80%90draft%E3%80%91%E5%BA%94%E7%94%A8/%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF/%E4%B8%9A%E5%8A%A1%E5%AE%89%E5%85%A8/" itemprop="url" rel="index"><span itemprop="name">业务安全</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>2.3k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>4 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2><span id="业务风控常用算法归纳">业务风控常用算法归纳</span></h2>
<blockquote>
<p><strong>风控碎碎念</strong>：<a target="_blank" rel="noopener" href="https://www.zhihu.com/column/c_1483570023214510080">https://www.zhihu.com/column/c_1483570023214510080</a></p>
<p><strong>求是汪在路上</strong>：<a target="_blank" rel="noopener" href="https://www.zhihu.com/column/c_1156982447794233344">https://www.zhihu.com/column/c_1156982447794233344</a></p>
</blockquote>
<h4><span id="前言">前言</span></h4>
<p>本篇文章在这里主要是做一个综述性的文章简单介绍一下，做一个归纳性质的文章：<strong>风控最核心的算法，按我的理解可以分解为以下几类</strong></p>
<ul>
<li><strong>有监督的去评价用户各个场景的风险层级</strong>：欺诈类风险，信用类风险等；给用户一个评分，作为用户后续策略的基础；【LR、XGB、LGB】</li>
<li><strong>无监督的去挖掘用户的社区关系</strong>：社区发现类算法，最主要的适用于数据标签的扩散，通过用户的相似性或者用户的关联性，达到增加覆盖的目的</li>
<li><strong>发现数据中的异常值</strong>：往往用于日常的风险感知和监控之中，可以有最简单的箱线图，也可以有单分类的孤立森林；</li>
<li><strong>行为序列的发现</strong>：最简单的可以是频繁项集，复杂的可以用各类用于序列挖掘的深度学习模型，可以作为模型的一个特征，也可以作为风险行为的发现；</li>
<li><strong>内容风控中</strong>：往往从正则和规则开始，有复杂的深度学习模型来cover，这一块了解较少；</li>
</ul>
<h3><span id="一-风控算法场景">一、风控算法场景</span></h3>
<h4><span id="11-用于用户风险评级的算法">1.1 用于用户风险评级的算法</span></h4>
<p>这里不考虑<strong>冷启动阶段</strong>所涉及的一些专家规则和头脑风暴，一般评级往往存在于项目运行了一段时间，有了比较可靠的数据积累之后，这时候往往需要我们更精确的根据场景进行用户的划分，最为人熟知的便是信贷中常用的信用分的那一套东西，这一块的知识，我常常是看这个博主 <strong>求是汪在路上</strong>；这一块的算法或者说这一类的算法，这位大佬讲的已经十分清楚了，有兴趣的可以翻出来看看；</p>
<p>**<font color="red"> 这一类的算法，主要是以有监督为准，难点主要集中在，正负样本不平衡，正负样本的选择，样本的观察期，表现期，观察点等的选择。</font>**一般涉及到的算法，主要以lr，xgb为主，那么在实际使用中，xgb和lightGBM因为其效果出色，特征工程的东西往往比较简单，往往在使用中用的更多一些。</p>
<p>这一类场景，往往目标相对明确，用途相对明确，做起来，工作量主要集中在特征工程上，一般来说特征工程做好了，这一类模型都可以做出还可以的效果；</p>
<h4><span id="12-用于社区挖掘的算法">1.2 用于社区挖掘的算法</span></h4>
<p><strong>社区挖掘，其实和聚类有点点像，也有点像推荐中的基于用户相似的推荐</strong>，本质就是将有关系，有联系的各类用户放到一起，用以达到用户分群的目的，这一块写的比较好的文章，我推荐：</p>
<ol>
<li>怎么去找边与边之间的关联：</li>
</ol>
<ul>
<li><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/471165448">小伍哥聊风控：风控中团伙挖掘的14大关系类型</a></li>
<li><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/33164335">今晚的风儿很喧嚣：推荐算法入门（1）相似度计算方法大全</a></li>
</ul>
<p>2、 社区挖掘的算法有哪些：</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/141401358">马东什么：社区发现算法综述</a></li>
<li><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/397573443">Shirley：基于深度学习的社区发现综述</a></li>
</ul>
<p>基本社区发现就是在于如何发现用户之间，边与边之间的关系，可以是直接关系可以是相似关系，然后将边连成图，进行图挖掘，一般来说一个庞大的图大多数会先选择做连通图，再到连通图下做二次挖掘，用以增速提效。<strong>前期的数据探索，我比较推荐gephi软件，如果你习惯用python，networkx也是很好的选择，你只需要定义好点和边，便可以大致看出数据的分布和图的密度，选择合适的算法进行愉快的聚类咯。</strong></p>
<p>其实这一块，我觉得和推荐场景有一点点像，推荐是猜你喜欢，风控是猜你会干坏事，只是标签不一样，要做的事情是一样的，所有用于推荐相关的算法，也可以类比的用于风控，往往会有<strong>出其不意的效果</strong>；</p>
<h4><span id="13-异常值相关的发现算法">1.3 异常值相关的发现算法</span></h4>
<p>异常值算法，其实和不平衡数据集(pu-learning)的解决方法类似，因为对于风控来讲，风控本身针对的用户在平台或者在用户群中，占比就非常非常低，部分场景可能连千分之一，万分之一都不到，对于大数据集来讲，本身就算是一种<strong>异常值</strong>了，所以往往异常值发现的算法，在实际使用当中，往往会有意想不到的好效果；</p>
<p>说到异常值发现，日常的监控可能是一个方面，比如同比环比，比例异常，用户群占比异常等；除此之外还有一些，xgbod，iforest的半监督或者单分类的模型可以用于此类场景，这类场景，推荐可以参考：</p>
<p><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/368352445">xiaobo Xie：异常检测用于不平衡数据的二分类</a></p>
<p>我个人觉得这是一类对于风控来讲非常好的思考方式，就<strong>是当我们很难刻画黑用户的特征的时候，我们能尽可能好的描述好白用户的特征</strong>，我们一样可以解决问题，这一类问题的模型解决也往往是朝着这个思路来做的；</p>
<h4><span id="14-行为序列相关的算法">1.4 行为序列相关的算法</span></h4>
<p>行为序列作为风控行为挖掘的重要组成部分，在部分场景往往有着意想不到的作用，举个例子，电商场景，正常人从搜索到下单，<strong>往往有着复杂的序列，至少大部分用户会有复杂的序列</strong>，而黑灰产往往会点击某些固定的链接直接进入商详，或者搜索固定的词进入商品，下单购买一气呵成，而如果一个非营销类商品大多数聚集着这样的序列，可能往往就存在一些问题，如果这个问题深入探讨下去，便是行为序列的挖掘；</p>
<p>从简入深，可以有<strong>频繁项集</strong>(前后无关联，只要频繁反复出现某类行为即为有问题)，往深了做，可以<strong>有rnn及其改进的lstm</strong>相关的算法，进行进一步的建模，可以更加准确。在业务前期，我们可以先用频繁项集提取一些有价值的规则，在满足前期需求之后，可以进一步使用模型对当前场景进行优化，已达到提升召回和准确的作用。</p>
<p>同样我也在这里推荐一篇知乎上的文章：</p>
<p><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/420995638">没什么大不了：浅谈行为序列建模</a></p>
<h4><span id="15-内容风控相关算法">1.5 <strong>内容风控相关算法</strong></span></h4>
<p>这一部分是我的一个知识盲区，我自己大约只能做到正则，基于同义词的正则相关的策略，其余更深入的算法探索，我没有做过，也没有相关经验，也就不班门弄斧了，毕业以来做深度学习的东西比较少，理论大约停留在表面，不太深入，也没做过什么实践，就不赘述了；网上也没找到什么比较深入探讨的资料，如果有小伙伴推荐的话，我也希望可以评论或者私信告知，不甚荣幸。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://powerlzy.github.io/posts/28N4D7Y/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/cat_mac.jpg">
      <meta itemprop="name" content="lzy">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="PowerLZY's Blog">
      <meta itemprop="description" content="相比到达的地方，同行的人更重要！">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | PowerLZY's Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/posts/28N4D7Y/" class="post-title-link" itemprop="url">深度学习-GNN（4）【Nan】GCN</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2022-06-30 16:09:49" itemprop="dateCreated datePublished" datetime="2022-06-30T16:09:49+08:00">2022-06-30</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2022-07-11 17:21:23" itemprop="dateModified" datetime="2022-07-11T17:21:23+08:00">2022-07-11</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E7%AE%97%E6%B3%95/" itemprop="url" rel="index"><span itemprop="name">算法</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E7%AE%97%E6%B3%95/%E3%80%90draft%E3%80%91%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/" itemprop="url" rel="index"><span itemprop="name">【draft】深度学习</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E7%AE%97%E6%B3%95/%E3%80%90draft%E3%80%91%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/GNN/" itemprop="url" rel="index"><span itemprop="name">GNN</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>0</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>1 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




  <nav class="pagination">
    <a class="extend prev" rel="prev" title="上一页" aria-label="上一页" href="/page/5/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/5/">5</a><span class="page-number current">6</span><a class="page-number" href="/page/7/">7</a><span class="space">&hellip;</span><a class="page-number" href="/page/27/">27</a><a class="extend next" rel="next" title="下一页" aria-label="下一页" href="/page/7/"><i class="fa fa-angle-right"></i></a>
  </nav>

</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 
  <span itemprop="copyrightYear">2023</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">lzy</span>
</div>
<div class="busuanzi-count">
    <span class="post-meta-item" id="busuanzi_container_site_uv">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="总访客量">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-item" id="busuanzi_container_site_pv">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="总访问量">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>

<!--
  <div class="powered-by">由 <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/pisces/" rel="noopener" target="_blank">NexT.Pisces</a> 强力驱动
  </div>-->
<!-- 网站运行时间的设置 -->
<span id="timeDate">载入天数...</span>
<span id="times">载入时分秒...</span>
<script>
    var now = new Date();
    function createtime() {
        var grt= new Date("03/01/2023 10:00:00"); //此处修改你的建站时间或者网站上线时间
        now.setTime(now.getTime()+250);
        days = (now - grt ) / 1000 / 60 / 60 / 24; dnum = Math.floor(days);
        hours = (now - grt ) / 1000 / 60 / 60 - (24 * dnum); hnum = Math.floor(hours);
        if(String(hnum).length ==1 ){hnum = "0" + hnum;} minutes = (now - grt ) / 1000 /60 - (24 * 60 * dnum) - (60 * hnum);
        mnum = Math.floor(minutes); if(String(mnum).length ==1 ){mnum = "0" + mnum;}
        seconds = (now - grt ) / 1000 - (24 * 60 * 60 * dnum) - (60 * 60 * hnum) - (60 * mnum);
        snum = Math.round(seconds); if(String(snum).length ==1 ){snum = "0" + snum;}
        document.getElementById("timeDate").innerHTML = "本站已安全运行 "+dnum+" 天 ";
        document.getElementById("times").innerHTML = hnum + " 小时 " + mnum + " 分 " + snum + " 秒.";
    }
setInterval("createtime()",250);
</script>

    </div>
  </footer>

  

  <a href="https://github.com/PowerLZY" class="github-corner" title="在 GitHub 上关注我" aria-label="在 GitHub 上关注我" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/next-boot.js"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-generator-searchdb/1.4.1/search.js" integrity="sha256-1kfA5uHPf65M5cphT2dvymhkuyHPQp5A53EGZOnOLmc=" crossorigin="anonymous"></script>
<script src="/js/third-party/search/local-search.js"></script>


  <script class="next-config" data-name="mermaid" type="application/json">{"enable":true,"theme":{"light":"default","dark":"dark"},"js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/mermaid/9.4.3/mermaid.min.js","integrity":"sha256-e0o3JYsdjqKajf9eOe22FhioYSz9WofRY4dLKo3F6do="}}</script>
  <script src="/js/third-party/tags/mermaid.js"></script>


  <script src="/js/third-party/pace.js"></script>

  
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>




  

  <script class="next-config" data-name="enableMath" type="application/json">true</script><script class="next-config" data-name="mathjax" type="application/json">{"enable":true,"tags":"all","js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/mathjax/3.2.2/es5/tex-mml-chtml.js","integrity":"sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI="}}</script>
<script src="/js/third-party/math/mathjax.js"></script>




        <script src="//cdn.jsdelivr.net/npm/js-base64/base64.min.js"></script>
        <script>
        const hasAttr = (e,a) => a.some(_=> e.attr(_)!==undefined);
        $('a').each(function() {
          const $this = $(this);
          if(hasAttr($this,["data-fancybox","ignore-external-link"])) return;
          const href = $this.attr('href');
          if (href && href.match('^((http|https|thunder|qqdl|ed2k|Flashget|qbrowser|ftp|rtsp|mms)://)')) {
            const strs = href.split('/');
            if (strs.length >= 3) {
                const host = strs[2];
                if (host !== 'powerlzy.github.io' || window.location.host) {
                    $this.attr('href', '/go.html?u='+Base64.encode(href)+'').attr('rel', 'external nofollow noopener noreferrer');
                    if (true) {
                        $this.attr('target', '_blank');
                    }
                }
            }
          }
        });
        </script></body>
</html>
